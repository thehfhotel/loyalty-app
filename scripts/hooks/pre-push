#!/bin/bash

# Lightweight Pre-Push Hook - ESLint and TypeCheck Only
# For faster pushes while maintaining code quality
# Tests and builds are handled by CI/CD pipeline

set -e  # Exit on any error

echo "üöÄ Pre-Push Quality Check (Lightweight)..."
echo "================================================"

# Color codes for output
RED='\033[0;31m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Check if we're in the project root
if [ ! -f "package.json" ] || [ ! -d "backend" ] || [ ! -d "frontend" ]; then
    echo -e "${RED}[ERROR]${NC} Must be run from project root directory"
    exit 1
fi

# 1. Backend TypeScript Check
echo -e "${BLUE}[1/4]${NC} Backend TypeScript check..."
if cd backend && npm run typecheck; then
    echo -e "${GREEN}‚úÖ Backend TypeScript passed${NC}"
else
    echo -e "${RED}‚ùå Backend TypeScript check failed${NC}"
    exit 1
fi
cd ..

# 2. Frontend TypeScript Check
echo -e "${BLUE}[2/4]${NC} Frontend TypeScript check..."
if cd frontend && npm run typecheck; then
    echo -e "${GREEN}‚úÖ Frontend TypeScript passed${NC}"
else
    echo -e "${RED}‚ùå Frontend TypeScript check failed${NC}"
    exit 1
fi
cd ..

# 3. Backend ESLint
echo -e "${BLUE}[3/4]${NC} Backend ESLint..."
if cd backend && npm run lint; then
    echo -e "${GREEN}‚úÖ Backend ESLint passed${NC}"
else
    echo -e "${RED}‚ùå Backend ESLint failed${NC}"
    exit 1
fi
cd ..

# 4. Frontend ESLint
echo -e "${BLUE}[4/4]${NC} Frontend ESLint..."
if cd frontend && npm run lint; then
    echo -e "${GREEN}‚úÖ Frontend ESLint passed${NC}"
else
    echo -e "${RED}‚ùå Frontend ESLint failed${NC}"
    exit 1
fi
cd ..

# Summary
echo ""
echo "================================================"
echo -e "${GREEN}üéâ All pre-push checks passed!${NC}"
echo -e "${GREEN}‚úÖ TypeScript compilation successful${NC}"
echo -e "${GREEN}‚úÖ ESLint checks passed${NC}"
echo ""
echo -e "${BLUE}üöÄ Push to remote is approved!${NC}"
echo "================================================"

exit 0
