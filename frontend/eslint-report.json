
> loyalty-frontend@4.0.1 lint
> eslint . --ext ts,tsx --report-unused-disable-directives --format=json

[{"filePath":"/Users/nut/loyalty-app/frontend/src/App.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is assigned a value but never used.","line":34,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":12},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":43,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":43,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[2201,2267],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":61,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":61,"endColumn":27,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[2983,3041],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":70,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":70,"endColumn":23,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[3302,3370],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":80,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":80,"endColumn":23,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[3747,3832],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":99,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":99,"endColumn":27,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[4567,4635],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":103,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":103,"endColumn":25,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[4727,4837],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":112,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":112,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5111,5386],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":120,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":120,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5429,5496],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';\nimport { Toaster } from 'react-hot-toast';\nimport { useTranslation } from 'react-i18next';\nimport { Suspense } from 'react';\nimport { useAuthStore } from './store/authStore';\nimport LoginPage from './pages/auth/LoginPage';\nimport RegisterPage from './pages/auth/RegisterPage';\nimport ResetPasswordPage from './pages/auth/ResetPasswordPage';\nimport OAuthSuccessPage from './pages/auth/OAuthSuccessPage';\nimport DashboardPage from './pages/DashboardPage';\nimport ProfilePage from './pages/ProfilePage';\nimport LoyaltyAdminPage from './pages/admin/LoyaltyAdminPage';\nimport CouponManagement from './pages/admin/CouponManagement';\nimport CouponWallet from './pages/coupons/CouponWallet';\nimport ProtectedRoute from './components/auth/ProtectedRoute';\nimport SessionManager from './components/auth/SessionManager';\nimport LanguageProvider from './components/LanguageProvider';\nimport DevTools from './components/dev/DevTools';\nimport SurveyList from './pages/surveys/SurveyList';\nimport TakeSurvey from './pages/surveys/TakeSurvey';\nimport SurveyDetailsPage from './pages/surveys/SurveyDetailsPage';\nimport SurveyManagement from './pages/admin/SurveyManagement';\nimport SurveyBuilderWithTranslation from './pages/admin/SurveyBuilderWithTranslation';\nimport SurveyAnalytics from './pages/admin/SurveyAnalytics';\nimport SurveyPreviewPage from './pages/admin/SurveyPreview';\nimport SurveyTemplates from './pages/admin/SurveyTemplates';\nimport SurveyInvitations from './pages/admin/SurveyInvitations';\nimport ThaiSurveyDebug from './pages/admin/ThaiSurveyDebug';\nimport UserManagement from './pages/admin/UserManagement';\nimport NewMemberCouponSettings from './pages/admin/NewMemberCouponSettings';\nimport { useEffect, useState } from 'react';\n\nfunction App() {\n  const { t } = useTranslation();\n  const isAuthenticated = useAuthStore((state) => state.isAuthenticated);\n  const [isInitialized, setIsInitialized] = useState(false);\n  \n\n  useEffect(() => {\n    const initializeAuth = async () => {\n      // Set maximum timeout for initialization to prevent infinite loading\n      const initTimeout = setTimeout(() => {\n        console.warn('Auth initialization timeout - forcing app to load');\n        setIsInitialized(true);\n      }, 5000); // 5 second max timeout\n\n      try {\n        // Give Zustand persist time to rehydrate state from localStorage\n        await new Promise(resolve => setTimeout(resolve, 200));\n        \n        // Get current auth state after rehydration\n        const authStore = useAuthStore.getState();\n        \n        // Check for corrupted localStorage data and clear if needed\n        try {\n          const storedAuth = localStorage.getItem('auth-storage');\n          if (storedAuth) {\n            const parsed = JSON.parse(storedAuth);\n            // Validate structure - if malformed, clear it\n            if (!parsed.state || typeof parsed.state !== 'object') {\n              console.warn('Corrupted auth storage detected, clearing');\n              localStorage.removeItem('auth-storage');\n              authStore.clearAuth();\n              clearTimeout(initTimeout);\n              setIsInitialized(true);\n              return;\n            }\n          }\n        } catch (parseError) {\n          console.warn('Failed to parse auth storage, clearing:', parseError);\n          localStorage.removeItem('auth-storage');\n          authStore.clearAuth();\n          clearTimeout(initTimeout);\n          setIsInitialized(true);\n          return;\n        }\n        \n        // Quick consistency check - if inconsistent state, clear immediately\n        if (authStore.isAuthenticated && (!authStore.accessToken || !authStore.refreshToken)) {\n          console.warn('Auth state inconsistent (authenticated but missing tokens), clearing');\n          authStore.clearAuth();\n          clearTimeout(initTimeout);\n          setIsInitialized(true);\n          return;\n        }\n        \n        // If we have stored auth data, validate it with timeout\n        if (authStore.accessToken && authStore.refreshToken) {\n          try {\n            // Add timeout to auth validation to prevent hanging\n            const validationPromise = authStore.checkAuthStatus();\n            const timeoutPromise = new Promise((_, reject) => {\n              setTimeout(() => reject(new Error('Auth validation timeout')), 3000);\n            });\n            \n            const isValid = await Promise.race([validationPromise, timeoutPromise]);\n            \n            if (!isValid) {\n              console.warn('Stored auth tokens are invalid, clearing auth state');\n              authStore.clearAuth();\n            }\n          } catch (error) {\n            console.warn('Auth validation failed during initialization:', error instanceof Error ? error.message : error);\n            // Clear potentially corrupted auth state on any error\n            authStore.clearAuth();\n          }\n        }\n        \n        // Only log in development mode\n        if (import.meta.env?.DEV) {\n          const finalState = useAuthStore.getState();\n          console.log('App initialized. Final auth state:', { \n            isAuthenticated: finalState.isAuthenticated, \n            user: finalState.user?.email,\n            hasAccessToken: !!finalState.accessToken,\n            hasRefreshToken: !!finalState.refreshToken\n          });\n        }\n      } catch (error) {\n        console.error('Critical error during auth initialization:', error);\n        // Clear auth state on any critical error\n        useAuthStore.getState().clearAuth();\n      } finally {\n        // Always clear timeout and mark as initialized\n        clearTimeout(initTimeout);\n        setIsInitialized(true);\n      }\n    };\n    \n    initializeAuth();\n  }, []); // Only run once on mount\n\n  // Show loading while Zustand rehydrates from localStorage\n  if (!isInitialized) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600\" />\n          <p className=\"mt-4 text-gray-600\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <LanguageProvider>\n      <Suspense fallback={<div className=\"flex items-center justify-center min-h-screen\">Loading...</div>}>\n        <Router\n          future={{\n            v7_startTransition: true,\n            v7_relativeSplatPath: true,\n          }}\n        >\n          <SessionManager />\n          <Toaster \n            position=\"top-right\"\n            toastOptions={{\n              duration: 4000,\n              style: {\n                background: '#363636',\n                color: '#fff',\n              },\n            }}\n          />\n          <Routes>\n        {/* Public routes */}\n        <Route\n          path=\"/login\"\n          element={!isAuthenticated ? <LoginPage /> : <Navigate to=\"/dashboard\" />}\n        />\n        <Route\n          path=\"/register\"\n          element={!isAuthenticated ? <RegisterPage /> : <Navigate to=\"/dashboard\" />}\n        />\n        <Route\n          path=\"/reset-password\"\n          element={!isAuthenticated ? <ResetPasswordPage /> : <Navigate to=\"/dashboard\" />}\n        />\n        <Route\n          path=\"/oauth/success\"\n          element={<OAuthSuccessPage />}\n        />\n\n        {/* Protected routes */}\n        <Route\n          path=\"/dashboard\"\n          element={\n            <ProtectedRoute>\n              <DashboardPage />\n            </ProtectedRoute>\n          }\n        />\n        <Route\n          path=\"/profile\"\n          element={\n            <ProtectedRoute>\n              <ProfilePage />\n            </ProtectedRoute>\n          }\n        />\n        <Route\n          path=\"/coupons\"\n          element={\n            <ProtectedRoute>\n              <CouponWallet />\n            </ProtectedRoute>\n          }\n        />\n        <Route\n          path=\"/surveys\"\n          element={\n            <ProtectedRoute>\n              <SurveyList />\n            </ProtectedRoute>\n          }\n        />\n        <Route\n          path=\"/surveys/:id/take\"\n          element={\n            <ProtectedRoute>\n              <TakeSurvey />\n            </ProtectedRoute>\n          }\n        />\n        <Route\n          path=\"/surveys/:id/details\"\n          element={\n            <ProtectedRoute>\n              <SurveyDetailsPage />\n            </ProtectedRoute>\n          }\n        />\n        <Route\n          path=\"/admin/loyalty\"\n          element={\n            <ProtectedRoute requiredRole=\"admin\">\n              <LoyaltyAdminPage />\n            </ProtectedRoute>\n          }\n        />\n        <Route\n          path=\"/admin/coupons\"\n          element={\n            <ProtectedRoute requiredRole=\"admin\">\n              <CouponManagement />\n            </ProtectedRoute>\n          }\n        />\n        <Route\n          path=\"/admin/users\"\n          element={\n            <ProtectedRoute requiredRole=\"admin\">\n              <UserManagement />\n            </ProtectedRoute>\n          }\n        />\n        <Route\n          path=\"/admin/surveys\"\n          element={\n            <ProtectedRoute requiredRole=\"admin\">\n              <SurveyManagement />\n            </ProtectedRoute>\n          }\n        />\n        <Route\n          path=\"/admin/surveys/create\"\n          element={\n            <ProtectedRoute requiredRole=\"admin\">\n              <SurveyBuilderWithTranslation />\n            </ProtectedRoute>\n          }\n        />\n        <Route\n          path=\"/admin/surveys/:id/edit\"\n          element={\n            <ProtectedRoute requiredRole=\"admin\">\n              <SurveyBuilderWithTranslation />\n            </ProtectedRoute>\n          }\n        />\n        <Route\n          path=\"/admin/surveys/:id/analytics\"\n          element={\n            <ProtectedRoute requiredRole=\"admin\">\n              <SurveyAnalytics />\n            </ProtectedRoute>\n          }\n        />\n        <Route\n          path=\"/admin/surveys/:id/preview\"\n          element={\n            <ProtectedRoute requiredRole=\"admin\">\n              <SurveyPreviewPage />\n            </ProtectedRoute>\n          }\n        />\n        <Route\n          path=\"/admin/surveys/templates\"\n          element={\n            <ProtectedRoute requiredRole=\"admin\">\n              <SurveyTemplates />\n            </ProtectedRoute>\n          }\n        />\n        <Route\n          path=\"/admin/surveys/:id/invitations\"\n          element={\n            <ProtectedRoute requiredRole=\"admin\">\n              <SurveyInvitations />\n            </ProtectedRoute>\n          }\n        />\n        <Route\n          path=\"/admin/surveys/debug/thai\"\n          element={\n            <ProtectedRoute requiredRole=\"admin\">\n              <ThaiSurveyDebug />\n            </ProtectedRoute>\n          }\n        />\n        <Route\n          path=\"/admin/new-member-coupons\"\n          element={\n            <ProtectedRoute requiredRole=\"admin\">\n              <NewMemberCouponSettings />\n            </ProtectedRoute>\n          }\n        />\n\n        {/* Default redirect */}\n        <Route path=\"/\" element={<Navigate to={isAuthenticated ? \"/dashboard\" : \"/login\"} />} />\n        \n        {/* Catch-all route for unknown paths - redirect based on auth status */}\n        <Route path=\"*\" element={<Navigate to={isAuthenticated ? \"/dashboard\" : \"/login\"} replace />} />\n          </Routes>\n          \n          {/* Development tools - only shows in development mode */}\n          <DevTools />\n        </Router>\n      </Suspense>\n    </LanguageProvider>\n  );\n}\n\nexport default App;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/LanguageProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/LanguageSwitcher.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":16,"column":79,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":16,"endColumn":81,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[582,584],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { FiGlobe, FiCheck } from 'react-icons/fi';\n\nconst languages = [\n  { code: 'en', name: 'English', flag: 'üá¨üáß' },\n  { code: 'th', name: '‡πÑ‡∏ó‡∏¢', flag: 'üáπüá≠' },\n  { code: 'zh-CN', name: '‰∏≠Êñá(ÁÆÄ‰Ωì)', flag: 'üá®üá≥' },\n];\n\nexport default function LanguageSwitcher() {\n  const { i18n } = useTranslation();\n  const [isOpen, setIsOpen] = useState(false);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n\n  const currentLanguage = languages.find(lang => lang.code === i18n.language) || languages[0];\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const handleLanguageChange = (languageCode: string) => {\n    i18n.changeLanguage(languageCode);\n    setIsOpen(false);\n    // Store the language preference\n    localStorage.setItem('i18nextLng', languageCode);\n  };\n\n  return (\n    <div className=\"relative\" ref={dropdownRef}>\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"flex items-center space-x-2 px-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors\"\n        aria-label=\"Change language\"\n      >\n        <FiGlobe className=\"h-4 w-4\" />\n        <span className=\"hidden sm:inline\">{currentLanguage.flag} {currentLanguage.name}</span>\n        <span className=\"sm:hidden\">{currentLanguage.flag}</span>\n      </button>\n\n      {isOpen && (\n        <div className=\"absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-50\">\n          <div className=\"py-1\" role=\"menu\" aria-orientation=\"vertical\" aria-labelledby=\"options-menu\">\n            {languages.map((language) => (\n              <button\n                key={language.code}\n                onClick={() => handleLanguageChange(language.code)}\n                className=\"flex items-center justify-between w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900\"\n                role=\"menuitem\"\n              >\n                <span className=\"flex items-center space-x-2\">\n                  <span>{language.flag}</span>\n                  <span>{language.name}</span>\n                </span>\n                {i18n.language === language.code && (\n                  <FiCheck className=\"h-4 w-4 text-primary-600\" />\n                )}\n              </button>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/admin/CouponAssignmentsModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isOpen' is defined but never used.","line":32,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":9},{"ruleId":"no-empty-pattern","severity":1,"message":"Unexpected empty object pattern.","line":35,"column":9,"nodeType":"ObjectPattern","messageId":"unexpected","endLine":35,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1912,1915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1912,1915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":65,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":65,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1925,1981],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadAssignments'. Either include it or remove the dependency array.","line":74,"column":6,"nodeType":"ArrayExpression","endLine":74,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [coupon.id, loadAssignments]","fix":{"range":[2161,2172],"text":"[coupon.id, loadAssignments]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3803,3806],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3803,3806],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":132,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":132,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3816,3867],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { couponService } from '../../services/couponService';\nimport { Coupon } from '../../types/coupon';\n\ninterface CouponAssignment {\n  userId: string;\n  firstName: string;\n  lastName: string;\n  email: string;\n  assignedCount: number;\n  usedCount: number;\n  availableCount: number;\n  latestAssignment: Date;\n}\n\ninterface CouponAssignmentSummary {\n  totalUsers: number;\n  totalAssigned: number;\n  totalUsed: number;\n  totalAvailable: number;\n}\n\ninterface CouponAssignmentsModalProps {\n  coupon: Coupon;\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst CouponAssignmentsModal: React.FC<CouponAssignmentsModalProps> = ({\n  coupon,\n  isOpen,\n  onClose\n}) => {\n  const { } = useTranslation();\n  const [assignments, setAssignments] = useState<CouponAssignment[]>([]);\n  const [summary, setSummary] = useState<CouponAssignmentSummary>({\n    totalUsers: 0,\n    totalAssigned: 0,\n    totalUsed: 0,\n    totalAvailable: 0\n  });\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [page, setPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [total, setTotal] = useState(0);\n  const [removingUserId, setRemovingUserId] = useState<string | null>(null);\n  const [showConfirmation, setShowConfirmation] = useState(false);\n  const [userToRemove, setUserToRemove] = useState<CouponAssignment | null>(null);\n  const limit = 10;\n\n  const loadAssignments = async (pageNum: number = 1) => {\n    try {\n      setLoading(true);\n      setError(null);\n      const result = await couponService.getCouponAssignments(coupon.id, pageNum, limit);\n      \n      setAssignments(result.assignments);\n      setSummary(result.summary);\n      setPage(result.page);\n      setTotalPages(result.totalPages);\n      setTotal(result.total);\n    } catch (err: any) {\n      console.error('Error loading coupon assignments:', err);\n      setError(err.response?.data?.message || 'Failed to load assignments');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    loadAssignments(1);\n  }, [coupon.id]);\n\n  const formatDate = (date: Date) => {\n    return new Date(date).toLocaleDateString(undefined, {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const getStatusBadge = (assignment: CouponAssignment) => {\n    const { usedCount, availableCount } = assignment;\n    if (availableCount > 0 && usedCount > 0) {\n      return (\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800\">\n          Partially Used\n        </span>\n      );\n    } else if (usedCount > 0) {\n      return (\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800\">\n          All Used\n        </span>\n      );\n    } else {\n      return (\n        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\n          Available\n        </span>\n      );\n    }\n  };\n\n  const handleRemoveClick = (assignment: CouponAssignment) => {\n    setUserToRemove(assignment);\n    setShowConfirmation(true);\n  };\n\n  const handleConfirmRemove = async () => {\n    if (!userToRemove) {return;}\n\n    try {\n      setRemovingUserId(userToRemove.userId);\n      setShowConfirmation(false);\n      \n      await couponService.revokeUserCouponsForCoupon(\n        coupon.id, \n        userToRemove.userId,\n        'Removed by admin from assignment management'\n      );\n      \n      // Reload assignments to reflect changes\n      await loadAssignments(page);\n      \n      setUserToRemove(null);\n    } catch (err: any) {\n      console.error('Error removing user coupons:', err);\n      setError(err.response?.data?.message || 'Failed to remove user coupons');\n    } finally {\n      setRemovingUserId(null);\n    }\n  };\n\n  const handleCancelRemove = () => {\n    setShowConfirmation(false);\n    setUserToRemove(null);\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden\">\n        {/* Header */}\n        <div className=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-xl font-semibold text-gray-900\">\n              Coupon Assignments\n            </h2>\n            <p className=\"text-sm text-gray-600 mt-1\">\n              {coupon.name} ({coupon.code})\n            </p>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 text-2xl font-bold\"\n          >\n            √ó\n          </button>\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 overflow-y-auto\">\n          {loading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\" />\n              <span className=\"ml-2 text-gray-600\">Loading assignments...</span>\n            </div>\n          ) : error ? (\n            <div className=\"p-6 text-center\">\n              <div className=\"text-red-600 mb-2\">‚ö†Ô∏è</div>\n              <p className=\"text-gray-600\">{error}</p>\n              <button\n                onClick={() => loadAssignments(page)}\n                className=\"mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700\"\n              >\n                Try Again\n              </button>\n            </div>\n          ) : assignments.length === 0 ? (\n            <div className=\"p-6 text-center\">\n              <div className=\"text-gray-400 mb-2\">üìã</div>\n              <p className=\"text-gray-600\">No users have been assigned this coupon yet.</p>\n            </div>\n          ) : (\n            <>\n              {/* Summary */}\n              <div className=\"px-6 py-4 bg-gray-50 border-b border-gray-200\">\n                <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 text-center\">\n                  <div>\n                    <div className=\"text-2xl font-bold text-blue-600\">{summary.totalUsers}</div>\n                    <div className=\"text-sm text-gray-600\">Total Users</div>\n                  </div>\n                  <div>\n                    <div className=\"text-2xl font-bold text-green-600\">\n                      {summary.totalAssigned}\n                    </div>\n                    <div className=\"text-sm text-gray-600\">Total Assigned</div>\n                  </div>\n                  <div>\n                    <div className=\"text-2xl font-bold text-gray-600\">\n                      {summary.totalUsed}\n                    </div>\n                    <div className=\"text-sm text-gray-600\">Used</div>\n                  </div>\n                  <div>\n                    <div className=\"text-2xl font-bold text-orange-600\">\n                      {summary.totalAvailable}\n                    </div>\n                    <div className=\"text-sm text-gray-600\">Available</div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Assignments Table */}\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-gray-200\">\n                  <thead className=\"bg-gray-50\">\n                    <tr>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        User\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        Email\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        Assigned\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        Used\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        Available\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        Status\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        Latest Assignment\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        Actions\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-gray-200\">\n                    {assignments.map((assignment) => (\n                      <tr key={assignment.userId} className=\"hover:bg-gray-50\">\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <div className=\"text-sm font-medium text-gray-900\">\n                            {assignment.firstName} {assignment.lastName}\n                          </div>\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <div className=\"text-sm text-gray-500\">\n                            {assignment.email}\n                          </div>\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <div className=\"text-sm font-semibold text-blue-600\">\n                            {assignment.assignedCount}\n                          </div>\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <div className=\"text-sm font-semibold text-gray-600\">\n                            {assignment.usedCount}\n                          </div>\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <div className=\"text-sm font-semibold text-orange-600\">\n                            {assignment.availableCount}\n                          </div>\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          {getStatusBadge(assignment)}\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                          {formatDate(assignment.latestAssignment)}\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                          {assignment.availableCount > 0 ? (\n                            <button\n                              onClick={() => handleRemoveClick(assignment)}\n                              disabled={removingUserId === assignment.userId}\n                              className=\"text-red-600 hover:text-red-900 disabled:opacity-50 disabled:cursor-not-allowed\"\n                            >\n                              {removingUserId === assignment.userId ? 'Removing...' : 'Remove'}\n                            </button>\n                          ) : (\n                            <span className=\"text-gray-400\">No coupons</span>\n                          )}\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </>\n          )}\n        </div>\n\n        {/* Footer with Pagination */}\n        {totalPages > 1 && (\n          <div className=\"px-6 py-4 border-t border-gray-200 bg-gray-50\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"text-sm text-gray-700\">\n                Page {page} of {totalPages} ({total} users)\n              </div>\n              <div className=\"flex space-x-2\">\n                <button\n                  onClick={() => loadAssignments(page - 1)}\n                  disabled={page <= 1}\n                  className=\"px-3 py-1 text-sm bg-white border border-gray-300 rounded text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  Previous\n                </button>\n                <button\n                  onClick={() => loadAssignments(page + 1)}\n                  disabled={page >= totalPages}\n                  className=\"px-3 py-1 text-sm bg-white border border-gray-300 rounded text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  Next\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Confirmation Dialog */}\n      {showConfirmation && userToRemove && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-lg p-6 max-w-md w-full mx-4\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\n              Confirm Coupon Removal\n            </h3>\n            <p className=\"text-gray-600 mb-6\">\n              Are you sure you want to remove all available coupons from {userToRemove.firstName} {userToRemove.lastName}? \n              This action will revoke {userToRemove.availableCount} coupon{userToRemove.availableCount > 1 ? 's' : ''} and cannot be undone.\n            </p>\n            <div className=\"flex space-x-3 justify-end\">\n              <button\n                onClick={handleCancelRemove}\n                className=\"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleConfirmRemove}\n                className=\"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700\"\n              >\n                Remove Coupons\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default CouponAssignmentsModal;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/auth/AuthLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/auth/GoogleLoginButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/auth/LineLoginButton.tsx","messages":[{"ruleId":"security/detect-object-injection","severity":1,"message":"Variable Assigned to Object Injection Sink","line":34,"column":18,"nodeType":"MemberExpression","endLine":34,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useTranslation } from 'react-i18next';\n\ninterface LineLoginButtonProps {\n  onSuccess?: () => void;\n  onFailure?: () => void;\n  size?: 'small' | 'medium' | 'large';\n  variant?: 'signIn' | 'continue';\n}\n\nexport default function LineLoginButton({ size = 'medium', variant = 'signIn' }: LineLoginButtonProps) {\n  const { t } = useTranslation();\n  \n  const handleLineClick = () => {\n    const oauthUrl = `${import.meta.env.VITE_API_URL}/oauth/line`;\n    // Redirect to backend OAuth endpoint\n    window.location.href = oauthUrl;\n  };\n\n  // Official LINE branding guidelines colors\n  const lineColors = {\n    base: '#06C755',\n    hover: '#05B04A', // Base + 10% black opacity approximation\n    pressed: '#048A3D', // Base + 30% black opacity approximation\n    disabled: '#FFFFFF'\n  };\n\n  // Size configurations\n  const sizeConfigs = {\n    small: { height: '36px', fontSize: '12px', iconSize: '16' },\n    medium: { height: '44px', fontSize: '14px', iconSize: '20' },\n    large: { height: '52px', fontSize: '16px', iconSize: '24' }\n  };\n\n  const config = sizeConfigs[size];\n\n  return (\n    <button\n      onClick={handleLineClick}\n      className=\"w-full flex justify-center items-center rounded-md shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500\"\n      style={{\n        backgroundColor: lineColors.base,\n        border: 'none',\n        color: '#FFFFFF',\n        fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif',\n        fontSize: config.fontSize,\n        fontWeight: '600',\n        height: config.height,\n        padding: '0 16px'\n      }}\n      onMouseOver={(e) => {\n        e.currentTarget.style.backgroundColor = lineColors.hover;\n      }}\n      onMouseOut={(e) => {\n        e.currentTarget.style.backgroundColor = lineColors.base;\n      }}\n      onMouseDown={(e) => {\n        e.currentTarget.style.backgroundColor = lineColors.pressed;\n      }}\n      onMouseUp={(e) => {\n        e.currentTarget.style.backgroundColor = lineColors.hover;\n      }}\n    >\n      {/* Official LINE logo SVG */}\n      <svg\n        width={config.iconSize}\n        height={config.iconSize}\n        viewBox=\"0 0 24 24\"\n        className=\"mr-2\"\n        style={{ flexShrink: 0 }}\n        fill=\"white\"\n      >\n        <path d=\"M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63h2.386c.349 0 .63.285.63.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.2 0-.395-.078-.546-.207l-2.05-1.742v2.948c0 .348-.281.63-.631.63-.345 0-.626-.282-.626-.63V8.108c0-.27.173-.51.43-.595.063-.022.132-.032.199-.032.2 0 .394.078.545.207l2.05 1.742V6.482c0-.349.281-.63.63-.63.351 0 .63.281.63.63v4.397zm-5.741 0c0 .348-.282.63-.631.63-.345 0-.627-.282-.627-.63V8.108c0-.345.282-.63.627-.63.349 0 .631.285.631.63v4.771zm-2.466.629H4.917c-.345 0-.63-.282-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.281.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.774.039 1.085l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314\" />\n      </svg>\n      {variant === 'signIn' ? t('auth.signInWithLine') : t('auth.continueWithLine')}\n    </button>\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/auth/ProtectedRoute.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":31,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":31,"endColumn":23,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[1125,1192],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":69,"column":31,"nodeType":"MemberExpression","endLine":69,"endColumn":58}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Navigate, useLocation } from 'react-router-dom';\nimport { useAuthStore } from '../../store/authStore';\nimport { ReactNode, useEffect } from 'react';\n\ninterface ProtectedRouteProps {\n  children: ReactNode;\n  requiredRole?: 'customer' | 'staff' | 'admin' | 'super_admin';\n  redirectTo?: string;\n}\n\nexport default function ProtectedRoute({ \n  children, \n  requiredRole,\n  redirectTo = '/login' \n}: ProtectedRouteProps) {\n  const isAuthenticated = useAuthStore((state) => state.isAuthenticated);\n  const user = useAuthStore((state) => state.user);\n  const accessToken = useAuthStore((state) => state.accessToken);\n  const isLoading = useAuthStore((state) => state.isLoading);\n  const checkAuthStatus = useAuthStore((state) => state.checkAuthStatus);\n  const location = useLocation();\n\n  // Verify authentication on mount and when tokens change\n  useEffect(() => {\n    const verifyAuth = async () => {\n      // Only check if we think we're authenticated but don't have valid data\n      if (isAuthenticated && (!user || !accessToken)) {\n        try {\n          await checkAuthStatus();\n        } catch (error) {\n          console.warn('Auth verification failed in ProtectedRoute:', error);\n          // Auth state will be cleared by checkAuthStatus on failure\n        }\n      }\n    };\n\n    verifyAuth();\n  }, [isAuthenticated, user, accessToken, checkAuthStatus]);\n\n  // Show loading while auth is being verified\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\" />\n          <p className=\"mt-4 text-gray-600\">Verifying authentication...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Not authenticated - redirect to login with return URL\n  if (!isAuthenticated || !user || !accessToken) {\n    // Save the attempted location for redirect after login\n    const returnUrl = location.pathname + location.search;\n    return <Navigate to={`${redirectTo}?returnUrl=${encodeURIComponent(returnUrl)}`} replace />;\n  }\n\n  // Check role requirements if specified\n  if (requiredRole && user) {\n    const roleHierarchy = {\n      'customer': 0,\n      'staff': 1,\n      'admin': 2,\n      'super_admin': 3\n    };\n\n    const userRoleLevel = roleHierarchy[user.role] || 0;\n    const requiredRoleLevel = roleHierarchy[requiredRole] || 0;\n\n    // User doesn't have sufficient role\n    if (userRoleLevel < requiredRoleLevel) {\n      return (\n        <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <h3 className=\"text-lg font-medium text-gray-900\">Access Denied</h3>\n            <p className=\"mt-2 text-sm text-gray-500\">\n              You need {requiredRole.replace('_', ' ')} privileges to access this page.\n            </p>\n            <button\n              onClick={() => window.history.back()}\n              className=\"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n            >\n              Go Back\n            </button>\n          </div>\n        </div>\n      );\n    }\n  }\n\n  // User is authenticated and has required role (if any)\n  return <>{children}</>;\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/auth/SessionManager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/common/EmailDisplay.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Link } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { FiMail } from 'react-icons/fi';\n\ninterface EmailDisplayProps {\n  email?: string | null;\n  linkToProfile?: boolean;\n  className?: string;\n  showIcon?: boolean;\n}\n\nexport default function EmailDisplay({ \n  email, \n  linkToProfile = true, \n  className = '',\n  showIcon = false \n}: EmailDisplayProps) {\n  const { t } = useTranslation();\n\n  if (!email) {\n    return linkToProfile ? (\n      <Link \n        to=\"/profile?tab=settings\"\n        className={`text-blue-600 hover:text-blue-800 underline inline-flex items-center ${className}`}\n      >\n        {showIcon && <FiMail className=\"w-4 h-4 mr-1\" />}\n        {t('profile.addEmailAddress')}\n      </Link>\n    ) : (\n      <span className={`text-gray-400 italic ${className}`}>\n        {t('profile.noEmailProvided')}\n      </span>\n    );\n  }\n\n  return (\n    <span className={`text-gray-900 inline-flex items-center ${className}`}>\n      {showIcon && <FiMail className=\"w-4 h-4 mr-1 text-gray-500\" />}\n      {email}\n    </span>\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/coupons/CouponCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/coupons/CouponDetailsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/coupons/CouponScanner.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[960,963],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[960,963],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":40,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":40,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1607,1653],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-alert","severity":1,"message":"Unexpected alert.","line":41,"column":7,"nodeType":"CallExpression","messageId":"unexpected","endLine":41,"endColumn":38},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":1,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":47,"column":9,"nodeType":null,"messageId":"preferOptionalChain","endLine":47,"endColumn":55,"suggestions":[{"fix":{"range":[1771,1817],"text":"videoRef.current?.srcObject"},"messageId":"optionalChainSuggest","desc":"Change to an optional chain."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'startCamera'. Either include it or remove the dependency array.","line":63,"column":6,"nodeType":"ArrayExpression","endLine":63,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [scanMode, startCamera]","fix":{"range":[2175,2185],"text":"[scanMode, startCamera]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2475,2478],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2475,2478],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":76,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":76,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2488,2535],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-alert","severity":1,"message":"Unexpected alert.","line":107,"column":7,"nodeType":"CallExpression","messageId":"unexpected","endLine":107,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4208,4211],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4208,4211],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":140,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":140,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4221,4267],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { RedeemCouponRequest, RedeemCouponResponse } from '../../types/coupon';\nimport { couponService } from '../../services/couponService';\n\ninterface CouponScannerProps {\n  onRedemptionComplete?: (result: RedeemCouponResponse) => void;\n  onClose?: () => void;\n  className?: string;\n}\n\nconst CouponScanner: React.FC<CouponScannerProps> = ({\n  onRedemptionComplete,\n  onClose,\n  className = ''\n}) => {\n  const { t } = useTranslation();\n  const [scanMode, setScanMode] = useState<'camera' | 'manual'>('manual');\n  const [qrCode, setQrCode] = useState('');\n  const [originalAmount, setOriginalAmount] = useState<string>('');\n  const [transactionReference, setTransactionReference] = useState('');\n  const [location, setLocation] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [validationResult, setValidationResult] = useState<any>(null);\n  const [redemptionResult, setRedemptionResult] = useState<RedeemCouponResponse | null>(null);\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const [cameraActive, setCameraActive] = useState(false);\n\n  // Camera functionality (simplified - in production, use a proper QR code scanner library)\n  const startCamera = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ \n        video: { facingMode: 'environment' } // Use back camera on mobile\n      });\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        setCameraActive(true);\n      }\n    } catch (err) {\n      console.error('Error accessing camera:', err);\n      alert(t('coupons.cameraError'));\n      setScanMode('manual');\n    }\n  };\n\n  const stopCamera = () => {\n    if (videoRef.current && videoRef.current.srcObject) {\n      const stream = videoRef.current.srcObject as MediaStream;\n      stream.getTracks().forEach(track => track.stop());\n      videoRef.current.srcObject = null;\n      setCameraActive(false);\n    }\n  };\n\n  useEffect(() => {\n    if (scanMode === 'camera') {\n      startCamera();\n    } else {\n      stopCamera();\n    }\n\n    return () => stopCamera();\n  }, [scanMode]);\n\n  const validateCoupon = async (code: string) => {\n    if (!code.trim()) {\n      setValidationResult(null);\n      return;\n    }\n\n    try {\n      setLoading(true);\n      const result = await couponService.validateCoupon(code.trim());\n      setValidationResult(result);\n    } catch (err: any) {\n      console.error('Error validating coupon:', err);\n      setValidationResult({\n        success: false,\n        valid: false,\n        message: err.response?.data?.message || t('errors.validationFailed')\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleQRCodeChange = (value: string) => {\n    setQrCode(value);\n    setRedemptionResult(null);\n    // Auto-validate when QR code is entered\n    if (value.length >= 8) { // Assuming minimum QR code length\n      validateCoupon(value);\n    } else {\n      setValidationResult(null);\n    }\n  };\n\n  const handleRedeemCoupon = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!qrCode.trim() || !originalAmount || !validationResult?.valid) {\n      return;\n    }\n\n    const amount = parseFloat(originalAmount);\n    if (isNaN(amount) || amount <= 0) {\n      alert(t('coupons.invalidAmount'));\n      return;\n    }\n\n    try {\n      setLoading(true);\n      \n      const request: RedeemCouponRequest = {\n        qrCode: qrCode.trim(),\n        originalAmount: amount,\n        transactionReference: transactionReference.trim() || undefined,\n        location: location.trim() || undefined,\n        metadata: {\n          redemptionChannel: 'staff_interface',\n          timestamp: new Date().toISOString()\n        }\n      };\n\n      const result = await couponService.redeemCoupon(request);\n      setRedemptionResult(result);\n      \n      if (result.success) {\n        // Reset form for next redemption\n        setQrCode('');\n        setOriginalAmount('');\n        setTransactionReference('');\n        setValidationResult(null);\n        \n        if (onRedemptionComplete) {\n          onRedemptionComplete(result);\n        }\n      }\n    } catch (err: any) {\n      console.error('Error redeeming coupon:', err);\n      const errorResult: RedeemCouponResponse = {\n        success: false,\n        message: err.response?.data?.message || t('errors.redemptionFailed'),\n        discountAmount: 0,\n        finalAmount: parseFloat(originalAmount) || 0\n      };\n      setRedemptionResult(errorResult);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Calculate preview of discount\n  const discountPreview = validationResult?.valid && originalAmount ? \n    couponService.calculateDiscount(validationResult.data, parseFloat(originalAmount)) : null;\n\n  return (\n    <div className={`bg-white rounded-lg shadow-lg ${className}`}>\n      {/* Header */}\n      <div className=\"flex items-center justify-between p-4 border-b\">\n        <h2 className=\"text-xl font-semibold text-gray-900\">\n          {t('coupons.scanCoupon')}\n        </h2>\n        {onClose && (\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 text-xl font-bold\"\n          >\n            √ó\n          </button>\n        )}\n      </div>\n\n      <div className=\"p-6\">\n        {/* Scan Mode Toggle */}\n        <div className=\"flex mb-6 bg-gray-100 rounded-lg p-1\">\n          <button\n            onClick={() => setScanMode('manual')}\n            className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${\n              scanMode === 'manual' \n                ? 'bg-white text-gray-900 shadow-sm' \n                : 'text-gray-600 hover:text-gray-900'\n            }`}\n          >\n            {t('coupons.manualEntry')}\n          </button>\n          <button\n            onClick={() => setScanMode('camera')}\n            className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${\n              scanMode === 'camera' \n                ? 'bg-white text-gray-900 shadow-sm' \n                : 'text-gray-600 hover:text-gray-900'\n            }`}\n          >\n            {t('coupons.scanCamera')}\n          </button>\n        </div>\n\n        {/* Camera View */}\n        {scanMode === 'camera' && (\n          <div className=\"mb-6\">\n            <video\n              ref={videoRef}\n              autoPlay\n              playsInline\n              className=\"w-full max-w-sm mx-auto rounded-lg bg-gray-100\"\n            />\n            {cameraActive && (\n              <p className=\"text-center text-sm text-gray-600 mt-2\">\n                {t('coupons.pointCameraAtQR')}\n              </p>\n            )}\n          </div>\n        )}\n\n        {/* Redemption Form */}\n        <form onSubmit={handleRedeemCoupon} className=\"space-y-4\">\n          {/* QR Code Input */}\n          <div>\n            <label htmlFor=\"qrCode\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n              {t('coupons.qrCode')} *\n            </label>\n            <input\n              type=\"text\"\n              id=\"qrCode\"\n              value={qrCode}\n              onChange={(e) => handleQRCodeChange(e.target.value)}\n              placeholder={t('coupons.enterQRCode')}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              required\n            />\n          </div>\n\n          {/* Validation Result */}\n          {validationResult && (\n            <div className={`p-3 rounded-md ${\n              validationResult.valid \n                ? 'bg-green-50 border border-green-200' \n                : 'bg-red-50 border border-red-200'\n            }`}\n            >\n              <div className={`flex items-center ${\n                validationResult.valid ? 'text-green-800' : 'text-red-800'\n              }`}\n              >\n                <span className=\"mr-2\">\n                  {validationResult.valid ? '‚úÖ' : '‚ùå'}\n                </span>\n                <span className=\"font-medium\">{validationResult.message}</span>\n              </div>\n              \n              {validationResult.valid && validationResult.data && (\n                <div className=\"mt-2 text-sm text-green-700\">\n                  <div className=\"font-medium\">{validationResult.data.name}</div>\n                  <div>{validationResult.data.description}</div>\n                  <div className=\"mt-1\">\n                    {t('coupons.value')}: {couponService.formatCouponValue(validationResult.data)}\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Original Amount */}\n          <div>\n            <label htmlFor=\"originalAmount\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n              {t('coupons.originalAmount')} *\n            </label>\n            <div className=\"relative\">\n              <span className=\"absolute left-3 top-2 text-gray-500\">$</span>\n              <input\n                type=\"number\"\n                id=\"originalAmount\"\n                value={originalAmount}\n                onChange={(e) => setOriginalAmount(e.target.value)}\n                placeholder=\"0.00\"\n                min=\"0\"\n                step=\"0.01\"\n                className=\"w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                required\n              />\n            </div>\n          </div>\n\n          {/* Discount Preview */}\n          {discountPreview && discountPreview.isValid && (\n            <div className=\"bg-blue-50 border border-blue-200 rounded-md p-3\">\n              <h4 className=\"font-medium text-blue-900 mb-2\">\n                {t('coupons.discountPreview')}\n              </h4>\n              <div className=\"space-y-1 text-sm\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-blue-700\">{t('coupons.originalAmount')}:</span>\n                  <span className=\"font-medium\">‡∏ø{parseFloat(originalAmount).toFixed(2)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-blue-700\">{t('coupons.discount')}:</span>\n                  <span className=\"font-medium text-green-600\">\n                    -‡∏ø{discountPreview.discountAmount.toFixed(2)}\n                  </span>\n                </div>\n                <div className=\"flex justify-between border-t border-blue-200 pt-1\">\n                  <span className=\"text-blue-900 font-medium\">{t('coupons.finalAmount')}:</span>\n                  <span className=\"font-bold text-blue-900\">\n                    ‡∏ø{discountPreview.finalAmount.toFixed(2)}\n                  </span>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Transaction Reference */}\n          <div>\n            <label htmlFor=\"transactionReference\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n              {t('coupons.transactionReference')}\n            </label>\n            <input\n              type=\"text\"\n              id=\"transactionReference\"\n              value={transactionReference}\n              onChange={(e) => setTransactionReference(e.target.value)}\n              placeholder={t('coupons.enterTransactionReference')}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          {/* Location */}\n          <div>\n            <label htmlFor=\"location\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n              {t('coupons.location')}\n            </label>\n            <input\n              type=\"text\"\n              id=\"location\"\n              value={location}\n              onChange={(e) => setLocation(e.target.value)}\n              placeholder={t('coupons.enterLocation')}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          {/* Submit Button */}\n          <button\n            type=\"submit\"\n            disabled={loading || !validationResult?.valid || !originalAmount}\n            className=\"w-full bg-blue-600 text-white py-3 px-4 rounded-md font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n          >\n            {loading ? t('common.processing') : t('coupons.redeemCoupon')}\n          </button>\n        </form>\n\n        {/* Redemption Result */}\n        {redemptionResult && (\n          <div className={`mt-6 p-4 rounded-md ${\n            redemptionResult.success \n              ? 'bg-green-50 border border-green-200' \n              : 'bg-red-50 border border-red-200'\n          }`}\n          >\n            <div className={`flex items-center mb-2 ${\n              redemptionResult.success ? 'text-green-800' : 'text-red-800'\n            }`}\n            >\n              <span className=\"mr-2 text-xl\">\n                {redemptionResult.success ? 'üéâ' : '‚ùå'}\n              </span>\n              <span className=\"font-medium\">{redemptionResult.message}</span>\n            </div>\n            \n            {redemptionResult.success && (\n              <div className=\"text-sm text-green-700 space-y-1\">\n                <div className=\"flex justify-between\">\n                  <span>{t('coupons.discountApplied')}:</span>\n                  <span className=\"font-medium\">\n                    ‡∏ø{redemptionResult.discountAmount.toFixed(2)}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>{t('coupons.customerPays')}:</span>\n                  <span className=\"font-bold text-lg\">\n                    ‡∏ø{redemptionResult.finalAmount.toFixed(2)}\n                  </span>\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default CouponScanner;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/coupons/QRCodeDisplay.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generateQRCodeDataURL' is assigned a value but never used.","line":22,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":30},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":48,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":48,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1377,1423],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":61,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":61,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1702,1741],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useRef } from 'react';\nimport { UserActiveCoupon } from '../../types/coupon';\nimport { useTranslation } from 'react-i18next';\nimport toast from 'react-hot-toast';\n\ninterface QRCodeDisplayProps {\n  coupon: UserActiveCoupon;\n  onClose?: () => void;\n  className?: string;\n}\n\nconst QRCodeDisplay: React.FC<QRCodeDisplayProps> = ({\n  coupon,\n  onClose,\n  className = ''\n}) => {\n  const { t } = useTranslation();\n  const qrCodeRef = useRef<HTMLDivElement>(null);\n\n  // Generate QR code data URL (simplified implementation)\n  // In a real implementation, you would use a QR code library like qrcode or react-qr-code\n  const generateQRCodeDataURL = (text: string): string => {\n    // This is a placeholder. In production, use a proper QR code library\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    if (!ctx) {return '';}\n\n    canvas.width = 200;\n    canvas.height = 200;\n    \n    // Simple placeholder pattern\n    ctx.fillStyle = '#000';\n    ctx.fillRect(0, 0, 200, 200);\n    ctx.fillStyle = '#fff';\n    ctx.font = '12px Arial';\n    ctx.textAlign = 'center';\n    ctx.fillText(text, 100, 100);\n    \n    return canvas.toDataURL();\n  };\n\n\n  const copyToClipboard = async () => {\n    try {\n      await navigator.clipboard.writeText(coupon.qrCode);\n      toast.success(t('coupons.qrCodeCopied'));\n    } catch (err) {\n      console.error('Failed to copy QR code:', err);\n    }\n  };\n\n  const shareQRCode = async () => {\n    if (navigator.share) {\n      try {\n        await navigator.share({\n          title: coupon.name,\n          text: `Use this coupon: ${coupon.code}`,\n          url: window.location.href\n        });\n      } catch (err) {\n        console.error('Failed to share:', err);\n      }\n    } else {\n      // Fallback to copying\n      copyToClipboard();\n    }\n  };\n\n  return (\n    <div className={`bg-white rounded-lg shadow-lg ${className}`}>\n      {/* Header */}\n      <div className=\"flex items-center justify-between p-4 border-b\">\n        <h3 className=\"text-lg font-semibold text-gray-900\">\n          {t('coupons.qrCode')}\n        </h3>\n        {onClose && (\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 text-xl font-bold\"\n          >\n            √ó\n          </button>\n        )}\n      </div>\n\n      {/* QR Code Content */}\n      <div className=\"p-6 text-center\">\n        {/* Coupon Info */}\n        <div className=\"mb-6\">\n          <h4 className=\"text-xl font-bold text-gray-900 mb-2\">\n            {coupon.name}\n          </h4>\n          <p className=\"text-gray-600 mb-2\">\n            {coupon.code}\n          </p>\n          {coupon.description && (\n            <p className=\"text-sm text-gray-500\">\n              {coupon.description}\n            </p>\n          )}\n        </div>\n\n        {/* QR Code */}\n        <div className=\"flex justify-center mb-6\" ref={qrCodeRef}>\n          <div className=\"bg-white p-4 rounded-lg shadow-inner border-2 border-gray-200\">\n            {/* Placeholder for QR code - in production, use a proper QR code library */}\n            <div className=\"w-48 h-48 bg-gray-100 border-2 border-dashed border-gray-300 flex items-center justify-center\">\n              <div className=\"text-center\">\n                <div className=\"text-2xl mb-2\">üì±</div>\n                <div className=\"text-xs text-gray-500 font-mono break-all px-2\">\n                  {coupon.qrCode}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Instructions */}\n        <div className=\"bg-blue-50 rounded-lg p-4 mb-6\">\n          <h5 className=\"font-medium text-blue-900 mb-2\">\n            {t('coupons.howToUse')}\n          </h5>\n          <ol className=\"text-sm text-blue-800 text-left space-y-1\">\n            <li>1. {t('coupons.showQRCode')}</li>\n            <li>2. {t('coupons.letStaffScan')}</li>\n            <li>3. {t('coupons.enjoyDiscount')}</li>\n          </ol>\n        </div>\n\n        {/* Coupon Details */}\n        <div className=\"text-left bg-gray-50 rounded-lg p-4 mb-6\">\n          <h5 className=\"font-medium text-gray-900 mb-2\">\n            {t('coupons.details')}\n          </h5>\n          <div className=\"space-y-2 text-sm\">\n            <div className=\"flex justify-between\">\n              <span className=\"text-gray-600\">{t('coupons.type')}:</span>\n              <span className=\"font-medium\">\n                {t(`coupons.types.${coupon.type}`)}\n              </span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-gray-600\">{t('coupons.value')}:</span>\n              <span className=\"font-medium text-green-600\">\n                {coupon.type === 'percentage' ? `${coupon.value}%` : \n                 coupon.type === 'fixed_amount' ? `${coupon.currency}${coupon.value}` :\n                 t(`coupons.types.${coupon.type}`)}\n              </span>\n            </div>\n            {coupon.minimumSpend && (\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-600\">{t('coupons.minimumSpend')}:</span>\n                <span className=\"font-medium\">\n                  {coupon.currency}{coupon.minimumSpend}\n                </span>\n              </div>\n            )}\n            {coupon.maximumDiscount && (\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-600\">{t('coupons.maximumDiscount')}:</span>\n                <span className=\"font-medium\">\n                  {coupon.currency}{coupon.maximumDiscount}\n                </span>\n              </div>\n            )}\n            {coupon.effectiveExpiry && (\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-600\">{t('coupons.expiresOn')}:</span>\n                <span className=\"font-medium\">\n                  {new Date(coupon.effectiveExpiry).toLocaleDateString()}\n                </span>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Terms and Conditions */}\n        {coupon.termsAndConditions && (\n          <div className=\"text-left bg-yellow-50 rounded-lg p-4 mb-6\">\n            <h5 className=\"font-medium text-yellow-900 mb-2\">\n              {t('coupons.termsAndConditions')}\n            </h5>\n            <p className=\"text-sm text-yellow-800\">\n              {coupon.termsAndConditions}\n            </p>\n          </div>\n        )}\n\n        {/* Action Buttons */}\n        <div className=\"flex space-x-3\">\n          <button\n            onClick={copyToClipboard}\n            className=\"flex-1 bg-gray-100 text-gray-700 py-2 px-4 rounded-md text-sm font-medium hover:bg-gray-200 transition-colors\"\n          >\n            {t('coupons.copyCode')}\n          </button>\n          <button\n            onClick={shareQRCode}\n            className=\"flex-1 bg-blue-600 text-white py-2 px-4 rounded-md text-sm font-medium hover:bg-blue-700 transition-colors\"\n          >\n            {t('coupons.share')}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default QRCodeDisplay;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/coupons/QRCodeModal.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":40,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":40,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1199,1249],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-alert","severity":1,"message":"Unexpected alert.","line":52,"column":7,"nodeType":"CallExpression","messageId":"unexpected","endLine":52,"endColumn":66},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":54,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":54,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1563,1613],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useRef, useState, useEffect } from 'react';\nimport { UserActiveCoupon } from '../../types/coupon';\nimport { useTranslation } from 'react-i18next';\nimport QRCode from 'qrcode';\n\ninterface QRCodeModalProps {\n  coupon: UserActiveCoupon;\n  onClose?: () => void;\n  className?: string;\n}\n\nconst QRCodeModal: React.FC<QRCodeModalProps> = ({\n  coupon,\n  onClose,\n  className = ''\n}) => {\n  const { t } = useTranslation();\n  const qrCodeRef = useRef<HTMLDivElement>(null);\n  const [qrCodeDataURL, setQrCodeDataURL] = useState<string>('');\n  const [isGeneratingQR, setIsGeneratingQR] = useState(true);\n\n  // Generate QR code when component mounts or coupon changes\n  useEffect(() => {\n    const generateQRCode = async () => {\n      try {\n        setIsGeneratingQR(true);\n        // Generate QR code with unique redemption ID for backend processing\n        const qrData = coupon.qrCode;\n        const dataURL = await QRCode.toDataURL(qrData, {\n          width: 256,\n          margin: 2,\n          color: {\n            dark: '#000000',\n            light: '#FFFFFF',\n          },\n          errorCorrectionLevel: 'M',\n        });\n        setQrCodeDataURL(dataURL);\n      } catch (error) {\n        console.error('Error generating QR code:', error);\n      } finally {\n        setIsGeneratingQR(false);\n      }\n    };\n\n    generateQRCode();\n  }, [coupon.qrCode]);\n\n  const copyToClipboard = async () => {\n    try {\n      await navigator.clipboard.writeText(coupon.code);\n      alert(t('coupons.couponCodeCopied', 'Coupon code copied!'));\n    } catch (err) {\n      console.error('Failed to copy coupon code:', err);\n    }\n  };\n\n\n  return (\n    <div className={`bg-white rounded-lg shadow-lg ${className}`}>\n      {/* Header */}\n      <div className=\"flex items-center justify-between p-4 border-b\">\n        <h3 className=\"text-lg font-semibold text-gray-900\">\n          {t('coupons.useCoupon')}\n        </h3>\n        {onClose && (\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 text-xl font-bold\"\n          >\n            √ó\n          </button>\n        )}\n      </div>\n\n      {/* QR Code Content */}\n      <div className=\"p-6 text-center\">\n        {/* Coupon Basic Info */}\n        <div className=\"mb-6\">\n          <h4 className=\"text-xl font-bold text-gray-900 mb-2\">\n            {coupon.name}\n          </h4>\n        </div>\n\n        {/* QR Code */}\n        <div className=\"flex flex-col items-center mb-6\" ref={qrCodeRef}>\n          <div className=\"bg-white p-6 rounded-lg shadow-inner border-2 border-gray-200 mb-4\">\n            {/* QR Code Display */}\n            <div className=\"w-64 h-64 flex items-center justify-center rounded-lg\">\n              {isGeneratingQR ? (\n                <div className=\"text-center\">\n                  <div className=\"text-4xl mb-3\">‚è≥</div>\n                  <div className=\"text-sm text-gray-600 font-semibold\">\n                    {t('coupons.generatingQR', 'Generating QR Code...')}\n                  </div>\n                </div>\n              ) : qrCodeDataURL ? (\n                <img \n                  src={qrCodeDataURL} \n                  alt={`QR Code for ${coupon.code}`}\n                  className=\"w-full h-full object-contain rounded-lg\"\n                />\n              ) : (\n                <div className=\"text-center\">\n                  <div className=\"text-4xl mb-3\">‚ùå</div>\n                  <div className=\"text-sm text-gray-600 font-semibold\">\n                    {t('coupons.qrError', 'Error generating QR code')}\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n          \n          {/* Coupon Code underneath */}\n          <div className=\"text-center\">\n            <div className=\"text-sm text-gray-600 mb-1 font-medium\">\n              {t('coupons.couponCode', 'Coupon Code')}\n            </div>\n            <div className=\"text-lg font-mono bg-gray-100 px-4 py-2 rounded-lg border\">\n              {coupon.code}\n            </div>\n          </div>\n        </div>\n\n        {/* Redemption Instructions */}\n        <div className=\"bg-blue-50 rounded-lg p-4 mb-6\">\n          <h5 className=\"font-medium text-blue-900 mb-3 flex items-center justify-center\">\n            <span className=\"mr-2\">üìã</span>\n            {t('coupons.howToUse')}\n          </h5>\n          <ol className=\"text-sm text-blue-800 text-left space-y-2\">\n            <li className=\"flex items-start\">\n              <span className=\"bg-blue-200 text-blue-800 rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold mr-3 mt-0.5\">1</span>\n              {t('coupons.showQRCode')}\n            </li>\n            <li className=\"flex items-start\">\n              <span className=\"bg-blue-200 text-blue-800 rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold mr-3 mt-0.5\">2</span>\n              {t('coupons.letStaffScan')}\n            </li>\n            <li className=\"flex items-start\">\n              <span className=\"bg-blue-200 text-blue-800 rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold mr-3 mt-0.5\">3</span>\n              {t('coupons.enjoyDiscount')}\n            </li>\n          </ol>\n        </div>\n\n        {/* Important Note */}\n        <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-3 mb-6\">\n          <p className=\"text-sm text-amber-800\">\n            <span className=\"font-semibold\">‚ö†Ô∏è {t('common.important')}:</span> {t('coupons.oneTimeUse')}\n          </p>\n        </div>\n\n        {/* Action Buttons */}\n        <div className=\"flex justify-center\">\n          <button\n            onClick={copyToClipboard}\n            className=\"bg-gray-100 text-gray-700 py-3 px-6 rounded-md text-sm font-medium hover:bg-gray-200 transition-colors flex items-center justify-center\"\n          >\n            <span className=\"mr-2\">üìã</span>\n            {t('coupons.copyCode')}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default QRCodeModal;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/dev/DevTools.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[444,447],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[444,447],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\n\n/**\n * Development tools component that shows helpful development information\n * Only renders in development mode\n */\nexport default function DevTools() {\n  const [showDevInfo, setShowDevInfo] = useState(false);\n\n  useEffect(() => {\n    // Only show in development mode\n    if (!import.meta.env?.DEV) {return;}\n\n    // Check if React DevTools is installed\n    const hasReactDevTools = !!(window as any).__REACT_DEVTOOLS_GLOBAL_HOOK__;\n    \n    if (!hasReactDevTools) {\n      // Show info about React DevTools only once per session\n      const hasShownDevTools = sessionStorage.getItem('react-devtools-info-shown');\n      if (!hasShownDevTools) {\n        setShowDevInfo(true);\n        sessionStorage.setItem('react-devtools-info-shown', 'true');\n      }\n    }\n  }, []);\n\n  // Don't render anything in production\n  if (!import.meta.env?.DEV || !showDevInfo) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed bottom-4 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-lg max-w-sm z-50\">\n      <div className=\"flex items-start space-x-2\">\n        <div className=\"flex-shrink-0\">\n          ‚öõÔ∏è\n        </div>\n        <div className=\"flex-1\">\n          <h4 className=\"font-semibold text-sm\">React DevTools</h4>\n          <p className=\"text-xs mt-1 opacity-90\">\n            Install React DevTools browser extension for better development experience\n          </p>\n          <div className=\"mt-2 flex space-x-2\">\n            <a\n              href=\"https://reactjs.org/link/react-devtools\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"text-xs bg-blue-500 hover:bg-blue-400 px-2 py-1 rounded\"\n            >\n              Install\n            </a>\n            <button\n              onClick={() => setShowDevInfo(false)}\n              className=\"text-xs bg-gray-600 hover:bg-gray-500 px-2 py-1 rounded\"\n            >\n              Dismiss\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/layout/MainLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/loyalty/PointsBalance.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FiTrendingUp' is defined but never used.","line":3,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { UserLoyaltyStatus } from '../../services/loyaltyService';\nimport { useTranslation } from 'react-i18next';\nimport { FiStar, FiTrendingUp } from 'react-icons/fi';\n\ninterface PointsBalanceProps {\n  loyaltyStatus: UserLoyaltyStatus;\n  // Legacy props kept for compatibility but no longer used since points never expire\n  expiringPoints?: number;\n  nextExpiryDate?: string | null;\n}\n\nexport default function PointsBalance({ \n  loyaltyStatus\n}: PointsBalanceProps) {\n  const { t } = useTranslation();\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-md p-6 border-l-4\" \n         style={{ borderLeftColor: loyaltyStatus.tier_color }}\n    >\n      <div className=\"flex items-center justify-between mb-4\">\n        <div className=\"flex items-center space-x-3\">\n          <div className=\"p-2 rounded-lg\" style={{ backgroundColor: `${loyaltyStatus.tier_color}20` }}>\n            <FiStar className=\"w-6 h-6\" style={{ color: loyaltyStatus.tier_color }} />\n          </div>\n          <div>\n            <h3 className=\"text-lg font-semibold text-gray-900\">\n              {t('loyalty.pointsBalance')}\n            </h3>\n            <p className=\"text-sm text-gray-600\">\n              {loyaltyStatus.tier_name} {t('loyalty.member')}\n            </p>\n          </div>\n        </div>\n        <div className=\"text-right\">\n          <div className=\"text-3xl font-bold\" style={{ color: loyaltyStatus.tier_color }}>\n            {loyaltyStatus.current_points.toLocaleString()}\n          </div>\n          <div className=\"text-sm text-gray-600\">\n            {t('loyalty.availablePoints')}\n          </div>\n        </div>\n      </div>\n\n      {/* Points never expire - no expiration display needed */}\n\n      {/* Tier Benefits Preview */}\n      <div className=\"border-t pt-4\">\n        <div className=\"text-sm font-medium text-gray-700 mb-2\">\n          {t('loyalty.tierBenefits')}\n        </div>\n        <div className=\"text-sm text-gray-600\">\n          {loyaltyStatus.tier_benefits?.description || t('loyalty.noDescription')}\n        </div>\n        {loyaltyStatus.tier_benefits?.perks && loyaltyStatus.tier_benefits.perks.length > 0 && (\n          <div className=\"mt-2\">\n            <ul className=\"text-xs text-gray-600 space-y-1\">\n              {loyaltyStatus.tier_benefits.perks.slice(0, 2).map((perk, index) => (\n                <li key={index} className=\"flex items-center space-x-1\">\n                  <span className=\"w-1.5 h-1.5 rounded-full\" \n                        style={{ backgroundColor: loyaltyStatus.tier_color }}\n                  />\n                  <span>{perk}</span>\n                </li>\n              ))}\n              {loyaltyStatus.tier_benefits.perks.length > 2 && (\n                <li className=\"text-gray-500\">\n                  +{loyaltyStatus.tier_benefits.perks.length - 2} {t('loyalty.moreBenefits')}\n                </li>\n              )}\n            </ul>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/loyalty/TierStatus.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":22,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":22,"endColumn":19,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[803,874],"text":""},"desc":"Remove the console.warn()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { UserLoyaltyStatus, Tier } from '../../services/loyaltyService';\nimport { useTranslation } from 'react-i18next';\nimport { FiChevronUp, FiAward } from 'react-icons/fi';\n\ninterface TierStatusProps {\n  loyaltyStatus: UserLoyaltyStatus;\n  allTiers: Tier[];\n}\n\nexport default function TierStatus({ loyaltyStatus, allTiers }: TierStatusProps) {\n  const { t } = useTranslation();\n\n  const currentTierIndex = allTiers.findIndex(tier => tier.name === loyaltyStatus.tier_name);\n  const isTopTier = currentTierIndex === allTiers.length - 1;\n\n  // Helper function to safely convert progress_percentage to number\n  const getProgressPercentage = () => {\n    try {\n      const percentage = Number(loyaltyStatus.progress_percentage);\n      return isNaN(percentage) ? 0 : percentage;\n    } catch (error) {\n      console.warn('Error converting progress_percentage to number:', error);\n      return 0;\n    }\n  };\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-md p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900\">\n          {t('loyalty.tierStatus')}\n        </h3>\n        <div className=\"flex items-center space-x-2\">\n          <FiAward className=\"w-5 h-5\" style={{ color: loyaltyStatus.tier_color }} />\n          <span className=\"font-medium\" style={{ color: loyaltyStatus.tier_color }}>\n            {loyaltyStatus.tier_name}\n          </span>\n        </div>\n      </div>\n\n      {/* Tier Progress */}\n      <div className=\"space-y-4\">\n        {allTiers.map((tier, index) => {\n          const isCurrentTier = tier.name === loyaltyStatus.tier_name;\n          const isCompleted = index < currentTierIndex || isCurrentTier;\n          const isNext = index === currentTierIndex + 1;\n\n          return (\n            <div key={tier.id} className=\"flex items-center space-x-4\">\n              {/* Tier Icon */}\n              <div className={`\n                w-10 h-10 rounded-full flex items-center justify-center border-2\n                ${isCompleted \n                  ? 'border-transparent' \n                  : isNext \n                    ? 'border-gray-300 border-dashed' \n                    : 'border-gray-200'\n                }\n              `}\nstyle={{\n                backgroundColor: isCompleted ? tier.color : isNext ? `${tier.color}20` : '#f9fafb'\n              }}\n              >\n                <FiAward className={`w-5 h-5 ${\n                  isCompleted ? 'text-white' : isNext ? 'text-gray-600' : 'text-gray-400'\n                }`}\n                />\n              </div>\n\n              {/* Tier Info */}\n              <div className=\"flex-1\">\n                <div className=\"flex items-center justify-between\">\n                  <span className={`font-medium ${\n                    isCurrentTier ? 'text-gray-900' : isCompleted ? 'text-gray-700' : 'text-gray-500'\n                  }`}\n                  >\n                    {tier.name}\n                  </span>\n                  <span className={`text-sm ${\n                    isCurrentTier ? 'text-gray-900' : 'text-gray-500'\n                  }`}\n                  >\n                    {tier.min_points === 0 ? t('loyalty.newMember') : `${tier.min_points}+ ${tier.min_points === 1 ? t('loyalty.night') : t('loyalty.nights')}`}\n                  </span>\n                </div>\n\n                {/* Progress Bar for Next Tier */}\n                {isNext && loyaltyStatus.progress_percentage !== null && (\n                  <div className=\"mt-2\">\n                    <div className=\"flex items-center justify-between text-xs text-gray-600 mb-1\">\n                      <span>\n                        {loyaltyStatus.nights_to_next_tier !== undefined && loyaltyStatus.nights_to_next_tier !== null\n                          ? `${loyaltyStatus.nights_to_next_tier} ${loyaltyStatus.nights_to_next_tier === 1 ? t('loyalty.nightToGo') : t('loyalty.nightsToGo')}`\n                          : `${loyaltyStatus.points_to_next_tier?.toLocaleString()} ${t('loyalty.pointsToGo')}`\n                        }\n                      </span>\n                      <span>\n                        {getProgressPercentage().toFixed(1)}%\n                      </span>\n                    </div>\n                    <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                      <div \n                        className=\"h-2 rounded-full transition-all duration-300\"\n                        style={{ \n                          width: `${getProgressPercentage()}%`,\n                          backgroundColor: tier.color\n                        }}\n                      />\n                    </div>\n                  </div>\n                )}\n\n                {/* Current Tier Indicator */}\n                {isCurrentTier && (\n                  <div className=\"mt-1 flex items-center space-x-1\">\n                    <div className=\"w-2 h-2 rounded-full\" style={{ backgroundColor: tier.color }} />\n                    <span className=\"text-xs text-gray-600\">{t('loyalty.currentTier')}</span>\n                  </div>\n                )}\n              </div>\n\n              {/* Next Tier Arrow */}\n              {isNext && (\n                <FiChevronUp className=\"w-4 h-4 text-gray-400\" />\n              )}\n            </div>\n          );\n        })}\n      </div>\n\n      {/* Next Tier Benefits Preview */}\n      {!isTopTier && loyaltyStatus.next_tier_name && (\n        <div className=\"mt-6 p-4 bg-gray-50 rounded-lg\">\n          <div className=\"text-sm font-medium text-gray-700 mb-2\">\n            {t('loyalty.nextTierBenefits', { tier: loyaltyStatus.next_tier_name })}\n          </div>\n          <div className=\"text-xs text-gray-600\">\n            {loyaltyStatus.nights_to_next_tier !== undefined && loyaltyStatus.nights_to_next_tier !== null\n              ? t('loyalty.unlockBenefitsNights', { nights: loyaltyStatus.nights_to_next_tier })\n              : t('loyalty.unlockBenefits', { points: loyaltyStatus.points_to_next_tier?.toLocaleString() })}\n          </div>\n        </div>\n      )}\n\n      {/* Top Tier Message */}\n      {isTopTier && (\n        <div className=\"mt-6 p-4 rounded-lg\" style={{ backgroundColor: `${loyaltyStatus.tier_color}10` }}>\n          <div className=\"text-sm font-medium\" style={{ color: loyaltyStatus.tier_color }}>\n            üéâ {t('loyalty.topTierMessage')}\n          </div>\n          <div className=\"text-xs text-gray-600 mt-1\">\n            {t('loyalty.topTierDescription')}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/loyalty/TransactionList.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sanitizeDescription' is assigned a value but never used.","line":38,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":38,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'points' is assigned a value but never used.","line":56,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":56,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatTransactionType' is assigned a value but never used.","line":86,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":86,"endColumn":30},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":97,"column":12,"nodeType":"MemberExpression","endLine":97,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { PointsTransaction } from '../../services/loyaltyService';\nimport { useTranslation } from 'react-i18next';\nimport { FiPlus, FiMinus, FiClock, FiUser } from 'react-icons/fi';\n\ninterface TransactionListProps {\n  transactions: PointsTransaction[];\n  isLoading?: boolean;\n  showLoadMore?: boolean;\n  onLoadMore?: () => void;\n  showAdminInfo?: boolean; // New prop to control admin info visibility\n}\n\nexport default function TransactionList({ \n  transactions, \n  isLoading = false, \n  showLoadMore = false, \n  onLoadMore,\n  showAdminInfo = false // Default to false - don't show admin info unless explicitly requested\n}: TransactionListProps) {\n  const { t } = useTranslation();\n\n  const getTransactionIcon = (points: number) => {\n    if (points > 0) {\n      return <FiPlus className=\"w-4 h-4 text-green-600\" />;\n    } else {\n      return <FiMinus className=\"w-4 h-4 text-red-600\" />;\n    }\n  };\n\n  const getTransactionColor = (points: number) => {\n    if (points > 0) {\n      return 'text-green-600';\n    } else {\n      return 'text-red-600';\n    }\n  };\n\n  const sanitizeDescription = (description: string | null) => {\n    if (!description) {return null;}\n    \n    // Remove any text that mentions spending amounts or THB\n    const lowercaseDesc = description.toLowerCase();\n    if (lowercaseDesc.includes('thb') || \n        lowercaseDesc.includes('baht') || \n        lowercaseDesc.includes('‡∏ø') ||\n        /\\d+\\s*(baht|thb)/i.test(description) ||\n        /spent.*\\d+/i.test(description)) {\n      return null; // Hide descriptions containing spending amounts\n    }\n    \n    return description;\n  };\n\n  const getPointsFocusedDescription = (transaction: PointsTransaction) => {\n    // Always focus on points gained/lost rather than any spending amounts\n    const points = Math.abs(transaction.points);\n    \n    if (transaction.points > 0) {\n      // Positive points - focus on earning\n      switch (transaction.type) {\n        case 'earned_stay':\n        case 'stay_earning':\n          return `${t('loyalty.transactionTypes.earnedStay')}`;\n        case 'earned_bonus':\n          return `${t('loyalty.transactionTypes.earnedBonus')}`;\n        case 'admin_award':\n          return `${t('loyalty.transactionTypes.adminAward')}`;\n        default:\n          return `${t('loyalty.pointsEarned')}`;\n      }\n    } else {\n      // Negative points - focus on usage/deduction\n      switch (transaction.type) {\n        case 'redeemed':\n          return `${t('loyalty.transactionTypes.redeemed')}`;\n        case 'expired':\n          return `${t('loyalty.transactionTypes.expired')}`;\n        case 'admin_deduction':\n          return `${t('loyalty.transactionTypes.adminDeduction')}`;\n        default:\n          return `${t('loyalty.pointsDeducted')}`;\n      }\n    }\n  };\n\n  const formatTransactionType = (type: string) => {\n    const typeMap: { [key: string]: string } = {\n      'earned_stay': t('loyalty.transactionTypes.earnedStay'),\n      'stay_earning': t('loyalty.transactionTypes.earnedStay'),\n      'earned_bonus': t('loyalty.transactionTypes.earnedBonus'),\n      'redeemed': t('loyalty.transactionTypes.redeemed'),\n      'expired': t('loyalty.transactionTypes.expired'),\n      'admin_adjustment': t('loyalty.transactionTypes.adminAdjustment'),\n      'admin_award': t('loyalty.transactionTypes.adminAward'),\n      'admin_deduction': t('loyalty.transactionTypes.adminDeduction'),\n    };\n    return typeMap[type] || type;\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('th-TH', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"bg-white rounded-lg shadow-md p-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\n          {t('loyalty.transactionHistory')}\n        </h3>\n        <div className=\"space-y-4\">\n          {[...Array(5)].map((_, index) => (\n            <div key={index} className=\"animate-pulse\">\n              <div className=\"flex items-center space-x-4\">\n                <div className=\"w-10 h-10 bg-gray-200 rounded-lg\" />\n                <div className=\"flex-1\">\n                  <div className=\"h-4 bg-gray-200 rounded w-1/2 mb-2\" />\n                  <div className=\"h-3 bg-gray-200 rounded w-1/3\" />\n                </div>\n                <div className=\"h-4 bg-gray-200 rounded w-16\" />\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-md p-6\">\n      <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\n        {t('loyalty.transactionHistory')}\n      </h3>\n\n      {transactions.length === 0 ? (\n        <div className=\"text-center py-8 text-gray-500\">\n          <FiClock className=\"w-12 h-12 mx-auto mb-3 text-gray-400\" />\n          <p>{t('loyalty.noTransactions')}</p>\n        </div>\n      ) : (\n        <div className=\"space-y-4\">\n          {transactions.map((transaction) => (\n            <div key={transaction.id} className=\"flex items-center space-x-4 py-3 border-b border-gray-100 last:border-b-0\">\n              {/* Transaction Icon */}\n              <div className={`\n                w-10 h-10 rounded-lg flex items-center justify-center\n                ${transaction.points > 0 ? 'bg-green-50' : 'bg-red-50'}\n              `}\n              >\n                {getTransactionIcon(transaction.points)}\n              </div>\n\n              {/* Transaction Details */}\n              <div className=\"flex-1 min-w-0\">\n                <div className=\"flex items-center justify-between\">\n                  <p className=\"font-medium text-gray-900 truncate\">\n                    {getPointsFocusedDescription(transaction)}\n                  </p>\n                  <p className={`font-semibold ${getTransactionColor(transaction.points)}`}>\n                    {transaction.points > 0 ? '+' : ''}{transaction.points.toLocaleString()} {t('loyalty.points')}\n                  </p>\n                </div>\n                \n                <div className=\"flex items-center space-x-4 mt-1\">\n                  <p className=\"text-sm text-gray-600\">\n                    {formatDate(transaction.created_at)}\n                  </p>\n                  \n                  {showAdminInfo && transaction.admin_email && (\n                    <div className=\"flex items-center space-x-1 text-xs text-gray-500\">\n                      <FiUser className=\"w-3 h-3\" />\n                      <span>{transaction.admin_email}</span>\n                    </div>\n                  )}\n                  \n                  {transaction.expires_at && (\n                    <div className=\"text-xs text-yellow-600\">\n                      {t('loyalty.expires')} {formatDate(transaction.expires_at)}\n                    </div>\n                  )}\n                </div>\n\n                {transaction.admin_reason && !transaction.admin_reason.toLowerCase().includes('thb') && !transaction.admin_reason.toLowerCase().includes('baht') && !transaction.admin_reason.toLowerCase().includes('‡∏ø') && (\n                  <p className=\"text-xs text-gray-500 mt-1 italic\">\n                    {transaction.admin_reason}\n                  </p>\n                )}\n              </div>\n            </div>\n          ))}\n\n          {showLoadMore && (\n            <div className=\"text-center pt-4\">\n              <button\n                onClick={onLoadMore}\n                className=\"px-4 py-2 text-sm font-medium text-primary-600 bg-primary-50 rounded-lg hover:bg-primary-100 transition-colors\"\n              >\n                {t('common.loadMore')}\n              </button>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/navigation/DashboardButton.tsx","messages":[{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":45,"column":45,"nodeType":"MemberExpression","endLine":45,"endColumn":68},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":45,"column":72,"nodeType":"MemberExpression","endLine":45,"endColumn":89},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":56,"column":25,"nodeType":"MemberExpression","endLine":56,"endColumn":46}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\n\ninterface DashboardButtonProps {\n  className?: string;\n  variant?: 'primary' | 'secondary' | 'outline';\n  size?: 'sm' | 'md' | 'lg';\n  showIcon?: boolean;\n}\n\nconst DashboardButton: React.FC<DashboardButtonProps> = ({\n  className = '',\n  variant = 'outline',\n  size = 'md',\n  showIcon = true\n}) => {\n  const navigate = useNavigate();\n  const { t } = useTranslation();\n\n  const handleDashboardClick = () => {\n    navigate('/dashboard');\n  };\n\n  const baseClasses = 'inline-flex items-center font-medium rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2';\n  \n  const variantClasses = {\n    primary: 'bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500',\n    secondary: 'bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500',\n    outline: 'border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-blue-500'\n  };\n\n  const sizeClasses = {\n    sm: 'px-3 py-1.5 text-sm',\n    md: 'px-4 py-2 text-sm',\n    lg: 'px-6 py-3 text-base'\n  };\n\n  const iconSizeClasses = {\n    sm: 'h-4 w-4',\n    md: 'h-5 w-5',\n    lg: 'h-6 w-6'\n  };\n\n  const combinedClasses = `${baseClasses} ${variantClasses[variant]} ${sizeClasses[size]} ${className}`;\n\n  return (\n    <button\n      onClick={handleDashboardClick}\n      className={combinedClasses}\n      type=\"button\"\n      aria-label={t('navigation.backToDashboard')}\n    >\n      {showIcon && (\n        <svg \n          className={`${iconSizeClasses[size]} mr-2`}\n          fill=\"none\" \n          stroke=\"currentColor\" \n          viewBox=\"0 0 24 24\"\n          aria-hidden=\"true\"\n        >\n          <path \n            strokeLinecap=\"round\" \n            strokeLinejoin=\"round\" \n            strokeWidth={2} \n            d=\"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6\" \n          />\n        </svg>\n      )}\n      {t('navigation.dashboard')}\n    </button>\n  );\n};\n\nexport default DashboardButton;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/profile/EmojiAvatar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":32,"column":13,"nodeType":"MemberExpression","endLine":32,"endColumn":30},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":52,"column":11,"nodeType":"MemberExpression","endLine":52,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { formatEmojiAvatar } from '../../utils/emojiUtils';\n\ninterface EmojiAvatarProps {\n  avatarUrl?: string | null;\n  size?: 'sm' | 'md' | 'lg' | 'xl';\n  className?: string;\n  onClick?: () => void;\n}\n\nexport default function EmojiAvatar({ \n  avatarUrl, \n  size = 'md', \n  className = '',\n  onClick \n}: EmojiAvatarProps) {\n  const { emoji, isEmoji, className: emojiClassName } = formatEmojiAvatar(avatarUrl, size);\n  \n  // Size configurations\n  const sizeClasses = {\n    sm: 'w-8 h-8 text-lg',\n    md: 'w-12 h-12 text-2xl',\n    lg: 'w-16 h-16 text-3xl',\n    xl: 'w-20 h-20 text-4xl',\n  };\n\n  // Handle non-emoji avatars (uploaded images and URLs)\n  if (!isEmoji && avatarUrl && !avatarUrl.startsWith('emoji:')) {\n    return (\n      <div\n        className={`\n          ${sizeClasses[size]} rounded-full bg-gray-100 border-2 border-gray-200 \n          overflow-hidden flex items-center justify-center\n          ${onClick ? 'cursor-pointer hover:ring-2 hover:ring-blue-500' : ''}\n          ${className}\n        `}\n        onClick={onClick}\n      >\n        <img\n          src={avatarUrl}\n          alt=\"Profile\"\n          className=\"w-full h-full object-cover\"\n        />\n      </div>\n    );\n  }\n\n  // Handle emoji avatars or default\n  return (\n    <div\n      className={`\n        ${sizeClasses[size]} rounded-full bg-gray-100 border-2 border-gray-200 \n        flex items-center justify-center\n        ${onClick ? 'cursor-pointer hover:ring-2 hover:ring-blue-500 hover:scale-105 transition-all' : ''}\n        ${className}\n      `}\n      onClick={onClick}\n      title={isEmoji ? `Profile picture: ${emoji}` : 'Click to set profile picture'}\n    >\n      <span className={emojiClassName}>\n        {emoji}\n      </span>\n    </div>\n  );\n}\n\n// Compact version for lists\nexport function EmojiAvatarCompact({ \n  avatarUrl, \n  className = '' \n}: Pick<EmojiAvatarProps, 'avatarUrl' | 'className'>) {\n  return <EmojiAvatar avatarUrl={avatarUrl} size=\"sm\" className={className} />;\n}\n\n// Large version for profile pages\nexport function EmojiAvatarLarge({ \n  avatarUrl, \n  onClick,\n  className = '' \n}: Pick<EmojiAvatarProps, 'avatarUrl' | 'onClick' | 'className'>) {\n  return (\n    <EmojiAvatar \n      avatarUrl={avatarUrl} \n      size=\"xl\" \n      onClick={onClick}\n      className={className}\n    />\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/profile/EmojiSelector.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isValidEmojiAvatar' is defined but never used.","line":2,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":48},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatEmojiAvatar' is defined but never used.","line":2,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":67},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":17,"column":82,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":17,"endColumn":84,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[499,501],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { getAllEmojiOptions, isValidEmojiAvatar, formatEmojiAvatar } from '../../utils/emojiUtils';\n\ninterface EmojiSelectorProps {\n  currentEmoji?: string | null;\n  onSelect: (emoji: string) => void;\n  onCancel?: () => void;\n  className?: string;\n}\n\nexport default function EmojiSelector({ \n  currentEmoji, \n  onSelect, \n  onCancel,\n  className = '' \n}: EmojiSelectorProps) {\n  const [selectedEmoji, setSelectedEmoji] = useState<string | null>(currentEmoji || null);\n  const emojiOptions = getAllEmojiOptions();\n\n  const handleEmojiClick = (emoji: string) => {\n    setSelectedEmoji(emoji);\n  };\n\n  const handleConfirm = () => {\n    if (selectedEmoji) {\n      onSelect(selectedEmoji);\n    }\n  };\n\n  return (\n    <div className={`bg-white rounded-lg border shadow-lg p-6 ${className}`}>\n      <div className=\"text-center mb-4\">\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n          Choose Your Profile Picture\n        </h3>\n        <p className=\"text-sm text-gray-600\">\n          Select an emoji to represent your profile\n        </p>\n      </div>\n\n      {/* Current/Selected Preview */}\n      <div className=\"flex justify-center mb-6\">\n        <div className=\"w-20 h-20 rounded-full bg-gray-100 border-2 border-gray-200 flex items-center justify-center\">\n          {selectedEmoji ? (\n            <span className=\"text-4xl\">{selectedEmoji}</span>\n          ) : (\n            <span className=\"text-4xl text-gray-400\">üë§</span>\n          )}\n        </div>\n      </div>\n\n      {/* Emoji Options Grid */}\n      <div className=\"max-h-64 overflow-y-auto mb-6 border rounded-lg p-3 bg-gray-50\">\n        <div className=\"grid grid-cols-8 gap-2\">\n          {emojiOptions.map((emoji, index) => (\n            <button\n              key={index}\n              onClick={() => handleEmojiClick(emoji)}\n              className={`\n                w-8 h-8 rounded border flex items-center justify-center\n                text-lg transition-all duration-200 hover:scale-110\n                ${selectedEmoji === emoji \n                  ? 'border-blue-500 bg-blue-100 shadow-sm' \n                  : 'border-gray-200 hover:border-gray-300 hover:bg-white'\n                }\n              `}\n              title={`Select ${emoji} as profile picture`}\n            >\n              {emoji}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Action Buttons */}\n      <div className=\"flex gap-3\">\n        {onCancel && (\n          <button\n            onClick={onCancel}\n            className=\"flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 \n                     rounded-lg font-medium transition-colors\"\n          >\n            Cancel\n          </button>\n        )}\n        <button\n          onClick={handleConfirm}\n          disabled={!selectedEmoji}\n          className={`\n            flex-1 px-4 py-2 rounded-lg font-medium transition-colors\n            ${selectedEmoji\n              ? 'bg-blue-600 hover:bg-blue-700 text-white'\n              : 'bg-gray-300 text-gray-500 cursor-not-allowed'\n            }\n          `}\n        >\n          {selectedEmoji ? 'Confirm Selection' : 'Select an Emoji'}\n        </button>\n      </div>\n\n      {/* Info Text */}\n      <p className=\"text-xs text-gray-500 text-center mt-4\">\n        You can change your profile picture anytime in your profile settings\n      </p>\n    </div>\n  );\n}\n\n// Compact version for inline use with all emojis in scrollable grid\nexport function EmojiSelectorInline({ \n  currentEmoji, \n  onSelect,\n  className = '' \n}: Omit<EmojiSelectorProps, 'onCancel'>) {\n  const emojiOptions = getAllEmojiOptions();\n\n  return (\n    <div className={`${className}`}>\n      <div className=\"max-h-40 overflow-y-auto border rounded-lg p-2 bg-gray-50\">\n        <div className=\"grid grid-cols-8 gap-1\">\n          {emojiOptions.map((emoji, index) => (\n            <button\n              key={index}\n              onClick={() => onSelect(emoji)}\n              className={`\n                w-7 h-7 rounded border flex items-center justify-center\n                text-sm transition-all duration-200 hover:scale-110\n                ${currentEmoji === emoji \n                  ? 'border-blue-500 bg-blue-100 shadow-sm' \n                  : 'border-gray-200 hover:border-gray-300 hover:bg-white'\n                }\n              `}\n              title={`Select ${emoji} as profile picture`}\n            >\n              {emoji}\n            </button>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/profile/ProfileCompletionBanner.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":36,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":36,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1164,1231],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":57,"column":3,"nodeType":"Identifier","endLine":57,"endColumn":12}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { FiX, FiGift, FiChevronRight } from 'react-icons/fi';\nimport { Link } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { useAuthStore } from '../../store/authStore';\nimport { userService } from '../../services/userService';\n\ninterface ProfileStatus {\n  isComplete: boolean;\n  missingFields: string[];\n  newMemberCouponAvailable: boolean;\n}\n\ninterface ProfileCompletionBannerProps {\n  className?: string;\n}\n\nexport default function ProfileCompletionBanner({ className = '' }: ProfileCompletionBannerProps) {\n  const { t } = useTranslation();\n  const user = useAuthStore((state) => state.user);\n  const [profileStatus, setProfileStatus] = useState<ProfileStatus | null>(null);\n  const [isDismissed, setIsDismissed] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    const checkProfileStatus = async () => {\n      if (!user?.id) {\n        setIsLoading(false);\n        return;\n      }\n\n      try {\n        const response = await userService.getProfileCompletionStatus();\n        setProfileStatus(response);\n      } catch (error) {\n        console.error('Failed to check profile completion status:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    checkProfileStatus();\n  }, [user?.id]);\n\n  // Don't show banner if loading, dismissed, profile is complete, or no coupon available\n  if (isLoading || isDismissed || !profileStatus || profileStatus.isComplete || !profileStatus.newMemberCouponAvailable) {\n    return null;\n  }\n\n  const handleDismiss = () => {\n    setIsDismissed(true);\n    // Store dismissal in session storage (temporary dismissal)\n    sessionStorage.setItem('profile-banner-dismissed', 'true');\n  };\n\n  // Check if banner was previously dismissed in this session\n  useEffect(() => {\n    const wasDismissed = sessionStorage.getItem('profile-banner-dismissed');\n    if (wasDismissed === 'true') {\n      setIsDismissed(true);\n    }\n  }, []);\n\n  const getMissingFieldsText = () => {\n    const fields = profileStatus.missingFields.map(field => {\n      switch (field) {\n        case 'date_of_birth': return t('profile.dateOfBirth');\n        case 'gender': return t('profile.gender');\n        case 'occupation': return t('profile.occupation');\n        case 'interests': return t('profile.interests');\n        case 'phone': return t('profile.phone');\n        default: return field;\n      }\n    });\n    \n    if (fields.length <= 2) {\n      return fields.join(` ${t('common.and')} `);\n    } else {\n      return `${fields.slice(0, -1).join(', ')} ${t('common.and')} ${fields[fields.length - 1]}`;\n    }\n  };\n\n  return (\n    <div className={`bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-sm ${className}`}>\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"flex items-center justify-between py-3\">\n          <div className=\"flex items-center flex-1 min-w-0\">\n            <div className=\"flex-shrink-0\">\n              <FiGift className=\"h-6 w-6 text-yellow-300\" />\n            </div>\n            <div className=\"ml-3 flex-1 min-w-0\">\n              <p className=\"text-sm font-medium\">\n                <span className=\"inline-flex items-center\">\n                  <span className=\"bg-yellow-300 text-blue-900 px-2 py-0.5 rounded-full text-xs font-semibold mr-2\">\n                    {t('profile.newMemberOffer')}\n                  </span>\n                  {t('profile.completeProfileForCoupon')}\n                </span>\n              </p>\n              <p className=\"text-xs text-blue-100 mt-1\">\n                {t('profile.missingFields', { fields: getMissingFieldsText() })}\n              </p>\n            </div>\n            <div className=\"flex-shrink-0 ml-4\">\n              <Link\n                to=\"/profile\"\n                className=\"inline-flex items-center px-4 py-2 border border-white/20 text-sm font-medium rounded-md text-white bg-white/10 hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-blue-600 focus:ring-white transition-colors\"\n              >\n                {t('profile.completeProfile')}\n                <FiChevronRight className=\"ml-1 h-4 w-4\" />\n              </Link>\n            </div>\n          </div>\n          <div className=\"flex-shrink-0 ml-4\">\n            <button\n              type=\"button\"\n              onClick={handleDismiss}\n              className=\"inline-flex items-center justify-center p-1 rounded-md text-white/70 hover:text-white hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-blue-600 focus:ring-white transition-colors\"\n              aria-label={t('common.dismiss')}\n            >\n              <FiX className=\"h-5 w-5\" />\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/profile/SettingsModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updateUser' is assigned a value but never used.","line":52,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":52,"endColumn":19},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":65,"column":26,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":65,"endColumn":28,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2275,2277],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":66,"column":37,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":66,"endColumn":39,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2318,2320],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":67,"column":35,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":67,"endColumn":37,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2359,2361],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":68,"column":29,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":68,"endColumn":31,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2394,2396],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":72,"column":31,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":72,"endColumn":33,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2555,2557],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":73,"column":39,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":73,"endColumn":41,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2600,2602],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":74,"column":49,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":74,"endColumn":51,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2655,2657],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":82,"column":28,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":82,"endColumn":30,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2806,2808],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":85,"column":30,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":85,"endColumn":32,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2916,2918],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":89,"column":32,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":89,"endColumn":34,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[3083,3085],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":90,"column":40,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":90,"endColumn":42,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[3129,3131],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":91,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":91,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[3185,3187],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3551,3554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3551,3554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useRef } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useTranslation } from 'react-i18next';\nimport { FiX, FiUser, FiPhone, FiCalendar, FiCamera, FiSmile, FiMail, FiBriefcase, FiHeart } from 'react-icons/fi';\nimport { UserProfile, userService } from '../../services/userService';\nimport { useAuthStore } from '../../store/authStore';\nimport EmojiAvatar from './EmojiAvatar';\nimport { EmojiSelectorInline } from './EmojiSelector';\nimport { notify } from '../../utils/notificationManager';\nimport { extractEmojiFromUrl } from '../../utils/emojiUtils';\n\nconst profileSchema = z.object({\n  email: z.string().email('Please enter a valid email address').optional().or(z.literal('')),\n  firstName: z.string().min(1, 'First name is required'),\n  lastName: z.string().optional(),\n  phone: z.string().optional(),\n  dateOfBirth: z.string().optional(),\n  gender: z.string().optional(),\n  occupation: z.string().optional(),\n  interests: z.string().optional(), // Comma-separated string\n});\n\ntype ProfileFormData = z.infer<typeof profileSchema>;\n\ninterface SettingsModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  profile: UserProfile | null;\n  onSubmit: (data: ProfileFormData) => Promise<void>;\n  isSaving: boolean;\n  onAvatarUpload: (event: React.ChangeEvent<HTMLInputElement>) => Promise<void>;\n  onDeleteAvatar: () => Promise<void>;\n  uploadingAvatar: boolean;\n  onProfileUpdate?: (profile: UserProfile) => void;\n}\n\nexport default function SettingsModal({\n  isOpen,\n  onClose,\n  profile,\n  onSubmit,\n  isSaving,\n  onAvatarUpload,\n  onDeleteAvatar,\n  uploadingAvatar,\n  onProfileUpdate\n}: SettingsModalProps) {\n  const { t } = useTranslation();\n  const user = useAuthStore((state) => state.user);\n  const updateUser = useAuthStore((state) => state.updateUser);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [showEmojiSelector, setShowEmojiSelector] = React.useState(false);\n  const [updatingEmoji, setUpdatingEmoji] = React.useState(false);\n\n  const {\n    register,\n    handleSubmit,\n    formState: { errors },\n    reset,\n  } = useForm<ProfileFormData>({\n    resolver: zodResolver(profileSchema),\n    defaultValues: {\n      email: user?.email || '',\n      firstName: profile?.firstName || '',\n      lastName: profile?.lastName || '',\n      phone: profile?.phone || '',\n      dateOfBirth: profile?.dateOfBirth \n        ? new Date(profile.dateOfBirth).toISOString().split('T')[0] \n        : '',\n      gender: profile?.gender || '',\n      occupation: profile?.occupation || '',\n      interests: profile?.interests?.join(', ') || '',\n    }\n  });\n\n  // Reset form when profile or user changes\n  React.useEffect(() => {\n    if (profile) {\n      reset({\n        email: user?.email || '',\n        firstName: profile.firstName,\n        lastName: profile.lastName,\n        phone: profile.phone || '',\n        dateOfBirth: profile.dateOfBirth \n          ? new Date(profile.dateOfBirth).toISOString().split('T')[0] \n          : '',\n        gender: profile.gender || '',\n        occupation: profile.occupation || '',\n        interests: profile.interests?.join(', ') || '',\n      });\n    }\n  }, [profile, user, reset]);\n\n  const handleEmojiSelect = async (emoji: string) => {\n    setUpdatingEmoji(true);\n    try {\n      const updatedProfile = await userService.updateEmojiAvatar(emoji);\n      onProfileUpdate?.(updatedProfile);\n      setShowEmojiSelector(false);\n      notify.success('Profile picture updated!');\n    } catch (error: any) {\n      notify.error(error.response?.data?.error || 'Failed to update profile picture');\n    } finally {\n      setUpdatingEmoji(false);\n    }\n  };\n\n  if (!isOpen) {return null;}\n\n  return (\n    <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n      <div className=\"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0\">\n        {/* Backdrop */}\n        <div \n          className=\"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity\"\n          onClick={onClose}\n        />\n\n        {/* Modal */}\n        <div className=\"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full\">\n          <div className=\"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4\">\n            {/* Header */}\n            <div className=\"flex items-center justify-between mb-6\">\n              <h3 className=\"text-lg font-medium text-gray-900\">\n                {t('profile.editProfile')}\n              </h3>\n              <button\n                onClick={onClose}\n                className=\"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500\"\n              >\n                <FiX className=\"h-6 w-6\" />\n              </button>\n            </div>\n\n            {/* Profile Picture Section */}\n            <div className=\"mb-6\">\n              <h4 className=\"text-md font-medium text-gray-900 mb-4\">Profile Picture</h4>\n              \n              <div className=\"flex items-center space-x-4 mb-4\">\n                <div className=\"relative\">\n                  <EmojiAvatar \n                    avatarUrl={profile?.avatarUrl} \n                    size=\"lg\" \n                    className={updatingEmoji ? 'opacity-50' : ''}\n                  />\n                  {updatingEmoji && (\n                    <div className=\"absolute inset-0 flex items-center justify-center\">\n                      <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600\" />\n                    </div>\n                  )}\n                </div>\n                \n                <div className=\"flex-1\">\n                  <div className=\"flex flex-wrap gap-2 mb-2\">\n                    <button\n                      onClick={() => setShowEmojiSelector(!showEmojiSelector)}\n                      disabled={updatingEmoji}\n                      className=\"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-primary-700 bg-primary-100 hover:bg-primary-200 disabled:opacity-50\"\n                    >\n                      <FiSmile className=\"mr-1 h-4 w-4\" />\n                      Choose Emoji\n                    </button>\n                    \n                    <button\n                      onClick={() => fileInputRef.current?.click()}\n                      disabled={uploadingAvatar || updatingEmoji}\n                      className=\"inline-flex items-center px-3 py-2 border border-gray-300 text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50\"\n                    >\n                      <FiCamera className=\"mr-1 h-4 w-4\" />\n                      Upload Image\n                    </button>\n                    \n                    {profile?.avatarUrl && (\n                      <button\n                        onClick={onDeleteAvatar}\n                        disabled={uploadingAvatar || updatingEmoji}\n                        className=\"text-sm text-red-600 hover:text-red-700 disabled:opacity-50 px-2 py-1\"\n                      >\n                        Remove\n                      </button>\n                    )}\n                  </div>\n                  \n                  <p className=\"text-xs text-gray-500\">\n                    Choose an emoji or upload your own image for your profile picture\n                  </p>\n                </div>\n\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={onAvatarUpload}\n                  className=\"hidden\"\n                />\n              </div>\n\n              {/* Emoji Selector */}\n              {showEmojiSelector && (\n                <div className=\"border rounded-lg p-4 bg-gray-50\">\n                  <div className=\"flex items-center justify-between mb-3\">\n                    <span className=\"text-sm font-medium text-gray-700\">Select an emoji:</span>\n                    <button\n                      onClick={() => setShowEmojiSelector(false)}\n                      className=\"text-gray-400 hover:text-gray-600\"\n                    >\n                      <FiX className=\"h-4 w-4\" />\n                    </button>\n                  </div>\n                  <EmojiSelectorInline\n                    currentEmoji={extractEmojiFromUrl(profile?.avatarUrl)}\n                    onSelect={handleEmojiSelect}\n                  />\n                </div>\n              )}\n            </div>\n\n            {/* Form */}\n            <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-4\">\n              {/* Email Field */}\n              <div>\n                <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700\">\n                  {t('profile.email')}\n                </label>\n                <div className=\"mt-1 relative\">\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                    <FiMail className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                  <input\n                    {...register('email')}\n                    id=\"email\"\n                    type=\"email\"\n                    className=\"appearance-none block w-full px-3 py-2 pl-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                    placeholder={t('profile.emailPlaceholder')}\n                  />\n                </div>\n                {errors.email && (\n                  <p className=\"mt-1 text-sm text-red-600\">{errors.email.message}</p>\n                )}\n                <p className=\"mt-1 text-xs text-gray-500\">\n                  {t('profile.emailHelpText')}\n                </p>\n              </div>\n\n              <div className=\"grid grid-cols-1 gap-4 sm:grid-cols-2\">\n                <div>\n                  <label htmlFor=\"firstName\" className=\"block text-sm font-medium text-gray-700\">\n                    {t('auth.firstName')}\n                  </label>\n                  <div className=\"mt-1 relative\">\n                    <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                      <FiUser className=\"h-5 w-5 text-gray-400\" />\n                    </div>\n                    <input\n                      {...register('firstName')}\n                      id=\"firstName\"\n                      type=\"text\"\n                      className=\"appearance-none block w-full px-3 py-2 pl-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                      placeholder={t('profile.firstNamePlaceholder')}\n                    />\n                  </div>\n                  {errors.firstName && (\n                    <p className=\"mt-1 text-sm text-red-600\">{errors.firstName.message}</p>\n                  )}\n                </div>\n\n                <div>\n                  <label htmlFor=\"lastName\" className=\"block text-sm font-medium text-gray-700\">\n                    {t('auth.lastName')}\n                  </label>\n                  <div className=\"mt-1 relative\">\n                    <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                      <FiUser className=\"h-5 w-5 text-gray-400\" />\n                    </div>\n                    <input\n                      {...register('lastName')}\n                      id=\"lastName\"\n                      type=\"text\"\n                      className=\"appearance-none block w-full px-3 py-2 pl-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                      placeholder={t('profile.lastNamePlaceholder')}\n                    />\n                  </div>\n                  {errors.lastName && (\n                    <p className=\"mt-1 text-sm text-red-600\">{errors.lastName.message}</p>\n                  )}\n                </div>\n              </div>\n\n              <div>\n                <label htmlFor=\"phone\" className=\"block text-sm font-medium text-gray-700\">\n                  {t('auth.phone')}\n                </label>\n                <div className=\"mt-1 relative\">\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                    <FiPhone className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                  <input\n                    {...register('phone')}\n                    id=\"phone\"\n                    type=\"tel\"\n                    className=\"appearance-none block w-full px-3 py-2 pl-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                    placeholder={t('profile.phonePlaceholder')}\n                  />\n                </div>\n                {errors.phone && (\n                  <p className=\"mt-1 text-sm text-red-600\">{errors.phone.message}</p>\n                )}\n              </div>\n\n              <div>\n                <label htmlFor=\"dateOfBirth\" className=\"block text-sm font-medium text-gray-700\">\n                  {t('profile.dateOfBirth')}\n                </label>\n                <div className=\"mt-1 relative\">\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                    <FiCalendar className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                  <input\n                    {...register('dateOfBirth')}\n                    id=\"dateOfBirth\"\n                    type=\"date\"\n                    className=\"appearance-none block w-full px-3 py-2 pl-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                  />\n                </div>\n                {errors.dateOfBirth && (\n                  <p className=\"mt-1 text-sm text-red-600\">{errors.dateOfBirth.message}</p>\n                )}\n              </div>\n\n              <div>\n                <label htmlFor=\"gender\" className=\"block text-sm font-medium text-gray-700\">\n                  {t('profile.gender')}\n                </label>\n                <div className=\"mt-1\">\n                  <select\n                    {...register('gender')}\n                    id=\"gender\"\n                    className=\"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                  >\n                    <option value=\"\">{t('profile.selectGender')}</option>\n                    <option value=\"male\">{t('profile.male')}</option>\n                    <option value=\"female\">{t('profile.female')}</option>\n                    <option value=\"other\">{t('profile.other')}</option>\n                    <option value=\"prefer_not_to_say\">{t('profile.preferNotToSay')}</option>\n                  </select>\n                </div>\n                {errors.gender && (\n                  <p className=\"mt-1 text-sm text-red-600\">{errors.gender.message}</p>\n                )}\n              </div>\n\n              <div>\n                <label htmlFor=\"occupation\" className=\"block text-sm font-medium text-gray-700\">\n                  {t('profile.occupation')}\n                </label>\n                <div className=\"mt-1 relative\">\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                    <FiBriefcase className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                  <input\n                    {...register('occupation')}\n                    id=\"occupation\"\n                    type=\"text\"\n                    className=\"appearance-none block w-full px-3 py-2 pl-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                    placeholder={t('profile.occupationPlaceholder')}\n                  />\n                </div>\n                {errors.occupation && (\n                  <p className=\"mt-1 text-sm text-red-600\">{errors.occupation.message}</p>\n                )}\n              </div>\n\n              <div>\n                <label htmlFor=\"interests\" className=\"block text-sm font-medium text-gray-700\">\n                  {t('profile.interests')}\n                </label>\n                <div className=\"mt-1 relative\">\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                    <FiHeart className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                  <input\n                    {...register('interests')}\n                    id=\"interests\"\n                    type=\"text\"\n                    className=\"appearance-none block w-full px-3 py-2 pl-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                    placeholder={t('profile.interestsPlaceholder')}\n                  />\n                </div>\n                {errors.interests && (\n                  <p className=\"mt-1 text-sm text-red-600\">{errors.interests.message}</p>\n                )}\n                <p className=\"mt-1 text-xs text-gray-500\">\n                  {t('profile.interestsHelpText')}\n                </p>\n              </div>\n\n              <div className=\"flex justify-end space-x-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={onClose}\n                  className=\"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n                >\n                  {t('common.cancel')}\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={isSaving}\n                  className=\"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  {isSaving ? t('common.saving') : t('common.save')}\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/surveys/MultiLanguageEditor.tsx","messages":[{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":73,"column":12,"nodeType":"MemberExpression","endLine":73,"endColumn":37},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":81,"column":80,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":81,"endColumn":82,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2329,2331],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":82,"column":23,"nodeType":"MemberExpression","endLine":82,"endColumn":39},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":195,"column":61,"nodeType":"MemberExpression","endLine":195,"endColumn":71}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { FiGlobe, FiPlus, FiTrash2, FiCheck } from 'react-icons/fi';\n\ninterface Language {\n  code: string;\n  name: string;\n  flag: string;\n}\n\ninterface MultiLanguageEditorProps {\n  value: Record<string, string>;\n  onChange: (translations: Record<string, string>) => void;\n  label: string;\n  placeholder?: string;\n  type?: 'text' | 'textarea';\n  required?: boolean;\n}\n\nconst supportedLanguages: Language[] = [\n  { code: 'en', name: 'English', flag: 'üá∫üá∏' },\n  { code: 'th', name: '‡πÑ‡∏ó‡∏¢ (Thai)', flag: 'üáπüá≠' },\n  { code: 'zh', name: '‰∏≠Êñá (Chinese)', flag: 'üá®üá≥' },\n  { code: 'ja', name: 'Êó•Êú¨Ë™û (Japanese)', flag: 'üáØüáµ' },\n  { code: 'ko', name: 'ÌïúÍµ≠Ïñ¥ (Korean)', flag: 'üá∞üá∑' },\n  { code: 'es', name: 'Espa√±ol', flag: 'üá™üá∏' },\n  { code: 'fr', name: 'Fran√ßais', flag: 'üá´üá∑' },\n  { code: 'de', name: 'Deutsch', flag: 'üá©üá™' },\n];\n\nconst MultiLanguageEditor: React.FC<MultiLanguageEditorProps> = ({\n  value = {},\n  onChange,\n  label,\n  placeholder,\n  type = 'text',\n  required = false\n}) => {\n  const [activeTab, setActiveTab] = useState<string>('en');\n  const [showLanguageSelector, setShowLanguageSelector] = useState(false);\n  \n  // Get currently enabled languages\n  const enabledLanguages = supportedLanguages.filter(lang => \n    value[lang.code] !== undefined || lang.code === 'en'\n  );\n  \n  // Get available languages to add\n  const availableToAdd = supportedLanguages.filter(lang => \n    !enabledLanguages.some(enabled => enabled.code === lang.code)\n  );\n\n  const handleTextChange = (langCode: string, text: string) => {\n    const newTranslations = {\n      ...value,\n      [langCode]: text\n    };\n    onChange(newTranslations);\n  };\n\n  const addLanguage = (langCode: string) => {\n    const newTranslations = {\n      ...value,\n      [langCode]: value['en'] || '' // Default to English text\n    };\n    onChange(newTranslations);\n    setActiveTab(langCode);\n    setShowLanguageSelector(false);\n  };\n\n  const removeLanguage = (langCode: string) => {\n    if (langCode === 'en') {return;} // Don't allow removing English\n    \n    const newTranslations = { ...value };\n    delete newTranslations[langCode];\n    onChange(newTranslations);\n    \n    if (activeTab === langCode) {\n      setActiveTab('en');\n    }\n  };\n\n  const currentLang = supportedLanguages.find(lang => lang.code === activeTab) || supportedLanguages[0];\n  const currentText = value[activeTab] || '';\n\n  return (\n    <div className=\"space-y-3\">\n      <label className=\"block text-sm font-medium text-gray-700\">\n        {label}\n        {required && <span className=\"text-red-500 ml-1\">*</span>}\n      </label>\n      \n      {/* Language Tabs */}\n      <div className=\"flex items-center space-x-2 border-b border-gray-200\">\n        <div className=\"flex space-x-1\">\n          {enabledLanguages.map(lang => (\n            <button\n              key={lang.code}\n              onClick={() => setActiveTab(lang.code)}\n              className={`px-3 py-2 text-sm font-medium rounded-t-md flex items-center space-x-2 ${\n                activeTab === lang.code\n                  ? 'bg-blue-50 text-blue-700 border-b-2 border-blue-500'\n                  : 'text-gray-500 hover:text-gray-700'\n              }`}\n            >\n              <span>{lang.flag}</span>\n              <span>{lang.name}</span>\n              {value[lang.code] && (\n                <FiCheck className=\"h-3 w-3 text-green-500\" />\n              )}\n              {lang.code !== 'en' && (\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    removeLanguage(lang.code);\n                  }}\n                  className=\"ml-1 text-red-500 hover:text-red-700\"\n                >\n                  <FiTrash2 className=\"h-3 w-3\" />\n                </button>\n              )}\n            </button>\n          ))}\n        </div>\n        \n        {/* Add Language Button */}\n        {availableToAdd.length > 0 && (\n          <div className=\"relative\">\n            <button\n              onClick={() => setShowLanguageSelector(!showLanguageSelector)}\n              className=\"px-3 py-2 text-sm text-gray-500 hover:text-gray-700 flex items-center space-x-1\"\n            >\n              <FiPlus className=\"h-4 w-4\" />\n              <FiGlobe className=\"h-4 w-4\" />\n            </button>\n            \n            {showLanguageSelector && (\n              <div className=\"absolute top-full left-0 mt-1 w-48 bg-white border border-gray-200 rounded-md shadow-lg z-20\">\n                <div className=\"p-2\">\n                  <p className=\"text-xs text-gray-500 mb-2\">Add Language:</p>\n                  {availableToAdd.map(lang => (\n                    <button\n                      key={lang.code}\n                      onClick={() => addLanguage(lang.code)}\n                      className=\"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 rounded flex items-center space-x-2\"\n                    >\n                      <span>{lang.flag}</span>\n                      <span>{lang.name}</span>\n                    </button>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n      \n      {/* Text Editor */}\n      <div className=\"space-y-2\">\n        <div className=\"flex items-center justify-between\">\n          <span className=\"text-xs text-gray-500\">\n            Editing: {currentLang.flag} {currentLang.name}\n          </span>\n          {activeTab !== 'en' && value['en'] && (\n            <button\n              onClick={() => handleTextChange(activeTab, value['en'])}\n              className=\"text-xs text-blue-600 hover:text-blue-800\"\n            >\n              Copy from English\n            </button>\n          )}\n        </div>\n        \n        {type === 'textarea' ? (\n          <textarea\n            value={currentText}\n            onChange={(e) => handleTextChange(activeTab, e.target.value)}\n            placeholder={placeholder ? `${placeholder} (${currentLang.name})` : `Enter text in ${currentLang.name}...`}\n            rows={3}\n            className=\"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n          />\n        ) : (\n          <input\n            type=\"text\"\n            value={currentText}\n            onChange={(e) => handleTextChange(activeTab, e.target.value)}\n            placeholder={placeholder ? `${placeholder} (${currentLang.name})` : `Enter text in ${currentLang.name}...`}\n            className=\"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n          />\n        )}\n      </div>\n      \n      {/* Translation Status */}\n      <div className=\"text-xs text-gray-500\">\n        <div className=\"flex items-center space-x-4\">\n          <span>\n            Translations: {Object.keys(value).filter(key => value[key]?.trim()).length} / {enabledLanguages.length}\n          </span>\n          <div className=\"flex space-x-1\">\n            {enabledLanguages.map(lang => (\n              <span\n                key={lang.code}\n                className={`inline-block w-2 h-2 rounded-full ${\n                  value[lang.code]?.trim() ? 'bg-green-400' : 'bg-gray-300'\n                }`}\n                title={`${lang.name}: ${value[lang.code]?.trim() ? 'Translated' : 'Missing'}`}\n              />\n            ))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default MultiLanguageEditor;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/surveys/MultiLanguageSurvey.tsx","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":30,"column":86,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":30,"endColumn":88,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[947,949],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":34,"column":12,"nodeType":"MemberExpression","endLine":34,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { FiGlobe } from 'react-icons/fi';\nimport { SurveyQuestion } from '../../types/survey';\n\ninterface MultiLanguageQuestion extends Omit<SurveyQuestion, 'text' | 'description' | 'options'> {\n  text: Record<string, string>;\n  description?: Record<string, string>;\n  options?: Array<{\n    id: string;\n    text: Record<string, string>;\n    value: string | number;\n  }>;\n}\n\ninterface MultiLanguageSurveyProps {\n  questions: MultiLanguageQuestion[];\n  onLanguageChange: (language: string) => void;\n  currentLanguage: string;\n  availableLanguages: { code: string; name: string; flag: string }[];\n}\n\nconst MultiLanguageSurvey: React.FC<MultiLanguageSurveyProps> = ({\n  questions,\n  onLanguageChange,\n  currentLanguage,\n  availableLanguages\n}) => {\n  const [showLanguageSelector, setShowLanguageSelector] = useState(false);\n\n  const currentLang = availableLanguages.find(lang => lang.code === currentLanguage) || availableLanguages[0];\n\n  const getTranslatedText = (textObj: Record<string, string> | string, fallback = '') => {\n    if (typeof textObj === 'string') {return textObj;}\n    return textObj[currentLanguage] || textObj['en'] || fallback;\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto\">\n      {/* Language Selector */}\n      <div className=\"mb-6\">\n        <div className=\"relative\">\n          <button\n            onClick={() => setShowLanguageSelector(!showLanguageSelector)}\n            className=\"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n          >\n            <FiGlobe className=\"mr-2 h-4 w-4\" />\n            <span className=\"mr-2\">{currentLang.flag}</span>\n            {currentLang.name}\n            <svg className=\"ml-2 h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n            </svg>\n          </button>\n\n          {showLanguageSelector && (\n            <div className=\"absolute top-full left-0 mt-1 w-48 bg-white border border-gray-200 rounded-md shadow-lg z-10\">\n              {availableLanguages.map(lang => (\n                <button\n                  key={lang.code}\n                  onClick={() => {\n                    onLanguageChange(lang.code);\n                    setShowLanguageSelector(false);\n                  }}\n                  className={`w-full px-4 py-2 text-left text-sm hover:bg-gray-100 flex items-center ${\n                    lang.code === currentLanguage ? 'bg-blue-50 text-blue-700' : 'text-gray-700'\n                  }`}\n                >\n                  <span className=\"mr-3\">{lang.flag}</span>\n                  {lang.name}\n                  {lang.code === currentLanguage && (\n                    <svg className=\"ml-auto h-4 w-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                      <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\n                    </svg>\n                  )}\n                </button>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Questions */}\n      <div className=\"space-y-6\">\n        {questions.map((question, index) => (\n          <div key={question.id} className=\"bg-white rounded-lg shadow p-6\">\n            <div className=\"mb-4\">\n              <h3 className=\"text-lg font-medium text-gray-900\">\n                {index + 1}. {getTranslatedText(question.text)}\n                {question.required && <span className=\"text-red-500 ml-1\">*</span>}\n              </h3>\n              {question.description && (\n                <p className=\"mt-1 text-sm text-gray-600\">\n                  {getTranslatedText(question.description)}\n                </p>\n              )}\n            </div>\n\n            {/* Question Type Display */}\n            <div className=\"text-xs text-gray-500 mb-2\">\n              Question Type: {question.type.replace('_', ' ').toUpperCase()}\n            </div>\n\n            {/* Options for choice questions */}\n            {(question.type === 'single_choice' || question.type === 'multiple_choice') && question.options && (\n              <div className=\"space-y-2\">\n                {question.options.map(option => (\n                  <div key={option.id} className=\"flex items-center\">\n                    <input\n                      type={question.type === 'single_choice' ? 'radio' : 'checkbox'}\n                      id={`${question.id}_${option.id}`}\n                      name={question.id}\n                      value={option.value}\n                      className=\"mr-3\"\n                      disabled\n                    />\n                    <label htmlFor={`${question.id}_${option.id}`} className=\"text-sm text-gray-700\">\n                      {getTranslatedText(option.text)}\n                    </label>\n                  </div>\n                ))}\n              </div>\n            )}\n\n            {/* Text inputs */}\n            {question.type === 'text' && (\n              <input\n                type=\"text\"\n                placeholder={`Your answer in ${currentLang.name}...`}\n                className=\"w-full p-2 border border-gray-300 rounded-md\"\n                disabled\n              />\n            )}\n\n            {question.type === 'textarea' && (\n              <textarea\n                placeholder={`Your answer in ${currentLang.name}...`}\n                rows={4}\n                className=\"w-full p-2 border border-gray-300 rounded-md\"\n                disabled\n              />\n            )}\n\n            {/* Rating scales */}\n            {(question.type === 'rating_5' || question.type === 'rating_10') && (\n              <div className=\"flex space-x-2\">\n                {Array.from({ length: question.type === 'rating_5' ? 5 : 10 }, (_, i) => (\n                  <button\n                    key={i}\n                    className=\"w-10 h-10 border border-gray-300 rounded-md text-sm text-gray-500 hover:bg-gray-100\"\n                    disabled\n                  >\n                    {i + 1}\n                  </button>\n                ))}\n              </div>\n            )}\n\n            {/* Yes/No */}\n            {question.type === 'yes_no' && (\n              <div className=\"space-x-4\">\n                <label className=\"inline-flex items-center\">\n                  <input type=\"radio\" name={question.id} value=\"yes\" className=\"mr-2\" disabled />\n                  Yes\n                </label>\n                <label className=\"inline-flex items-center\">\n                  <input type=\"radio\" name={question.id} value=\"no\" className=\"mr-2\" disabled />\n                  No\n                </label>\n              </div>\n            )}\n          </div>\n        ))}\n      </div>\n\n      {/* Language Status */}\n      <div className=\"mt-8 p-4 bg-blue-50 rounded-lg\">\n        <div className=\"flex items-center\">\n          <FiGlobe className=\"h-5 w-5 text-blue-600 mr-2\" />\n          <div>\n            <p className=\"text-sm font-medium text-blue-900\">\n              Multi-Language Survey Preview\n            </p>\n            <p className=\"text-xs text-blue-700 mt-1\">\n              Currently showing: {currentLang.name}. \n              Survey supports {availableLanguages.length} languages.\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default MultiLanguageSurvey;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/surveys/QuestionEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'questionNumber' is defined but never used.","line":21,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":17},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":172,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":172,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[6066,6068],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":230,"column":44,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":230,"endColumn":46,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[8905,8907],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":244,"column":44,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":244,"endColumn":46,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[9594,9596],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":324,"column":59,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":324,"endColumn":61,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[13083,13085],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { FiMove, FiTrash2, FiPlus, FiX } from 'react-icons/fi';\nimport { SurveyQuestion, QuestionOption } from '../../types/survey';\nimport { surveyService } from '../../services/surveyService';\n\ninterface QuestionEditorProps {\n  question: SurveyQuestion;\n  index: number;\n  questionNumber: number;\n  onUpdate: (updates: Partial<SurveyQuestion>) => void;\n  onRemove: () => void;\n  onReorder: (fromIndex: number, toIndex: number) => void;\n  canMove: boolean;\n  disabled?: boolean;\n}\n\nconst QuestionEditor: React.FC<QuestionEditorProps> = ({\n  question,\n  index,\n  questionNumber,\n  onUpdate,\n  onRemove,\n  onReorder,\n  canMove,\n  disabled = false\n}) => {\n  const { t } = useTranslation();\n  const [isDragging, setIsDragging] = useState(false);\n\n  const addOption = () => {\n    if (!question.options) {return;}\n    \n    const newOption: QuestionOption = {\n      id: surveyService.generateOptionId(),\n      text: t('surveys.admin.questionEditor.newOptionText', { number: question.options.length + 1 }),\n      value: (question.options.length + 1).toString() // Auto-generate sequential numeric value\n    };\n    \n    onUpdate({\n      options: [...question.options, newOption]\n    });\n  };\n\n  const updateOption = (optionId: string, field: 'text' | 'value', value: string) => {\n    if (!question.options) {return;}\n    \n    // Only allow text updates from UI, value is auto-generated\n    if (field === 'value') {return;}\n    \n    const updatedOptions = question.options.map((option, index) =>\n      option.id === optionId \n        ? { ...option, text: value, value: (index + 1).toString() } // Keep value as sequential number\n        : option\n    );\n    \n    onUpdate({ options: updatedOptions });\n  };\n\n  const removeOption = (optionId: string) => {\n    if (!question.options || question.options.length <= 2) {return;}\n    \n    // Re-index values when removing an option\n    const filteredOptions = question.options\n      .filter(option => option.id !== optionId)\n      .map((option, index) => ({\n        ...option,\n        value: (index + 1).toString() // Re-index values sequentially\n      }));\n    \n    onUpdate({ options: filteredOptions });\n  };\n\n  const handleDragStart = (e: React.DragEvent) => {\n    e.dataTransfer.setData('text/plain', index.toString());\n    setIsDragging(true);\n  };\n\n  const handleDragEnd = () => {\n    setIsDragging(false);\n  };\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    const fromIndex = parseInt(e.dataTransfer.getData('text/plain'));\n    if (fromIndex !== index) {\n      onReorder(fromIndex, index);\n    }\n  };\n\n  const getQuestionTypeLabel = (type: string) => {\n    switch (type) {\n      case 'single_choice': return t('surveys.admin.questionEditor.questionTypes.singleChoice');\n      case 'multiple_choice': return t('surveys.admin.questionEditor.questionTypes.multipleChoice');\n      case 'text': return t('surveys.admin.questionEditor.questionTypes.text');\n      case 'textarea': return t('surveys.admin.questionEditor.questionTypes.textarea');\n      case 'rating_5': return t('surveys.admin.questionEditor.questionTypes.rating5');\n      case 'rating_10': return t('surveys.admin.questionEditor.questionTypes.rating10');\n      case 'yes_no': return t('surveys.admin.questionEditor.questionTypes.yesNo');\n      default: return type;\n    }\n  };\n\n  return (\n    <div\n      className={`border rounded-lg p-4 bg-white ${isDragging ? 'opacity-50' : ''}`}\n      draggable={canMove}\n      onDragStart={handleDragStart}\n      onDragEnd={handleDragEnd}\n      onDragOver={handleDragOver}\n      onDrop={handleDrop}\n      data-question-id={question.id}\n    >\n      <div className=\"flex items-start justify-between mb-4\">\n        <div className=\"flex items-center space-x-2\">\n          {canMove && (\n            <button className=\"p-1 text-gray-400 hover:text-gray-600 cursor-move\">\n              <FiMove className=\"h-4 w-4\" />\n            </button>\n          )}\n          <span className=\"text-sm font-medium text-gray-900\">\n            {t('surveys.admin.questionEditor.questionNumber', { number: question.order })}\n          </span>\n          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">\n            {getQuestionTypeLabel(question.type)}\n          </span>\n        </div>\n        \n        <button\n          onClick={onRemove}\n          disabled={disabled}\n          className=\"p-1 text-gray-400 hover:text-red-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n        >\n          <FiTrash2 className=\"h-4 w-4\" />\n        </button>\n      </div>\n\n      <div className=\"space-y-4\">\n        {/* Question Text */}\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n            {t('surveys.admin.questionEditor.questionText')}\n          </label>\n          <textarea\n            value={question.text}\n            onChange={(e) => onUpdate({ text: e.target.value })}\n            disabled={disabled}\n            rows={2}\n            className={`block w-full rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${\n              !question.text || question.text.trim() === '' \n                ? 'border-red-300 focus:border-red-500 focus:ring-red-500' \n                : 'border-gray-300'\n            } ${disabled ? 'bg-gray-100' : ''}`}\n            placeholder={t('surveys.admin.questionEditor.questionTextPlaceholder')}\n          />\n          {(!question.text || question.text.trim() === '') && (\n            <p className=\"mt-1 text-sm text-red-600\">{t('surveys.admin.questionEditor.fieldRequired')}</p>\n          )}\n        </div>\n\n        {/* Question Description */}\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n            {t('surveys.admin.questionEditor.description')}\n          </label>\n          <input\n            type=\"text\"\n            value={question.description || ''}\n            onChange={(e) => onUpdate({ description: e.target.value })}\n            disabled={disabled}\n            className={`block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${disabled ? 'bg-gray-100' : ''}`}\n            placeholder={t('surveys.admin.questionEditor.descriptionPlaceholder')}\n          />\n        </div>\n\n        {/* Options for choice questions */}\n        {(question.type === 'single_choice' || question.type === 'multiple_choice') && (\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              {t('surveys.admin.questionEditor.answerOptions')}\n            </label>\n            <div className=\"space-y-2\">\n              {question.options?.map((option, index) => (\n                <div key={option.id} className=\"flex items-center space-x-2\">\n                  <span className=\"text-sm font-medium text-gray-500 w-6\">{index + 1}.</span>\n                  <input\n                    type=\"text\"\n                    value={option.text}\n                    onChange={(e) => updateOption(option.id, 'text', e.target.value)}\n                    disabled={disabled}\n                    className={`flex-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${disabled ? 'bg-gray-100' : ''}`}\n                    placeholder={t('surveys.admin.questionEditor.optionTextPlaceholder')}\n                  />\n                  {question.options && question.options.length > 2 && (\n                    <button\n                      onClick={() => removeOption(option.id)}\n                      disabled={disabled}\n                      className=\"p-1 text-gray-400 hover:text-red-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n                    >\n                      <FiX className=\"h-4 w-4\" />\n                    </button>\n                  )}\n                </div>\n              ))}\n              <button\n                onClick={addOption}\n                disabled={disabled}\n                className=\"flex items-center text-sm text-blue-600 hover:text-blue-800 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                <FiPlus className=\"mr-1 h-4 w-4\" />\n                {t('surveys.admin.questionEditor.addOption')}\n              </button>\n            </div>\n          </div>\n        )}\n\n        {/* Rating range for rating questions */}\n        {(question.type === 'rating_5' || question.type === 'rating_10') && (\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                {t('surveys.admin.questionEditor.minRating')}\n              </label>\n              <input\n                type=\"number\"\n                value={question.min_rating || 1}\n                onChange={(e) => onUpdate({ min_rating: parseInt(e.target.value) })}\n                disabled={disabled}\n                min=\"1\"\n                max={question.type === 'rating_5' ? 5 : 10}\n                className={`block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${disabled ? 'bg-gray-100' : ''}`}\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                {t('surveys.admin.questionEditor.maxRating')}\n              </label>\n              <input\n                type=\"number\"\n                value={question.max_rating || (question.type === 'rating_5' ? 5 : 10)}\n                onChange={(e) => onUpdate({ max_rating: parseInt(e.target.value) })}\n                disabled={disabled}\n                min=\"1\"\n                max={question.type === 'rating_5' ? 5 : 10}\n                className={`block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${disabled ? 'bg-gray-100' : ''}`}\n              />\n            </div>\n          </div>\n        )}\n\n        {/* Required toggle */}\n        <div className=\"flex items-center\">\n          <input\n            id={`required-${question.id}`}\n            type=\"checkbox\"\n            checked={question.required}\n            onChange={(e) => onUpdate({ required: e.target.checked })}\n            disabled={disabled}\n            className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded disabled:opacity-50\"\n          />\n          <label htmlFor={`required-${question.id}`} className=\"ml-2 block text-sm text-gray-700\">\n            {t('surveys.admin.questionEditor.requiredQuestion')}\n          </label>\n        </div>\n\n        {/* Preview */}\n        <div className=\"mt-4 p-3 bg-gray-50 rounded-md\">\n          <p className=\"text-xs text-gray-500 mb-2 font-medium\">{t('surveys.admin.questionEditor.preview')}</p>\n          <div className=\"text-sm\">\n            <p className=\"font-medium text-gray-900 mb-1\">\n              {question.text || t('surveys.admin.questionEditor.previewPlaceholder')}\n              {question.required && <span className=\"text-red-500 ml-1\">*</span>}\n            </p>\n            {question.description && (\n              <p className=\"text-xs text-gray-600 mb-2\">{question.description}</p>\n            )}\n            \n            {question.type === 'single_choice' && (\n              <div className=\"space-y-1\">\n                {question.options?.map((option) => (\n                  <label key={option.id} className=\"flex items-center\">\n                    <input type=\"radio\" name={`preview-${question.id}`} className=\"mr-2\" />\n                    <span className=\"text-sm\">{option.text}</span>\n                  </label>\n                ))}\n              </div>\n            )}\n            \n            {question.type === 'multiple_choice' && (\n              <div className=\"space-y-1\">\n                {question.options?.map((option) => (\n                  <label key={option.id} className=\"flex items-center\">\n                    <input type=\"checkbox\" className=\"mr-2\" />\n                    <span className=\"text-sm\">{option.text}</span>\n                  </label>\n                ))}\n              </div>\n            )}\n            \n            {question.type === 'text' && (\n              <input\n                type=\"text\"\n                disabled\n                className=\"w-full border-gray-300 rounded text-sm\"\n                placeholder={t('surveys.admin.questionEditor.textInputPlaceholder')}\n              />\n            )}\n            \n            {question.type === 'textarea' && (\n              <textarea\n                disabled\n                rows={3}\n                className=\"w-full border-gray-300 rounded text-sm\"\n                placeholder={t('surveys.admin.questionEditor.longTextInputPlaceholder')}\n              />\n            )}\n            \n            {(question.type === 'rating_5' || question.type === 'rating_10') && (\n              <div className=\"flex items-center space-x-1\">\n                {Array.from({ length: question.max_rating || (question.type === 'rating_5' ? 5 : 10) }, (_, i) => (\n                  <span key={i} className=\"text-gray-300 text-lg\">‚òÖ</span>\n                ))}\n              </div>\n            )}\n            \n            {question.type === 'yes_no' && (\n              <div className=\"space-y-1\">\n                <label className=\"flex items-center\">\n                  <input type=\"radio\" name={`preview-${question.id}`} className=\"mr-2\" />\n                  <span className=\"text-sm\">{t('common.yes')}</span>\n                </label>\n                <label className=\"flex items-center\">\n                  <input type=\"radio\" name={`preview-${question.id}`} className=\"mr-2\" />\n                  <span className=\"text-sm\">{t('common.no')}</span>\n                </label>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default QuestionEditor;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/surveys/QuestionRenderer.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[201,204],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[201,204],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[253,256],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[253,256],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[477,480],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[477,480],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { SurveyQuestion } from '../../types/survey';\nimport { useTranslation } from 'react-i18next';\n\ninterface QuestionRendererProps {\n  question: SurveyQuestion;\n  answer: any;\n  onAnswerChange: (questionId: string, answer: any) => void;\n  error?: string;\n}\n\nconst QuestionRenderer: React.FC<QuestionRendererProps> = ({\n  question,\n  answer,\n  onAnswerChange,\n  error\n}) => {\n  const { t } = useTranslation();\n\n  const handleAnswerChange = (value: any) => {\n    onAnswerChange(question.id, value);\n  };\n\n  const renderQuestion = () => {\n    switch (question.type) {\n      case 'single_choice':\n        return (\n          <div className=\"space-y-3\">\n            {question.options?.map((option) => {\n              // Convert both to strings for comparison to handle type mismatches\n              const isChecked = String(answer) === String(option.value);\n              return (\n                <label key={option.id} className=\"flex items-center cursor-pointer hover:bg-gray-50 p-2 rounded-md transition-colors\">\n                  <input\n                    type=\"radio\"\n                    name={`question_${question.id}`}\n                    value={option.value}\n                    checked={isChecked}\n                    onChange={(e) => handleAnswerChange(e.target.value)}\n                    className=\"mr-3 h-4 w-4 text-blue-600 focus:ring-blue-500 focus:ring-2 border-gray-300\"\n                  />\n                  <span className={`text-gray-700 select-none ${isChecked ? 'font-medium text-blue-700' : ''}`}>{option.text}</span>\n                </label>\n              );\n            })}\n          </div>\n        );\n\n      case 'multiple_choice':\n        return (\n          <div className=\"space-y-3\">\n            {question.options?.map((option) => (\n              <label key={option.id} className=\"flex items-center cursor-pointer hover:bg-gray-50 p-2 rounded-md transition-colors\">\n                <input\n                  type=\"checkbox\"\n                  checked={Array.isArray(answer) && answer.includes(option.value)}\n                  onChange={(e) => {\n                    const currentAnswers = Array.isArray(answer) ? answer : [];\n                    if (e.target.checked) {\n                      handleAnswerChange([...currentAnswers, option.value]);\n                    } else {\n                      handleAnswerChange(currentAnswers.filter(a => a !== option.value));\n                    }\n                  }}\n                  className=\"mr-3 h-4 w-4 text-blue-600 focus:ring-blue-500 focus:ring-2 border-gray-300 rounded\"\n                />\n                <span className={`text-gray-700 select-none ${Array.isArray(answer) && answer.includes(option.value) ? 'font-medium text-blue-700' : ''}`}>{option.text}</span>\n              </label>\n            ))}\n          </div>\n        );\n\n      case 'text':\n        return (\n          <input\n            type=\"text\"\n            value={answer || ''}\n            onChange={(e) => handleAnswerChange(e.target.value)}\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n            placeholder={t('surveys.enterAnswer', 'Enter your answer...')}\n          />\n        );\n\n      case 'textarea':\n        return (\n          <textarea\n            value={answer || ''}\n            onChange={(e) => handleAnswerChange(e.target.value)}\n            rows={4}\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n            placeholder={t('surveys.enterAnswer', 'Enter your answer...')}\n          />\n        );\n\n      case 'rating_5':\n        return (\n          <div className=\"flex items-center space-x-2\">\n            <span className=\"text-sm text-gray-500\">1</span>\n            {[1, 2, 3, 4, 5].map((rating) => (\n              <button\n                key={rating}\n                type=\"button\"\n                onClick={() => handleAnswerChange(rating)}\n                className={`w-10 h-10 rounded-full border-2 font-medium transition-colors ${\n                  Number(answer) === rating\n                    ? 'bg-blue-600 text-white border-blue-600'\n                    : 'bg-white text-gray-700 border-gray-300 hover:border-blue-300'\n                }`}\n              >\n                {rating}\n              </button>\n            ))}\n            <span className=\"text-sm text-gray-500\">5</span>\n          </div>\n        );\n\n      case 'rating_10':\n        return (\n          <div className=\"grid grid-cols-5 gap-2\">\n            {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map((rating) => (\n              <button\n                key={rating}\n                type=\"button\"\n                onClick={() => handleAnswerChange(rating)}\n                className={`w-12 h-10 rounded border-2 font-medium transition-colors ${\n                  Number(answer) === rating\n                    ? 'bg-blue-600 text-white border-blue-600'\n                    : 'bg-white text-gray-700 border-gray-300 hover:border-blue-300'\n                }`}\n              >\n                {rating}\n              </button>\n            ))}\n          </div>\n        );\n\n      case 'yes_no':\n        return (\n          <div className=\"flex space-x-4\">\n            <label className=\"flex items-center cursor-pointer hover:bg-gray-50 p-2 rounded-md transition-colors\">\n              <input\n                type=\"radio\"\n                name={`question_${question.id}`}\n                value=\"yes\"\n                checked={String(answer) === 'yes'}\n                onChange={(e) => handleAnswerChange(e.target.value)}\n                className=\"mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 focus:ring-2 border-gray-300\"\n              />\n              <span className={`text-gray-700 select-none ${String(answer) === 'yes' ? 'font-medium text-blue-700' : ''}`}>{t('common.yes', 'Yes')}</span>\n            </label>\n            <label className=\"flex items-center cursor-pointer hover:bg-gray-50 p-2 rounded-md transition-colors\">\n              <input\n                type=\"radio\"\n                name={`question_${question.id}`}\n                value=\"no\"\n                checked={String(answer) === 'no'}\n                onChange={(e) => handleAnswerChange(e.target.value)}\n                className=\"mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 focus:ring-2 border-gray-300\"\n              />\n              <span className={`text-gray-700 select-none ${String(answer) === 'no' ? 'font-medium text-blue-700' : ''}`}>{t('common.no', 'No')}</span>\n            </label>\n          </div>\n        );\n\n      default:\n        return (\n          <div className=\"text-red-500\">\n            {t('surveys.unknownQuestionType', 'Unknown question type')}: {question.type}\n          </div>\n        );\n    }\n  };\n\n  return (\n    <div className=\"mb-6\">\n      <div className=\"mb-4\">\n        <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n          {question.text}\n          {question.required && <span className=\"text-red-500 ml-1\">*</span>}\n        </h3>\n        {question.description && (\n          <p className=\"text-sm text-gray-600 mb-3\">{question.description}</p>\n        )}\n      </div>\n\n      {renderQuestion()}\n\n      {error && (\n        <p className=\"mt-2 text-sm text-red-600\">{error}</p>\n      )}\n    </div>\n  );\n};\n\nexport default QuestionRenderer;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/surveys/SurveyCouponAssignments.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FiCalendar' is defined but never used.","line":3,"column":53,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":63},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":136,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":136,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[5029,5031],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":154,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":154,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[5896,5898],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":283,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":283,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11048,11050],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":298,"column":43,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":298,"endColumn":45,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11765,11767],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'surveyTitle' is defined but never used.","line":343,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":343,"endColumn":14},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":356,"column":6,"nodeType":"ArrayExpression","endLine":356,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [loadData, surveyId]","fix":{"range":[13985,13995],"text":"[loadData, surveyId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":368,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":368,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14398,14401],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14398,14401],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":369,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":369,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[14411,14476],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":382,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":382,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14879,14882],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14879,14882],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":383,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":383,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[14892,14940],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":401,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":401,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15518,15521],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15518,15521],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":402,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":402,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[15531,15582],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-alert","severity":1,"message":"Unexpected confirm.","line":408,"column":10,"nodeType":"CallExpression","messageId":"unexpected","endLine":408,"endColumn":68},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":414,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":414,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16068,16071],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16068,16071],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":415,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":415,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[16081,16132],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { FiPlus, FiEdit, FiTrash2, FiGift, FiUsers, FiCalendar } from 'react-icons/fi';\nimport toast from 'react-hot-toast';\nimport { \n  SurveyCouponDetails, \n  AssignCouponToSurveyRequest, \n  UpdateSurveyCouponAssignmentRequest\n} from '../../types/survey';\nimport { Coupon } from '../../types/coupon';\nimport { surveyService } from '../../services/surveyService';\nimport { couponService } from '../../services/couponService';\n\ninterface SurveyCouponAssignmentsProps {\n  surveyId: string;\n  surveyTitle: string;\n  surveyStatus: string;\n}\n\ninterface AssignCouponModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onAssign: (data: AssignCouponToSurveyRequest) => void;\n  surveyId: string;\n  coupons: Coupon[];\n  existingAssignments: SurveyCouponDetails[];\n}\n\ninterface EditAssignmentModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onUpdate: (data: UpdateSurveyCouponAssignmentRequest) => void;\n  assignment: SurveyCouponDetails | null;\n}\n\nconst AssignCouponModal: React.FC<AssignCouponModalProps> = ({\n  isOpen,\n  onClose,\n  onAssign,\n  surveyId,\n  coupons,\n  existingAssignments\n}) => {\n  const { t } = useTranslation();\n  const [selectedCouponId, setSelectedCouponId] = useState('');\n  // Note: Coupons are always awarded on survey completion\n  const [maxAwards, setMaxAwards] = useState<number | undefined>();\n  const [customExpiryDays, setCustomExpiryDays] = useState<number | undefined>();\n  const [assignedReason, setAssignedReason] = useState('Survey completion reward');\n\n  const assignedCouponIds = new Set(existingAssignments.map(a => a.coupon_id));\n  const availableCoupons = coupons.filter(c => \n    c.status === 'active' && !assignedCouponIds.has(c.id)\n  );\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!selectedCouponId) {\n      toast.error(t('surveys.admin.couponAssignment.selectCoupon'));\n      return;\n    }\n\n    onAssign({\n      survey_id: surveyId,\n      coupon_id: selectedCouponId,\n      max_awards: maxAwards,\n      custom_expiry_days: customExpiryDays,\n      assigned_reason: assignedReason\n    });\n\n    // Reset form\n    setSelectedCouponId('');\n    setMaxAwards(undefined);\n    setCustomExpiryDays(undefined);\n    setAssignedReason('Survey completion reward');\n  };\n\n  if (!isOpen) {return null;}\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto\">\n        <div className=\"p-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\n            {t('surveys.admin.couponAssignment.assignCoupon')}\n          </h3>\n\n          <form onSubmit={handleSubmit}>\n            <div className=\"space-y-4\">\n              {/* Coupon Selection */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  {t('coupons.coupon')} *\n                </label>\n                <select\n                  value={selectedCouponId}\n                  onChange={(e) => setSelectedCouponId(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  required\n                >\n                  <option value=\"\">{t('surveys.admin.couponAssignment.selectCoupon')}</option>\n                  {availableCoupons.map(coupon => (\n                    <option key={coupon.id} value={coupon.id}>\n                      {coupon.code} - {coupon.name}\n                      {coupon.type === 'percentage' && ` (${coupon.value}% off)`}\n                      {coupon.type === 'fixed_amount' && ` (${coupon.currency} ${coupon.value} off)`}\n                    </option>\n                  ))}\n                </select>\n                {availableCoupons.length === 0 && (\n                  <p className=\"text-sm text-gray-500 mt-1\">\n                    {t('surveys.admin.couponAssignment.noAvailableCoupons')}\n                  </p>\n                )}\n              </div>\n\n              {/* Award Condition - Always completion */}\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                <h4 className=\"text-sm font-medium text-blue-900 mb-2 flex items-center\">\n                  <FiGift className=\"mr-2\" />\n                  {t('surveys.admin.couponAssignment.rewardCondition')}\n                </h4>\n                <p className=\"text-sm text-blue-700\">\n                  {t('surveys.admin.couponAssignment.alwaysOnCompletion')}\n                </p>\n              </div>\n\n              {/* Max Awards */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  {t('surveys.admin.couponAssignment.maxAwards')}\n                </label>\n                <input\n                  type=\"number\"\n                  min=\"1\"\n                  value={maxAwards || ''}\n                  onChange={(e) => setMaxAwards(e.target.value ? parseInt(e.target.value) : undefined)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  placeholder={t('surveys.admin.couponAssignment.unlimited')}\n                />\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  {t('surveys.admin.couponAssignment.maxAwardsHelp')}\n                </p>\n              </div>\n\n              {/* Custom Expiry */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  {t('surveys.admin.couponAssignment.customExpiry')}\n                </label>\n                <input\n                  type=\"number\"\n                  min=\"1\"\n                  value={customExpiryDays || ''}\n                  onChange={(e) => setCustomExpiryDays(e.target.value ? parseInt(e.target.value) : undefined)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  placeholder={t('surveys.admin.couponAssignment.useCouponExpiry')}\n                />\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  {t('surveys.admin.couponAssignment.customExpiryHelp')}\n                </p>\n              </div>\n\n              {/* Assigned Reason */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  {t('surveys.admin.couponAssignment.reason')}\n                </label>\n                <textarea\n                  value={assignedReason}\n                  onChange={(e) => setAssignedReason(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  rows={2}\n                  placeholder={t('surveys.admin.couponAssignment.reasonPlaceholder')}\n                />\n              </div>\n            </div>\n\n            <div className=\"flex justify-end space-x-3 mt-6\">\n              <button\n                type=\"button\"\n                onClick={onClose}\n                className=\"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors\"\n              >\n                {t('common.cancel')}\n              </button>\n              <button\n                type=\"submit\"\n                disabled={!selectedCouponId}\n                className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n              >\n                {t('surveys.admin.couponAssignment.assign')}\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst EditAssignmentModal: React.FC<EditAssignmentModalProps> = ({\n  isOpen,\n  onClose,\n  onUpdate,\n  assignment\n}) => {\n  const { t } = useTranslation();\n  // Note: Coupons are always awarded on survey completion\n  const [maxAwards, setMaxAwards] = useState<number | undefined>();\n  const [customExpiryDays, setCustomExpiryDays] = useState<number | undefined>();\n  const [assignedReason, setAssignedReason] = useState('');\n  const [isActive, setIsActive] = useState(true);\n\n  useEffect(() => {\n    if (assignment) {\n      setMaxAwards(assignment.max_awards);\n      setCustomExpiryDays(assignment.custom_expiry_days);\n      setAssignedReason(assignment.assigned_reason);\n      setIsActive(assignment.is_active);\n    }\n  }, [assignment]);\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onUpdate({\n      max_awards: maxAwards,\n      custom_expiry_days: customExpiryDays,\n      assigned_reason: assignedReason,\n      is_active: isActive\n    });\n  };\n\n  if (!isOpen || !assignment) {return null;}\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto\">\n        <div className=\"p-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\n            {t('surveys.couponAssignment.editAssignment')}\n          </h3>\n          <p className=\"text-sm text-gray-600 mb-4\">\n            {t('coupons.coupon')}: <strong>{assignment.coupon_code} - {assignment.coupon_name}</strong>\n          </p>\n\n          <form onSubmit={handleSubmit}>\n            <div className=\"space-y-4\">\n              {/* Active Status */}\n              <div>\n                <label className=\"flex items-center\">\n                  <input\n                    type=\"checkbox\"\n                    checked={isActive}\n                    onChange={(e) => setIsActive(e.target.checked)}\n                    className=\"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50\"\n                  />\n                  <span className=\"ml-2 text-sm text-gray-700\">\n                    {t('common.active')}\n                  </span>\n                </label>\n              </div>\n\n              {/* Award Condition - Always completion */}\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                <h4 className=\"text-sm font-medium text-blue-900 mb-2 flex items-center\">\n                  <FiGift className=\"mr-2\" />\n                  {t('surveys.admin.couponAssignment.rewardCondition')}\n                </h4>\n                <p className=\"text-sm text-blue-700\">\n                  {t('surveys.admin.couponAssignment.alwaysOnCompletion')}\n                </p>\n              </div>\n\n              {/* Max Awards */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  {t('surveys.admin.couponAssignment.maxAwards')}\n                </label>\n                <input\n                  type=\"number\"\n                  min=\"1\"\n                  value={maxAwards || ''}\n                  onChange={(e) => setMaxAwards(e.target.value ? parseInt(e.target.value) : undefined)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  placeholder={t('surveys.admin.couponAssignment.unlimited')}\n                />\n              </div>\n\n              {/* Custom Expiry */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  {t('surveys.admin.couponAssignment.customExpiry')}\n                </label>\n                <input\n                  type=\"number\"\n                  min=\"1\"\n                  value={customExpiryDays || ''}\n                  onChange={(e) => setCustomExpiryDays(e.target.value ? parseInt(e.target.value) : undefined)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  placeholder={t('surveys.admin.couponAssignment.useCouponExpiry')}\n                />\n              </div>\n\n              {/* Assigned Reason */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  {t('surveys.admin.couponAssignment.reason')}\n                </label>\n                <textarea\n                  value={assignedReason}\n                  onChange={(e) => setAssignedReason(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  rows={2}\n                />\n              </div>\n            </div>\n\n            <div className=\"flex justify-end space-x-3 mt-6\">\n              <button\n                type=\"button\"\n                onClick={onClose}\n                className=\"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors\"\n              >\n                {t('common.cancel')}\n              </button>\n              <button\n                type=\"submit\"\n                className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors\"\n              >\n                {t('common.save')}\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst SurveyCouponAssignments: React.FC<SurveyCouponAssignmentsProps> = ({\n  surveyId,\n  surveyTitle,\n  surveyStatus\n}) => {\n  const { t } = useTranslation();\n  const [assignments, setAssignments] = useState<SurveyCouponDetails[]>([]);\n  const [coupons, setCoupons] = useState<Coupon[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showAssignModal, setShowAssignModal] = useState(false);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [editingAssignment, setEditingAssignment] = useState<SurveyCouponDetails | null>(null);\n\n  useEffect(() => {\n    loadData();\n  }, [surveyId]);\n\n  const loadData = async () => {\n    try {\n      setLoading(true);\n      const [assignmentsResponse, couponsResponse] = await Promise.all([\n        surveyService.getSurveyCouponAssignments(surveyId),\n        couponService.listCoupons(1, 100, { status: 'active' })\n      ]);\n      \n      setAssignments(assignmentsResponse.assignments);\n      setCoupons(couponsResponse.coupons);\n    } catch (error: any) {\n      console.error('Error loading survey coupon assignments:', error);\n      toast.error(t('surveys.admin.couponAssignment.loadError'));\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleAssignCoupon = async (data: AssignCouponToSurveyRequest) => {\n    try {\n      await surveyService.assignCouponToSurvey(data);\n      toast.success(t('surveys.admin.couponAssignment.assignSuccess'));\n      setShowAssignModal(false);\n      loadData();\n    } catch (error: any) {\n      console.error('Error assigning coupon:', error);\n      toast.error(error.response?.data?.message || t('surveys.admin.couponAssignment.assignError'));\n    }\n  };\n\n  const handleUpdateAssignment = async (data: UpdateSurveyCouponAssignmentRequest) => {\n    if (!editingAssignment) {return;}\n\n    try {\n      await surveyService.updateSurveyCouponAssignment(\n        editingAssignment.survey_id,\n        editingAssignment.coupon_id,\n        data\n      );\n      toast.success(t('surveys.admin.couponAssignment.updateSuccess'));\n      setShowEditModal(false);\n      setEditingAssignment(null);\n      loadData();\n    } catch (error: any) {\n      console.error('Error updating assignment:', error);\n      toast.error(error.response?.data?.message || t('surveys.admin.couponAssignment.updateError'));\n    }\n  };\n\n  const handleRemoveAssignment = async (assignment: SurveyCouponDetails) => {\n    if (!confirm(t('surveys.admin.couponAssignment.confirmRemove'))) {return;}\n\n    try {\n      await surveyService.removeCouponFromSurvey(assignment.survey_id, assignment.coupon_id);\n      toast.success(t('surveys.admin.couponAssignment.removeSuccess'));\n      loadData();\n    } catch (error: any) {\n      console.error('Error removing assignment:', error);\n      toast.error(error.response?.data?.message || t('surveys.admin.couponAssignment.removeError'));\n    }\n  };\n\n  const openEditModal = (assignment: SurveyCouponDetails) => {\n    setEditingAssignment(assignment);\n    setShowEditModal(true);\n  };\n\n  if (loading) {\n    return (\n      <div className=\"bg-white rounded-lg shadow p-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-6 bg-gray-200 rounded w-1/4 mb-4\" />\n          <div className=\"space-y-3\">\n            <div className=\"h-4 bg-gray-200 rounded\" />\n            <div className=\"h-4 bg-gray-200 rounded w-5/6\" />\n            <div className=\"h-4 bg-gray-200 rounded w-4/6\" />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white rounded-lg shadow\">\n      <div className=\"p-6 border-b border-gray-200\">\n        <div className=\"flex justify-between items-center\">\n          <div>\n            <h3 className=\"text-lg font-medium text-gray-900\">\n              {t('surveys.admin.couponAssignment.title')}\n            </h3>\n            <p className=\"text-sm text-gray-500 mt-1\">\n              {t('surveys.admin.couponAssignment.description')}\n            </p>\n          </div>\n          <button\n            onClick={() => setShowAssignModal(true)}\n            className=\"flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors\"\n            disabled={surveyStatus !== 'active'}\n          >\n            <FiPlus className=\"mr-2\" />\n            {t('surveys.admin.couponAssignment.assignCoupon')}\n          </button>\n        </div>\n      </div>\n\n      <div className=\"p-6\">\n        {assignments.length === 0 ? (\n          <div className=\"text-center py-8\">\n            <FiGift className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n            <p className=\"text-gray-500\">{t('surveys.admin.couponAssignment.noAssignments')}</p>\n            <p className=\"text-sm text-gray-400 mt-2\">\n              {t('surveys.admin.couponAssignment.noAssignmentsHelp')}\n            </p>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            {assignments.map((assignment) => (\n              <div\n                key={assignment.assignment_id}\n                className=\"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors\"\n              >\n                <div className=\"flex justify-between items-start\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center space-x-3 mb-2\">\n                      <h4 className=\"font-medium text-gray-900\">\n                        {assignment.coupon_code} - {assignment.coupon_name}\n                      </h4>\n                      <span className={`px-2 py-1 rounded-full text-xs font-medium ${\n                        assignment.is_active\n                          ? 'bg-green-100 text-green-800'\n                          : 'bg-gray-100 text-gray-800'\n                      }`}\n                      >\n                        {assignment.is_active ? t('common.active') : t('common.inactive')}\n                      </span>\n                    </div>\n\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600\">\n                      <div className=\"flex items-center\">\n                        <FiGift className=\"mr-2 text-blue-500\" />\n                        <span>\n                          {assignment.coupon_type === 'percentage' && `${assignment.coupon_value}% off`}\n                          {assignment.coupon_type === 'fixed_amount' && `${assignment.coupon_currency} ${assignment.coupon_value} off`}\n                          {assignment.coupon_type === 'free_upgrade' && t('coupons.freeUpgrade')}\n                          {assignment.coupon_type === 'free_service' && t('coupons.freeService')}\n                        </span>\n                      </div>\n\n                      <div className=\"flex items-center\">\n                        <FiUsers className=\"mr-2 text-green-500\" />\n                        <span>\n                          {t('surveys.admin.couponAssignment.awarded')}: {assignment.awarded_count}\n                          {assignment.max_awards && ` / ${assignment.max_awards}`}\n                        </span>\n                      </div>\n\n                      <div className=\"flex items-center\">\n                        <FiGift className=\"mr-2 text-orange-500\" />\n                        <span>\n                          {t('surveys.admin.couponAssignment.awardedOnCompletion')}\n                        </span>\n                      </div>\n                    </div>\n\n                    {assignment.assigned_reason && (\n                      <p className=\"text-sm text-gray-500 mt-2\">\n                        {t('surveys.admin.couponAssignment.reason')}: {assignment.assigned_reason}\n                      </p>\n                    )}\n                  </div>\n\n                  <div className=\"flex space-x-2 ml-4\">\n                    <button\n                      onClick={() => openEditModal(assignment)}\n                      className=\"p-2 text-gray-400 hover:text-blue-600 transition-colors\"\n                      title={t('common.edit')}\n                    >\n                      <FiEdit className=\"h-4 w-4\" />\n                    </button>\n                    <button\n                      onClick={() => handleRemoveAssignment(assignment)}\n                      className=\"p-2 text-gray-400 hover:text-red-600 transition-colors\"\n                      title={t('common.remove')}\n                    >\n                      <FiTrash2 className=\"h-4 w-4\" />\n                    </button>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n\n      <AssignCouponModal\n        isOpen={showAssignModal}\n        onClose={() => setShowAssignModal(false)}\n        onAssign={handleAssignCoupon}\n        surveyId={surveyId}\n        coupons={coupons}\n        existingAssignments={assignments}\n      />\n\n      <EditAssignmentModal\n        isOpen={showEditModal}\n        onClose={() => {\n          setShowEditModal(false);\n          setEditingAssignment(null);\n        }}\n        onUpdate={handleUpdateAssignment}\n        assignment={editingAssignment}\n      />\n    </div>\n  );\n};\n\nexport default SurveyCouponAssignments;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/surveys/SurveyPreview.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[521,524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[521,524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[591,594],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[591,594],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":86,"column":16,"nodeType":"MemberExpression","endLine":86,"endColumn":49},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":88,"column":29,"nodeType":"MemberExpression","endLine":88,"endColumn":62},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":89,"column":35,"nodeType":"MemberExpression","endLine":89,"endColumn":68},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":131,"column":33,"nodeType":"MemberExpression","endLine":131,"endColumn":56}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { FiX, FiArrowLeft, FiArrowRight } from 'react-icons/fi';\nimport { Survey } from '../../types/survey';\nimport QuestionRenderer from './QuestionRenderer';\nimport SurveyProgress from './SurveyProgress';\n\ninterface SurveyPreviewProps {\n  survey: Survey;\n  onClose: () => void;\n}\n\nconst SurveyPreview: React.FC<SurveyPreviewProps> = ({ survey, onClose }) => {\n  const [currentQuestion, setCurrentQuestion] = useState(0);\n  const [answers, setAnswers] = useState<Record<string, any>>({});\n\n  const handleAnswerChange = (questionId: string, answer: any) => {\n    setAnswers(prev => ({\n      ...prev,\n      [questionId]: answer\n    }));\n  };\n\n  const goToNext = () => {\n    if (currentQuestion < survey.questions.length - 1) {\n      setCurrentQuestion(prev => prev + 1);\n    }\n  };\n\n  const goToPrevious = () => {\n    if (currentQuestion > 0) {\n      setCurrentQuestion(prev => prev - 1);\n    }\n  };\n\n  const goToQuestion = (index: number) => {\n    setCurrentQuestion(index);\n  };\n\n  const calculateProgress = () => {\n    const answeredQuestions = Object.keys(answers).length;\n    return Math.round((answeredQuestions / survey.questions.length) * 100);\n  };\n\n  const isLastQuestion = currentQuestion >= survey.questions.length - 1;\n  const isCompletionPage = currentQuestion >= survey.questions.length;\n\n  return (\n    <div className=\"bg-white shadow rounded-lg\">\n      {/* Preview Header */}\n      <div className=\"bg-blue-50 px-6 py-4 border-b rounded-t-lg\">\n        <div className=\"flex justify-between items-center\">\n          <div>\n            <h2 className=\"text-lg font-semibold text-gray-900\">Survey Preview</h2>\n            <p className=\"text-sm text-gray-600\">This is how your survey will appear to customers</p>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600\"\n          >\n            <FiX className=\"h-6 w-6\" />\n          </button>\n        </div>\n      </div>\n\n      {/* Survey Preview Content */}\n      <div className=\"p-6\">\n        {!isCompletionPage ? (\n          <>\n            {/* Survey Header */}\n            <div className=\"text-center mb-6\">\n              <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">{survey.title}</h1>\n              {survey.description && (\n                <p className=\"text-gray-600\">{survey.description}</p>\n              )}\n            </div>\n\n            {/* Progress */}\n            <SurveyProgress\n              current={currentQuestion + 1}\n              total={survey.questions.length}\n              progress={calculateProgress()}\n            />\n\n            {/* Current Question */}\n            <div className=\"bg-gray-50 rounded-lg p-6 mb-6 min-h-[300px]\">\n              {survey.questions[currentQuestion] && (\n                <QuestionRenderer\n                  question={survey.questions[currentQuestion]}\n                  answer={answers[survey.questions[currentQuestion].id]}\n                  onAnswerChange={handleAnswerChange}\n                  error=\"\"\n                />\n              )}\n            </div>\n\n            {/* Navigation */}\n            <div className=\"flex justify-between items-center mb-4\">\n              <button\n                onClick={goToPrevious}\n                disabled={currentQuestion === 0}\n                className=\"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                <FiArrowLeft className=\"mr-2 h-4 w-4\" />\n                Previous\n              </button>\n\n              <div className=\"flex items-center space-x-2\">\n                <span className=\"text-sm text-gray-500\">\n                  Question {currentQuestion + 1} of {survey.questions.length}\n                </span>\n              </div>\n\n              <button\n                onClick={goToNext}\n                className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700\"\n              >\n                {isLastQuestion ? 'Complete Survey' : 'Next'}\n                <FiArrowRight className=\"ml-2 h-4 w-4\" />\n              </button>\n            </div>\n\n            {/* Question Navigation Dots */}\n            <div className=\"flex justify-center space-x-2\">\n              {survey.questions.map((_, index) => (\n                <button\n                  key={index}\n                  onClick={() => goToQuestion(index)}\n                  className={`w-3 h-3 rounded-full transition-colors ${\n                    index === currentQuestion\n                      ? 'bg-blue-600'\n                      : answers[survey.questions[index].id]\n                      ? 'bg-green-400'\n                      : 'bg-gray-300'\n                  }`}\n                />\n              ))}\n            </div>\n          </>\n        ) : (\n          /* Completion Page */\n          <div className=\"text-center py-12\">\n            <div className=\"text-6xl mb-4\">üéâ</div>\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">\n              Survey Completed!\n            </h2>\n            <p className=\"text-gray-600 mb-6\">\n              Thank you for taking the time to complete this survey. Your feedback is valuable to us.\n            </p>\n            \n            <div className=\"bg-green-50 border border-green-200 rounded-lg p-4 mb-6\">\n              <p className=\"text-green-800 text-sm\">\n                ‚úì Your responses have been saved successfully\n              </p>\n            </div>\n\n            <button className=\"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md\">\n              Back to Surveys\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* Preview Footer */}\n      <div className=\"bg-gray-50 px-6 py-3 border-t rounded-b-lg\">\n        <div className=\"flex justify-between items-center text-sm text-gray-600\">\n          <span>Preview Mode - No responses will be saved</span>\n          <button\n            onClick={onClose}\n            className=\"text-blue-600 hover:text-blue-800 font-medium\"\n          >\n            Close Preview\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default SurveyPreview;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/surveys/SurveyProgress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/surveys/SurveyRewardHistory.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'surveyTitle' is defined but never used.","line":15,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":14},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadRewardHistory'. Either include it or remove the dependency array.","line":26,"column":6,"nodeType":"ArrayExpression","endLine":26,"endColumn":29,"suggestions":[{"desc":"Update the dependencies array to be: [surveyId, currentPage, loadRewardHistory]","fix":{"range":[880,903],"text":"[surveyId, currentPage, loadRewardHistory]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1175,1178],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1175,1178],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":35,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":35,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1188,1242],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":43,"column":73,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":43,"endColumn":75,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[1411,1552],"text":"(reward.user_email?.toLowerCase().includes(searchTerm.toLowerCase()) ??\n    reward.user_name?.toLowerCase().includes(searchTerm.toLowerCase()))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":44,"column":72,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":44,"endColumn":74,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[1486,1628],"text":"(reward.user_name?.toLowerCase().includes(searchTerm.toLowerCase()) ??\n    reward.coupon_code?.toLowerCase().includes(searchTerm.toLowerCase()))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":45,"column":74,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":45,"endColumn":76,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[1629,1631],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":136,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":136,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[5217,5219],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { FiGift, FiUser, FiCalendar, FiSearch } from 'react-icons/fi';\nimport toast from 'react-hot-toast';\nimport { SurveyRewardHistory } from '../../types/survey';\nimport { surveyService } from '../../services/surveyService';\n\ninterface SurveyRewardHistoryProps {\n  surveyId: string;\n  surveyTitle: string;\n}\n\nconst SurveyRewardHistoryComponent: React.FC<SurveyRewardHistoryProps> = ({\n  surveyId,\n  surveyTitle\n}) => {\n  const { t } = useTranslation();\n  const [rewards, setRewards] = useState<SurveyRewardHistory[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [searchTerm, setSearchTerm] = useState('');\n\n  useEffect(() => {\n    loadRewardHistory();\n  }, [surveyId, currentPage]);\n\n  const loadRewardHistory = async () => {\n    try {\n      setLoading(true);\n      const response = await surveyService.getSurveyRewardHistory(surveyId, currentPage, 20);\n      setRewards(response.rewards);\n      setTotalPages(response.totalPages);\n    } catch (error: any) {\n      console.error('Error loading reward history:', error);\n      toast.error(t('surveys.couponAssignment.loadError'));\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const filteredRewards = rewards.filter(reward =>\n    reward.user_email?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    reward.user_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    reward.coupon_code?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    reward.coupon_name?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleString();\n  };\n\n  if (loading && currentPage === 1) {\n    return (\n      <div className=\"bg-white rounded-lg shadow p-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-6 bg-gray-200 rounded w-1/4 mb-4\" />\n          <div className=\"space-y-3\">\n            {[1, 2, 3].map(i => (\n              <div key={i} className=\"h-16 bg-gray-200 rounded\" />\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white rounded-lg shadow\">\n      <div className=\"p-6 border-b border-gray-200\">\n        <div className=\"flex justify-between items-center mb-4\">\n          <div>\n            <h3 className=\"text-lg font-medium text-gray-900\">\n              {t('surveys.rewardHistory.title')}\n            </h3>\n            <p className=\"text-sm text-gray-500 mt-1\">\n              {t('surveys.rewardHistory.description')}\n            </p>\n          </div>\n        </div>\n\n        {/* Search */}\n        <div className=\"relative\">\n          <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n            <FiSearch className=\"h-5 w-5 text-gray-400\" />\n          </div>\n          <input\n            type=\"text\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n            placeholder={t('surveys.rewardHistory.searchPlaceholder')}\n          />\n        </div>\n      </div>\n\n      <div className=\"p-6\">\n        {filteredRewards.length === 0 ? (\n          <div className=\"text-center py-8\">\n            <FiGift className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n            <p className=\"text-gray-500\">\n              {rewards.length === 0 \n                ? t('surveys.rewardHistory.noRewardsAwarded')\n                : t('surveys.rewardHistory.noRewardsMatch')\n              }\n            </p>\n            <p className=\"text-sm text-gray-400 mt-2\">\n              {rewards.length === 0 \n                ? t('surveys.rewardHistory.couponsWillAppear')\n                : t('surveys.rewardHistory.tryAdjustingSearch')\n              }\n            </p>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            {filteredRewards.map((reward) => (\n              <div\n                key={reward.id}\n                className=\"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors\"\n              >\n                <div className=\"flex justify-between items-start\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center space-x-3 mb-2\">\n                      <div className=\"flex items-center\">\n                        <FiGift className=\"h-5 w-5 text-blue-500 mr-2\" />\n                        <h4 className=\"font-medium text-gray-900\">\n                          {reward.coupon_code} - {reward.coupon_name}\n                        </h4>\n                      </div>\n                    </div>\n\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600\">\n                      <div className=\"flex items-center\">\n                        <FiUser className=\"mr-2 text-green-500\" />\n                        <span>\n                          {reward.user_name || 'Unknown User'} ({reward.user_email})\n                        </span>\n                      </div>\n\n                      <div className=\"flex items-center\">\n                        <FiCalendar className=\"mr-2 text-orange-500\" />\n                        <span>\n                          {t('surveys.rewardHistory.awarded')}: {formatDate(reward.awarded_at)}\n                        </span>\n                      </div>\n                    </div>\n\n                    {reward.metadata && (\n                      <div className=\"mt-2 text-sm text-gray-500\">\n                        <details className=\"group\">\n                          <summary className=\"cursor-pointer hover:text-gray-700\">\n                            {t('surveys.rewardHistory.viewDetails')}\n                          </summary>\n                          <div className=\"mt-2 p-3 bg-gray-50 rounded border\">\n                            <pre className=\"text-xs overflow-x-auto\">\n                              {JSON.stringify(reward.metadata, null, 2)}\n                            </pre>\n                          </div>\n                        </details>\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"ml-4\">\n                    <span className=\"px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full\">\n                      {t('surveys.couponAssignment.completed')}\n                    </span>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {/* Pagination */}\n        {totalPages > 1 && (\n          <div className=\"flex justify-between items-center mt-6 pt-4 border-t border-gray-200\">\n            <p className=\"text-sm text-gray-700\">\n              {t('surveys.rewardHistory.page')} {currentPage} {t('surveys.rewardHistory.of')} {totalPages}\n            </p>\n            <div className=\"flex space-x-2\">\n              <button\n                onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))}\n                disabled={currentPage === 1}\n                className=\"px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {t('surveys.rewardHistory.previous')}\n              </button>\n              <button\n                onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))}\n                disabled={currentPage === totalPages}\n                className=\"px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {t('surveys.rewardHistory.next')}\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default SurveyRewardHistoryComponent;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/translation/LanguageTabs.tsx","messages":[{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":35,"column":12,"nodeType":"MemberExpression","endLine":35,"endColumn":35},{"ruleId":"security/detect-object-injection","severity":1,"message":"Variable Assigned to Object Injection Sink","line":45,"column":20,"nodeType":"MemberExpression","endLine":45,"endColumn":47},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":184,"column":9,"nodeType":"MemberExpression","endLine":184,"endColumn":23},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":184,"column":27,"nodeType":"MemberExpression","endLine":184,"endColumn":41},{"ruleId":"security/detect-object-injection","severity":1,"message":"Variable Assigned to Object Injection Sink","line":212,"column":26,"nodeType":"MemberExpression","endLine":212,"endColumn":46},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":213,"column":25,"nodeType":"MemberExpression","endLine":213,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { SupportedLanguage } from '../../types/multilingual';\nimport { FiCheck, FiClock, FiAlertCircle, FiFile } from 'react-icons/fi';\n\ninterface LanguageTabsProps {\n  languages: SupportedLanguage[];\n  currentLanguage: SupportedLanguage;\n  onLanguageChange: (language: SupportedLanguage) => void;\n  translationStatus?: { [key in SupportedLanguage]?: 'original' | 'translated' | 'pending' | 'error' };\n  isLoading?: boolean;\n  className?: string;\n  'aria-label'?: string;\n}\n\nconst LanguageTabs: React.FC<LanguageTabsProps> = ({\n  languages,\n  currentLanguage,\n  onLanguageChange,\n  translationStatus = {},\n  isLoading = false,\n  className = '',\n  'aria-label': ariaLabel = 'Language selection'\n}) => {\n  const { t } = useTranslation();\n\n  // Memoize language display names for performance\n  const languageNames = useMemo(() => ({\n    'th': '‡πÑ‡∏ó‡∏¢',\n    'en': 'English',\n    'zh-CN': '‰∏≠Êñá'\n  } as const), []);\n\n  const getLanguageDisplayName = useCallback((language: SupportedLanguage): string => {\n    return languageNames[language] || language;\n  }, [languageNames]);\n\n  // Memoize status indicators for performance\n  const getStatusIndicator = useCallback((language: SupportedLanguage) => {\n    // Only show status indicators if translationStatus prop is provided and has values\n    if (!translationStatus || Object.keys(translationStatus).length === 0) {\n      return null;\n    }\n    \n    const status = translationStatus[language];\n    \n    const statusConfig = {\n      original: { color: 'text-blue-600', label: t('translation.original') },\n      translated: { color: 'text-green-600', label: t('translation.translated') },\n      pending: { color: 'text-yellow-600 animate-pulse', label: t('translation.pending') },\n      error: { color: 'text-red-600', label: t('translation.error') }\n    };\n    \n    const config = statusConfig[status as keyof typeof statusConfig];\n    if (!config) {return null;}\n    \n    return (\n      <span \n        className={`${config.color} text-xs`}\n        aria-label={config.label}\n        role=\"status\"\n      >\n        ‚óè\n      </span>\n    );\n  }, [translationStatus, t]);\n\n  // Memoize the tab click handler\n  const handleLanguageChange = useCallback((language: SupportedLanguage) => {\n    if (isLoading || language === currentLanguage) {return;}\n    onLanguageChange(language);\n  }, [isLoading, currentLanguage, onLanguageChange]);\n\n  // Memoize the tabs to prevent unnecessary re-renders\n  const tabs = useMemo(() => \n    languages.map((language) => {\n      const isActive = currentLanguage === language;\n      const isDisabled = isLoading;\n      \n      return (\n        <button\n          key={language}\n          onClick={() => handleLanguageChange(language)}\n          disabled={isDisabled}\n          className={`\n            relative whitespace-nowrap py-2 px-3 border-b-2 font-medium text-sm \n            flex items-center space-x-2 transition-all duration-200\n            focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\n            disabled:opacity-50 disabled:cursor-not-allowed\n            ${isActive\n              ? 'border-blue-500 text-blue-600 bg-blue-50'\n              : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50'\n            }\n          `}\n          aria-pressed={isActive}\n          aria-label={`Switch to ${getLanguageDisplayName(language)}`}\n          role=\"tab\"\n          tabIndex={isActive ? 0 : -1}\n        >\n          <span>{getLanguageDisplayName(language)}</span>\n          {getStatusIndicator(language)}\n          {isLoading && isActive && (\n            <div className=\"absolute inset-0 flex items-center justify-center bg-white bg-opacity-75\">\n              <div className=\"w-3 h-3 border border-blue-500 border-t-transparent rounded-full animate-spin\" />\n            </div>\n          )}\n        </button>\n      );\n    }), [languages, currentLanguage, isLoading, handleLanguageChange, getLanguageDisplayName, getStatusIndicator]);\n\n  return (\n    <div className={`border-b border-gray-200 ${className}`}>\n      <nav \n        className=\"-mb-px flex space-x-8\" \n        aria-label={ariaLabel}\n        role=\"tablist\"\n      >\n        {tabs}\n      </nav>\n      \n      {/* Enhanced Status Legend */}\n      {translationStatus && Object.keys(translationStatus).length > 0 && (\n        <StatusLegend translationStatus={translationStatus} />      \n      )}\n    </div>\n  );\n};\n\n// Enhanced Status Legend Component\ninterface StatusLegendProps {\n  translationStatus: { [key in SupportedLanguage]?: 'original' | 'translated' | 'pending' | 'error' };\n}\n\nconst StatusLegend: React.FC<StatusLegendProps> = ({ translationStatus }) => {\n  const { t } = useTranslation();\n\n  // Memoize status configuration for performance\n  const statusConfig = useMemo(() => ({\n    original: {\n      icon: FiFile,\n      color: 'text-blue-600',\n      bgColor: 'bg-blue-50',\n      borderColor: 'border-blue-200',\n      label: t('translation.original'),\n      description: t('translation.originalDescription')\n    },\n    translated: {\n      icon: FiCheck,\n      color: 'text-green-600',\n      bgColor: 'bg-green-50',\n      borderColor: 'border-green-200',\n      label: t('translation.translated'),\n      description: t('translation.translatedDescription')\n    },\n    pending: {\n      icon: FiClock,\n      color: 'text-yellow-600',\n      bgColor: 'bg-yellow-50',\n      borderColor: 'border-yellow-200',\n      label: t('translation.pending'),\n      description: t('translation.pendingDescription')\n    },\n    error: {\n      icon: FiAlertCircle,\n      color: 'text-red-600',\n      bgColor: 'bg-red-50',\n      borderColor: 'border-red-200',\n      label: t('translation.error'),\n      description: t('translation.errorDescription')\n    }\n  }), [t]);\n\n  // Get unique statuses currently in use\n  const activeStatuses = useMemo(() => {\n    const statusesInUse = Object.values(translationStatus).filter(Boolean);\n    return [...new Set(statusesInUse)] as Array<keyof typeof statusConfig>;\n  }, [translationStatus]);\n\n  // Count languages by status\n  const statusCounts = useMemo(() => {\n    const counts: Record<string, number> = {};\n    Object.values(translationStatus).forEach(status => {\n      if (status) {\n        counts[status] = (counts[status] || 0) + 1;\n      }\n    });\n    return counts;\n  }, [translationStatus]);\n\n  if (activeStatuses.length === 0) {return null;}\n\n  return (\n    <div \n      className=\"mt-4 p-4 bg-gradient-to-r from-slate-50 to-gray-50 border border-gray-200 rounded-lg shadow-sm\"\n      role=\"region\"\n      aria-label={t('translation.statusLegend')}\n    >\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-3\">\n        <h3 className=\"text-sm font-medium text-gray-700 flex items-center space-x-2\">\n          <span>{t('translation.statusLegend')}</span>\n          <span className=\"text-xs text-gray-500\">(\n            {Object.keys(translationStatus).length} {t('translation.languages')}\n          )\n          </span>\n        </h3>\n      </div>\n      \n      {/* Status Items */}\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3\">\n        {activeStatuses.map((status) => {\n          const config = statusConfig[status];\n          const count = statusCounts[status] || 0;\n          const IconComponent = config.icon;\n          \n          return (\n            <div\n              key={status}\n              className={`\n                flex items-center p-3 rounded-md border transition-all duration-200\n                ${config.bgColor} ${config.borderColor} \n                hover:shadow-sm group\n              `}\n              role=\"listitem\"\n              aria-label={`${config.label}: ${count} ${count === 1 ? t('translation.language') : t('translation.languages')}`}\n            >\n              <div className={`flex-shrink-0 ${config.color} mr-3`}>\n                <IconComponent size={16} aria-hidden=\"true\" />\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <div className=\"flex items-center justify-between\">\n                  <span className={`text-sm font-medium ${config.color} truncate`}>\n                    {config.label}\n                  </span>\n                  <span className={`ml-2 text-xs font-semibold ${config.color} bg-white px-2 py-0.5 rounded-full`}>\n                    {count}\n                  </span>\n                </div>\n                <p className=\"text-xs text-gray-500 mt-1 group-hover:text-gray-600 transition-colors\">\n                  {config.description}\n                </p>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n      \n      {/* Progress Summary */}\n      {activeStatuses.includes('translated') && activeStatuses.includes('pending') && (\n        <div className=\"mt-3 p-2 bg-white rounded border border-gray-200\">\n          <div className=\"flex items-center justify-between text-xs\">\n            <span className=\"text-gray-600\">{t('translation.progress')}:</span>\n            <div className=\"flex items-center space-x-2\">\n              <div className=\"w-24 bg-gray-200 rounded-full h-1.5\">\n                <div \n                  className=\"bg-green-500 h-1.5 rounded-full transition-all duration-300\"\n                  style={{ \n                    width: `${(statusCounts.translated || 0) / Object.keys(translationStatus).length * 100}%` \n                  }}\n                  aria-label={`${Math.round((statusCounts.translated || 0) / Object.keys(translationStatus).length * 100)}% complete`}\n                />\n              </div>\n              <span className=\"text-green-600 font-medium\">\n                {Math.round((statusCounts.translated || 0) / Object.keys(translationStatus).length * 100)}%\n              </span>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default LanguageTabs;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/components/translation/TranslationButton.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is assigned a value but never used.","line":21,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":12},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":34,"column":12,"nodeType":"MemberExpression","endLine":34,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { FiGlobe, FiRefreshCw } from 'react-icons/fi';\nimport { SupportedLanguage } from '../../types/multilingual';\n\ninterface TranslationButtonProps {\n  onTranslate: (targetLanguages: SupportedLanguage[]) => void;\n  isTranslating: boolean;\n  disabled?: boolean;\n  availableLanguages?: SupportedLanguage[];\n  originalLanguage: SupportedLanguage;\n}\n\nconst TranslationButton: React.FC<TranslationButtonProps> = ({\n  onTranslate,\n  isTranslating,\n  disabled = false,\n  availableLanguages = ['th'],\n  originalLanguage\n}) => {\n  const { t } = useTranslation();\n  const [showLanguageSelection, setShowLanguageSelection] = useState(false);\n  const [selectedLanguages, setSelectedLanguages] = useState<SupportedLanguage[]>([]);\n\n  const allLanguages: SupportedLanguage[] = ['th', 'en', 'zh-CN'];\n  const targetLanguages = allLanguages.filter(lang => lang !== originalLanguage);\n\n  const getLanguageDisplayName = (language: SupportedLanguage): string => {\n    const names: { [key in SupportedLanguage]: string } = {\n      'th': '‡πÑ‡∏ó‡∏¢',\n      'en': 'English',\n      'zh-CN': '‰∏≠Êñá'\n    };\n    return names[language] || language;\n  };\n\n  const handleStartTranslation = () => {\n    setShowLanguageSelection(true);\n    // Pre-select untranslated languages\n    const untranslatedLanguages = targetLanguages.filter(lang => !availableLanguages.includes(lang));\n    setSelectedLanguages(untranslatedLanguages);\n  };\n\n  const handleLanguageToggle = (language: SupportedLanguage) => {\n    setSelectedLanguages(prev => \n      prev.includes(language)\n        ? prev.filter(l => l !== language)\n        : [...prev, language]\n    );\n  };\n\n  const handleConfirmTranslation = () => {\n    if (selectedLanguages.length > 0) {\n      onTranslate(selectedLanguages);\n      setShowLanguageSelection(false);\n      setSelectedLanguages([]);\n    }\n  };\n\n  const handleCancel = () => {\n    setShowLanguageSelection(false);\n    setSelectedLanguages([]);\n  };\n\n  const isFirstTranslation = availableLanguages.length === 1;\n\n  if (showLanguageSelection) {\n    return (\n      <div className=\"bg-white border border-gray-200 rounded-lg p-4 shadow-sm\">\n        <h3 className=\"text-sm font-medium text-gray-900 mb-3\">\n          {isFirstTranslation ? 'Select languages to translate to:' : 'Select languages to update:'}\n        </h3>\n        \n        <div className=\"space-y-2 mb-4\">\n          {targetLanguages.map((language) => {\n            const isTranslated = availableLanguages.includes(language);\n            return (\n              <label key={language} className=\"flex items-center\">\n                <input\n                  type=\"checkbox\"\n                  checked={selectedLanguages.includes(language)}\n                  onChange={() => handleLanguageToggle(language)}\n                  className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                />\n                <span className=\"ml-2 text-sm text-gray-700\">\n                  {getLanguageDisplayName(language)}\n                  {isTranslated && (\n                    <span className=\"ml-1 text-xs text-green-600\">(translated)</span>\n                  )}\n                </span>\n              </label>\n            );\n          })}\n        </div>\n\n        <div className=\"flex justify-end space-x-2\">\n          <button\n            onClick={handleCancel}\n            className=\"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50\"\n          >\n            Cancel\n          </button>\n          <button\n            onClick={handleConfirmTranslation}\n            disabled={selectedLanguages.length === 0}\n            className=\"px-3 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {isFirstTranslation ? 'Translate' : 'Update Translations'}\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <button\n      onClick={handleStartTranslation}\n      disabled={disabled || isTranslating}\n      className=\"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n    >\n      {isTranslating ? (\n        <>\n          <FiRefreshCw className=\"mr-2 h-4 w-4 animate-spin\" />\n          Translating...\n        </>\n      ) : (\n        <>\n          <FiGlobe className=\"mr-2 h-4 w-4\" />\n          {isFirstTranslation ? 'Translate' : 'Update Translations'}\n        </>\n      )}\n    </button>\n  );\n};\n\nexport default TranslationButton;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/hooks/useAuthRedirect.ts","messages":[{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":51,"column":31,"nodeType":"MemberExpression","endLine":51,"endColumn":58}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { useAuthStore } from '../store/authStore';\n\n/**\n * Hook to automatically redirect unauthenticated users to login\n * Can be used as a backup to ProtectedRoute for extra security\n */\nexport function useAuthRedirect() {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const isAuthenticated = useAuthStore((state) => state.isAuthenticated);\n  const user = useAuthStore((state) => state.user);\n  const accessToken = useAuthStore((state) => state.accessToken);\n\n  useEffect(() => {\n    // Skip if we're already on auth pages\n    const authPages = ['/login', '/register', '/reset-password', '/oauth/success'];\n    if (authPages.some(page => location.pathname.startsWith(page))) {\n      return;\n    }\n\n    // Redirect if not properly authenticated\n    if (!isAuthenticated || !user || !accessToken) {\n      const returnUrl = location.pathname + location.search;\n      navigate(`/login?returnUrl=${encodeURIComponent(returnUrl)}`, { replace: true });\n    }\n  }, [isAuthenticated, user, accessToken, navigate, location]);\n\n  return { isAuthenticated: isAuthenticated && !!user && !!accessToken };\n}\n\n/**\n * Hook to check if user has required role, redirects to login if not authenticated\n */\nexport function useRoleCheck(requiredRole?: 'customer' | 'staff' | 'admin' | 'super_admin') {\n  const { isAuthenticated } = useAuthRedirect(); // This handles auth redirect\n  const user = useAuthStore((state) => state.user);\n\n  const hasRole = () => {\n    if (!isAuthenticated || !user || !requiredRole) {return isAuthenticated;}\n\n    const roleHierarchy = {\n      'customer': 0,\n      'staff': 1,\n      'admin': 2,\n      'super_admin': 3\n    };\n\n    const userRoleLevel = roleHierarchy[user.role] || 0;\n    const requiredRoleLevel = roleHierarchy[requiredRole] || 0;\n\n    return userRoleLevel >= requiredRoleLevel;\n  };\n\n  return { isAuthenticated, hasRole: hasRole() };\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/hooks/useSessionTimeout.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/i18n/config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/main.tsx","messages":[{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":11,"column":21,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":11,"endColumn":53}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport App from './App';\nimport './styles/index.css';\nimport { setupAxiosInterceptors } from './utils/axiosInterceptor';\nimport './i18n/config';\n\n// Set up global axios interceptors\nsetupAxiosInterceptors();\n\nReactDOM.createRoot(document.getElementById('root')!).render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n);","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/DashboardPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isSuperAdmin' is assigned a value but never used.","line":12,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useAuthStore } from '../store/authStore';\nimport { FiUser, FiAward, FiUsers } from 'react-icons/fi';\nimport { Link } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport MainLayout from '../components/layout/MainLayout';\n\nexport default function DashboardPage() {\n  const { t } = useTranslation();\n  const user = useAuthStore((state) => state.user);\n  \n  // Check user roles\n  const isSuperAdmin = user?.role === 'super_admin';\n  const isAdmin = user?.role === 'admin' || user?.role === 'super_admin';\n\n  return (\n    <MainLayout title={t('dashboard.title')}>\n          <div className=\"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3\">\n            {/* Profile & Loyalty Card */}\n            <Link\n              to=\"/profile\"\n              className=\"bg-white overflow-hidden shadow rounded-lg hover:shadow-lg transition-shadow\"\n            >\n              <div className=\"p-5\">\n                <div className=\"flex items-center justify-between mb-3\">\n                  <div className=\"flex items-center\">\n                    <div className=\"flex-shrink-0\">\n                      <FiUser className=\"h-6 w-6 text-primary-600\" />\n                    </div>\n                    <div className=\"ml-3\">\n                      <dt className=\"text-lg font-semibold text-gray-900\">\n                        {t('dashboard.myProfile')}\n                      </dt>\n                    </div>\n                  </div>\n                  <div className=\"flex-shrink-0\">\n                    <div className=\"h-6 w-6 bg-gold-500 rounded-full flex items-center justify-center\">\n                      <span className=\"text-xs text-white font-bold\">‚òÖ</span>\n                    </div>\n                  </div>\n                </div>\n                <div>\n                  <dd className=\"text-sm font-medium text-gray-500 mb-1\">\n                    {t('dashboard.manageProfile')}\n                  </dd>\n                  <dd className=\"text-sm font-medium text-gray-500\">\n                    {t('dashboard.manageLoyalty')}\n                  </dd>\n                </div>\n              </div>\n            </Link>\n\n            {/* Coupons Card */}\n            <Link\n              to=\"/coupons\"\n              className=\"bg-white overflow-hidden shadow rounded-lg hover:shadow-lg transition-shadow\"\n            >\n              <div className=\"p-5\">\n                <div className=\"flex items-center\">\n                  <div className=\"flex-shrink-0\">\n                    <div className=\"h-6 w-6 bg-green-500 rounded flex items-center justify-center\">\n                      <span className=\"text-xs text-white font-bold\">üé´</span>\n                    </div>\n                  </div>\n                  <div className=\"ml-5 w-0 flex-1\">\n                    <dl>\n                      <dt className=\"text-lg font-semibold text-gray-900 truncate\">\n                        {t('dashboard.myCoupons')}\n                      </dt>\n                      <dd className=\"mt-1 text-sm font-medium text-gray-500\">\n                        {t('dashboard.manageCoupons')}\n                      </dd>\n                    </dl>\n                  </div>\n                </div>\n              </div>\n            </Link>\n\n            {/* Surveys Card */}\n            <Link\n              to=\"/surveys\"\n              className=\"bg-white overflow-hidden shadow rounded-lg hover:shadow-lg transition-shadow\"\n            >\n              <div className=\"p-5\">\n                <div className=\"flex items-center\">\n                  <div className=\"flex-shrink-0\">\n                    <div className=\"h-6 w-6 bg-purple-500 rounded flex items-center justify-center\">\n                      <span className=\"text-xs text-white font-bold\">üìù</span>\n                    </div>\n                  </div>\n                  <div className=\"ml-5 w-0 flex-1\">\n                    <dl>\n                      <dt className=\"text-lg font-semibold text-gray-900 truncate\">\n                        {t('dashboard.surveys')}\n                      </dt>\n                      <dd className=\"mt-1 text-sm font-medium text-gray-500\">\n                        {t('dashboard.takeSurveys')}\n                      </dd>\n                    </dl>\n                  </div>\n                </div>\n              </div>\n            </Link>\n\n            {/* Loyalty Management Card (Admin+ Only) */}\n            {isAdmin && (\n              <Link\n                to=\"/admin/loyalty\"\n                className=\"bg-white overflow-hidden shadow rounded-lg hover:shadow-lg transition-shadow\"\n              >\n                <div className=\"p-5\">\n                  <div className=\"flex items-center\">\n                    <div className=\"flex-shrink-0\">\n                      <FiAward className=\"h-6 w-6 text-blue-600\" />\n                    </div>\n                    <div className=\"ml-5 w-0 flex-1\">\n                      <dl>\n                        <dt className=\"text-lg font-semibold text-gray-900 truncate\">\n                          {t('dashboard.loyaltyManagement')}\n                        </dt>\n                        <dd className=\"mt-1 text-sm font-medium text-gray-500\">\n                          {t('dashboard.manageLoyaltyAdmin')}\n                        </dd>\n                      </dl>\n                    </div>\n                  </div>\n                </div>\n              </Link>\n            )}\n\n            {/* Coupon Management Card (Admin+ Only) */}\n            {isAdmin && (\n              <Link\n                to=\"/admin/coupons\"\n                className=\"bg-white overflow-hidden shadow rounded-lg hover:shadow-lg transition-shadow\"\n              >\n                <div className=\"p-5\">\n                  <div className=\"flex items-center\">\n                    <div className=\"flex-shrink-0\">\n                      <div className=\"h-6 w-6 bg-yellow-500 rounded flex items-center justify-center\">\n                        <span className=\"text-xs text-white font-bold\">üé´</span>\n                      </div>\n                    </div>\n                    <div className=\"ml-5 w-0 flex-1\">\n                      <dl>\n                        <dt className=\"text-lg font-semibold text-gray-900 truncate\">\n                          {t('dashboard.couponManagement')}\n                        </dt>\n                        <dd className=\"mt-1 text-sm font-medium text-gray-500\">\n                          {t('dashboard.manageCouponsAdmin')}\n                        </dd>\n                      </dl>\n                    </div>\n                  </div>\n                </div>\n              </Link>\n            )}\n\n            {/* Survey Management Card (Admin+ Only) */}\n            {isAdmin && (\n              <Link\n                to=\"/admin/surveys\"\n                className=\"bg-white overflow-hidden shadow rounded-lg hover:shadow-lg transition-shadow\"\n              >\n                <div className=\"p-5\">\n                  <div className=\"flex items-center\">\n                    <div className=\"flex-shrink-0\">\n                      <div className=\"h-6 w-6 bg-purple-500 rounded flex items-center justify-center\">\n                        <span className=\"text-xs text-white font-bold\">üìä</span>\n                      </div>\n                    </div>\n                    <div className=\"ml-5 w-0 flex-1\">\n                      <dl>\n                        <dt className=\"text-lg font-semibold text-gray-900 truncate\">\n                          {t('dashboard.surveyManagement')}\n                        </dt>\n                        <dd className=\"mt-1 text-sm font-medium text-gray-500\">\n                          {t('dashboard.manageSurveysAdmin')}\n                        </dd>\n                      </dl>\n                    </div>\n                  </div>\n                </div>\n              </Link>\n            )}\n\n            {/* User Management Card (Admin+ Only) */}\n            {isAdmin && (\n              <Link\n                to=\"/admin/users\"\n                className=\"bg-white overflow-hidden shadow rounded-lg hover:shadow-lg transition-shadow\"\n              >\n                <div className=\"p-5\">\n                  <div className=\"flex items-center\">\n                    <div className=\"flex-shrink-0\">\n                      <FiUsers className=\"h-6 w-6 text-blue-600\" />\n                    </div>\n                    <div className=\"ml-5 w-0 flex-1\">\n                      <dl>\n                        <dt className=\"text-lg font-semibold text-gray-900 truncate\">\n                          {t('dashboard.userManagement')}\n                        </dt>\n                        <dd className=\"mt-1 text-sm font-medium text-gray-500\">\n                          {t('dashboard.manageUsersAdmin')}\n                        </dd>\n                      </dl>\n                    </div>\n                  </div>\n                </div>\n              </Link>\n            )}\n\n            {/* New Member Coupons Card (Admin+ Only) */}\n            {isAdmin && (\n              <Link\n                to=\"/admin/new-member-coupons\"\n                className=\"bg-white overflow-hidden shadow rounded-lg hover:shadow-lg transition-shadow\"\n              >\n                <div className=\"p-5\">\n                  <div className=\"flex items-center\">\n                    <div className=\"flex-shrink-0\">\n                      <div className=\"h-6 w-6 bg-green-500 rounded flex items-center justify-center\">\n                        <span className=\"text-xs text-white font-bold\">üéÅ</span>\n                      </div>\n                    </div>\n                    <div className=\"ml-5 w-0 flex-1\">\n                      <dl>\n                        <dt className=\"text-lg font-semibold text-gray-900 truncate\">\n                          New Member Coupons\n                        </dt>\n                        <dd className=\"mt-1 text-sm font-medium text-gray-500\">\n                          Configure welcome coupons\n                        </dd>\n                      </dl>\n                    </div>\n                  </div>\n                </div>\n              </Link>\n            )}\n\n          </div>\n\n          {/* Welcome Message */}\n          <div className=\"mt-8 bg-white shadow rounded-lg\">\n            <div className=\"px-4 py-5 sm:p-6\">\n              <h3 className=\"text-lg leading-6 font-medium text-gray-900\">\n                {t('dashboard.welcomeMessage')}\n              </h3>\n              <div className=\"mt-2 max-w-xl text-sm text-gray-500\">\n                <p>\n                  {t('dashboard.welcomeDescription')}\n                </p>\n              </div>\n            </div>\n          </div>\n    </MainLayout>\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/ProfilePage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":2,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FiUser' is defined but never used.","line":11,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FiPhone' is defined but never used.","line":11,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FiCalendar' is defined but never used.","line":11,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FiCamera' is defined but never used.","line":11,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FiLink' is defined but never used.","line":11,"column":49,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getUserDisplayName' is defined but never used.","line":13,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getOAuthProviderName' is defined but never used.","line":13,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isOAuthUser' is defined but never used.","line":13,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":63},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DashboardButton' is defined but never used.","line":14,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'register' is assigned a value but never used.","line":63,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":63,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleSubmit' is assigned a value but never used.","line":64,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":64,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'errors' is assigned a value but never used.","line":65,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":65,"endColumn":24},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadLoyaltyData' and 'loadProfile'. Either include them or remove the dependency array.","line":74,"column":6,"nodeType":"ArrayExpression","endLine":74,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadLoyaltyData, loadProfile]","fix":{"range":[3074,3076],"text":"[loadLoyaltyData, loadProfile]"}}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":93,"column":34,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":93,"endColumn":36,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[3644,3646],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3818,3821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3818,3821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":100,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":100,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3882,3926],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":123,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":123,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4592,4644],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":134,"column":40,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":134,"endColumn":42,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[4928,4958],"text":"(data.gender ?? data.occupation)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":134,"column":59,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":134,"endColumn":61,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[4959,4961],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":142,"column":29,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":142,"endColumn":31,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[5256,5258],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":143,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":143,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[5310,5312],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":144,"column":31,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":144,"endColumn":33,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[5354,5356],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":145,"column":39,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":145,"endColumn":41,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[5406,5408],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":171,"column":29,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":171,"endColumn":31,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[6323,6325],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":172,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":172,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[6377,6379],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":186,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6809,6812],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6809,6812],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":228,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8054,8057],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8054,8057],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-alert","severity":1,"message":"Unexpected confirm.","line":240,"column":10,"nodeType":"CallExpression","messageId":"unexpected","endLine":240,"endColumn":50},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":260,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":260,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8863,8866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8863,8866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":492,"column":59,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":492,"endColumn":80}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":31,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\nimport { Link, useSearchParams } from 'react-router-dom';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useTranslation } from 'react-i18next';\nimport toast from 'react-hot-toast';\nimport { userService, UserProfile } from '../services/userService';\nimport { useAuthStore } from '../store/authStore';\nimport { notify } from '../utils/notificationManager';\nimport { FiUser, FiPhone, FiCalendar, FiCamera, FiLink, FiCopy, FiSettings, FiGift } from 'react-icons/fi';\nimport EmailDisplay from '../components/common/EmailDisplay';\nimport { getUserDisplayName, getOAuthProviderName, isOAuthUser } from '../utils/userHelpers';\nimport DashboardButton from '../components/navigation/DashboardButton';\nimport MainLayout from '../components/layout/MainLayout';\nimport { \n  loyaltyService, \n  UserLoyaltyStatus, \n  Tier, \n  PointsTransaction,\n  PointsCalculation\n} from '../services/loyaltyService';\nimport PointsBalance from '../components/loyalty/PointsBalance';\nimport TierStatus from '../components/loyalty/TierStatus';\nimport TransactionList from '../components/loyalty/TransactionList';\nimport SettingsModal from '../components/profile/SettingsModal';\nimport EmojiAvatar from '../components/profile/EmojiAvatar';\n\nconst profileSchema = z.object({\n  email: z.string().email('Please enter a valid email address').optional().or(z.literal('')),\n  firstName: z.string().min(1, 'First name is required'),\n  lastName: z.string().optional(),\n  phone: z.string().optional(),\n  dateOfBirth: z.string().optional(),\n  gender: z.string().optional(),\n  occupation: z.string().optional(),\n  interests: z.string().optional(), // Comma-separated string\n});\n\ntype ProfileFormData = z.infer<typeof profileSchema>;\n\nexport default function ProfilePage() {\n  const { t } = useTranslation();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const user = useAuthStore((state) => state.user);\n  const updateUser = useAuthStore((state) => state.updateUser);\n  const [profile, setProfile] = useState<UserProfile | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [isSaving, setIsSaving] = useState(false);\n  const [uploadingAvatar, setUploadingAvatar] = useState(false);\n  const [showSettingsModal, setShowSettingsModal] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  \n  // Loyalty data states\n  const [loyaltyStatus, setLoyaltyStatus] = useState<UserLoyaltyStatus | null>(null);\n  const [allTiers, setAllTiers] = useState<Tier[]>([]);\n  const [pointsCalculation, setPointsCalculation] = useState<PointsCalculation | null>(null);\n  const [transactions, setTransactions] = useState<PointsTransaction[]>([]);\n  const [loyaltyLoading, setLoyaltyLoading] = useState(true);\n  \n\n  const {\n    register,\n    handleSubmit,\n    formState: { errors },\n    reset,\n  } = useForm<ProfileFormData>({\n    resolver: zodResolver(profileSchema),\n  });\n\n  useEffect(() => {\n    loadProfile();\n    loadLoyaltyData();\n  }, []);\n\n  // Handle URL parameters to open settings modal\n  useEffect(() => {\n    const tab = searchParams.get('tab');\n    if (tab === 'settings') {\n      setShowSettingsModal(true);\n      // Clean up URL parameter after opening modal\n      setSearchParams({});\n    }\n  }, [searchParams, setSearchParams]);\n\n  const loadProfile = async () => {\n    try {\n      const profileData = await userService.getProfile();\n      setProfile(profileData);\n      reset({\n        firstName: profileData.firstName,\n        lastName: profileData.lastName,\n        phone: profileData.phone || '',\n        dateOfBirth: profileData.dateOfBirth \n          ? new Date(profileData.dateOfBirth).toISOString().split('T')[0] \n          : '',\n      });\n    } catch (error: any) {\n      notify.error(t('profile.profileLoadError'));\n      console.error('Profile load error:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const loadLoyaltyData = async () => {\n    try {\n      setLoyaltyLoading(true);\n      \n      // Load all loyalty data in parallel\n      const [statusResult, tiersResult, calculationResult, historyResult] = await Promise.all([\n        loyaltyService.getUserLoyaltyStatus(),\n        loyaltyService.getTiers(),\n        loyaltyService.getPointsCalculation(),\n        loyaltyService.getPointsHistory(10, 0)\n      ]);\n\n      setLoyaltyStatus(statusResult);\n      setAllTiers(tiersResult);\n      setPointsCalculation(calculationResult);\n      setTransactions(historyResult.transactions);\n    } catch (error) {\n      console.error('Error loading loyalty data:', error);\n      toast.error(t('errors.networkError'));\n    } finally {\n      setLoyaltyLoading(false);\n    }\n  };\n\n  const onSubmit = async (data: ProfileFormData) => {\n    setIsSaving(true);\n    try {\n      // Check if this is a profile completion (has new fields)\n      const hasNewFields = data.gender || data.occupation || data.interests;\n      \n      let response;\n      if (hasNewFields) {\n        // Use complete profile endpoint for potential coupon rewards\n        response = await userService.completeProfile({\n          firstName: data.firstName,\n          lastName: data.lastName,\n          phone: data.phone || undefined,\n          dateOfBirth: data.dateOfBirth || undefined,\n          gender: data.gender || undefined,\n          occupation: data.occupation || undefined,\n          interests: data.interests ? data.interests.split(',').map(i => i.trim()).filter(i => i) : undefined,\n        });\n        \n        setProfile(response.profile);\n        \n        // Show coupon notification if awarded\n        if (response.couponAwarded && response.coupon) {\n          notify.success(\n            t('profile.newMemberCouponAwarded', { \n              couponName: response.coupon.name,\n              value: response.coupon.value \n            }),\n            { duration: 8000 }\n          );\n          \n          // Refresh loyalty data to show new coupon\n          loadLoyaltyData();\n        } else {\n          notify.success(t('profile.profileCompleted'));\n        }\n      } else {\n        // Regular profile update\n        const updatedProfile = await userService.updateProfile({\n          firstName: data.firstName,\n          lastName: data.lastName,\n          phone: data.phone || undefined,\n          dateOfBirth: data.dateOfBirth || undefined,\n        });\n        setProfile(updatedProfile);\n        notify.success(t('profile.profileUpdated'));\n      }\n      \n      // Update email if changed\n      if (data.email && data.email !== user?.email) {\n        await userService.updateEmail(data.email);\n        updateUser({ email: data.email });\n        notify.success(t('profile.emailUpdated'));\n      }\n      \n      setShowSettingsModal(false);\n    } catch (error: any) {\n      notify.error(error.response?.data?.error || t('profile.profileUpdateError'));\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const handleAvatarUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) {return;}\n\n    // Validate file type\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];\n    if (!allowedTypes.includes(file.type)) {\n      notify.error(t('profile.invalidImageType'));\n      return;\n    }\n\n    // Validate file size (5MB)\n    const maxSize = 5 * 1024 * 1024;\n    if (file.size > maxSize) {\n      notify.error(t('profile.fileTooLarge'));\n      return;\n    }\n\n    setUploadingAvatar(true);\n\n    try {\n      const response = await userService.uploadAvatar(file);\n      \n      // Update local profile state immediately for instant display\n      if (profile && response.data?.avatarUrl) {\n        setProfile({\n          ...profile,\n          avatarUrl: response.data.avatarUrl\n        });\n        \n        // Update auth store to persist avatar across restarts\n        updateUser({ avatarUrl: response.data.avatarUrl });\n      }\n      \n      notify.success(t('profile.photoUpdated'));\n    } catch (error: any) {\n      notify.error(error.response?.data?.error || t('profile.photoUploadError'));\n    } finally {\n      setUploadingAvatar(false);\n      // Reset file input\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n  const handleDeleteAvatar = async () => {\n    if (!confirm(t('profile.confirmRemovePhoto'))) {\n      return;\n    }\n\n    setUploadingAvatar(true);\n    try {\n      await userService.deleteAvatar();\n      \n      // Update local profile state\n      if (profile) {\n        setProfile({\n          ...profile,\n          avatarUrl: undefined\n        });\n        \n        // Update auth store to persist removal across restarts\n        updateUser({ avatarUrl: undefined });\n      }\n      \n      notify.success(t('profile.photoRemoved'));\n    } catch (error: any) {\n      notify.error(error.response?.data?.error || t('profile.photoRemoveError'));\n    } finally {\n      setUploadingAvatar(false);\n    }\n  };\n\n  if (isLoading || loyaltyLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600\" />\n          <p className=\"mt-4 text-gray-600\">{t('profile.loading')}</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <MainLayout title={t('profile.title')} showProfileBanner={false}>\n        {/* Membership Tier Display */}\n        {loyaltyStatus && (\n          <div className=\"mb-6 bg-white shadow rounded-lg border-l-4\" style={{ borderLeftColor: loyaltyStatus.tier_color }}>\n            <div className=\"px-4 py-5 sm:p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center space-x-4\">\n                  <div className=\"p-3 rounded-lg\" style={{ backgroundColor: `${loyaltyStatus.tier_color}20` }}>\n                    <FiGift className=\"w-8 h-8\" style={{ color: loyaltyStatus.tier_color }} />\n                  </div>\n                  <div>\n                    <h2 className=\"text-xl font-bold text-gray-900\">\n                      {loyaltyStatus.tier_name} {t('loyalty.member')}\n                    </h2>\n                    <p className=\"text-sm text-gray-600 mt-1\">\n                      {t('loyalty.currentTier')}\n                      {loyaltyStatus.total_nights !== undefined && (\n                        <> ‚Ä¢ {loyaltyStatus.total_nights} {loyaltyStatus.total_nights === 1 ? t('loyalty.night') : t('loyalty.nights')} {t('profile.stayed')}</>\n                      )}\n                      <> ‚Ä¢ {loyaltyStatus.current_points.toLocaleString()} {t('loyalty.availablePoints')}</>\n                    </p>\n                  </div>\n                </div>\n                <div className=\"text-right\">\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    {loyaltyStatus.total_nights !== undefined && (\n                      <div>\n                        <div className=\"text-2xl font-bold\" style={{ color: loyaltyStatus.tier_color }}>\n                          {loyaltyStatus.total_nights}\n                        </div>\n                        <div className=\"text-sm text-gray-600\">\n                          {loyaltyStatus.total_nights === 1 ? t('loyalty.night') : t('loyalty.nights')}\n                        </div>\n                        <div className=\"text-xs text-gray-500 mt-1\">\n                          {t('loyalty.tierEligibility')}\n                        </div>\n                      </div>\n                    )}\n                    <div>\n                      <div className=\"text-2xl font-bold\" style={{ color: loyaltyStatus.tier_color }}>\n                        {loyaltyStatus.current_points.toLocaleString()}\n                      </div>\n                      <div className=\"text-sm text-gray-600\">\n                        {t('loyalty.points')}\n                      </div>\n                      <div className=\"text-xs text-gray-500 mt-1\">\n                        {t('loyalty.forRewards')}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              \n              {/* Progress to next tier */}\n              {loyaltyStatus.next_tier_name && loyaltyStatus.progress_percentage !== null && (\n                <div className=\"mt-4\">\n                  <div className=\"flex items-center justify-between text-sm text-gray-600 mb-2\">\n                    <span>\n                      {t('loyalty.progressToNextTier', { tier: loyaltyStatus.next_tier_name })}\n                    </span>\n                    <span>\n                      {loyaltyStatus.nights_to_next_tier !== undefined && loyaltyStatus.nights_to_next_tier !== null\n                        ? `${loyaltyStatus.nights_to_next_tier} ${loyaltyStatus.nights_to_next_tier === 1 ? t('loyalty.nightToGo') : t('loyalty.nightsToGo')}`\n                        : `${loyaltyStatus.points_to_next_tier?.toLocaleString()} ${t('loyalty.pointsToGo')}`\n                      }\n                    </span>\n                  </div>\n                  <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                    <div \n                      className=\"h-2 rounded-full transition-all duration-300\"\n                      style={{ \n                        width: `${loyaltyStatus.progress_percentage}%`,\n                        backgroundColor: loyaltyStatus.tier_color\n                      }}\n                    />\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Profile Information Section */}\n        <div className=\"mb-6 bg-white shadow rounded-lg\">\n          <div className=\"px-4 py-5 sm:p-6\">\n            {/* Profile Header with Settings Button */}\n            <div className=\"flex items-center justify-between mb-6\">\n              <h2 className=\"text-xl font-semibold text-gray-900\">\n                {t('profile.personalInformation')}\n              </h2>\n              <button\n                onClick={() => setShowSettingsModal(true)}\n                className=\"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n              >\n                <FiSettings className=\"mr-2 h-4 w-4\" />\n                {t('profile.editSettings')}\n              </button>\n            </div>\n\n            {/* Profile Display */}\n            <div className=\"flex items-start space-x-6\">\n              <div className=\"flex-shrink-0\">\n                <EmojiAvatar \n                  avatarUrl={profile?.avatarUrl} \n                  size=\"xl\"\n                  onClick={() => setShowSettingsModal(true)}\n                  className=\"cursor-pointer\"\n                />\n              </div>\n              \n              <div className=\"flex-1 min-w-0\">\n                <div className=\"flex items-center space-x-3 mb-4\">\n                  <h3 className=\"text-lg font-medium text-gray-900\">\n                    {profile ? `${profile.firstName} ${profile.lastName}` : 'Loading...'}\n                  </h3>\n                  {user?.role && user.role !== 'customer' && (\n                    <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\n                      user.role === 'super_admin' \n                        ? 'bg-purple-100 text-purple-800' \n                        : user.role === 'admin'\n                        ? 'bg-blue-100 text-blue-800'\n                        : 'bg-gray-100 text-gray-800'\n                    }`}\n                    >\n                      {user.role === 'super_admin' ? t('profile.superAdmin') : \n                       user.role === 'admin' ? t('profile.admin') : \n                       t('profile.staff')}\n                    </span>\n                  )}\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\n                  <div>\n                    <dt className=\"font-medium text-gray-500\">{t('profile.email')}</dt>\n                    <dd className=\"mt-1\">\n                      <EmailDisplay \n                        email={user?.email} \n                        linkToProfile={true}\n                        showIcon={false}\n                      />\n                    </dd>\n                  </div>\n                  \n                  {profile?.phone && (\n                    <div>\n                      <dt className=\"font-medium text-gray-500\">{t('auth.phone')}</dt>\n                      <dd className=\"mt-1 text-gray-900\">{profile.phone}</dd>\n                    </div>\n                  )}\n                  \n                  {profile?.dateOfBirth && (\n                    <div>\n                      <dt className=\"font-medium text-gray-500\">{t('profile.dateOfBirth')}</dt>\n                      <dd className=\"mt-1 text-gray-900\">\n                        {new Date(profile.dateOfBirth).toLocaleDateString()}\n                      </dd>\n                    </div>\n                  )}\n\n                  {profile?.gender && (\n                    <div>\n                      <dt className=\"font-medium text-gray-500\">{t('profile.gender')}</dt>\n                      <dd className=\"mt-1 text-gray-900\">\n                        {profile.gender === 'male' ? t('profile.male') :\n                         profile.gender === 'female' ? t('profile.female') :\n                         profile.gender === 'other' ? t('profile.other') :\n                         profile.gender === 'prefer_not_to_say' ? t('profile.preferNotToSay') :\n                         profile.gender}\n                      </dd>\n                    </div>\n                  )}\n\n                  {profile?.occupation && (\n                    <div>\n                      <dt className=\"font-medium text-gray-500\">{t('profile.occupation')}</dt>\n                      <dd className=\"mt-1 text-gray-900\">{profile.occupation}</dd>\n                    </div>\n                  )}\n\n                  {profile?.interests && profile.interests.length > 0 && (\n                    <div>\n                      <dt className=\"font-medium text-gray-500\">{t('profile.interests')}</dt>\n                      <dd className=\"mt-1\">\n                        <div className=\"flex flex-wrap gap-1\">\n                          {profile.interests.map((interest, index) => (\n                            <span \n                              key={index}\n                              className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\"\n                            >\n                              {interest}\n                            </span>\n                          ))}\n                        </div>\n                      </dd>\n                    </div>\n                  )}\n\n                  <div>\n                    <dt className=\"font-medium text-gray-500\">{t('profile.memberSince')}</dt>\n                    <dd className=\"mt-1 text-gray-900\">\n                      {profile ? new Date(profile.createdAt).toLocaleDateString() : '...'}\n                    </dd>\n                  </div>\n\n                  {profile?.membershipId && (\n                    <div>\n                      <dt className=\"font-medium text-gray-500\">{t('profile.membershipId')}</dt>\n                      <dd className=\"mt-1 flex items-center space-x-2\">\n                        <span className=\"font-mono bg-gray-100 px-2 py-1 rounded text-gray-800\">\n                          {profile.membershipId}\n                        </span>\n                        <button\n                          onClick={() => {\n                            navigator.clipboard.writeText(profile.membershipId!);\n                            notify.success(t('profile.membershipIdCopied'));\n                          }}\n                          className=\"text-gray-400 hover:text-gray-600 p-1\"\n                          title={t('profile.copyMembershipId')}\n                        >\n                          <FiCopy className=\"h-3 w-3\" />\n                        </button>\n                      </dd>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Loyalty Information Section */}\n        {loyaltyStatus && pointsCalculation && (\n          <div className=\"mb-6\">\n            <div className=\"flex items-center space-x-2 mb-4\">\n              <FiGift className=\"h-6 w-6 text-primary-600\" />\n              <h2 className=\"text-xl font-semibold text-gray-900\">\n                {t('loyalty.dashboard.title')}\n              </h2>\n            </div>\n            \n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n              {/* Left Column - Points & Transactions */}\n              <div className=\"lg:col-span-2 space-y-6\">\n                {/* Points Balance */}\n                <PointsBalance\n                  loyaltyStatus={loyaltyStatus}\n                />\n\n                {/* Transaction History */}\n                <TransactionList\n                  transactions={transactions}\n                  isLoading={false}\n                />\n              </div>\n\n              {/* Right Column - Tier Status */}\n              <div className=\"space-y-6\">\n                <TierStatus\n                  loyaltyStatus={loyaltyStatus}\n                  allTiers={allTiers}\n                />\n              </div>\n            </div>\n          </div>\n        )}\n\n\n        {/* Settings Modal */}\n        <SettingsModal\n          isOpen={showSettingsModal}\n          onClose={() => setShowSettingsModal(false)}\n          profile={profile}\n          onSubmit={onSubmit}\n          isSaving={isSaving}\n          onAvatarUpload={handleAvatarUpload}\n          onDeleteAvatar={handleDeleteAvatar}\n          uploadingAvatar={uploadingAvatar}\n          onProfileUpdate={(updatedProfile) => {\n            setProfile(updatedProfile);\n            updateUser({ avatarUrl: updatedProfile.avatarUrl });\n          }}\n        />\n    </MainLayout>\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/admin/CouponManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3301,3304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3301,3304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":83,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":83,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3314,3359],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3864,3867],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3864,3867],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":106,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":106,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4110,4153],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5343,5346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5343,5346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":178,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6346,6349],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6346,6349],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":179,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":179,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[6359,6399],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":193,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6893,6896],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6893,6896],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":223,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":223,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7700,7703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7700,7703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":224,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":224,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[7713,7758],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":377,"column":57,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":377,"endColumn":59,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[14219,14221],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":381,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":381,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[14386,14388],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":383,"column":89,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":383,"endColumn":91,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[14553,14555],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":780,"column":61,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":780,"endColumn":63,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[33495,33497],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":822,"column":59,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":822,"endColumn":61,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[35814,35816],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":885,"column":46,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[38709,38710],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[38709,38710],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[38709,38710],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[38709,38710],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":885,"column":68,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[38731,38734],"text":"&quot; ("},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[38731,38734],"text":"&ldquo; ("},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[38731,38734],"text":"&#34; ("},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[38731,38734],"text":"&rdquo; ("},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":17,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Coupon, CreateCouponRequest, CouponType, CouponStatus } from '../../types/coupon';\nimport { couponService } from '../../services/couponService';\nimport { loyaltyService } from '../../services/loyaltyService';\nimport DashboardButton from '../../components/navigation/DashboardButton';\nimport CouponAssignmentsModal from '../../components/admin/CouponAssignmentsModal';\nimport toast from 'react-hot-toast';\n\ninterface User {\n  id: string;\n  email: string;\n  firstName: string;\n  lastName: string;\n  membershipId?: string | null;\n}\n\nconst CouponManagement: React.FC = () => {\n  const { t } = useTranslation();\n  const [coupons, setCoupons] = useState<Coupon[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [showAssignModal, setShowAssignModal] = useState(false);\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\n  const [showAssignmentsModal, setShowAssignmentsModal] = useState(false);\n  const [selectedCoupon, setSelectedCoupon] = useState<Coupon | null>(null);\n  const [deleteConfirmText, setDeleteConfirmText] = useState('');\n  const [users, setUsers] = useState<User[]>([]);\n  const [selectedUsers, setSelectedUsers] = useState<string[]>([]);\n  const [userSearchTerm, setUserSearchTerm] = useState('');\n  const [page, setPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [createModalError, setCreateModalError] = useState<string | null>(null);\n\n  // Create coupon form state\n  const [newCoupon, setNewCoupon] = useState<CreateCouponRequest>({\n    code: '',\n    name: '',\n    description: '',\n    type: 'percentage',\n    value: 0,\n    minimumSpend: 0,\n    maximumDiscount: 0,\n    usageLimit: 100,\n    usageLimitPerUser: 1,\n    validFrom: new Date().toISOString().split('T')[0],\n    validUntil: '',\n    termsAndConditions: ''\n  });\n\n  const loadCoupons = async (pageNum: number = 1) => {\n    try {\n      setLoading(true);\n      setError(null);\n      \n      // Get all non-expired coupons - let backend handle the filtering\n      // We need to make multiple calls to get different statuses since API doesn't support \"NOT expired\"\n      const [activeResponse, pausedResponse, draftResponse] = await Promise.all([\n        couponService.getAdminCoupons(1, 1000, { status: 'active' }),\n        couponService.getAdminCoupons(1, 1000, { status: 'paused' }),\n        couponService.getAdminCoupons(1, 1000, { status: 'draft' })\n      ]);\n      \n      // Combine all non-expired coupons\n      const allCoupons = [\n        ...activeResponse.coupons,\n        ...pausedResponse.coupons, \n        ...draftResponse.coupons\n      ];\n      \n      // Implement client-side pagination for the filtered results\n      const itemsPerPage = 10;\n      const startIndex = (pageNum - 1) * itemsPerPage;\n      const endIndex = startIndex + itemsPerPage;\n      const paginatedCoupons = allCoupons.slice(startIndex, endIndex);\n      const calculatedTotalPages = Math.ceil(allCoupons.length / itemsPerPage);\n      \n      setCoupons(paginatedCoupons);\n      setTotalPages(calculatedTotalPages);\n      setPage(pageNum);\n    } catch (err: any) {\n      console.error('Error loading coupons:', err);\n      setError(err.response?.data?.message || 'Failed to load coupons');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const loadUsers = async () => {\n    try {\n      // Use the loyalty service instead of direct fetch to avoid hardcoded URLs\n      const response = await loyaltyService.getAllUsersLoyaltyStatus(100, 0);\n      const usersData = response.users || [];\n      \n      // Transform the loyalty service response to our User interface\n      const transformedUsers = usersData.map((user: any) => ({\n        id: user.user_id,\n        email: user.email,\n        firstName: user.first_name,\n        lastName: user.last_name,\n        membershipId: user.membership_id\n      }));\n      setUsers(transformedUsers);\n    } catch (err) {\n      console.error('Error loading users:', err);\n    }\n  };\n\n  useEffect(() => {\n    loadCoupons();\n    loadUsers();\n  }, []);\n\n  const handleCreateCoupon = async (e: React.FormEvent) => {\n    e.preventDefault();\n    try {\n      setLoading(true);\n      setCreateModalError(null); // Clear any previous errors\n      \n      // Convert date strings to datetime format for backend validation\n      const couponData = {\n        ...newCoupon,\n        validFrom: newCoupon.validFrom ? new Date(newCoupon.validFrom + 'T00:00:00.000Z').toISOString() : undefined,\n        validUntil: newCoupon.validUntil ? new Date(newCoupon.validUntil + 'T23:59:59.999Z').toISOString() : undefined\n      };\n      \n      await couponService.createCoupon(couponData);\n      setShowCreateModal(false);\n      setCreateModalError(null); // Clear error on success\n      setNewCoupon({\n        code: '',\n        name: '',\n        description: '',\n        type: 'percentage',\n        value: 0,\n        minimumSpend: 0,\n        maximumDiscount: 0,\n        usageLimit: 100,\n        usageLimitPerUser: 1,\n        validFrom: new Date().toISOString().split('T')[0],\n        validUntil: '',\n        termsAndConditions: ''\n      });\n      await loadCoupons();\n    } catch (err: any) {\n      // Show error in modal instead of main page\n      setCreateModalError(err.response?.data?.message || 'Failed to create coupon');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleAssignCoupons = async () => {\n    if (!selectedCoupon || selectedUsers.length === 0) {return;}\n    \n    try {\n      setLoading(true);\n      setError(null);\n      \n      const response = await couponService.assignCouponToUsers({\n        couponId: selectedCoupon.id,\n        userIds: selectedUsers,\n        assignedReason: 'Admin assignment'\n      });\n      \n      // Show success message\n      const assignedCount = response?.length || selectedUsers.length;\n      toast.success(`Successfully assigned coupon \"${selectedCoupon.name}\" to ${assignedCount} user(s)`);\n      \n      setShowAssignModal(false);\n      setSelectedUsers([]);\n      setSelectedCoupon(null);\n      setUserSearchTerm('');\n      \n      // Refresh the coupons list to update counts\n      await loadCoupons();\n    } catch (err: any) {\n      console.error('Assignment error:', err);\n      const errorMessage = err.response?.data?.message || err.message || 'Failed to assign coupons';\n      setError(errorMessage);\n      toast.error(errorMessage);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleToggleCouponStatus = async (coupon: Coupon) => {\n    try {\n      const newStatus = coupon.status === 'active' ? 'paused' : 'active';\n      await couponService.updateCouponStatus(coupon.id, newStatus as CouponStatus);\n      await loadCoupons();\n    } catch (err: any) {\n      setError(err.response?.data?.message || 'Failed to update coupon status');\n    }\n  };\n\n  const handleDeleteCoupon = (coupon: Coupon) => {\n    setSelectedCoupon(coupon);\n    setDeleteConfirmText('');\n    setShowDeleteModal(true);\n  };\n\n  const confirmDeleteCoupon = async () => {\n    const deleteKeyword = t('admin.coupons.deleteKeyword');\n    if (!selectedCoupon || deleteConfirmText !== deleteKeyword) {\n      return;\n    }\n\n    try {\n      setLoading(true);\n      await couponService.deleteCoupon(selectedCoupon.id);\n      \n      // Close modal and reset state\n      setShowDeleteModal(false);\n      setSelectedCoupon(null);\n      setDeleteConfirmText('');\n      \n      // Reload coupons and clear any existing errors\n      await loadCoupons();\n      setError(null);\n      \n    } catch (err: any) {\n      console.error('Error deleting coupon:', err);\n      \n      // Handle authentication errors specifically\n      if (err.response?.status === 401) {\n        setError('Your session has expired. Please refresh the page and log in again.');\n      } else if (err.response?.status === 403) {\n        setError('You do not have permission to delete coupons. Admin access required.');\n      } else if (err.response?.status === 404) {\n        // Handle case where coupon was already deleted\n        setError(`Coupon \"${selectedCoupon.name}\" has already been deleted. Refreshing the list...`);\n        // Auto-refresh the list to remove stale entries\n        setTimeout(() => {\n          loadCoupons();\n          setError(null);\n        }, 2000);\n      } else {\n        setError(err.response?.data?.message || `Failed to delete coupon \"${selectedCoupon.name}\"`);\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('th-TH', {\n      style: 'currency',\n      currency: 'THB'\n    }).format(amount);\n  };\n\n  if (loading && coupons.length === 0) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 p-4\">\n        <div className=\"max-w-6xl mx-auto\">\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <div className=\"animate-pulse space-y-4\">\n              <div className=\"h-6 bg-gray-200 rounded w-1/4\" />\n              <div className=\"space-y-3\">\n                {[...Array(5)].map((_, i) => (\n                  <div key={i} className=\"h-16 bg-gray-200 rounded\" />\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <div className=\"bg-white shadow-sm\">\n        <div className=\"max-w-6xl mx-auto p-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-2xl font-bold text-gray-900\">\n                {t('admin.coupons.title')}\n              </h1>\n              <p className=\"text-gray-600 mt-1\">\n                {t('admin.coupons.subtitle')}\n              </p>\n            </div>\n            <div className=\"flex items-center space-x-3\">\n              <button\n                onClick={() => {\n                  setShowCreateModal(true);\n                  setCreateModalError(null); // Clear any previous errors\n                }}\n                className=\"inline-flex items-center font-medium bg-blue-600 text-white px-4 py-2 text-sm rounded-md hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n              >\n                {t('admin.coupons.createCoupon')}\n              </button>\n              <DashboardButton variant=\"outline\" size=\"md\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"max-w-6xl mx-auto p-4\">\n        {error && (\n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-6\">\n            <div className=\"flex\">\n              <div className=\"text-red-400 mr-3\">‚ö†Ô∏è</div>\n              <div>\n                <h3 className=\"text-red-800 font-medium\">Error</h3>\n                <p className=\"text-red-700 mt-1\">{error}</p>\n                <button\n                  onClick={() => setError(null)}\n                  className=\"text-red-600 underline hover:text-red-800 mt-2\"\n                >\n                  Dismiss\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Coupons Table */}\n        <div className=\"bg-white rounded-lg shadow overflow-hidden\">\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full divide-y divide-gray-200\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    {t('admin.coupons.title_field')}\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    {t('admin.coupons.couponTypeAndValue')}\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    {t('admin.coupons.usage')}\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    {t('admin.coupons.validity')}\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    {t('admin.coupons.status')}\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    {t('admin.coupons.actions')}\n                  </th>\n                </tr>\n              </thead>\n              <tbody className=\"bg-white divide-y divide-gray-200\">\n                {coupons.length === 0 ? (\n                  <tr>\n                    <td colSpan={6} className=\"px-6 py-12 text-center\">\n                      <div className=\"text-gray-500\">\n                        <p className=\"text-lg font-medium\">{t('admin.coupons.noCoupons')}</p>\n                        <p className=\"text-sm mt-1\">{t('admin.coupons.noCouponsDescription')}</p>\n                      </div>\n                    </td>\n                  </tr>\n                ) : (\n                  coupons.map((coupon) => (\n                    <tr key={coupon.id} className=\"hover:bg-gray-50\">\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <div>\n                        <div className=\"text-sm font-medium text-gray-900\">\n                          {coupon.name}\n                        </div>\n                        <div className=\"text-sm text-gray-500\">\n                          {coupon.code} - {coupon.description}\n                        </div>\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <div className=\"text-sm text-gray-900\">\n                        {coupon.type === 'percentage' \n                          ? `${coupon.value}% off`\n                          : coupon.type === 'fixed_amount'\n                          ? formatCurrency(coupon.value || 0)\n                          : t(`coupons.types.${coupon.type}`)\n                        }\n                      </div>\n                      {(coupon.minimumSpend || 0) > 0 && (\n                        <div className=\"text-sm text-gray-500\">\n                          {t('admin.coupons.min')}: {formatCurrency(coupon.minimumSpend || 0)}\n                        </div>\n                      )}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <div className=\"text-sm text-gray-900\">\n                        {coupon.usedCount || 0} / {coupon.usageLimit}\n                      </div>\n                      <div className=\"text-sm text-gray-500\">\n                        {t('admin.coupons.maxPerUser', { count: coupon.usageLimitPerUser })}\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <div className=\"text-sm text-gray-900\">\n                        {new Date(coupon.validFrom).toLocaleDateString()}\n                      </div>\n                      <div className=\"text-sm text-gray-500\">\n                        {t('admin.coupons.to')} {coupon.validUntil ? new Date(coupon.validUntil).toLocaleDateString() : t('common.noEndDate')}\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${\n                        coupon.status === 'active'\n                          ? 'bg-green-100 text-green-800'\n                          : coupon.status === 'paused'\n                          ? 'bg-yellow-100 text-yellow-800'\n                          : 'bg-red-100 text-red-800'\n                      }`}\n                      >\n                        {coupon.status === 'active' ? t('admin.coupons.active') : \n                         coupon.status === 'paused' ? t('admin.coupons.paused') : \n                         t(`admin.coupons.${coupon.status}`)}\n                      </span>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\n                      <div className=\"flex flex-col sm:flex-row sm:space-x-2 space-y-1 sm:space-y-0\">\n                        <button\n                          onClick={() => {\n                            setSelectedCoupon(coupon);\n                            setShowAssignModal(true);\n                          }}\n                          className=\"text-blue-600 hover:text-blue-900 text-left\"\n                        >\n                          {t('admin.coupons.assign')}\n                        </button>\n                        <button\n                          onClick={() => {\n                            setSelectedCoupon(coupon);\n                            setShowAssignmentsModal(true);\n                          }}\n                          className=\"text-purple-600 hover:text-purple-900 text-left\"\n                        >\n                          {t('admin.coupons.viewAssignments')}\n                        </button>\n                        <button\n                          onClick={() => handleToggleCouponStatus(coupon)}\n                          className={`text-left ${\n                            coupon.status === 'active'\n                              ? 'text-orange-600 hover:text-orange-900'\n                              : 'text-green-600 hover:text-green-900'\n                          }`}\n                        >\n                          {coupon.status === 'active' ? t('admin.coupons.pause') : t('admin.coupons.activate')}\n                        </button>\n                        <button\n                          onClick={() => handleDeleteCoupon(coupon)}\n                          className=\"text-red-600 hover:text-red-900 text-left\"\n                          title={t('admin.coupons.deleteTooltip')}\n                        >\n                          {t('admin.coupons.remove')}\n                        </button>\n                      </div>\n                    </td>\n                    </tr>\n                  ))\n                )}\n              </tbody>\n            </table>\n          </div>\n\n          {/* Pagination */}\n          {totalPages > 1 && (\n            <div className=\"bg-white px-4 py-3 border-t border-gray-200 sm:px-6\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"text-sm text-gray-700\">\n                  {t('admin.pagination.page')} {page} {t('admin.pagination.of')} {totalPages}\n                </div>\n                <div className=\"flex space-x-2\">\n                  <button\n                    onClick={() => loadCoupons(page - 1)}\n                    disabled={page <= 1}\n                    className=\"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded disabled:opacity-50\"\n                  >\n                    {t('common.previous')}\n                  </button>\n                  <button\n                    onClick={() => loadCoupons(page + 1)}\n                    disabled={page >= totalPages}\n                    className=\"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded disabled:opacity-50\"\n                  >\n                    {t('common.next')}\n                  </button>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Create Coupon Modal */}\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg max-w-2xl w-full max-h-full overflow-y-auto\">\n            <div className=\"p-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h2 className=\"text-xl font-semibold\">{t('admin.coupons.createNewCoupon')}</h2>\n                <button\n                  onClick={() => {\n                    setShowCreateModal(false);\n                    setCreateModalError(null); // Clear error when closing\n                  }}\n                  className=\"text-gray-400 hover:text-gray-600\"\n                >\n                  ‚úï\n                </button>\n              </div>\n\n              {/* Modal-specific error display */}\n              {createModalError && (\n                <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-4\">\n                  <div className=\"flex\">\n                    <div className=\"text-red-400 mr-3\">‚ö†Ô∏è</div>\n                    <div className=\"flex-1\">\n                      <h3 className=\"text-red-800 font-medium text-sm\">{t('admin.coupons.errorCreating')}</h3>\n                      <p className=\"text-red-700 text-sm mt-1\">{createModalError}</p>\n                      <button\n                        onClick={() => setCreateModalError(null)}\n                        className=\"text-red-600 underline hover:text-red-800 text-xs mt-2\"\n                      >\n                        {t('common.dismiss')}\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              <form onSubmit={handleCreateCoupon} className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      {t('admin.coupons.code')}\n                    </label>\n                    <input\n                      type=\"text\"\n                      required\n                      value={newCoupon.code}\n                      onChange={(e) => setNewCoupon({...newCoupon, code: e.target.value.toUpperCase()})}\n                      placeholder={t('admin.coupons.codePlaceholder')}\n                      className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      {t('admin.coupons.name')}\n                    </label>\n                    <input\n                      type=\"text\"\n                      required\n                      value={newCoupon.name}\n                      onChange={(e) => setNewCoupon({...newCoupon, name: e.target.value})}\n                      placeholder={t('admin.coupons.namePlaceholder')}\n                      className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      {t('admin.coupons.type_field')}\n                    </label>\n                    <select\n                      value={newCoupon.type}\n                      onChange={(e) => setNewCoupon({...newCoupon, type: e.target.value as CouponType})}\n                      className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    >\n                      <option value=\"percentage\">{t('coupons.types.percentage')}</option>\n                      <option value=\"fixed_amount\">{t('coupons.types.fixed_amount')}</option>\n                      <option value=\"bogo\">{t('coupons.types.bogo')}</option>\n                      <option value=\"free_upgrade\">{t('coupons.types.free_upgrade')}</option>\n                      <option value=\"free_service\">{t('coupons.types.free_service')}</option>\n                    </select>\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    {t('admin.coupons.description_field')}\n                  </label>\n                  <textarea\n                    value={newCoupon.description}\n                    onChange={(e) => setNewCoupon({...newCoupon, description: e.target.value})}\n                    rows={3}\n                    className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      {newCoupon.type === 'percentage' ? t('admin.coupons.percentage') : t('admin.coupons.amount')}\n                    </label>\n                    <input\n                      type=\"number\"\n                      step={newCoupon.type === 'percentage' ? '1' : '0.01'}\n                      min=\"0\"\n                      required\n                      value={newCoupon.value}\n                      onChange={(e) => setNewCoupon({...newCoupon, value: parseFloat(e.target.value) || 0})}\n                      className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      {t('admin.coupons.minimumSpend')}\n                    </label>\n                    <input\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0\"\n                      value={newCoupon.minimumSpend}\n                      onChange={(e) => setNewCoupon({...newCoupon, minimumSpend: parseFloat(e.target.value) || 0})}\n                      className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      {t('admin.coupons.maximumDiscount')}\n                    </label>\n                    <input\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0\"\n                      value={newCoupon.maximumDiscount}\n                      onChange={(e) => setNewCoupon({...newCoupon, maximumDiscount: parseFloat(e.target.value) || 0})}\n                      className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      {t('admin.coupons.maxTotalUses')}\n                    </label>\n                    <input\n                      type=\"number\"\n                      min=\"1\"\n                      required\n                      value={newCoupon.usageLimit}\n                      onChange={(e) => setNewCoupon({...newCoupon, usageLimit: parseInt(e.target.value) || 1})}\n                      className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      {t('admin.coupons.maxUsesPerUser')}\n                    </label>\n                    <input\n                      type=\"number\"\n                      min=\"1\"\n                      required\n                      value={newCoupon.usageLimitPerUser}\n                      onChange={(e) => setNewCoupon({...newCoupon, usageLimitPerUser: parseInt(e.target.value) || 1})}\n                      className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      {t('admin.coupons.validFrom')}\n                    </label>\n                    <input\n                      type=\"date\"\n                      required\n                      value={newCoupon.validFrom}\n                      onChange={(e) => setNewCoupon({...newCoupon, validFrom: e.target.value})}\n                      className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      {t('admin.coupons.validUntil')}\n                    </label>\n                    <input\n                      type=\"date\"\n                      required\n                      value={newCoupon.validUntil}\n                      onChange={(e) => setNewCoupon({...newCoupon, validUntil: e.target.value})}\n                      className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    />\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    {t('admin.coupons.termsAndConditions')}\n                  </label>\n                  <textarea\n                    value={newCoupon.termsAndConditions}\n                    onChange={(e) => setNewCoupon({...newCoupon, termsAndConditions: e.target.value})}\n                    rows={3}\n                    className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  />\n                </div>\n\n                <div className=\"text-sm text-gray-600\">\n                  <p>{t('admin.coupons.activeImmediately')}</p>\n                </div>\n\n                <div className=\"flex justify-end space-x-3 pt-4\">\n                  <button\n                    type=\"button\"\n                    onClick={() => {\n                      setShowCreateModal(false);\n                      setCreateModalError(null); // Clear error when canceling\n                    }}\n                    className=\"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200\"\n                  >\n                    {t('common.cancel')}\n                  </button>\n                  <button\n                    type=\"submit\"\n                    disabled={loading}\n                    className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50\"\n                  >\n                    {loading ? t('admin.coupons.creating') : t('admin.coupons.createCoupon')}\n                  </button>\n                </div>\n              </form>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Assign Coupon Modal */}\n      {showAssignModal && selectedCoupon && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg max-w-lg w-full max-h-full overflow-y-auto\">\n            <div className=\"p-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h2 className=\"text-xl font-semibold\">{t('admin.coupons.assignCoupon')}</h2>\n                <button\n                  onClick={() => {\n                    setShowAssignModal(false);\n                    setUserSearchTerm('');\n                  }}\n                  className=\"text-gray-400 hover:text-gray-600\"\n                >\n                  ‚úï\n                </button>\n              </div>\n\n              <div className=\"mb-4 p-3 bg-gray-50 rounded-md\">\n                <div className=\"font-medium\">{selectedCoupon.name}</div>\n                <div className=\"text-sm text-gray-600\">{selectedCoupon.code} - {selectedCoupon.description}</div>\n              </div>\n\n              {/* Search Field */}\n              <div className=\"mb-4\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  {t('admin.coupons.searchUsers')}\n                </label>\n                <input\n                  type=\"text\"\n                  value={userSearchTerm}\n                  onChange={(e) => setUserSearchTerm(e.target.value)}\n                  placeholder={t('admin.coupons.searchPlaceholder')}\n                  className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                />\n              </div>\n\n              <div className=\"space-y-3 max-h-60 overflow-y-auto\">\n                {users\n                  .filter(user => {\n                    if (!userSearchTerm) {return true;}\n                    const searchLower = userSearchTerm.toLowerCase();\n                    const fullName = `${user.firstName || ''} ${user.lastName || ''}`.toLowerCase();\n                    const email = (user.email || '').toLowerCase();\n                    const membershipId = (user.membershipId || '').toLowerCase();\n                    return (\n                      fullName.includes(searchLower) ||\n                      email.includes(searchLower) ||\n                      membershipId.includes(searchLower)\n                    );\n                  })\n                  .map((user) => (\n                  <label key={user.id || user.email} className=\"flex items-center p-2 hover:bg-gray-50 rounded-md cursor-pointer\">\n                    <input\n                      type=\"checkbox\"\n                      checked={selectedUsers.includes(user.id)}\n                      onChange={(e) => {\n                        if (e.target.checked) {\n                          setSelectedUsers([...selectedUsers, user.id]);\n                        } else {\n                          setSelectedUsers(selectedUsers.filter(id => id !== user.id));\n                        }\n                      }}\n                      className=\"mr-3 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                    />\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"font-medium text-gray-900\">{user.firstName || ''} {user.lastName || ''}</div>\n                        {user.membershipId && (\n                          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">\n                            ID: {user.membershipId}\n                          </span>\n                        )}\n                      </div>\n                      <div className=\"text-sm text-gray-600\">{user.email || 'No email'}</div>\n                      {!user.membershipId && (\n                        <div className=\"text-xs text-gray-400\">{t('admin.coupons.noMembershipId')}</div>\n                      )}\n                    </div>\n                  </label>\n                ))}\n                {users.filter(user => {\n                  if (!userSearchTerm) {return false;}\n                  const searchLower = userSearchTerm.toLowerCase();\n                  const fullName = `${user.firstName || ''} ${user.lastName || ''}`.toLowerCase();\n                  const email = (user.email || '').toLowerCase();\n                  const membershipId = (user.membershipId || '').toLowerCase();\n                  return (\n                    fullName.includes(searchLower) ||\n                    email.includes(searchLower) ||\n                    membershipId.includes(searchLower)\n                  );\n                }).length === 0 && userSearchTerm && (\n                  <div className=\"text-center py-4 text-gray-500\">\n                    <div className=\"text-sm\">{t('admin.coupons.noUsersFound', { searchTerm: userSearchTerm })}</div>\n                    <div className=\"text-xs mt-1\">{t('admin.coupons.searchHint')}</div>\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex justify-end space-x-3 pt-4 border-t\">\n                <button\n                  onClick={() => {\n                    setShowAssignModal(false);\n                    setUserSearchTerm('');\n                  }}\n                  className=\"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200\"\n                >\n                  {t('common.cancel')}\n                </button>\n                <button\n                  onClick={handleAssignCoupons}\n                  disabled={loading || selectedUsers.length === 0}\n                  className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50\"\n                >\n                  {loading ? t('admin.coupons.assigning') : t('admin.coupons.assignToUsers', { count: selectedUsers.length })}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Delete Confirmation Modal */}\n      {showDeleteModal && selectedCoupon && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg max-w-md w-full\">\n            <div className=\"p-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h2 className=\"text-xl font-semibold text-red-600\">{t('admin.coupons.deleteCoupon')}</h2>\n                <button\n                  onClick={() => {\n                    setShowDeleteModal(false);\n                    setSelectedCoupon(null);\n                    setDeleteConfirmText('');\n                  }}\n                  className=\"text-gray-400 hover:text-gray-600\"\n                >\n                  ‚úï\n                </button>\n              </div>\n\n              <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-md\">\n                <div className=\"flex items-center mb-2\">\n                  <span className=\"text-red-500 mr-2\">‚ö†Ô∏è</span>\n                  <span className=\"font-medium text-red-800\">{t('admin.coupons.deleteWarning')}</span>\n                </div>\n                <div className=\"text-sm text-red-700\">\n                  <p className=\"mb-2\">{t('admin.coupons.deleteConfirmText')}:</p>\n                  <p className=\"font-medium\">\"{selectedCoupon.name}\" ({selectedCoupon.code})</p>\n                </div>\n              </div>\n\n              <div className=\"mb-4 p-3 bg-gray-50 rounded-md\">\n                <p className=\"text-sm text-gray-700 mb-2\">{t('admin.coupons.deleteAffects')}:</p>\n                <ul className=\"text-sm text-gray-600 space-y-1\">\n                  <li>‚Ä¢ {t('admin.coupons.existingRedemptions', { count: selectedCoupon.usedCount || 0 })}</li>\n                  <li>‚Ä¢ {t('admin.coupons.assignedUsers')}</li>\n                  <li>‚Ä¢ {t('admin.coupons.analyticsHistory')}</li>\n                </ul>\n              </div>\n\n              <div className=\"mb-6\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  {t('admin.coupons.typeToConfirm')} <span className=\"font-bold text-red-600\">{t('admin.coupons.deleteKeyword')}</span> {t('admin.coupons.toConfirm')}:\n                </label>\n                <input\n                  type=\"text\"\n                  value={deleteConfirmText}\n                  onChange={(e) => setDeleteConfirmText(e.target.value)}\n                  placeholder={t('admin.coupons.deletePlaceholder')}\n                  className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500\"\n                />\n              </div>\n\n              <div className=\"flex justify-end space-x-3\">\n                <button\n                  onClick={() => {\n                    setShowDeleteModal(false);\n                    setSelectedCoupon(null);\n                    setDeleteConfirmText('');\n                  }}\n                  className=\"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200\"\n                >\n                  {t('common.cancel')}\n                </button>\n                <button\n                  onClick={confirmDeleteCoupon}\n                  disabled={loading || deleteConfirmText !== t('admin.coupons.deleteKeyword')}\n                  className=\"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  {loading ? t('admin.coupons.deleting') : t('admin.coupons.deleteCoupon')}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Coupon Assignments Modal */}\n      {showAssignmentsModal && selectedCoupon && (\n        <CouponAssignmentsModal\n          coupon={selectedCoupon}\n          isOpen={true}\n          onClose={() => {\n            setShowAssignmentsModal(false);\n            setSelectedCoupon(null);\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default CouponManagement;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/admin/CouponManagementMultilingual.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CouponStatus' is defined but never used.","line":3,"column":51,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":63},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showAssignModal' is assigned a value but never used.","line":22,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setShowAssignModal' is assigned a value but never used.","line":22,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'users' is assigned a value but never used.","line":27,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedUsers' is assigned a value but never used.","line":28,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSelectedUsers' is assigned a value but never used.","line":28,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":41},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadCoupons'. Either include it or remove the dependency array.","line":70,"column":6,"nodeType":"ArrayExpression","endLine":70,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [loadCoupons, page]","fix":{"range":[3110,3116],"text":"[loadCoupons, page]"}}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":77,"column":15,"nodeType":"MemberExpression","endLine":77,"endColumn":59},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":77,"column":60,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":77,"endColumn":62,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[3329,3331],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":78,"column":22,"nodeType":"MemberExpression","endLine":78,"endColumn":73},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":78,"column":74,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":78,"endColumn":76,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[3409,3411],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":79,"column":29,"nodeType":"MemberExpression","endLine":79,"endColumn":87},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":79,"column":88,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":79,"endColumn":90,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[3503,3505],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":93,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":93,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3930,3976],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":104,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":104,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4196,4240],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4415,4418],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4415,4418],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":116,"column":13,"nodeType":"MemberExpression","endLine":116,"endColumn":35},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":119,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":119,"endColumn":23,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[4719,4782],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":130,"column":11,"nodeType":"MemberExpression","endLine":130,"endColumn":45},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":131,"column":11,"nodeType":"MemberExpression","endLine":131,"endColumn":52},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":132,"column":11,"nodeType":"MemberExpression","endLine":132,"endColumn":59},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":133,"column":11,"nodeType":"MemberExpression","endLine":133,"endColumn":41},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":141,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":141,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5579,5639],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":150,"column":86,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":150,"endColumn":88,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[5935,5937],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":151,"column":107,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":151,"endColumn":109,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[6050,6052],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":168,"column":9,"nodeType":"MemberExpression","endLine":168,"endColumn":24},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":185,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":185,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[6982,7026],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":191,"column":9,"nodeType":"MemberExpression","endLine":191,"endColumn":24},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":210,"column":13,"nodeType":"MemberExpression","endLine":210,"endColumn":28},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":228,"column":13,"nodeType":"MemberExpression","endLine":228,"endColumn":28},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":236,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":236,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[8782,8842],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":268,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":268,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9706,9709],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9706,9709],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":269,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":269,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[9719,9766],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":313,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":313,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[10930,10977],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":322,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":322,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11228,11230],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":324,"column":53,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":324,"endColumn":55,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11327,11329],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":328,"column":57,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":328,"endColumn":59,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11485,11487],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":329,"column":71,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":329,"endColumn":73,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11564,11566],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":335,"column":39,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":335,"endColumn":41,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11692,11694],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":337,"column":27,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":337,"endColumn":29,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11750,11752],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":338,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":338,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11796,11798],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":339,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":339,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11848,11850],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":340,"column":37,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":340,"endColumn":39,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11890,11892],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":344,"column":53,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":344,"endColumn":55,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[12198,12200],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":454,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":454,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[17206,17208],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":473,"column":157,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":473,"endColumn":159,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[18193,18195],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":46,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Coupon, CreateCouponRequest, CouponType, CouponStatus } from '../../types/coupon';\nimport { SupportedLanguage } from '../../types/multilingual';\nimport { couponService } from '../../services/couponService';\nimport { translationService } from '../../services/translationService';\nimport { loyaltyService, AdminUserLoyalty } from '../../services/loyaltyService';\nimport DashboardButton from '../../components/navigation/DashboardButton';\nimport LanguageTabs from '../../components/translation/LanguageTabs';\nimport TranslationButton from '../../components/translation/TranslationButton';\nimport CouponAssignmentsModal from '../../components/admin/CouponAssignmentsModal';\nimport toast from 'react-hot-toast';\n\n// Use AdminUserLoyalty type from loyaltyService instead of local interface\n\nconst CouponManagementMultilingual: React.FC = () => {\n  const { t } = useTranslation();\n  const [coupons, setCoupons] = useState<Coupon[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [showAssignModal, setShowAssignModal] = useState(false);\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\n  const [showAssignmentsModal, setShowAssignmentsModal] = useState(false);\n  const [selectedCoupon, setSelectedCoupon] = useState<Coupon | null>(null);\n  const [deleteConfirmText, setDeleteConfirmText] = useState('');\n  const [users, setUsers] = useState<AdminUserLoyalty[]>([]);\n  const [selectedUsers, setSelectedUsers] = useState<string[]>([]);\n  const [page, setPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [createModalError, setCreateModalError] = useState<string | null>(null);\n\n  // Translation state\n  const [currentLanguage, setCurrentLanguage] = useState<SupportedLanguage>('th');\n  const [availableLanguages, setAvailableLanguages] = useState<SupportedLanguage[]>(['th']);\n  const [translationStatus, setTranslationStatus] = useState<{ [key in SupportedLanguage]?: 'original' | 'translated' | 'pending' | 'error' }>({\n    'th': 'original'\n  });\n  const [translating, setTranslating] = useState(false);\n\n  // Create coupon form state with multilingual support\n  const [multilingualCouponData, setMultilingualCouponData] = useState<{\n    name: { [key in SupportedLanguage]?: string };\n    description: { [key in SupportedLanguage]?: string };\n    termsAndConditions: { [key in SupportedLanguage]?: string };\n  }>({\n    name: { th: '' },\n    description: { th: '' },\n    termsAndConditions: { th: '' }\n  });\n\n  const [newCoupon, setNewCoupon] = useState<CreateCouponRequest>({\n    code: '',\n    name: '',\n    description: '',\n    type: 'percentage',\n    value: 0,\n    minimumSpend: 0,\n    maximumDiscount: 0,\n    usageLimit: 100,\n    usageLimitPerUser: 1,\n    validFrom: new Date().toISOString().split('T')[0],\n    validUntil: '',\n    termsAndConditions: ''\n  });\n\n  useEffect(() => {\n    loadCoupons();\n    loadUsers();\n  }, [page]);\n\n  useEffect(() => {\n    // Update displayed form data when language changes\n    if (showCreateModal) {\n      setNewCoupon(prev => ({\n        ...prev,\n        name: multilingualCouponData.name[currentLanguage] || '',\n        description: multilingualCouponData.description[currentLanguage] || '',\n        termsAndConditions: multilingualCouponData.termsAndConditions[currentLanguage] || ''\n      }));\n    }\n  }, [currentLanguage, multilingualCouponData, showCreateModal]);\n\n  const loadCoupons = async (pageNum: number = 1) => {\n    try {\n      setLoading(true);\n      setError(null);\n      const response = await couponService.getCoupons(pageNum, 10);\n      setCoupons(response.coupons);\n      setTotalPages(response.totalPages);\n    } catch (err) {\n      setError(t('coupons.admin.errors.loadFailed'));\n      console.error('Failed to load coupons:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const loadUsers = async () => {\n    try {\n      const usersData = await loyaltyService.getUsers();\n      setUsers(usersData.users || []);\n    } catch (err) {\n      console.error('Failed to load users:', err);\n    }\n  };\n\n  const loadCouponTranslations = async (couponId: string, languages: SupportedLanguage[]) => {\n    try {\n      const translations: { [key in SupportedLanguage]?: any } = {};\n      \n      for (const language of languages) {\n        try {\n          const translatedCoupon = await couponService.getCouponWithTranslations(couponId);\n          if (translatedCoupon) {\n            translations[language] = translatedCoupon;\n          }\n        } catch (error) {\n          console.warn(`Failed to load ${language} translation:`, error);\n        }\n      }\n      \n      // Update multilingual data with translations\n      const newMultilingualData = { ...multilingualCouponData };\n      const newTranslationStatus = { ...translationStatus };\n      \n      Object.entries(translations).forEach(([lang, data]) => {\n        const language = lang as SupportedLanguage;\n        if (data) {\n          newMultilingualData.name[language] = data.name;\n          newMultilingualData.description[language] = data.description || '';\n          newMultilingualData.termsAndConditions[language] = data.termsAndConditions || '';\n          newTranslationStatus[language] = 'translated';\n        }\n      });\n      \n      setMultilingualCouponData(newMultilingualData);\n      setTranslationStatus(newTranslationStatus);\n      \n    } catch (error) {\n      console.error('Failed to load coupon translations:', error);\n    }\n  };\n\n  const updateCurrentLanguageData = () => {\n    if (showCreateModal) {\n      setMultilingualCouponData(prev => ({\n        ...prev,\n        name: { ...prev.name, [currentLanguage]: newCoupon.name },\n        description: { ...prev.description, [currentLanguage]: newCoupon.description || '' },\n        termsAndConditions: { ...prev.termsAndConditions, [currentLanguage]: newCoupon.termsAndConditions || '' }\n      }));\n    }\n  };\n\n  const handleLanguageChange = (language: SupportedLanguage) => {\n    updateCurrentLanguageData();\n    setCurrentLanguage(language);\n  };\n\n  const handleTranslateCoupon = async (couponId: string, targetLanguages: SupportedLanguage[]) => {\n    try {\n      setTranslating(true);\n      \n      // Update translation status to pending for target languages\n      const newStatus = { ...translationStatus };\n      targetLanguages.forEach(lang => {\n        newStatus[lang] = 'pending';\n      });\n      setTranslationStatus(newStatus);\n\n      // Start translation job\n      const translationJob = await translationService.translateCoupon(\n        couponId,\n        currentLanguage,\n        targetLanguages\n      );\n\n      toast.success(t('translation.translationStarted'));\n\n      // Poll for completion\n      pollTranslationProgress(translationJob.id, targetLanguages, couponId);\n\n    } catch (error) {\n      console.error('Translation failed:', error);\n      toast.error(t('translation.translationFailed'));\n      \n      // Reset status on error\n      const newStatus = { ...translationStatus };\n      targetLanguages.forEach(lang => {\n        newStatus[lang] = 'error';\n      });\n      setTranslationStatus(newStatus);\n    } finally {\n      setTranslating(false);\n    }\n  };\n\n  const pollTranslationProgress = async (jobId: string, targetLanguages: SupportedLanguage[], couponId: string) => {\n    const pollInterval = setInterval(async () => {\n      try {\n        const job = await translationService.getTranslationJobStatus(jobId);\n        \n        if (job.status === 'completed') {\n          clearInterval(pollInterval);\n          \n          // Update status to completed\n          const newStatus = { ...translationStatus };\n          targetLanguages.forEach(lang => {\n            newStatus[lang] = 'translated';\n          });\n          setTranslationStatus(newStatus);\n          \n          // Add new languages to available languages\n          const newAvailableLanguages = [...new Set([...availableLanguages, ...targetLanguages])];\n          setAvailableLanguages(newAvailableLanguages);\n          \n          // Reload translations\n          await loadCouponTranslations(couponId, newAvailableLanguages);\n          \n          toast.success(t('translation.translationCompleted'));\n          \n        } else if (job.status === 'failed') {\n          clearInterval(pollInterval);\n          \n          const newStatus = { ...translationStatus };\n          targetLanguages.forEach(lang => {\n            newStatus[lang] = 'error';\n          });\n          setTranslationStatus(newStatus);\n          \n          toast.error(t('translation.translationFailed'));\n        }\n        \n      } catch (error) {\n        console.error('Failed to check translation status:', error);\n        clearInterval(pollInterval);\n      }\n    }, 2000);\n\n    // Clear interval after 5 minutes to prevent infinite polling\n    setTimeout(() => clearInterval(pollInterval), 5 * 60 * 1000);\n  };\n\n  const handleCreateCoupon = async () => {\n    updateCurrentLanguageData();\n\n    if (!newCoupon.code || !newCoupon.name) {\n      setCreateModalError(t('coupons.admin.validation.requiredFields'));\n      return;\n    }\n\n    try {\n      setCreateModalError(null);\n      \n      const couponData: CreateCouponRequest = {\n        ...newCoupon,\n        originalLanguage: currentLanguage,\n        // Note: autoTranslate handled separately if needed\n      };\n\n      await couponService.createCoupon(couponData);\n      \n      toast.success(t('coupons.admin.createSuccess'));\n      setShowCreateModal(false);\n      resetCreateForm();\n      loadCoupons(page);\n    } catch (err: any) {\n      console.error('Failed to create coupon:', err);\n      setCreateModalError(err.response?.data?.error || t('coupons.admin.errors.createFailed'));\n    }\n  };\n\n  const resetCreateForm = () => {\n    setNewCoupon({\n      code: '',\n      name: '',\n      description: '',\n      type: 'percentage',\n      value: 0,\n      minimumSpend: 0,\n      maximumDiscount: 0,\n      usageLimit: 100,\n      usageLimitPerUser: 1,\n      validFrom: new Date().toISOString().split('T')[0],\n      validUntil: '',\n      termsAndConditions: ''\n    });\n    setMultilingualCouponData({\n      name: { th: '' },\n      description: { th: '' },\n      termsAndConditions: { th: '' }\n    });\n    setCurrentLanguage('th');\n    setAvailableLanguages(['th']);\n    setTranslationStatus({ 'th': 'original' });\n    setCreateModalError(null);\n  };\n\n  const handleDeleteCoupon = async () => {\n    if (!selectedCoupon || deleteConfirmText !== selectedCoupon.code) {\n      return;\n    }\n\n    try {\n      await couponService.deleteCoupon(selectedCoupon.id);\n      toast.success(t('coupons.admin.deleteSuccess'));\n      setShowDeleteModal(false);\n      setSelectedCoupon(null);\n      setDeleteConfirmText('');\n      loadCoupons(page);\n    } catch (err) {\n      console.error('Failed to delete coupon:', err);\n      toast.error(t('coupons.admin.errors.deleteFailed'));\n    }\n  };\n\n  const openEditModal = (coupon: Coupon) => {\n    setSelectedCoupon(coupon);\n    \n    // Initialize multilingual data for editing\n    const originalLang = coupon.originalLanguage || 'th';\n    setCurrentLanguage(originalLang);\n    setAvailableLanguages(coupon.availableLanguages || [originalLang]);\n    \n    setMultilingualCouponData({\n      name: { [originalLang]: coupon.name },\n      description: { [originalLang]: coupon.description || '' },\n      termsAndConditions: { [originalLang]: coupon.termsAndConditions || '' }\n    });\n    \n    setNewCoupon({\n      code: coupon.code,\n      name: coupon.name,\n      description: coupon.description || '',\n      type: coupon.type,\n      value: coupon.value || 0,\n      minimumSpend: coupon.minimumSpend || 0,\n      maximumDiscount: coupon.maximumDiscount || 0,\n      usageLimit: coupon.usageLimit || 100,\n      usageLimitPerUser: coupon.usageLimitPerUser,\n      validFrom: coupon.validFrom ? new Date(coupon.validFrom).toISOString().split('T')[0] : '',\n      validUntil: coupon.validUntil ? new Date(coupon.validUntil).toISOString().split('T')[0] : '',\n      termsAndConditions: coupon.termsAndConditions || ''\n    });\n    \n    // Load translations if available\n    if (coupon.availableLanguages && coupon.availableLanguages.length > 1) {\n      loadCouponTranslations(coupon.id, coupon.availableLanguages);\n    }\n    \n    setShowCreateModal(true);\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto\" />\n          <p className=\"mt-4 text-gray-600\">{t('common.loading')}</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-gray-900\">\n              {t('coupons.admin.title')}\n            </h1>\n            <p className=\"mt-2 text-gray-600\">\n              {t('coupons.admin.description')}\n            </p>\n          </div>\n          <div className=\"flex space-x-4\">\n            <button\n              onClick={() => setShowCreateModal(true)}\n              className=\"bg-primary-600 text-white px-4 py-2 rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500\"\n            >\n              {t('coupons.admin.createCoupon')}\n            </button>\n            <DashboardButton />\n          </div>\n        </div>\n\n        {error && (\n          <div className=\"bg-red-50 border border-red-200 rounded-md p-4 mb-6\">\n            <p className=\"text-red-800\">{error}</p>\n          </div>\n        )}\n\n        {/* Coupons List */}\n        <div className=\"bg-white shadow rounded-lg overflow-hidden\">\n          <table className=\"min-w-full divide-y divide-gray-200\">\n            <thead className=\"bg-gray-50\">\n              <tr>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  {t('coupons.admin.table.code')}\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  {t('coupons.admin.table.name')}\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  {t('coupons.admin.table.type')}\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  {t('coupons.admin.table.value')}\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  {t('coupons.admin.table.status')}\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  {t('translation.languages')}\n                </th>\n                <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  {t('common.actions')}\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"bg-white divide-y divide-gray-200\">\n              {coupons.map((coupon) => (\n                <tr key={coupon.id} className=\"hover:bg-gray-50\">\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\n                    {coupon.code}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                    {coupon.name}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                    {t(`coupons.types.${coupon.type}`)}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                    {coupon.type === 'percentage' ? `${coupon.value}%` : \n                     coupon.type === 'fixed_amount' ? `${coupon.value} ${coupon.currency}` : \n                     t(`coupons.types.${coupon.type}`)}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${\n                      coupon.status === 'active' ? 'bg-green-100 text-green-800' :\n                      coupon.status === 'draft' ? 'bg-yellow-100 text-yellow-800' :\n                      coupon.status === 'paused' ? 'bg-gray-100 text-gray-800' :\n                      'bg-red-100 text-red-800'\n                    }`}\n                    >\n                      {t(`coupons.statuses.${coupon.status}`)}\n                    </span>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                    <div className=\"flex space-x-1\">\n                      {(coupon.availableLanguages || ['th']).map(lang => (\n                        <span\n                          key={lang}\n                          className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800\"\n                        >\n                          {lang.toUpperCase()}\n                        </span>\n                      ))}\n                    </div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2\">\n                    <button\n                      onClick={() => openEditModal(coupon)}\n                      className=\"text-primary-600 hover:text-primary-900\"\n                    >\n                      {t('common.edit')}\n                    </button>\n                    {coupon.id && (\n                      <button\n                        onClick={() => handleTranslateCoupon(coupon.id, (['en', 'zh-CN'] as SupportedLanguage[]).filter(lang => !(coupon.availableLanguages || []).includes(lang)))}\n                        disabled={translating}\n                        className=\"text-green-600 hover:text-green-900 disabled:opacity-50\"\n                      >\n                        {t('translation.translate')}\n                      </button>\n                    )}\n                    <button\n                      onClick={() => {\n                        setSelectedCoupon(coupon);\n                        setShowDeleteModal(true);\n                      }}\n                      className=\"text-red-600 hover:text-red-900\"\n                    >\n                      {t('common.delete')}\n                    </button>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n\n          {coupons.length === 0 && (\n            <div className=\"text-center py-8 text-gray-500\">\n              <p>{t('coupons.admin.noCoupons')}</p>\n            </div>\n          )}\n        </div>\n\n        {/* Pagination */}\n        {totalPages > 1 && (\n          <div className=\"mt-6 flex items-center justify-center space-x-2\">\n            <button\n              onClick={() => setPage(Math.max(1, page - 1))}\n              disabled={page === 1}\n              className=\"px-3 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {t('common.previous')}\n            </button>\n            <span className=\"px-3 py-2 text-gray-700\">\n              {t('common.pageOf', { current: page, total: totalPages })}\n            </span>\n            <button\n              onClick={() => setPage(Math.min(totalPages, page + 1))}\n              disabled={page === totalPages}\n              className=\"px-3 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {t('common.next')}\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* Create/Edit Coupon Modal */}\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center p-4 z-50\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-auto\">\n            <div className=\"px-6 py-4 border-b border-gray-200\">\n              <h3 className=\"text-lg font-medium text-gray-900\">\n                {selectedCoupon ? t('coupons.admin.editCoupon') : t('coupons.admin.createCoupon')}\n              </h3>\n            </div>\n            \n            <div className=\"p-6 space-y-6\">\n              {/* Language Tabs */}\n              {selectedCoupon && (\n                <div>\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <h4 className=\"text-sm font-medium text-gray-900\">\n                      {t('translation.languages')}\n                    </h4>\n                    <TranslationButton\n                      onTranslate={(targetLanguages) => handleTranslateCoupon(selectedCoupon.id, targetLanguages)}\n                      isTranslating={translating}\n                      availableLanguages={availableLanguages}\n                      originalLanguage={availableLanguages[0] || 'th'}\n                    />\n                  </div>\n                  \n                  <LanguageTabs\n                    languages={availableLanguages}\n                    currentLanguage={currentLanguage}\n                    onLanguageChange={handleLanguageChange}\n                    translationStatus={translationStatus}\n                  />\n                </div>\n              )}\n\n              {createModalError && (\n                <div className=\"bg-red-50 border border-red-200 rounded-md p-4\">\n                  <p className=\"text-red-800\">{createModalError}</p>\n                </div>\n              )}\n\n              {/* Form Fields */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div>\n                  <label htmlFor=\"code\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    {t('coupons.admin.form.code')} *\n                  </label>\n                  <input\n                    type=\"text\"\n                    id=\"code\"\n                    value={newCoupon.code}\n                    onChange={(e) => setNewCoupon({ ...newCoupon, code: e.target.value })}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500\"\n                    placeholder={t('coupons.admin.form.codePlaceholder')}\n                    disabled={!!selectedCoupon}\n                  />\n                </div>\n\n                <div>\n                  <label htmlFor=\"name\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    {t('coupons.admin.form.name')} * ({currentLanguage.toUpperCase()})\n                  </label>\n                  <input\n                    type=\"text\"\n                    id=\"name\"\n                    value={newCoupon.name}\n                    onChange={(e) => setNewCoupon({ ...newCoupon, name: e.target.value })}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500\"\n                    placeholder={t('coupons.admin.form.namePlaceholder')}\n                  />\n                </div>\n\n                <div className=\"md:col-span-2\">\n                  <label htmlFor=\"description\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    {t('coupons.admin.form.description')} ({currentLanguage.toUpperCase()})\n                  </label>\n                  <textarea\n                    id=\"description\"\n                    value={newCoupon.description}\n                    onChange={(e) => setNewCoupon({ ...newCoupon, description: e.target.value })}\n                    rows={3}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500\"\n                    placeholder={t('coupons.admin.form.descriptionPlaceholder')}\n                  />\n                </div>\n\n                <div>\n                  <label htmlFor=\"type\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    {t('coupons.admin.form.type')}\n                  </label>\n                  <select\n                    id=\"type\"\n                    value={newCoupon.type}\n                    onChange={(e) => setNewCoupon({ ...newCoupon, type: e.target.value as CouponType })}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500\"\n                  >\n                    <option value=\"percentage\">{t('coupons.types.percentage')}</option>\n                    <option value=\"fixed_amount\">{t('coupons.types.fixed_amount')}</option>\n                    <option value=\"bogo\">{t('coupons.types.bogo')}</option>\n                    <option value=\"free_upgrade\">{t('coupons.types.free_upgrade')}</option>\n                    <option value=\"free_service\">{t('coupons.types.free_service')}</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label htmlFor=\"value\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    {t('coupons.admin.form.value')}\n                  </label>\n                  <input\n                    type=\"number\"\n                    id=\"value\"\n                    value={newCoupon.value}\n                    onChange={(e) => setNewCoupon({ ...newCoupon, value: Number(e.target.value) })}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500\"\n                    min=\"0\"\n                    step=\"0.01\"\n                  />\n                </div>\n\n                <div className=\"md:col-span-2\">\n                  <label htmlFor=\"termsAndConditions\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    {t('coupons.admin.form.termsAndConditions')} ({currentLanguage.toUpperCase()})\n                  </label>\n                  <textarea\n                    id=\"termsAndConditions\"\n                    value={newCoupon.termsAndConditions}\n                    onChange={(e) => setNewCoupon({ ...newCoupon, termsAndConditions: e.target.value })}\n                    rows={4}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500\"\n                    placeholder={t('coupons.admin.form.termsPlaceholder')}\n                  />\n                </div>\n              </div>\n            </div>\n\n            <div className=\"px-6 py-4 border-t border-gray-200 flex justify-end space-x-3\">\n              <button\n                onClick={() => {\n                  setShowCreateModal(false);\n                  setSelectedCoupon(null);\n                  resetCreateForm();\n                }}\n                className=\"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500\"\n              >\n                {t('common.cancel')}\n              </button>\n              <button\n                onClick={handleCreateCoupon}\n                className=\"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500\"\n              >\n                {selectedCoupon ? t('common.save') : t('common.create')}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Delete Confirmation Modal */}\n      {showDeleteModal && selectedCoupon && (\n        <div className=\"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center p-4 z-50\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full\">\n            <div className=\"px-6 py-4 border-b border-gray-200\">\n              <h3 className=\"text-lg font-medium text-gray-900\">\n                {t('coupons.admin.deleteCoupon')}\n              </h3>\n            </div>\n            \n            <div className=\"p-6\">\n              <p className=\"text-gray-700 mb-4\">\n                {t('coupons.admin.deleteConfirmation', { code: selectedCoupon.code })}\n              </p>\n              \n              <div className=\"mb-4\">\n                <label htmlFor=\"confirmText\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  {t('coupons.admin.typeCodeToConfirm')}\n                </label>\n                <input\n                  type=\"text\"\n                  id=\"confirmText\"\n                  value={deleteConfirmText}\n                  onChange={(e) => setDeleteConfirmText(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500\"\n                  placeholder={selectedCoupon.code}\n                />\n              </div>\n            </div>\n\n            <div className=\"px-6 py-4 border-t border-gray-200 flex justify-end space-x-3\">\n              <button\n                onClick={() => {\n                  setShowDeleteModal(false);\n                  setSelectedCoupon(null);\n                  setDeleteConfirmText('');\n                }}\n                className=\"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500\"\n              >\n                {t('common.cancel')}\n              </button>\n              <button\n                onClick={handleDeleteCoupon}\n                disabled={deleteConfirmText !== selectedCoupon.code}\n                className=\"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {t('common.delete')}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Assignments Modal */}\n      {showAssignmentsModal && selectedCoupon && (\n        <CouponAssignmentsModal\n          coupon={selectedCoupon}\n          isOpen={showAssignmentsModal}\n          onClose={() => {\n            setShowAssignmentsModal(false);\n            setSelectedCoupon(null);\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default CouponManagementMultilingual;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/admin/LoyaltyAdminPage.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadUsers'. Either include it or remove the dependency array.","line":69,"column":6,"nodeType":"ArrayExpression","endLine":69,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [currentPage, loadUsers, searchTerm]","fix":{"range":[1999,2024],"text":"[currentPage, loadUsers, searchTerm]"}}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":83,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":83,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2407,2453],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":95,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":95,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2803,2861],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":147,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":147,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4481,4530],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":190,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":190,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5510,5558],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":269,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":269,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[8279,8337],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":437,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":437,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[16839,16841],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":541,"column":98,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":541,"endColumn":100,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[21788,21790],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":605,"column":35,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[25307,25343],"text":"\n                                  &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[25307,25343],"text":"\n                                  &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[25307,25343],"text":"\n                                  &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[25307,25343],"text":"\n                                  &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":605,"column":62,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[25369,25403],"text":"&quot;\n                                "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[25369,25403],"text":"&ldquo;\n                                "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[25369,25403],"text":"&#34;\n                                "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[25369,25403],"text":"&rdquo;\n                                "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":757,"column":126,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":757,"endColumn":128,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[32373,32375],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":833,"column":130,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[36280,36315],"text":" to user&apos;s total\n                  "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[36280,36315],"text":" to user&lsquo;s total\n                  "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[36280,36315],"text":" to user&#39;s total\n                  "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[36280,36315],"text":" to user&rsquo;s total\n                  "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { \n  FiUsers, \n  FiAward, \n  FiPlus, \n  FiMinus, \n  FiRefreshCw,\n  FiSearch,\n  FiDollarSign,\n  FiUser\n} from 'react-icons/fi';\nimport toast from 'react-hot-toast';\nimport { \n  loyaltyService, \n  AdminUserLoyalty, \n  PointsTransaction \n} from '../../services/loyaltyService';\nimport DashboardButton from '../../components/navigation/DashboardButton';\n\ninterface PointsAdjustmentModal {\n  isOpen: boolean;\n  user: AdminUserLoyalty | null;\n  type: 'award' | 'deduct';\n}\n\ninterface SpendingConsoleModal {\n  isOpen: boolean;\n}\n\nexport default function LoyaltyAdminPage() {\n  const { t } = useTranslation();\n  \n  const [users, setUsers] = useState<AdminUserLoyalty[]>([]);\n  const [totalUsers, setTotalUsers] = useState(0);\n  const [currentPage, setCurrentPage] = useState(0);\n  const [pageSize] = useState(20);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [isLoading, setIsLoading] = useState(true);\n  const [isLoadingAction, setIsLoadingAction] = useState(false);\n  const [selectedUser, setSelectedUser] = useState<AdminUserLoyalty | null>(null);\n  const [userTransactions, setUserTransactions] = useState<PointsTransaction[]>([]);\n  const [pointsModal, setPointsModal] = useState<PointsAdjustmentModal>({\n    isOpen: false,\n    user: null,\n    type: 'award'\n  });\n  const [pointsForm, setPointsForm] = useState({\n    points: '',\n    description: '',\n    referenceId: ''\n  });\n  const [spendingModal, setSpendingModal] = useState<SpendingConsoleModal>({\n    isOpen: false\n  });\n  const [spendingForm, setSpendingForm] = useState({\n    userId: '',\n    spendingAmount: '',\n    nightsStayed: '',\n    checkinId: '',\n    userSearchTerm: '',\n    selectedUser: null as AdminUserLoyalty | null\n  });\n  const [userSearchResults, setUserSearchResults] = useState<AdminUserLoyalty[]>([]);\n  const [isSearchingUsers, setIsSearchingUsers] = useState(false);\n\n  useEffect(() => {\n    loadUsers();\n  }, [currentPage, searchTerm]);\n\n  const loadUsers = async () => {\n    try {\n      setIsLoading(true);\n      const result = await loyaltyService.getAllUsersLoyaltyStatus(\n        pageSize,\n        currentPage * pageSize,\n        searchTerm || undefined\n      );\n      setUsers(result.users);\n      setTotalUsers(result.total);\n    } catch (error) {\n      toast.error(t('admin.loyalty.errors.loadFailed'));\n      console.error('Failed to load users:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const loadUserTransactions = async (userId: string) => {\n    try {\n      const result = await loyaltyService.getUserPointsHistoryAdmin(userId, 50, 0);\n      setUserTransactions(result.transactions);\n    } catch (error) {\n      toast.error(t('admin.loyalty.errors.transactionsFailed'));\n      console.error('Failed to load user transactions:', error);\n    }\n  };\n\n  const handleSearch = (e: React.FormEvent) => {\n    e.preventDefault();\n    setCurrentPage(0);\n    loadUsers();\n  };\n\n  const openPointsModal = (user: AdminUserLoyalty, type: 'award' | 'deduct') => {\n    setPointsModal({ isOpen: true, user, type });\n    setPointsForm({ points: '', description: '', referenceId: '' });\n  };\n\n  const closePointsModal = () => {\n    setPointsModal({ isOpen: false, user: null, type: 'award' });\n    setPointsForm({ points: '', description: '', referenceId: '' });\n  };\n\n  const handlePointsSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!pointsModal.user || !pointsForm.points) {return;}\n\n    try {\n      setIsLoadingAction(true);\n      const points = parseInt(pointsForm.points);\n      \n      if (pointsModal.type === 'award') {\n        await loyaltyService.awardPoints(\n          pointsModal.user.user_id,\n          points,\n          pointsForm.description || undefined,\n          pointsForm.referenceId || undefined\n        );\n        toast.success(t('admin.loyalty.success.pointsAwarded', { points }));\n      } else {\n        await loyaltyService.deductPoints(\n          pointsModal.user.user_id,\n          points,\n          pointsForm.description || `Points deducted by admin`\n        );\n        toast.success(t('admin.loyalty.success.pointsDeducted', { points }));\n      }\n\n      closePointsModal();\n      loadUsers();\n      if (selectedUser?.user_id === pointsModal.user.user_id) {\n        loadUserTransactions(pointsModal.user.user_id);\n      }\n    } catch (error) {\n      toast.error(t('admin.loyalty.errors.pointsOperationFailed'));\n      console.error('Points operation failed:', error);\n    } finally {\n      setIsLoadingAction(false);\n    }\n  };\n\n  const openSpendingConsole = () => {\n    setSpendingModal({ isOpen: true });\n    setSpendingForm({\n      userId: '',\n      spendingAmount: '',\n      nightsStayed: '',\n      checkinId: '',\n      userSearchTerm: '',\n      selectedUser: null\n    });\n    setUserSearchResults([]);\n  };\n\n  const closeSpendingConsole = () => {\n    setSpendingModal({ isOpen: false });\n    setSpendingForm({\n      userId: '',\n      spendingAmount: '',\n      nightsStayed: '',\n      checkinId: '',\n      userSearchTerm: '',\n      selectedUser: null\n    });\n    setUserSearchResults([]);\n  };\n\n  const searchUsersForSpending = async (searchTerm: string) => {\n    if (!searchTerm.trim()) {\n      setUserSearchResults([]);\n      return;\n    }\n\n    try {\n      setIsSearchingUsers(true);\n      const result = await loyaltyService.getAllUsersLoyaltyStatus(10, 0, searchTerm);\n      setUserSearchResults(result.users);\n    } catch (error) {\n      console.error('Failed to search users:', error);\n      toast.error('Failed to search users');\n    } finally {\n      setIsSearchingUsers(false);\n    }\n  };\n\n  const handleUserSearchChange = (value: string) => {\n    setSpendingForm({ ...spendingForm, userSearchTerm: value, selectedUser: null });\n    searchUsersForSpending(value);\n  };\n\n  const selectUserForSpending = (user: AdminUserLoyalty) => {\n    setSpendingForm({\n      ...spendingForm,\n      userId: user.user_id,\n      selectedUser: user,\n      userSearchTerm: user.first_name && user.last_name \n        ? `${user.first_name} ${user.last_name}` \n        : user.oauth_provider === 'line' && user.first_name\n        ? user.first_name\n        : user.email\n    });\n    setUserSearchResults([]);\n  };\n\n  const calculatePoints = (spending: number): number => {\n    return Math.floor(spending * 10); // 1 THB = 10 points\n  };\n\n  const handleSpendingSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!spendingForm.selectedUser || !spendingForm.spendingAmount || !spendingForm.checkinId) {return;}\n\n    try {\n      setIsLoadingAction(true);\n      const spendingAmount = parseFloat(spendingForm.spendingAmount);\n      const nightsStayed = parseInt(spendingForm.nightsStayed) || 0;\n      const pointsToAward = calculatePoints(spendingAmount);\n      \n      let description = `Spending points: ${spendingAmount} THB`;\n      if (nightsStayed > 0) {\n        description += `, ${nightsStayed} ${nightsStayed === 1 ? 'night' : 'nights'}`;\n      }\n      description += ` (Check-in: ${spendingForm.checkinId})`;\n      \n      // If nights are provided, use the new method that handles both nights and points\n      if (nightsStayed > 0) {\n        // We'll need to add a new service method for this\n        await loyaltyService.awardSpendingWithNights(\n          spendingForm.selectedUser.user_id,\n          spendingAmount,\n          nightsStayed,\n          spendingForm.checkinId,\n          description\n        );\n      } else {\n        // Regular points-only award\n        await loyaltyService.awardPoints(\n          spendingForm.selectedUser.user_id,\n          pointsToAward,\n          description,\n          spendingForm.checkinId\n        );\n      }\n      \n      let successMessage = `Awarded ${pointsToAward} points for ${spendingAmount} THB spending`;\n      if (nightsStayed > 0) {\n        successMessage += ` and ${nightsStayed} ${nightsStayed === 1 ? 'night' : 'nights'}`;\n      }\n      toast.success(successMessage);\n      \n      closeSpendingConsole();\n      loadUsers();\n      if (selectedUser?.user_id === spendingForm.selectedUser.user_id) {\n        loadUserTransactions(spendingForm.selectedUser.user_id);\n      }\n    } catch (error) {\n      toast.error('Failed to award spending points');\n      console.error('Spending points operation failed:', error);\n    } finally {\n      setIsLoadingAction(false);\n    }\n  };\n\n\n  const selectUser = (user: AdminUserLoyalty) => {\n    setSelectedUser(user);\n    loadUserTransactions(user.user_id);\n  };\n\n  const totalPages = Math.ceil(totalUsers / pageSize);\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 py-8\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n        {/* Header */}\n        <div className=\"bg-white rounded-lg shadow-md p-6 mb-6\">\n          <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between\">\n            <div>\n              <h1 className=\"text-2xl font-bold text-gray-900 flex items-center\">\n                <FiAward className=\"w-8 h-8 mr-3 text-blue-600\" />\n                {t('admin.loyalty.title')}\n              </h1>\n              <p className=\"text-gray-600 mt-1\">\n                {t('admin.loyalty.subtitle')}\n              </p>\n            </div>\n            \n            <div className=\"mt-4 sm:mt-0 flex space-x-3\">\n              <button\n                onClick={openSpendingConsole}\n                className=\"inline-flex items-center font-medium border border-blue-300 bg-blue-50 text-blue-700 px-4 py-2 text-sm rounded-md hover:bg-blue-100 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n              >\n                <FiDollarSign className=\"w-4 h-4 mr-2\" />\n                Award Spending Points\n              </button>\n              \n              <button\n                onClick={loadUsers}\n                disabled={isLoading}\n                className=\"inline-flex items-center font-medium border border-gray-300 bg-white text-gray-700 px-4 py-2 text-sm rounded-md hover:bg-gray-50 disabled:opacity-50 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n              >\n                <FiRefreshCw className={`w-4 h-4 mr-2 ${isLoading ? 'animate-spin' : ''}`} />\n                {t('admin.loyalty.refresh')}\n              </button>\n              \n              <DashboardButton variant=\"outline\" size=\"md\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          {/* Users List */}\n          <div className=\"lg:col-span-2\">\n            <div className=\"bg-white rounded-lg shadow-md\">\n              <div className=\"p-6 border-b border-gray-200\">\n                <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between\">\n                  <h2 className=\"text-lg font-semibold text-gray-900 flex items-center\">\n                    <FiUsers className=\"w-5 h-5 mr-2\" />\n                    {t('admin.loyalty.usersList')} ({totalUsers})\n                  </h2>\n                  \n                  <form onSubmit={handleSearch} className=\"mt-4 sm:mt-0\">\n                    <div className=\"flex\">\n                      <input\n                        type=\"text\"\n                        value={searchTerm}\n                        onChange={(e) => setSearchTerm(e.target.value)}\n                        placeholder={t('admin.loyalty.searchPlaceholder')}\n                        className=\"block w-full px-3 py-2 border border-gray-300 rounded-l-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm\"\n                      />\n                      <button\n                        type=\"submit\"\n                        className=\"inline-flex items-center px-3 py-2 border border-l-0 border-gray-300 rounded-r-md bg-gray-50 text-gray-500 hover:bg-gray-100\"\n                      >\n                        <FiSearch className=\"w-4 h-4\" />\n                      </button>\n                    </div>\n                  </form>\n                </div>\n              </div>\n\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-gray-200\">\n                  <thead className=\"bg-gray-50\">\n                    <tr>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        {t('admin.loyalty.table.user')}\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        {t('admin.loyalty.table.tier')}\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        {t('profile.membershipId')}\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        {t('admin.loyalty.table.points')}\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        {t('admin.loyalty.table.actions')}\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-gray-200\">\n                    {isLoading ? (\n                      <tr>\n                        <td colSpan={5} className=\"px-6 py-4 text-center text-gray-500\">\n                          {t('common.loading')}\n                        </td>\n                      </tr>\n                    ) : users.length === 0 ? (\n                      <tr>\n                        <td colSpan={5} className=\"px-6 py-4 text-center text-gray-500\">\n                          {t('admin.loyalty.noUsers')}\n                        </td>\n                      </tr>\n                    ) : (\n                      users.map((user) => (\n                        <tr \n                          key={user.user_id}\n                          className={`hover:bg-gray-50 cursor-pointer ${\n                            selectedUser?.user_id === user.user_id ? 'bg-blue-50' : ''\n                          }`}\n                          onClick={() => selectUser(user)}\n                        >\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\n                            <div>\n                              <div className=\"text-sm font-medium text-gray-900\">\n                                {user.first_name && user.last_name \n                                  ? `${user.first_name} ${user.last_name}`\n                                  : user.oauth_provider === 'line' && user.first_name\n                                  ? user.first_name\n                                  : user.email\n                                }\n                              </div>\n                              <div className=\"text-sm text-gray-500\">\n                                {user.oauth_provider === 'line' && user.first_name ? 'LINE User' : user.email}\n                              </div>\n                              {user.oauth_provider && (\n                                <div className=\"text-xs mt-1\">\n                                  <span className={`inline-flex px-2 py-1 rounded-full text-xs font-medium ${\n                                    user.oauth_provider === 'line' ? 'bg-green-100 text-green-800' :\n                                    user.oauth_provider === 'google' ? 'bg-red-100 text-red-800' :\n                                    user.oauth_provider === 'facebook' ? 'bg-blue-100 text-blue-800' :\n                                    'bg-gray-100 text-gray-800'\n                                  }`}\n                                  >\n                                    via {user.oauth_provider.toUpperCase()}\n                                  </span>\n                                </div>\n                              )}\n                            </div>\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\n                            <span \n                              className=\"inline-flex px-2 py-1 text-xs font-semibold rounded-full\"\n                              style={{ \n                                backgroundColor: `${user.tier_color}20`,\n                                color: user.tier_color\n                              }}\n                            >\n                              {user.tier_name}\n                            </span>\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\n                            <span className=\"text-sm text-gray-900 font-mono\">\n                              {user.membership_id || '-'}\n                            </span>\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\n                            <div className=\"text-sm text-gray-900\">\n                              {user.current_points.toLocaleString()}\n                            </div>\n                          </td>\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2\">\n                            <button\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                openPointsModal(user, 'award');\n                              }}\n                              className=\"text-green-600 hover:text-green-900\"\n                            >\n                              <FiPlus className=\"w-4 h-4\" />\n                            </button>\n                            <button\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                openPointsModal(user, 'deduct');\n                              }}\n                              className=\"text-red-600 hover:text-red-900\"\n                            >\n                              <FiMinus className=\"w-4 h-4\" />\n                            </button>\n                          </td>\n                        </tr>\n                      ))\n                    )}\n                  </tbody>\n                </table>\n              </div>\n\n              {/* Pagination */}\n              {totalPages > 1 && (\n                <div className=\"px-6 py-3 bg-gray-50 border-t border-gray-200 flex items-center justify-between\">\n                  <div className=\"text-sm text-gray-700\">\n                    {t('admin.loyalty.pagination.showing', {\n                      start: currentPage * pageSize + 1,\n                      end: Math.min((currentPage + 1) * pageSize, totalUsers),\n                      total: totalUsers\n                    })}\n                  </div>\n                  <div className=\"flex space-x-1\">\n                    <button\n                      onClick={() => setCurrentPage(currentPage - 1)}\n                      disabled={currentPage === 0}\n                      className=\"px-3 py-1 text-sm border rounded disabled:opacity-50\"\n                    >\n                      {t('common.previous')}\n                    </button>\n                    <button\n                      onClick={() => setCurrentPage(currentPage + 1)}\n                      disabled={currentPage >= totalPages - 1}\n                      className=\"px-3 py-1 text-sm border rounded disabled:opacity-50\"\n                    >\n                      {t('common.next')}\n                    </button>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* User Details */}\n          <div>\n            {selectedUser ? (\n              <div className=\"bg-white rounded-lg shadow-md p-6\">\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\n                  {t('admin.loyalty.userDetails')}\n                </h3>\n                \n                <div className=\"space-y-4\">\n                  <div>\n                    <div className=\"text-sm font-medium text-gray-900\">\n                      {selectedUser.first_name && selectedUser.last_name \n                        ? `${selectedUser.first_name} ${selectedUser.last_name}`\n                        : selectedUser.oauth_provider === 'line' && selectedUser.first_name\n                        ? selectedUser.first_name\n                        : selectedUser.email\n                      }\n                    </div>\n                    <div className=\"text-sm text-gray-500\">\n                      {selectedUser.oauth_provider === 'line' && selectedUser.first_name ? 'LINE User' : selectedUser.email}\n                    </div>\n                    {selectedUser.oauth_provider && (\n                      <div className=\"text-xs mt-1\">\n                        <span className={`inline-flex px-2 py-1 rounded-full text-xs font-medium ${\n                          selectedUser.oauth_provider === 'line' ? 'bg-green-100 text-green-800' :\n                          selectedUser.oauth_provider === 'google' ? 'bg-red-100 text-red-800' :\n                          selectedUser.oauth_provider === 'facebook' ? 'bg-blue-100 text-blue-800' :\n                          'bg-gray-100 text-gray-800'\n                        }`}\n                        >\n                          via {selectedUser.oauth_provider.toUpperCase()}\n                        </span>\n                      </div>\n                    )}\n                  </div>\n                  \n                  <div>\n                    <div className=\"text-xs text-gray-500\">{t('profile.membershipId')}</div>\n                    <div className=\"text-sm font-mono text-gray-900\">{selectedUser.membership_id || t('admin.coupons.notAssigned')}</div>\n                  </div>\n                  \n                  <div>\n                    <div className=\"text-xs text-gray-500\">{t('admin.loyalty.currentPoints')}</div>\n                    <div className=\"text-lg font-semibold\">{selectedUser.current_points.toLocaleString()}</div>\n                  </div>\n                  \n                  <div>\n                    <div className=\"text-xs text-gray-500\">{t('admin.loyalty.currentTier')}</div>\n                    <div \n                      className=\"inline-flex px-2 py-1 text-sm font-semibold rounded-full\"\n                      style={{ \n                        backgroundColor: `${selectedUser.tier_color}20`,\n                        color: selectedUser.tier_color\n                      }}\n                    >\n                      {selectedUser.tier_name}\n                    </div>\n                  </div>\n                </div>\n\n                {/* Recent Transactions */}\n                <div className=\"mt-6\">\n                  <h4 className=\"text-sm font-medium text-gray-900 mb-3\">\n                    {t('admin.loyalty.recentTransactions')}\n                  </h4>\n                  <div className=\"max-h-64 overflow-y-auto space-y-3\">\n                    {userTransactions.length === 0 ? (\n                      <div className=\"text-sm text-gray-500\">\n                        {t('admin.loyalty.noTransactions')}\n                      </div>\n                    ) : (\n                      userTransactions.slice(0, 10).map((transaction) => (\n                        <div key={transaction.id} className=\"flex justify-between items-start text-sm border-b border-gray-100 pb-2 last:border-b-0\">\n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center space-x-2\">\n                              <div className={transaction.points > 0 ? 'text-green-600 font-medium' : 'text-red-600 font-medium'}>\n                                {transaction.points > 0 ? '+' : ''}{transaction.points.toLocaleString()} pts\n                              </div>\n                              <div className=\"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded\">\n                                {transaction.type}\n                              </div>\n                            </div>\n                            <div className=\"mt-1 space-y-1\">\n                              <div className=\"text-xs text-gray-600\">\n                                {new Date(transaction.created_at).toLocaleDateString('en-US', {\n                                  year: 'numeric',\n                                  month: 'short',\n                                  day: 'numeric',\n                                  hour: '2-digit',\n                                  minute: '2-digit'\n                                })}\n                              </div>\n                              {transaction.admin_email && (\n                                <div className=\"flex items-center space-x-1 text-xs text-blue-600\">\n                                  <FiUser className=\"w-3 h-3\" />\n                                  <span title={`Adjusted by ${transaction.admin_email}`}>\n                                    Admin: {transaction.admin_email}\n                                  </span>\n                                </div>\n                              )}\n                              {transaction.admin_reason && (\n                                <div className=\"text-xs text-gray-500 italic\">\n                                  \"{transaction.admin_reason}\"\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      ))\n                    )}\n                  </div>\n                </div>\n              </div>\n            ) : (\n              <div className=\"bg-white rounded-lg shadow-md p-6 text-center text-gray-500\">\n                {t('admin.loyalty.selectUser')}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Points Adjustment Modal */}\n      {pointsModal.isOpen && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-lg p-6 w-full max-w-md\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\n              {pointsModal.type === 'award' \n                ? t('admin.loyalty.awardPoints')\n                : t('admin.loyalty.deductPoints')\n              }\n            </h3>\n            \n            <form onSubmit={handlePointsSubmit} className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700\">\n                  {t('admin.loyalty.pointsAmount')}\n                </label>\n                <input\n                  type=\"number\"\n                  min=\"1\"\n                  value={pointsForm.points}\n                  onChange={(e) => setPointsForm({ ...pointsForm, points: e.target.value })}\n                  className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\n                  required\n                />\n              </div>\n              \n              <div>\n                <label className=\"block text-sm font-medium text-gray-700\">\n                  {t('admin.loyalty.description')}\n                </label>\n                <textarea\n                  value={pointsForm.description}\n                  onChange={(e) => setPointsForm({ ...pointsForm, description: e.target.value })}\n                  rows={3}\n                  className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\n                />\n              </div>\n              \n              <div>\n                <label className=\"block text-sm font-medium text-gray-700\">\n                  {t('admin.loyalty.referenceId')} ({t('common.optional')})\n                </label>\n                <input\n                  type=\"text\"\n                  value={pointsForm.referenceId}\n                  onChange={(e) => setPointsForm({ ...pointsForm, referenceId: e.target.value })}\n                  className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\n                />\n              </div>\n              \n              <div className=\"flex justify-end space-x-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={closePointsModal}\n                  className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200\"\n                >\n                  {t('common.cancel')}\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={isLoadingAction}\n                  className={`px-4 py-2 text-sm font-medium text-white rounded-md ${\n                    pointsModal.type === 'award'\n                      ? 'bg-green-600 hover:bg-green-700'\n                      : 'bg-red-600 hover:bg-red-700'\n                  } disabled:opacity-50`}\n                >\n                  {isLoadingAction ? t('common.processing') : (\n                    pointsModal.type === 'award' \n                      ? t('admin.loyalty.awardPoints')\n                      : t('admin.loyalty.deductPoints')\n                  )}\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n\n      {/* Spending Console Modal */}\n      {spendingModal.isOpen && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-lg p-6 w-full max-w-lg\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\n              <FiDollarSign className=\"w-5 h-5 inline mr-2\" />\n              Award Spending Points\n            </h3>\n            \n            <form onSubmit={handleSpendingSubmit} className=\"space-y-4\">\n              {/* User Selection */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Select Customer\n                </label>\n                <div className=\"relative\">\n                  <input\n                    type=\"text\"\n                    value={spendingForm.userSearchTerm}\n                    onChange={(e) => handleUserSearchChange(e.target.value)}\n                    placeholder=\"Search by name or email...\"\n                    className=\"block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\n                    required\n                  />\n                  {isSearchingUsers && (\n                    <div className=\"absolute right-3 top-2.5\">\n                      <FiRefreshCw className=\"w-4 h-4 animate-spin text-gray-400\" />\n                    </div>\n                  )}\n                </div>\n                \n                {/* User Search Results */}\n                {userSearchResults.length > 0 && !spendingForm.selectedUser && (\n                  <div className=\"mt-1 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-sm\">\n                    {userSearchResults.map((user) => (\n                      <button\n                        key={user.user_id}\n                        type=\"button\"\n                        onClick={() => selectUserForSpending(user)}\n                        className=\"w-full text-left px-3 py-2 hover:bg-gray-50 focus:bg-gray-50 border-b border-gray-100 last:border-b-0\"\n                      >\n                        <div className=\"font-medium text-sm\">\n                          {user.first_name && user.last_name \n                            ? `${user.first_name} ${user.last_name}`\n                            : user.oauth_provider === 'line' && user.first_name\n                            ? user.first_name\n                            : user.email\n                          }\n                        </div>\n                        <div className=\"text-xs text-gray-500\">\n                          {user.oauth_provider === 'line' && user.first_name ? 'LINE User' : user.email}\n                        </div>\n                        <div className=\"text-xs text-gray-400\">\n                          {user.tier_name} ‚Ä¢ {user.current_points} points ‚Ä¢ {t('profile.membershipId')}: {user.membership_id || 'N/A'}\n                        </div>\n                      </button>\n                    ))}\n                  </div>\n                )}\n                \n                {/* Selected User Display */}\n                {spendingForm.selectedUser && (\n                  <div className=\"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-md\">\n                    <div className=\"flex justify-between items-center\">\n                      <div>\n                        <div className=\"font-medium text-sm text-blue-900\">\n                          {spendingForm.selectedUser.first_name && spendingForm.selectedUser.last_name \n                            ? `${spendingForm.selectedUser.first_name} ${spendingForm.selectedUser.last_name}`\n                            : spendingForm.selectedUser.oauth_provider === 'line' && spendingForm.selectedUser.first_name\n                            ? spendingForm.selectedUser.first_name\n                            : spendingForm.selectedUser.email\n                          }\n                        </div>\n                        <div className=\"text-xs text-blue-700\">\n                          {spendingForm.selectedUser.oauth_provider === 'line' && spendingForm.selectedUser.first_name ? 'LINE User' : spendingForm.selectedUser.email}\n                        </div>\n                        <div className=\"text-xs text-blue-600\">\n                          {spendingForm.selectedUser.tier_name} ‚Ä¢ {spendingForm.selectedUser.current_points} points\n                        </div>\n                      </div>\n                      <button\n                        type=\"button\"\n                        onClick={() => setSpendingForm({ ...spendingForm, selectedUser: null, userSearchTerm: '' })}\n                        className=\"text-blue-600 hover:text-blue-800\"\n                      >\n                        Change\n                      </button>\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* Spending Amount */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700\">\n                  Spending Amount (THB)\n                </label>\n                <input\n                  type=\"number\"\n                  min=\"0.01\"\n                  step=\"0.01\"\n                  value={spendingForm.spendingAmount}\n                  onChange={(e) => setSpendingForm({ ...spendingForm, spendingAmount: e.target.value })}\n                  className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\n                  placeholder=\"0.00\"\n                  required\n                />\n                {spendingForm.spendingAmount && (\n                  <div className=\"mt-1 text-sm text-green-600\">\n                    Points to award: {calculatePoints(parseFloat(spendingForm.spendingAmount) || 0)}\n                  </div>\n                )}\n              </div>\n\n              {/* Nights Stayed */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700\">\n                  Nights Stayed (Optional)\n                </label>\n                <input\n                  type=\"number\"\n                  min=\"0\"\n                  value={spendingForm.nightsStayed}\n                  onChange={(e) => setSpendingForm({ ...spendingForm, nightsStayed: e.target.value })}\n                  className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\n                  placeholder=\"0\"\n                />\n                {spendingForm.nightsStayed && parseInt(spendingForm.nightsStayed) > 0 && (\n                  <div className=\"mt-1 text-sm text-blue-600\">\n                    Will add {spendingForm.nightsStayed} {parseInt(spendingForm.nightsStayed) === 1 ? 'night' : 'nights'} to user's total\n                  </div>\n                )}\n              </div>\n\n              {/* Check-in ID */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700\">\n                  Check-in ID (Reference)\n                </label>\n                <input\n                  type=\"text\"\n                  value={spendingForm.checkinId}\n                  onChange={(e) => setSpendingForm({ ...spendingForm, checkinId: e.target.value })}\n                  className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\n                  placeholder=\"e.g., CHK-2024-001\"\n                  required\n                />\n              </div>\n              \n              <div className=\"flex justify-end space-x-3 pt-4\">\n                <button\n                  type=\"button\"\n                  onClick={closeSpendingConsole}\n                  className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={isLoadingAction || !spendingForm.selectedUser || !spendingForm.spendingAmount || !spendingForm.checkinId}\n                  className=\"px-4 py-2 text-sm font-medium text-white rounded-md bg-blue-600 hover:bg-blue-700 disabled:opacity-50\"\n                >\n                  {isLoadingAction ? 'Processing...' : 'Award Points'}\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/admin/NewMemberCouponSettings.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FiSettings' is defined but never used.","line":6,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is assigned a value but never used.","line":45,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":45,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setValue' is assigned a value but never used.","line":57,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":57,"endColumn":13},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":76,"column":55,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":76,"endColumn":57,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2624,2626],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSettings'. Either include it or remove the dependency array.","line":90,"column":6,"nodeType":"ArrayExpression","endLine":90,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadSettings]","fix":{"range":[3040,3042],"text":"[loadSettings]"}}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":103,"column":53,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":103,"endColumn":55,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[3420,3422],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3766,3769],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3766,3769],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":114,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":114,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3779,3846],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4316,4319],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4316,4319],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":129,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":129,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4329,4380],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":142,"column":55,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":142,"endColumn":57,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[4753,4755],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"react/self-closing-comp","severity":1,"message":"Empty components are self-closing","line":160,"column":13,"nodeType":"JSXOpeningElement","messageId":"notSelfClosing","endLine":160,"endColumn":104,"fix":{"range":[5442,5449],"text":" />"}},{"ruleId":"react/self-closing-comp","severity":1,"message":"Empty components are self-closing","line":214,"column":17,"nodeType":"JSXOpeningElement","messageId":"notSelfClosing","endLine":214,"endColumn":410,"fix":{"range":[8266,8273],"text":" />"}},{"ruleId":"react/self-closing-comp","severity":1,"message":"Empty components are self-closing","line":409,"column":21,"nodeType":"JSXOpeningElement","messageId":"notSelfClosing","endLine":409,"endColumn":101,"fix":{"range":[17825,17832],"text":" />"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":3,"source":"import React, { useState, useEffect } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useTranslation } from 'react-i18next';\nimport { FiSettings, FiGift, FiCheck, FiX, FiInfo } from 'react-icons/fi';\nimport toast from 'react-hot-toast';\nimport MainLayout from '../../components/layout/MainLayout';\nimport { adminService } from '../../services/adminService';\n\nconst newMemberCouponSchema = z.object({\n  isEnabled: z.boolean(),\n  couponCode: z.string().min(1, 'Coupon code is required').max(20, 'Coupon code must be 20 characters or less'),\n  couponName: z.string().min(1, 'Coupon name is required'),\n  couponDescription: z.string().optional(),\n  couponType: z.enum(['percentage', 'fixed_amount']),\n  couponValue: z.number().min(0.01, 'Coupon value must be greater than 0'),\n  currency: z.string().default('USD'),\n  minimumSpend: z.number().min(0).optional(),\n  maximumDiscount: z.number().min(0).optional(),\n  validDays: z.number().min(1, 'Valid days must be at least 1').max(365, 'Valid days cannot exceed 365'),\n  termsAndConditions: z.string().min(1, 'Terms and conditions are required'),\n});\n\ntype NewMemberCouponFormData = z.infer<typeof newMemberCouponSchema>;\n\ninterface NewMemberCouponSettings {\n  id: string;\n  isEnabled: boolean;\n  couponCode: string;\n  couponName: string;\n  couponDescription?: string;\n  couponType: 'percentage' | 'fixed_amount';\n  couponValue: number;\n  currency: string;\n  minimumSpend?: number;\n  maximumDiscount?: number;\n  validDays: number;\n  termsAndConditions: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport default function NewMemberCouponSettings() {\n  const { t } = useTranslation();\n  const [settings, setSettings] = useState<NewMemberCouponSettings | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [isSaving, setIsSaving] = useState(false);\n  const [hasChanged, setHasChanged] = useState(false);\n\n  const {\n    register,\n    handleSubmit,\n    formState: { errors },\n    reset,\n    watch,\n    setValue,\n  } = useForm<NewMemberCouponFormData>({\n    resolver: zodResolver(newMemberCouponSchema),\n    defaultValues: {\n      isEnabled: true,\n      couponType: 'percentage',\n      currency: 'USD',\n      validDays: 30,\n    }\n  });\n\n  const watchedValues = watch();\n\n  useEffect(() => {\n    if (settings) {\n      setHasChanged(JSON.stringify(watchedValues) !== JSON.stringify({\n        isEnabled: settings.isEnabled,\n        couponCode: settings.couponCode,\n        couponName: settings.couponName,\n        couponDescription: settings.couponDescription || '',\n        couponType: settings.couponType,\n        couponValue: settings.couponValue,\n        currency: settings.currency,\n        minimumSpend: settings.minimumSpend,\n        maximumDiscount: settings.maximumDiscount,\n        validDays: settings.validDays,\n        termsAndConditions: settings.termsAndConditions,\n      }));\n    }\n  }, [watchedValues, settings]);\n\n  useEffect(() => {\n    loadSettings();\n  }, []);\n\n  const loadSettings = async () => {\n    try {\n      setIsLoading(true);\n      const data = await adminService.getNewMemberCouponSettings();\n      setSettings(data);\n      \n      if (data) {\n        reset({\n          isEnabled: data.isEnabled,\n          couponCode: data.couponCode,\n          couponName: data.couponName,\n          couponDescription: data.couponDescription || '',\n          couponType: data.couponType,\n          couponValue: data.couponValue,\n          currency: data.currency,\n          minimumSpend: data.minimumSpend,\n          maximumDiscount: data.maximumDiscount,\n          validDays: data.validDays,\n          termsAndConditions: data.termsAndConditions,\n        });\n      }\n    } catch (error: any) {\n      console.error('Failed to load new member coupon settings:', error);\n      toast.error(error.response?.data?.error || 'Failed to load settings');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const onSubmit = async (data: NewMemberCouponFormData) => {\n    setIsSaving(true);\n    try {\n      const updatedSettings = await adminService.updateNewMemberCouponSettings(data);\n      setSettings(updatedSettings);\n      setHasChanged(false);\n      toast.success('New member coupon settings updated successfully');\n    } catch (error: any) {\n      console.error('Failed to update settings:', error);\n      toast.error(error.response?.data?.error || 'Failed to update settings');\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const handleReset = () => {\n    if (settings) {\n      reset({\n        isEnabled: settings.isEnabled,\n        couponCode: settings.couponCode,\n        couponName: settings.couponName,\n        couponDescription: settings.couponDescription || '',\n        couponType: settings.couponType,\n        couponValue: settings.couponValue,\n        currency: settings.currency,\n        minimumSpend: settings.minimumSpend,\n        maximumDiscount: settings.maximumDiscount,\n        validDays: settings.validDays,\n        termsAndConditions: settings.termsAndConditions,\n      });\n      setHasChanged(false);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <MainLayout title=\"New Member Coupon Settings\" showProfileBanner={false}>\n        <div className=\"flex items-center justify-center py-12\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto\"></div>\n            <p className=\"mt-4 text-gray-600\">Loading settings...</p>\n          </div>\n        </div>\n      </MainLayout>\n    );\n  }\n\n  return (\n    <MainLayout title=\"New Member Coupon Settings\" showProfileBanner={false}>\n      <div className=\"max-w-4xl mx-auto\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <div className=\"flex items-center space-x-3 mb-4\">\n            <div className=\"p-2 bg-blue-100 rounded-lg\">\n              <FiGift className=\"h-6 w-6 text-blue-600\" />\n            </div>\n            <div>\n              <h1 className=\"text-2xl font-bold text-gray-900\">New Member Coupon Settings</h1>\n              <p className=\"text-gray-600\">Configure the welcome coupon for new members who complete their profile</p>\n            </div>\n          </div>\n          \n          {/* Info Banner */}\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n            <div className=\"flex items-start space-x-3\">\n              <FiInfo className=\"h-5 w-5 text-blue-600 mt-0.5\" />\n              <div className=\"text-sm text-blue-800\">\n                <p className=\"font-medium mb-1\">How it works:</p>\n                <ul className=\"space-y-1 list-disc list-inside\">\n                  <li>New users see a banner prompting them to complete their profile</li>\n                  <li>When they fill in all required fields (name, birthday, gender, occupation, interests), they automatically receive the configured coupon</li>\n                  <li>Each user can only receive this coupon once</li>\n                </ul>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Settings Form */}\n        <div className=\"bg-white shadow rounded-lg\">\n          <form onSubmit={handleSubmit(onSubmit)} className=\"p-6 space-y-6\">\n            {/* Enable/Disable Toggle */}\n            <div className=\"flex items-center justify-between py-4 border-b border-gray-200\">\n              <div>\n                <h3 className=\"text-lg font-medium text-gray-900\">Enable New Member Coupons</h3>\n                <p className=\"text-sm text-gray-500\">Turn on/off the new member coupon system</p>\n              </div>\n              <label className=\"relative inline-flex items-center cursor-pointer\">\n                <input\n                  type=\"checkbox\"\n                  {...register('isEnabled')}\n                  className=\"sr-only peer\"\n                />\n                <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600\"></div>\n              </label>\n            </div>\n\n            {/* Coupon Configuration */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              {/* Coupon Code */}\n              <div>\n                <label htmlFor=\"couponCode\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Coupon Code *\n                </label>\n                <input\n                  {...register('couponCode')}\n                  id=\"couponCode\"\n                  type=\"text\"\n                  className=\"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                  placeholder=\"e.g., NEWMEMBER20\"\n                />\n                {errors.couponCode && (\n                  <p className=\"mt-1 text-sm text-red-600\">{errors.couponCode.message}</p>\n                )}\n              </div>\n\n              {/* Coupon Name */}\n              <div>\n                <label htmlFor=\"couponName\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Coupon Name *\n                </label>\n                <input\n                  {...register('couponName')}\n                  id=\"couponName\"\n                  type=\"text\"\n                  className=\"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                  placeholder=\"e.g., New Member Welcome Coupon\"\n                />\n                {errors.couponName && (\n                  <p className=\"mt-1 text-sm text-red-600\">{errors.couponName.message}</p>\n                )}\n              </div>\n\n              {/* Coupon Type */}\n              <div>\n                <label htmlFor=\"couponType\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Discount Type *\n                </label>\n                <select\n                  {...register('couponType')}\n                  id=\"couponType\"\n                  className=\"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                >\n                  <option value=\"percentage\">Percentage Discount</option>\n                  <option value=\"fixed_amount\">Fixed Amount Discount</option>\n                </select>\n              </div>\n\n              {/* Coupon Value */}\n              <div>\n                <label htmlFor=\"couponValue\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Discount Value *\n                </label>\n                <div className=\"relative\">\n                  <input\n                    {...register('couponValue', { valueAsNumber: true })}\n                    id=\"couponValue\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    min=\"0.01\"\n                    className=\"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                    placeholder=\"20\"\n                  />\n                  <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none\">\n                    <span className=\"text-gray-500 sm:text-sm\">\n                      {watchedValues.couponType === 'percentage' ? '%' : watchedValues.currency}\n                    </span>\n                  </div>\n                </div>\n                {errors.couponValue && (\n                  <p className=\"mt-1 text-sm text-red-600\">{errors.couponValue.message}</p>\n                )}\n              </div>\n\n              {/* Minimum Spend */}\n              <div>\n                <label htmlFor=\"minimumSpend\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Minimum Spend (Optional)\n                </label>\n                <div className=\"relative\">\n                  <input\n                    {...register('minimumSpend', { valueAsNumber: true })}\n                    id=\"minimumSpend\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    min=\"0\"\n                    className=\"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                    placeholder=\"0\"\n                  />\n                  <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none\">\n                    <span className=\"text-gray-500 sm:text-sm\">{watchedValues.currency}</span>\n                  </div>\n                </div>\n              </div>\n\n              {/* Maximum Discount */}\n              {watchedValues.couponType === 'percentage' && (\n                <div>\n                  <label htmlFor=\"maximumDiscount\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Maximum Discount (Optional)\n                  </label>\n                  <div className=\"relative\">\n                    <input\n                      {...register('maximumDiscount', { valueAsNumber: true })}\n                      id=\"maximumDiscount\"\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0\"\n                      className=\"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                      placeholder=\"100\"\n                    />\n                    <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none\">\n                      <span className=\"text-gray-500 sm:text-sm\">{watchedValues.currency}</span>\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {/* Valid Days */}\n              <div>\n                <label htmlFor=\"validDays\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Valid for (days) *\n                </label>\n                <input\n                  {...register('validDays', { valueAsNumber: true })}\n                  id=\"validDays\"\n                  type=\"number\"\n                  min=\"1\"\n                  max=\"365\"\n                  className=\"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                  placeholder=\"30\"\n                />\n                {errors.validDays && (\n                  <p className=\"mt-1 text-sm text-red-600\">{errors.validDays.message}</p>\n                )}\n              </div>\n            </div>\n\n            {/* Coupon Description */}\n            <div>\n              <label htmlFor=\"couponDescription\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Description (Optional)\n              </label>\n              <textarea\n                {...register('couponDescription')}\n                id=\"couponDescription\"\n                rows={3}\n                className=\"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                placeholder=\"Welcome! Complete your profile to get 20% off your first stay.\"\n              />\n            </div>\n\n            {/* Terms and Conditions */}\n            <div>\n              <label htmlFor=\"termsAndConditions\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Terms and Conditions *\n              </label>\n              <textarea\n                {...register('termsAndConditions')}\n                id=\"termsAndConditions\"\n                rows={4}\n                className=\"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                placeholder=\"Valid for 30 days from profile completion. Cannot be combined with other offers. Minimum stay of 1 night required.\"\n              />\n              {errors.termsAndConditions && (\n                <p className=\"mt-1 text-sm text-red-600\">{errors.termsAndConditions.message}</p>\n              )}\n            </div>\n\n            {/* Action Buttons */}\n            <div className=\"flex justify-end space-x-3 pt-6 border-t border-gray-200\">\n              {hasChanged && (\n                <button\n                  type=\"button\"\n                  onClick={handleReset}\n                  className=\"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n                >\n                  <FiX className=\"inline-block w-4 h-4 mr-2\" />\n                  Reset\n                </button>\n              )}\n              <button\n                type=\"submit\"\n                disabled={isSaving || !hasChanged}\n                className=\"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {isSaving ? (\n                  <>\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                    Saving...\n                  </>\n                ) : (\n                  <>\n                    <FiCheck className=\"w-4 h-4 mr-2\" />\n                    Save Settings\n                  </>\n                )}\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    </MainLayout>\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/admin/SurveyAnalytics.tsx","messages":[{"ruleId":"no-empty-pattern","severity":1,"message":"Unexpected empty object pattern.","line":64,"column":9,"nodeType":"ObjectPattern","messageId":"unexpected","endLine":64,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadAnalytics'. Either include it or remove the dependency array.","line":73,"column":6,"nodeType":"ArrayExpression","endLine":73,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [id, loadAnalytics]","fix":{"range":[1692,1696],"text":"[id, loadAnalytics]"}}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":80,"column":68,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":80,"endColumn":71},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1927,1930],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1927,1930],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":83,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":83,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1940,1987],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":93,"column":62,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":93,"endColumn":65},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2742,2745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2742,2745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":104,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":104,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2755,2804],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2922,2925],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2922,2925],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3696,3699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3696,3699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'chartType' is assigned a value but never used.","line":143,"column":48,"nodeType":"Identifier","messageId":"unusedVar","endLine":143,"endColumn":72},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":181,"column":13,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":181,"endColumn":15,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[4864,4866],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":186,"column":23,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":186,"endColumn":25,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[5106,5108],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":338,"column":63,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":338,"endColumn":65,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11791,11793],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useParams, Link } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { \n  FiArrowLeft, \n  FiDownload, \n  FiUsers, \n  FiCheckCircle, \n  FiClock,\n  FiBarChart,\n  FiTrendingUp\n} from 'react-icons/fi';\nimport { Survey, SurveyResponse } from '../../types/survey';\nimport { surveyService } from '../../services/surveyService';\nimport DashboardButton from '../../components/navigation/DashboardButton';\nimport toast from 'react-hot-toast';\nimport {\n  Chart as ChartJS,\n  CategoryScale,\n  LinearScale,\n  BarElement,\n  ArcElement,\n  LineElement,\n  PointElement,\n  Title,\n  Tooltip,\n  Legend,\n  ChartData,\n  ChartOptions\n} from 'chart.js';\nimport { Bar, Pie, Line } from 'react-chartjs-2';\n\n// Register ChartJS components\nChartJS.register(\n  CategoryScale,\n  LinearScale,\n  BarElement,\n  ArcElement,\n  LineElement,\n  PointElement,\n  Title,\n  Tooltip,\n  Legend\n);\n\ninterface AnalyticsData {\n  survey: Survey;\n  responses: SurveyResponse[];\n  totalResponses: number;\n  completionRate: number;\n  averageCompletionTime: number;\n  responsesByDate: { date: string; count: number }[];\n  questionAnalytics: {\n    questionId: string;\n    question: string;\n    type: string;\n    responses: Record<string, number>;\n    averageRating?: number;\n  }[];\n}\n\nconst SurveyAnalytics: React.FC = () => {\n  const { id } = useParams<{ id: string }>();\n  const { } = useTranslation();\n  const [loading, setLoading] = useState(true);\n  const [analytics, setAnalytics] = useState<AnalyticsData | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (id) {\n      loadAnalytics();\n    }\n  }, [id]);\n\n  const loadAnalytics = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      \n      const analyticsData = await surveyService.getSurveyAnalytics(id!);\n      setAnalytics(analyticsData);\n    } catch (err: any) {\n      console.error('Error loading analytics:', err);\n      setError(err.response?.data?.message || 'Failed to load analytics');\n      toast.error('Failed to load survey analytics');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleExportAnalytics = async () => {\n    try {\n      const blob = await surveyService.exportSurveyResponses(id!);\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `survey-${analytics?.survey.title.replace(/[^a-z0-9]/gi, '-').toLowerCase()}-analytics.csv`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      window.URL.revokeObjectURL(url);\n      toast.success('Analytics exported successfully');\n    } catch (err: any) {\n      console.error('Error exporting analytics:', err);\n      toast.error('Failed to export analytics');\n    }\n  };\n\n  const getChartOptions = (title: string): ChartOptions<any> => ({\n    responsive: true,\n    maintainAspectRatio: false,\n    plugins: {\n      legend: {\n        position: 'top' as const,\n      },\n      title: {\n        display: true,\n        text: title,\n        font: {\n          size: 16\n        }\n      },\n    },\n  });\n\n  const getResponseTrendData = (): ChartData<'line'> => {\n    if (!analytics) {return { labels: [], datasets: [] };}\n\n    return {\n      labels: analytics.responsesByDate.map(d => d.date),\n      datasets: [\n        {\n          label: 'Daily Responses',\n          data: analytics.responsesByDate.map(d => d.count),\n          borderColor: 'rgb(59, 130, 246)',\n          backgroundColor: 'rgba(59, 130, 246, 0.1)',\n          tension: 0.4\n        }\n      ]\n    };\n  };\n\n  const getQuestionChartData = (question: any, chartType: 'bar' | 'pie' = 'bar'): ChartData<'bar'> | ChartData<'pie'> => {\n    const labels = Object.keys(question.responses);\n    const data = Object.values(question.responses) as number[];\n    \n    const backgroundColors = [\n      'rgba(255, 99, 132, 0.6)',\n      'rgba(54, 162, 235, 0.6)',\n      'rgba(255, 206, 86, 0.6)',\n      'rgba(75, 192, 192, 0.6)',\n      'rgba(153, 102, 255, 0.6)',\n      'rgba(255, 159, 64, 0.6)',\n    ];\n\n    return {\n      labels,\n      datasets: [{\n        label: 'Responses',\n        data,\n        backgroundColor: backgroundColors.slice(0, labels.length),\n        borderColor: backgroundColors.slice(0, labels.length).map(c => c.replace('0.6', '1')),\n        borderWidth: 1\n      }]\n    };\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-7xl mx-auto p-4\">\n          <div className=\"flex justify-center items-center h-64\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\" />\n            <span className=\"ml-3 text-gray-600\">Loading analytics...</span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !analytics) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-7xl mx-auto p-4\">\n          <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md\">\n            <p>{error || 'Survey not found'}</p>\n            <Link to=\"/admin/surveys\" className=\"text-red-800 underline mt-2 inline-block\">\n              Back to Surveys\n            </Link>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center py-6\">\n            <div className=\"flex items-center\">\n              <Link\n                to=\"/admin/surveys\"\n                className=\"mr-4 text-gray-400 hover:text-gray-600\"\n              >\n                <FiArrowLeft className=\"h-6 w-6\" />\n              </Link>\n              <div>\n                <h1 className=\"text-3xl font-bold text-gray-900\">Survey Analytics</h1>\n                <p className=\"text-sm text-gray-600 mt-1\">{analytics.survey.title}</p>\n              </div>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <button\n                onClick={handleExportAnalytics}\n                className=\"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n              >\n                <FiDownload className=\"mr-2 h-4 w-4\" />\n                Export CSV\n              </button>\n              <DashboardButton variant=\"outline\" size=\"md\" />\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Content */}\n      <main className=\"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8\">\n        <div className=\"px-4 py-6 sm:px-0\">\n          {/* Key Metrics */}\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8\">\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <div className=\"flex items-center\">\n                <div className=\"flex-shrink-0\">\n                  <FiUsers className=\"h-8 w-8 text-blue-500\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"text-sm font-medium text-gray-500\">Total Responses</p>\n                  <p className=\"text-2xl font-semibold text-gray-900\">{analytics.totalResponses}</p>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <div className=\"flex items-center\">\n                <div className=\"flex-shrink-0\">\n                  <FiCheckCircle className=\"h-8 w-8 text-green-500\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"text-sm font-medium text-gray-500\">Completion Rate</p>\n                  <p className=\"text-2xl font-semibold text-gray-900\">{analytics.completionRate.toFixed(1)}%</p>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <div className=\"flex items-center\">\n                <div className=\"flex-shrink-0\">\n                  <FiClock className=\"h-8 w-8 text-yellow-500\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"text-sm font-medium text-gray-500\">Avg. Completion Time</p>\n                  <p className=\"text-2xl font-semibold text-gray-900\">\n                    {Math.floor(analytics.averageCompletionTime / 60)}m {analytics.averageCompletionTime % 60}s\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <div className=\"flex items-center\">\n                <div className=\"flex-shrink-0\">\n                  <FiBarChart className=\"h-8 w-8 text-purple-500\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"text-sm font-medium text-gray-500\">Questions</p>\n                  <p className=\"text-2xl font-semibold text-gray-900\">{analytics.survey.questions.length}</p>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Response Trend */}\n          <div className=\"bg-white rounded-lg shadow p-6 mb-8\">\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\n              <FiTrendingUp className=\"mr-2 h-5 w-5\" />\n              Response Trend\n            </h2>\n            <div className=\"h-64\">\n              <Line \n                data={getResponseTrendData()} \n                options={getChartOptions('Daily Response Count')}\n              />\n            </div>\n          </div>\n\n          {/* Question Analytics */}\n          <div className=\"space-y-8\">\n            <h2 className=\"text-lg font-semibold text-gray-900\">Question Breakdown</h2>\n            \n            {analytics.questionAnalytics.map((question, index) => (\n              <div key={question.questionId} className=\"bg-white rounded-lg shadow p-6\">\n                <h3 className=\"text-md font-semibold text-gray-900 mb-4\">\n                  Q{index + 1}: {question.question}\n                </h3>\n                \n                {/* Chart based on question type */}\n                {(question.type === 'multiple_choice' || question.type === 'single_choice') && (\n                  <div className=\"grid md:grid-cols-2 gap-6\">\n                    <div className=\"h-64\">\n                      <Bar \n                        data={getQuestionChartData(question, 'bar') as ChartData<'bar'>} \n                        options={getChartOptions('Response Distribution')}\n                      />\n                    </div>\n                    <div className=\"h-64\">\n                      <Pie \n                        data={getQuestionChartData(question, 'pie') as ChartData<'pie'>} \n                        options={getChartOptions('Response Percentage')}\n                      />\n                    </div>\n                  </div>\n                )}\n                \n                {(question.type === 'rating_5' || question.type === 'rating_10') && (\n                  <div className=\"grid md:grid-cols-2 gap-6\">\n                    <div className=\"h-64\">\n                      <Bar \n                        data={getQuestionChartData(question, 'bar') as ChartData<'bar'>} \n                        options={getChartOptions('Rating Distribution')}\n                      />\n                    </div>\n                    <div className=\"flex items-center justify-center\">\n                      <div className=\"text-center\">\n                        <p className=\"text-gray-500 text-sm\">Average Rating</p>\n                        <p className=\"text-5xl font-bold text-blue-600\">\n                          {question.averageRating?.toFixed(1) || '0'}\n                        </p>\n                        <p className=\"text-gray-500 text-sm\">\n                          out of {question.type === 'rating_5' ? '5' : '10'}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                )}\n                \n                {question.type === 'yes_no' && (\n                  <div className=\"h-64 max-w-md mx-auto\">\n                    <Pie \n                      data={getQuestionChartData(question, 'pie') as ChartData<'pie'>} \n                      options={getChartOptions('Yes/No Distribution')}\n                    />\n                  </div>\n                )}\n                \n                {(question.type === 'text' || question.type === 'textarea') && (\n                  <div className=\"bg-gray-50 rounded p-4\">\n                    <p className=\"text-gray-600\">\n                      {Object.keys(question.responses).length} text responses collected\n                    </p>\n                    <p className=\"text-sm text-gray-500 mt-2\">\n                      Text responses are included in the CSV export\n                    </p>\n                  </div>\n                )}\n              </div>\n            ))}\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n};\n\nexport default SurveyAnalytics;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/admin/SurveyBuilder.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1145,1148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1145,1148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSurvey'. Either include it or remove the dependency array.","line":211,"column":6,"nodeType":"ArrayExpression","endLine":211,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [id, isEditing, loadSurvey, location.state]","fix":{"range":[7159,7190],"text":"[id, isEditing, loadSurvey, location.state]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":304,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":304,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9912,9915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9912,9915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":305,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":305,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[9925,9969],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":313,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":313,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10167,10170],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10167,10170],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":326,"column":40,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":326,"endColumn":42,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[10478,10480],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":339,"column":38,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":339,"endColumn":40,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11077,11079],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":348,"column":9,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":348,"endColumn":11,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11344,11346],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":355,"column":67,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":355,"endColumn":69,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11522,11524],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":360,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":360,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11656,11658],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":396,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":396,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[12647,12649],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":397,"column":25,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":397,"endColumn":27,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[12704,12706],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":402,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":402,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[12885,13147],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":411,"column":79,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":411,"endColumn":81,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[13264,13266],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":418,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":418,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13604,13607],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13604,13607],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":427,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":427,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14093,14096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14093,14096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":438,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":438,"endColumn":23,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[14521,14699],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":452,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":452,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[14995,15037],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":515,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":515,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[17657,17659],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":529,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":529,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[18369,18371],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":542,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":542,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[19036,19038],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":560,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":560,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[20191,20193],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":583,"column":91,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":583,"endColumn":93,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[21580,21582],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":598,"column":30,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":598,"endColumn":47,"suggestions":[{"messageId":"suggestOptionalChain","fix":{"range":[22197,22198],"text":"?"},"desc":"Consider using the optional chain operator `?.` instead. This operator includes runtime checks, so it is safer than the compile-only non-null assertion operator."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":24,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\n// Fixed JSX warning - cache refresh trigger\nimport { useNavigate, useParams, useLocation } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { FiPlus, FiSave, FiEye } from 'react-icons/fi';\nimport { Survey, SurveyQuestion, CreateSurveyRequest, QuestionType, SurveyAccessType, SurveyStatus } from '../../types/survey';\nimport { surveyService } from '../../services/surveyService';\nimport DashboardButton from '../../components/navigation/DashboardButton';\nimport QuestionEditor from '../../components/surveys/QuestionEditor';\nimport SurveyPreview from '../../components/surveys/SurveyPreview';\nimport LanguageSwitcher from '../../components/LanguageSwitcher';\nimport toast from 'react-hot-toast';\n\n// Validation utility types and functions\ninterface QuestionValidationError {\n  id: string;\n  text: string;\n  error: string;\n  questionNumber: number;\n}\n\ninterface SurveyValidationResult {\n  emptyQuestions: QuestionValidationError[];\n  emptyOptions: QuestionValidationError[];\n  isValid: boolean;\n}\n\nconst validateSurveyQuestions = (questions: SurveyQuestion[], t: any): SurveyValidationResult => {\n  const emptyQuestions: QuestionValidationError[] = [];\n  const emptyOptions: QuestionValidationError[] = [];\n\n  questions.forEach((question, index) => {\n    // Validate question text\n    const hasValidText = question.text && \n                        typeof question.text === 'string' && \n                        question.text.trim().length > 0;\n    \n    if (!hasValidText) {\n      emptyQuestions.push({\n        id: question.id,\n        text: question.text || '',\n        error: t('surveys.admin.validation.questionTextRequired'),\n        questionNumber: index + 1\n      });\n    }\n\n    // Validate options for choice questions\n    if (['single_choice', 'multiple_choice'].includes(question.type) && question.options) {\n      question.options.forEach((option, optIndex) => {\n        const hasValidOptionText = option.text && \n                                  typeof option.text === 'string' && \n                                  option.text.trim().length > 0;\n        \n        if (!hasValidOptionText) {\n          emptyOptions.push({\n            id: `${question.id}_${option.id}`,\n            text: option.text || '',\n            error: `Option ${optIndex + 1} text is required`,\n            questionNumber: index + 1\n          });\n        }\n      });\n    }\n  });\n\n  return {\n    emptyQuestions,\n    emptyOptions,\n    isValid: emptyQuestions.length === 0 && emptyOptions.length === 0\n  };\n};\n\nconst handleQuestionValidationErrors = (validationResult: SurveyValidationResult): void => {\n  const { emptyQuestions, emptyOptions } = validationResult;\n  \n  // Clear any previous highlights from both containers and fields\n  document.querySelectorAll('.validation-error-highlight').forEach(el => {\n    el.classList.remove('validation-error-highlight');\n  });\n  document.querySelectorAll('.validation-field-error').forEach(el => {\n    el.classList.remove('validation-field-error');\n  });\n  \n  if (emptyQuestions.length > 0) {\n    const questionNumbers = emptyQuestions.map(q => q.questionNumber).join(', ');\n    const message = emptyQuestions.length === 1 \n      ? `Question ${questionNumbers} needs your attention`\n      : `Questions ${questionNumbers} need your attention`;\n    \n    toast.error(message, {\n      duration: 6000,\n      icon: 'üëÜ'\n    });\n    \n    // Add red highlighting and focus to all empty questions\n    emptyQuestions.forEach((question, index) => {\n      const questionContainer = document.querySelector(`[data-question-id=\"${question.id}\"]`);\n      const questionTextarea = document.querySelector(`[data-question-id=\"${question.id}\"] textarea`);\n      \n      // Highlight the question container\n      if (questionContainer) {\n        questionContainer.classList.add('validation-error-highlight');\n      }\n      \n      // Also highlight the specific textarea field\n      if (questionTextarea) {\n        questionTextarea.classList.add('validation-field-error');\n        \n        // Focus and scroll to the first empty question\n        if (index === 0) {\n          questionTextarea.scrollIntoView({ \n            behavior: 'smooth', \n            block: 'center'\n          });\n          \n          // Add a slight delay to ensure smooth scroll completes before focus\n          setTimeout(() => {\n            (questionTextarea as HTMLElement).focus();\n            // Add pulsing effect to the field itself\n            questionTextarea.classList.add('animate-pulse');\n            setTimeout(() => {\n              questionTextarea.classList.remove('animate-pulse');\n            }, 2000);\n          }, 500);\n        }\n      }\n    });\n    \n    // Remove highlights after a delay\n    setTimeout(() => {\n      document.querySelectorAll('.validation-error-highlight').forEach(el => {\n        el.classList.remove('validation-error-highlight');\n      });\n      document.querySelectorAll('.validation-field-error').forEach(el => {\n        el.classList.remove('validation-field-error');\n      });\n    }, 8000);\n  }\n  \n  if (emptyOptions.length > 0) {\n    const message = emptyOptions.length === 1\n      ? 'Please fill in all option text fields'\n      : `Please fill in all option text fields (${emptyOptions.length} empty options found)`;\n    \n    toast.error(message, {\n      duration: 5000,\n      icon: 'üìã'\n    });\n    \n    // Highlight empty option fields\n    emptyOptions.forEach((option, index) => {\n      const optionInput = document.querySelector(`input[value=\"${option.text}\"]`);\n      if (optionInput) {\n        optionInput.classList.add('validation-field-error');\n        \n        // Focus the first empty option if no empty questions\n        if (emptyQuestions.length === 0 && index === 0) {\n          optionInput.scrollIntoView({ \n            behavior: 'smooth', \n            block: 'center'\n          });\n          setTimeout(() => {\n            (optionInput as HTMLElement).focus();\n          }, 500);\n        }\n      }\n    });\n  }\n};\n\nconst SurveyBuilder: React.FC = () => {\n  const { t } = useTranslation();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const { id } = useParams<{ id: string }>();\n  const isEditing = !!id;\n\n  const [survey, setSurvey] = useState<Partial<Survey>>({\n    title: '',\n    description: '',\n    questions: [],\n    target_segment: {},\n    status: 'draft',\n    access_type: 'public'\n  });\n  \n  const [loading, setLoading] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [showPreview, setShowPreview] = useState(false);\n  const [validationState, setValidationState] = useState<SurveyValidationResult>({\n    emptyQuestions: [],\n    emptyOptions: [],\n    isValid: true\n  });\n\n  useEffect(() => {\n    if (isEditing) {\n      loadSurvey();\n    } else if (location.state?.template) {\n      // Load from template\n      const template = location.state.template;\n      setSurvey({\n        title: template.title,\n        description: template.description,\n        questions: template.questions,\n        target_segment: {},\n        status: 'draft',\n        access_type: 'public'\n      });\n    }\n  }, [id, isEditing, location.state]);\n\n  // Real-time validation check\n  useEffect(() => {\n    if (survey.questions && survey.questions.length > 0) {\n      const validation = validateSurveyQuestions(survey.questions, t);\n      setValidationState(validation);\n    } else {\n      setValidationState({ emptyQuestions: [], emptyOptions: [], isValid: true });\n    }\n  }, [survey.questions, t]);\n\n  // Inject validation error highlighting CSS\n  useEffect(() => {\n    const styleId = 'validation-highlighting-styles';\n    \n    // Check if styles already exist\n    if (document.getElementById(styleId)) {\n      return;\n    }\n\n    const style = document.createElement('style');\n    style.id = styleId;\n    style.textContent = `\n      .validation-error-highlight {\n        border: 3px solid #ef4444 !important;\n        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2) !important;\n        transition: all 0.3s ease-in-out !important;\n        animation: validation-pulse 0.5s ease-in-out !important;\n      }\n      \n      @keyframes validation-pulse {\n        0% { transform: scale(1); }\n        50% { transform: scale(1.02); }\n        100% { transform: scale(1); }\n      }\n      \n      .validation-error-highlight textarea {\n        border-color: #ef4444 !important;\n        background-color: #fef2f2 !important;\n      }\n      \n      .validation-field-error {\n        border: 2px solid #ef4444 !important;\n        background-color: #fef2f2 !important;\n        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;\n        animation: field-error-pulse 0.6s ease-in-out !important;\n      }\n      \n      @keyframes field-error-pulse {\n        0% { \n          transform: scale(1);\n          box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);\n        }\n        50% { \n          transform: scale(1.01);\n          box-shadow: 0 0 0 5px rgba(239, 68, 68, 0.2);\n        }\n        100% { \n          transform: scale(1);\n          box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);\n        }\n      }\n      \n      .validation-field-error:focus {\n        border-color: #dc2626 !important;\n        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.3) !important;\n        background-color: #ffffff !important;\n      }\n      \n      .validation-error-highlight:hover {\n        border-color: #dc2626 !important;\n      }\n    `;\n\n    document.head.appendChild(style);\n\n    // Cleanup function to remove styles when component unmounts\n    return () => {\n      const existingStyle = document.getElementById(styleId);\n      if (existingStyle) {\n        existingStyle.remove();\n      }\n    };\n  }, []);\n\n  const loadSurvey = async () => {\n    if (!id) {return;}\n    \n    try {\n      setLoading(true);\n      const surveyData = await surveyService.getSurveyById(id);\n      setSurvey(surveyData);\n    } catch (err: any) {\n      console.error('Error loading survey:', err);\n      toast.error(t('surveys.admin.messages.loadError'));\n      navigate('/admin/surveys');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSurveyChange = (field: string, value: any) => {\n    setSurvey(prev => ({\n      ...prev,\n      [field]: value\n    }));\n  };\n\n  const addQuestion = (type: QuestionType) => {\n    const newQuestion: SurveyQuestion = {\n      id: surveyService.generateQuestionId(),\n      type,\n      text: '',\n      required: true,\n      order: (survey.questions?.length || 0) + 1,\n      ...(type === 'multiple_choice' || type === 'single_choice' ? {\n        options: [\n          { id: surveyService.generateOptionId(), text: t('surveys.admin.questions.defaultOptions.option1'), value: '1' },\n          { id: surveyService.generateOptionId(), text: t('surveys.admin.questions.defaultOptions.option2'), value: '2' }\n        ]\n      } : {}),\n      ...(type === 'rating_5' ? { min_rating: 1, max_rating: 5 } : {}),\n      ...(type === 'rating_10' ? { min_rating: 1, max_rating: 10 } : {})\n    };\n\n    setSurvey(prev => ({\n      ...prev,\n      questions: [...(prev.questions || []), newQuestion]\n    }));\n  };\n\n  const updateQuestion = (questionId: string, updates: Partial<SurveyQuestion>) => {\n    setSurvey(prev => ({\n      ...prev,\n      questions: prev.questions?.map(q => \n        q.id === questionId ? { ...q, ...updates } : q\n      ) || []\n    }));\n  };\n\n  const removeQuestion = (questionId: string) => {\n    setSurvey(prev => ({\n      ...prev,\n      questions: prev.questions?.filter(q => q.id !== questionId) || []\n    }));\n  };\n\n  const reorderQuestions = (fromIndex: number, toIndex: number) => {\n    const questions = [...(survey.questions || [])];\n    const [removed] = questions.splice(fromIndex, 1);\n    questions.splice(toIndex, 0, removed);\n    \n    // Update order numbers\n    const reorderedQuestions = questions.map((q, index) => ({\n      ...q,\n      order: index + 1\n    }));\n\n    setSurvey(prev => ({\n      ...prev,\n      questions: reorderedQuestions\n    }));\n  };\n\n  const saveSurvey = async (status?: string) => {\n    if (!survey.title || !survey.questions?.length) {\n      toast.error(t('surveys.admin.validation.titleAndQuestionRequired'));\n      return;\n    }\n\n    // Enhanced validation using real-time validation state\n    if (!validationState.isValid) {\n      handleQuestionValidationErrors(validationState);\n      return;\n    }\n\n    try {\n      setSaving(true);\n      \n      const surveyData: CreateSurveyRequest = {\n        title: survey.title,\n        description: survey.description,\n        questions: survey.questions,\n        target_segment: survey.target_segment,\n        access_type: survey.access_type || 'public' as SurveyAccessType,\n        status: (status || survey.status) as SurveyStatus\n      };\n\n      // Debug logging for development (only in non-production environments)\n      if (process.env.NODE_ENV === 'development') {\n        console.log('üìä Survey submission:', {\n          title: surveyData.title,\n          questionCount: surveyData.questions.length,\n          hasThaiContent: /[\\u0E00-\\u0E7F]/.test(JSON.stringify(surveyData)),\n          accessType: surveyData.access_type\n        });\n      }\n\n      if (isEditing && id) {\n        await surveyService.updateSurvey(id, { ...surveyData, status: (status || survey.status) as SurveyStatus });\n        toast.success(t('surveys.admin.messages.updateSuccess'));\n      } else {\n        const newSurvey = await surveyService.createSurvey(surveyData);\n        toast.success(t('surveys.admin.messages.createSuccess'));\n        navigate(`/admin/surveys/${newSurvey.id}/edit`);\n      }\n    } catch (err: any) {\n      // Enhanced error handling with graceful degradation\n      const isValidationError = err.response?.status === 400;\n      const errorMessage = err.response?.data?.message || err.message || 'Failed to save survey';\n      \n      if (isValidationError) {\n        // Handle backend validation errors gracefully\n        const backendErrors = err.response?.data?.validationErrors || [];\n        if (backendErrors.length > 0) {\n          const fieldErrors = backendErrors.map((error: any) => error.message || error.field).join(', ');\n          toast.error(t('surveys.admin.messages.validationFailed', { errors: fieldErrors }), {\n            duration: 6000,\n            icon: '‚ö†Ô∏è'\n          });\n        } else {\n          toast.error(errorMessage, { duration: 5000, icon: '‚ö†Ô∏è' });\n        }\n        \n        // Log only essential info for debugging\n        if (process.env.NODE_ENV === 'development') {\n          console.warn('Survey validation failed:', {\n            status: err.response?.status,\n            message: errorMessage,\n            validationErrors: backendErrors\n          });\n        }\n      } else {\n        // Handle network or server errors\n        toast.error(t('surveys.admin.messages.networkError', { message: errorMessage }), {\n          duration: 7000,\n          icon: 'üîå'\n        });\n        \n        // Log full error details for non-validation errors\n        console.error('Survey save failed:', err);\n      }\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-4xl mx-auto p-4\">\n          <div className=\"flex justify-center items-center h-64\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\" />\n            <span className=\"ml-3 text-gray-600\">{t('surveys.admin.surveyBuilder.loading')}</span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center py-6\">\n            <div className=\"flex items-center\">\n              <h1 className=\"text-2xl font-bold text-gray-900\">\n                {isEditing ? t('surveys.admin.surveyBuilder.pageTitle.edit') : t('surveys.admin.surveyBuilder.pageTitle.create')}\n              </h1>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <button\n                onClick={() => setShowPreview(!showPreview)}\n                className=\"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n              >\n                <FiEye className=\"mr-2 h-4 w-4\" />\n                {showPreview ? t('surveys.admin.surveyBuilder.hidePreview') : t('surveys.admin.surveyBuilder.preview')}\n              </button>\n              <LanguageSwitcher />\n              <DashboardButton variant=\"outline\" size=\"md\" />\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"max-w-4xl mx-auto p-4\">\n        {showPreview ? (\n          <SurveyPreview survey={survey as Survey} onClose={() => setShowPreview(false)} />\n        ) : (\n          <div className=\"space-y-6\">\n            {/* Basic Information */}\n            <div className=\"bg-white shadow rounded-lg p-6\">\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">{t('surveys.admin.basicInfo.title')}</h2>\n              \n              <div className=\"space-y-4\">\n                <div>\n                  <label htmlFor=\"title\" className=\"block text-sm font-medium text-gray-700\">\n                    {t('surveys.admin.basicInfo.surveyTitle')}\n                  </label>\n                  <input\n                    type=\"text\"\n                    id=\"title\"\n                    value={survey.title || ''}\n                    onChange={(e) => handleSurveyChange('title', e.target.value)}\n                    className=\"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm\"\n                    placeholder={t('surveys.admin.basicInfo.surveyTitlePlaceholder')}\n                  />\n                </div>\n\n                <div>\n                  <label htmlFor=\"description\" className=\"block text-sm font-medium text-gray-700\">\n                    {t('surveys.admin.basicInfo.description')}\n                  </label>\n                  <textarea\n                    id=\"description\"\n                    rows={3}\n                    value={survey.description || ''}\n                    onChange={(e) => handleSurveyChange('description', e.target.value)}\n                    className=\"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm\"\n                    placeholder={t('surveys.admin.basicInfo.descriptionPlaceholder')}\n                  />\n                </div>\n\n                <div>\n                  <label htmlFor=\"status\" className=\"block text-sm font-medium text-gray-700\">\n                    {t('surveys.admin.basicInfo.status')}\n                  </label>\n                  <select\n                    id=\"status\"\n                    value={survey.status || 'draft'}\n                    onChange={(e) => handleSurveyChange('status', e.target.value)}\n                    className=\"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm\"\n                  >\n                    <option value=\"draft\">{t('surveys.admin.basicInfo.statusOptions.draft')}</option>\n                    <option value=\"active\">{t('surveys.admin.basicInfo.statusOptions.active')}</option>\n                    <option value=\"paused\">{t('surveys.admin.basicInfo.statusOptions.paused')}</option>\n                    <option value=\"completed\">{t('surveys.admin.basicInfo.statusOptions.completed')}</option>\n                    <option value=\"archived\">{t('surveys.admin.basicInfo.statusOptions.archived')}</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label htmlFor=\"access_type\" className=\"block text-sm font-medium text-gray-700\">\n                    {t('surveys.admin.basicInfo.accessType')}\n                  </label>\n                  <select\n                    id=\"access_type\"\n                    value={survey.access_type || 'public'}\n                    onChange={(e) => handleSurveyChange('access_type', e.target.value)}\n                    className=\"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm\"\n                  >\n                    <option value=\"public\">{t('surveys.admin.basicInfo.accessTypeOptions.public')}</option>\n                    <option value=\"invite_only\">{t('surveys.admin.basicInfo.accessTypeOptions.inviteOnly')}</option>\n                  </select>\n                  <p className=\"mt-2 text-sm text-gray-500\">\n                    {survey.access_type === 'public' \n                      ? t('surveys.admin.basicInfo.accessTypeDescriptions.public')\n                      : t('surveys.admin.basicInfo.accessTypeDescriptions.inviteOnly')\n                    }\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* Questions */}\n            <div className=\"bg-white shadow rounded-lg p-6\">\n              <div className=\"flex justify-between items-center mb-4\">\n                <h2 className=\"text-lg font-medium text-gray-900\">{t('surveys.admin.questions.title')}</h2>\n                <div className=\"flex items-center space-x-2\">\n                  <span className=\"text-sm text-gray-500\">\n                    {t('surveys.admin.questions.count', { count: survey.questions?.length || 0 })}\n                  </span>\n                </div>\n              </div>\n\n              <div className=\"space-y-4\">\n                {survey.questions?.map((question, index) => (\n                  <QuestionEditor\n                    key={question.id}\n                    question={question}\n                    questionNumber={index + 1}\n                    index={index}\n                    onUpdate={(updates) => updateQuestion(question.id, updates)}\n                    onRemove={() => removeQuestion(question.id)}\n                    onReorder={reorderQuestions}\n                    canMove={survey.questions!.length > 1}\n                  />\n                ))}\n\n                {survey.questions?.length === 0 && (\n                  <div className=\"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg\">\n                    <p className=\"text-gray-500 mb-4\">{t('surveys.admin.questions.noQuestions')}</p>\n                  </div>\n                )}\n              </div>\n\n              {/* Add Question Buttons */}\n              <div className=\"mt-6 pt-6 border-t border-gray-200\">\n                <h3 className=\"text-sm font-medium text-gray-700 mb-3\">{t('surveys.admin.questions.addQuestion')}</h3>\n                <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\n                  <button\n                    onClick={() => addQuestion('single_choice')}\n                    className=\"flex items-center justify-center px-4 py-3 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n                  >\n                    <FiPlus className=\"mr-2 h-4 w-4\" />\n                    {t('surveys.admin.questions.questionTypes.singleChoice')}\n                  </button>\n                  <button\n                    onClick={() => addQuestion('multiple_choice')}\n                    className=\"flex items-center justify-center px-4 py-3 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n                  >\n                    <FiPlus className=\"mr-2 h-4 w-4\" />\n                    {t('surveys.admin.questions.questionTypes.multipleChoice')}\n                  </button>\n                  <button\n                    onClick={() => addQuestion('text')}\n                    className=\"flex items-center justify-center px-4 py-3 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n                  >\n                    <FiPlus className=\"mr-2 h-4 w-4\" />\n                    {t('surveys.admin.questions.questionTypes.text')}\n                  </button>\n                  <button\n                    onClick={() => addQuestion('textarea')}\n                    className=\"flex items-center justify-center px-4 py-3 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n                  >\n                    <FiPlus className=\"mr-2 h-4 w-4\" />\n                    {t('surveys.admin.questions.questionTypes.textarea')}\n                  </button>\n                  <button\n                    onClick={() => addQuestion('rating_5')}\n                    className=\"flex items-center justify-center px-4 py-3 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n                  >\n                    <FiPlus className=\"mr-2 h-4 w-4\" />\n                    {t('surveys.admin.questions.questionTypes.rating5')}\n                  </button>\n                  <button\n                    onClick={() => addQuestion('rating_10')}\n                    className=\"flex items-center justify-center px-4 py-3 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n                  >\n                    <FiPlus className=\"mr-2 h-4 w-4\" />\n                    {t('surveys.admin.questions.questionTypes.rating10')}\n                  </button>\n                  <button\n                    onClick={() => addQuestion('yes_no')}\n                    className=\"flex items-center justify-center px-4 py-3 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n                  >\n                    <FiPlus className=\"mr-2 h-4 w-4\" />\n                    {t('surveys.admin.questions.questionTypes.yesNo')}\n                  </button>\n                </div>\n              </div>\n            </div>\n\n            {/* Save Actions */}\n            <div className=\"bg-white shadow rounded-lg p-6\">\n              <div className=\"flex justify-between items-center\">\n                <button\n                  onClick={() => navigate('/admin/surveys')}\n                  className=\"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n                >\n                  {t('surveys.admin.surveyBuilder.cancel')}\n                </button>\n                \n                <div className=\"flex items-center space-x-3\">\n                  {/* Validation Status Indicator */}\n                  {survey.questions && survey.questions.length > 0 && (\n                    <div className=\"flex items-center text-sm\">\n                      {validationState.isValid ? (\n                        <span className=\"flex items-center text-green-600\">\n                          <span className=\"w-2 h-2 bg-green-500 rounded-full mr-2\" />\n                          {t('surveys.admin.validation.readyToSave')}\n                        </span>\n                      ) : (\n                        <span className=\"flex items-center text-amber-600\">\n                          <span className=\"w-2 h-2 bg-amber-500 rounded-full mr-2\" />\n                          {validationState.emptyQuestions.length === 1 \n                            ? t('surveys.admin.validation.needsAttention', { count: validationState.emptyQuestions.length })\n                            : t('surveys.admin.validation.needsAttentionPlural', { count: validationState.emptyQuestions.length })\n                          }\n                        </span>\n                      )}\n                    </div>\n                  )}\n                  \n                  <button\n                    onClick={() => saveSurvey('draft')}\n                    disabled={saving}\n                    className=\"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50\"\n                  >\n                    <FiSave className=\"mr-2 h-4 w-4\" />\n                    {t('surveys.admin.saveDraft')}\n                  </button>\n                  \n                  <button\n                    onClick={() => saveSurvey('active')}\n                    disabled={saving}\n                    className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50\"\n                  >\n                    {saving && <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\" />}\n                    {isEditing ? t('surveys.admin.updateAndPublish') : t('surveys.admin.createAndPublish')}\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default SurveyBuilder;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/admin/SurveyBuilderMultilingual.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'QuestionType' is defined but never used.","line":5,"column":55,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":67},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MultilingualSurvey' is defined but never used.","line":6,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getTextInLanguage' is defined but never used.","line":14,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createMultilingualText' is defined but never used.","line":14,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updateMultilingualText' is defined but never used.","line":14,"column":53,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":75},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSurvey'. Either include it or remove the dependency array.","line":57,"column":6,"nodeType":"ArrayExpression","endLine":57,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [id, loadSurvey]","fix":{"range":[2621,2625],"text":"[id, loadSurvey]"}}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":61,"column":14,"nodeType":"MemberExpression","endLine":61,"endColumn":53},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":61,"column":54,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":61,"endColumn":56,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2764,2766],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":62,"column":20,"nodeType":"MemberExpression","endLine":62,"endColumn":65},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":62,"column":66,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":62,"endColumn":68,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2837,2839],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":63,"column":18,"nodeType":"MemberExpression","endLine":63,"endColumn":61},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":63,"column":62,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":63,"endColumn":64,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2906,2908],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":75,"column":55,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":75,"endColumn":57,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[3237,3239],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":79,"column":61,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":79,"endColumn":63,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[3396,3398],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":92,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":92,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3920,3967],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4234,4237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4234,4237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":107,"column":13,"nodeType":"MemberExpression","endLine":107,"endColumn":35},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":110,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":110,"endColumn":23,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[4548,4611],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":121,"column":11,"nodeType":"MemberExpression","endLine":121,"endColumn":46},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":122,"column":11,"nodeType":"MemberExpression","endLine":122,"endColumn":52},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":123,"column":11,"nodeType":"MemberExpression","endLine":123,"endColumn":50},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":124,"column":11,"nodeType":"MemberExpression","endLine":124,"endColumn":41},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":132,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":132,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5374,5427],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":164,"column":9,"nodeType":"MemberExpression","endLine":164,"endColumn":24},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":181,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":181,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[6812,6856],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":187,"column":9,"nodeType":"MemberExpression","endLine":187,"endColumn":24},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":206,"column":13,"nodeType":"MemberExpression","endLine":206,"endColumn":28},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":226,"column":13,"nodeType":"MemberExpression","endLine":226,"endColumn":28},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":234,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":234,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[8616,8676],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":329,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":329,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[11178,11215],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":352,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":352,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[11797,11837],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fromIndex' is defined but never used.","line":506,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":506,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toIndex' is defined but never used.","line":506,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":506,"endColumn":49},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":576,"column":28,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":576,"endColumn":30,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[21668,21670],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":34,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { FiPlus, FiSave, FiEye } from 'react-icons/fi';\nimport { Survey, SurveyQuestion, CreateSurveyRequest, QuestionType, SurveyAccessType, SurveyStatus } from '../../types/survey';\nimport { SupportedLanguage, MultilingualSurvey } from '../../types/multilingual';\nimport { surveyService } from '../../services/surveyService';\nimport { translationService } from '../../services/translationService';\nimport DashboardButton from '../../components/navigation/DashboardButton';\nimport LanguageTabs from '../../components/translation/LanguageTabs';\nimport TranslationButton from '../../components/translation/TranslationButton';\nimport QuestionEditor from '../../components/surveys/QuestionEditor';\nimport SurveyPreview from '../../components/surveys/SurveyPreview';\nimport { getTextInLanguage, createMultilingualText, updateMultilingualText } from '../../utils/translationHelpers';\nimport toast from 'react-hot-toast';\n\nconst SurveyBuilderMultilingual: React.FC = () => {\n  const { t } = useTranslation();\n  const navigate = useNavigate();\n  const { id } = useParams();\n  \n  // UI State\n  const [loading, setLoading] = useState(!!id);\n  const [saving, setSaving] = useState(false);\n  const [translating, setTranslating] = useState(false);\n  const [showPreview, setShowPreview] = useState(false);\n  \n  // Language and Translation State\n  const [currentLanguage, setCurrentLanguage] = useState<SupportedLanguage>('th');\n  const [availableLanguages, setAvailableLanguages] = useState<SupportedLanguage[]>(['th']);\n  const [translationStatus, setTranslationStatus] = useState<{ [key in SupportedLanguage]?: 'original' | 'translated' | 'pending' | 'error' }>({\n    'th': 'original'\n  });\n  \n  // Survey Data State\n  const [title, setTitle] = useState('');\n  const [description, setDescription] = useState('');\n  const [questions, setQuestions] = useState<SurveyQuestion[]>([]);\n  const [accessType, setAccessType] = useState<SurveyAccessType>('public');\n  const [status, setStatus] = useState<SurveyStatus>('draft');\n  \n  // Translation data storage (for different languages)\n  const [multilingualData, setMultilingualData] = useState<{\n    title: { [key in SupportedLanguage]?: string };\n    description: { [key in SupportedLanguage]?: string };\n    questions: { [key in SupportedLanguage]?: SurveyQuestion[] };\n  }>({\n    title: { th: '' },\n    description: { th: '' },\n    questions: { th: [] }\n  });\n\n  useEffect(() => {\n    if (id) {\n      loadSurvey();\n    }\n  }, [id]);\n\n  useEffect(() => {\n    // Update current displayed content when language changes\n    setTitle(multilingualData.title[currentLanguage] || '');\n    setDescription(multilingualData.description[currentLanguage] || '');\n    setQuestions(multilingualData.questions[currentLanguage] || []);\n  }, [currentLanguage, multilingualData]);\n\n  const loadSurvey = async () => {\n    if (!id) {return;}\n    \n    try {\n      setLoading(true);\n      const survey = await surveyService.getSurveyById(id);\n      \n      if (survey) {\n        // Initialize with existing data\n        const originalLang = survey.original_language || 'th';\n        \n        setMultilingualData({\n          title: { [originalLang]: survey.title },\n          description: { [originalLang]: survey.description || '' },\n          questions: { [originalLang]: survey.questions }\n        });\n        \n        setAvailableLanguages((survey.available_languages as SupportedLanguage[]) || [originalLang]);\n        setCurrentLanguage(originalLang as SupportedLanguage);\n        setAccessType(survey.access_type);\n        setStatus(survey.status);\n        \n        // Load translations if available\n        await loadTranslations(id, (survey.available_languages as SupportedLanguage[]) || [originalLang]);\n      }\n    } catch (error) {\n      console.error('Failed to load survey:', error);\n      toast.error(t('surveys.admin.errors.loadFailed'));\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const loadTranslations = async (surveyId: string, languages: SupportedLanguage[]) => {\n    try {\n      const translations: { [key in SupportedLanguage]?: any } = {};\n      \n      for (const language of languages) {\n        try {\n          const translatedSurvey = await surveyService.getSurveyWithTranslations(surveyId, language);\n          if (translatedSurvey) {\n            translations[language] = translatedSurvey;\n          }\n        } catch (error) {\n          console.warn(`Failed to load ${language} translation:`, error);\n        }\n      }\n      \n      // Update multilingual data with translations\n      const newMultilingualData = { ...multilingualData };\n      const newTranslationStatus = { ...translationStatus };\n      \n      Object.entries(translations).forEach(([lang, data]) => {\n        const language = lang as SupportedLanguage;\n        if (data) {\n          newMultilingualData.title[language] = data.title;\n          newMultilingualData.description[language] = data.description || '';\n          newMultilingualData.questions[language] = data.questions;\n          newTranslationStatus[language] = 'translated';\n        }\n      });\n      \n      setMultilingualData(newMultilingualData);\n      setTranslationStatus(newTranslationStatus);\n      \n    } catch (error) {\n      console.error('Failed to load translations:', error);\n    }\n  };\n\n  const updateCurrentLanguageData = () => {\n    // Save current editing data to the multilingual store\n    setMultilingualData(prev => ({\n      ...prev,\n      title: { ...prev.title, [currentLanguage]: title },\n      description: { ...prev.description, [currentLanguage]: description },\n      questions: { ...prev.questions, [currentLanguage]: questions }\n    }));\n  };\n\n  const handleLanguageChange = (language: SupportedLanguage) => {\n    // Save current language data before switching\n    updateCurrentLanguageData();\n    setCurrentLanguage(language);\n  };\n\n  const handleTranslate = async (targetLanguages: SupportedLanguage[]) => {\n    if (!id) {\n      toast.error(t('translation.saveSurveyFirst'));\n      return;\n    }\n\n    try {\n      setTranslating(true);\n      \n      // Update translation status to pending for target languages\n      const newStatus = { ...translationStatus };\n      targetLanguages.forEach(lang => {\n        newStatus[lang] = 'pending';\n      });\n      setTranslationStatus(newStatus);\n\n      // Start translation job\n      const translationJob = await translationService.translateSurvey(\n        id,\n        currentLanguage,\n        targetLanguages\n      );\n\n      toast.success(t('translation.translationStarted'));\n\n      // Poll for completion\n      pollTranslationProgress(translationJob.id, targetLanguages);\n\n    } catch (error) {\n      console.error('Translation failed:', error);\n      toast.error(t('translation.translationFailed'));\n      \n      // Reset status on error\n      const newStatus = { ...translationStatus };\n      targetLanguages.forEach(lang => {\n        newStatus[lang] = 'error';\n      });\n      setTranslationStatus(newStatus);\n    } finally {\n      setTranslating(false);\n    }\n  };\n\n  const pollTranslationProgress = async (jobId: string, targetLanguages: SupportedLanguage[]) => {\n    const pollInterval = setInterval(async () => {\n      try {\n        const job = await translationService.getTranslationJobStatus(jobId);\n        \n        if (job.status === 'completed') {\n          clearInterval(pollInterval);\n          \n          // Update status to completed\n          const newStatus = { ...translationStatus };\n          targetLanguages.forEach(lang => {\n            newStatus[lang] = 'translated';\n          });\n          setTranslationStatus(newStatus);\n          \n          // Add new languages to available languages\n          const newAvailableLanguages = [...new Set([...availableLanguages, ...targetLanguages])];\n          setAvailableLanguages(newAvailableLanguages);\n          \n          // Reload translations\n          if (id) {\n            await loadTranslations(id, newAvailableLanguages);\n          }\n          \n          toast.success(t('translation.translationCompleted'));\n          \n        } else if (job.status === 'failed') {\n          clearInterval(pollInterval);\n          \n          const newStatus = { ...translationStatus };\n          targetLanguages.forEach(lang => {\n            newStatus[lang] = 'error';\n          });\n          setTranslationStatus(newStatus);\n          \n          toast.error(t('translation.translationFailed'));\n        }\n        \n      } catch (error) {\n        console.error('Failed to check translation status:', error);\n        clearInterval(pollInterval);\n      }\n    }, 2000);\n\n    // Clear interval after 5 minutes to prevent infinite polling\n    setTimeout(() => clearInterval(pollInterval), 5 * 60 * 1000);\n  };\n\n  const addQuestion = () => {\n    const newQuestion: SurveyQuestion = {\n      id: `q_${Date.now()}`,\n      type: 'text',\n      text: '',\n      required: false,\n      order: questions.length\n    };\n    \n    const newQuestions = [...questions, newQuestion];\n    setQuestions(newQuestions);\n    \n    // Update multilingual data\n    setMultilingualData(prev => ({\n      ...prev,\n      questions: { ...prev.questions, [currentLanguage]: newQuestions }\n    }));\n  };\n\n  const updateQuestion = (questionId: string, updates: Partial<SurveyQuestion>) => {\n    const newQuestions = questions.map(q => \n      q.id === questionId ? { ...q, ...updates } : q\n    );\n    setQuestions(newQuestions);\n    \n    // Update multilingual data\n    setMultilingualData(prev => ({\n      ...prev,\n      questions: { ...prev.questions, [currentLanguage]: newQuestions }\n    }));\n  };\n\n  const deleteQuestion = (questionId: string) => {\n    const newQuestions = questions.filter(q => q.id !== questionId);\n    setQuestions(newQuestions);\n    \n    // Update multilingual data\n    setMultilingualData(prev => ({\n      ...prev,\n      questions: { ...prev.questions, [currentLanguage]: newQuestions }\n    }));\n  };\n\n  const handleSave = async () => {\n    // Update current language data before saving\n    updateCurrentLanguageData();\n    \n    if (!title.trim()) {\n      toast.error(t('surveys.admin.validation.titleRequired'));\n      return;\n    }\n\n    if (questions.length === 0) {\n      toast.error(t('surveys.admin.validation.questionsRequired'));\n      return;\n    }\n\n    try {\n      setSaving(true);\n\n      const surveyData: CreateSurveyRequest = {\n        title,\n        description: description || undefined,\n        questions,\n        access_type: accessType,\n        status,\n        original_language: currentLanguage,\n        // Note: autoTranslate handled separately if needed\n      };\n\n      let savedSurvey: Survey;\n      \n      if (id) {\n        savedSurvey = await surveyService.updateSurvey(id, surveyData);\n      } else {\n        savedSurvey = await surveyService.createSurvey(surveyData);\n      }\n\n      toast.success(t('surveys.admin.saveSuccess'));\n\n      if (!id) {\n        // Navigate to edit mode for new surveys\n        navigate(`/admin/surveys/builder/${savedSurvey.id}`);\n      }\n\n    } catch (error) {\n      console.error('Save failed:', error);\n      toast.error(t('surveys.admin.errors.saveFailed'));\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handlePublish = async () => {\n    updateCurrentLanguageData();\n    \n    try {\n      setSaving(true);\n      \n      if (id) {\n        await surveyService.updateSurvey(id, { status: 'active' });\n        setStatus('active');\n        toast.success(t('surveys.admin.publishSuccess'));\n      } else {\n        // Save first, then publish\n        await handleSave();\n        // The save will redirect to edit mode where user can publish\n      }\n    } catch (error) {\n      console.error('Publish failed:', error);\n      toast.error(t('surveys.admin.errors.publishFailed'));\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto\" />\n          <p className=\"mt-4 text-gray-600\">{t('common.loading')}</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-gray-900\">\n              {id ? t('surveys.admin.editSurvey') : t('surveys.admin.createSurvey')}\n            </h1>\n            <p className=\"mt-2 text-gray-600\">\n              {t('surveys.admin.builderDescription')}\n            </p>\n          </div>\n          <DashboardButton />\n        </div>\n\n        {/* Language Tabs */}\n        <div className=\"bg-white rounded-lg shadow-sm p-6 mb-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h2 className=\"text-lg font-medium text-gray-900\">\n              {t('translation.languages')}\n            </h2>\n            {id && (\n              <TranslationButton\n                onTranslate={handleTranslate}\n                isTranslating={translating}\n                availableLanguages={availableLanguages}\n                originalLanguage={availableLanguages[0] || 'th'}\n              />\n            )}\n          </div>\n          \n          <LanguageTabs\n            languages={availableLanguages}\n            currentLanguage={currentLanguage}\n            onLanguageChange={handleLanguageChange}\n            translationStatus={translationStatus}\n          />\n        </div>\n\n        {/* Survey Form */}\n        <div className=\"bg-white rounded-lg shadow-sm p-6 mb-6\">\n          {/* Basic Information */}\n          <div className=\"mb-8\">\n            <h2 className=\"text-lg font-medium text-gray-900 mb-4\">\n              {t('surveys.admin.basicInformation')}\n            </h2>\n            \n            <div className=\"space-y-4\">\n              <div>\n                <label htmlFor=\"title\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  {t('surveys.admin.surveyTitle')} *\n                </label>\n                <input\n                  type=\"text\"\n                  id=\"title\"\n                  value={title}\n                  onChange={(e) => setTitle(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500\"\n                  placeholder={t('surveys.admin.surveyTitlePlaceholder')}\n                />\n              </div>\n\n              <div>\n                <label htmlFor=\"description\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  {t('surveys.admin.surveyDescription')}\n                </label>\n                <textarea\n                  id=\"description\"\n                  value={description}\n                  onChange={(e) => setDescription(e.target.value)}\n                  rows={3}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500\"\n                  placeholder={t('surveys.admin.surveyDescriptionPlaceholder')}\n                />\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label htmlFor=\"accessType\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    {t('surveys.admin.accessType')}\n                  </label>\n                  <select\n                    id=\"accessType\"\n                    value={accessType}\n                    onChange={(e) => setAccessType(e.target.value as SurveyAccessType)}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500\"\n                  >\n                    <option value=\"public\">{t('surveys.admin.accessTypes.public')}</option>\n                    <option value=\"invite_only\">{t('surveys.admin.accessTypes.inviteOnly')}</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label htmlFor=\"status\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    {t('surveys.admin.status')}\n                  </label>\n                  <select\n                    id=\"status\"\n                    value={status}\n                    onChange={(e) => setStatus(e.target.value as SurveyStatus)}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500\"\n                  >\n                    <option value=\"draft\">{t('surveys.admin.statuses.draft')}</option>\n                    <option value=\"active\">{t('surveys.admin.statuses.active')}</option>\n                    <option value=\"paused\">{t('surveys.admin.statuses.paused')}</option>\n                  </select>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Questions Section */}\n          <div className=\"mb-8\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-lg font-medium text-gray-900\">\n                {t('surveys.admin.questions')}\n              </h2>\n              <button\n                onClick={addQuestion}\n                className=\"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n              >\n                <FiPlus className=\"w-4 h-4 mr-2\" />\n                {t('surveys.admin.addQuestion')}\n              </button>\n            </div>\n\n            <div className=\"space-y-4\">\n              {questions.map((question, index) => (\n                <QuestionEditor\n                  key={question.id}\n                  question={question}\n                  index={index}\n                  questionNumber={index + 1}\n                  onUpdate={(updates) => updateQuestion(question.id, updates)}\n                  onRemove={() => deleteQuestion(question.id)}\n                  onReorder={(fromIndex, toIndex) => {}} \n                  canMove={false}\n                />\n              ))}\n              \n              {questions.length === 0 && (\n                <div className=\"text-center py-8 text-gray-500\">\n                  <p>{t('surveys.admin.noQuestions')}</p>\n                  <button\n                    onClick={addQuestion}\n                    className=\"mt-2 text-primary-600 hover:text-primary-700 font-medium\"\n                  >\n                    {t('surveys.admin.addFirstQuestion')}\n                  </button>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Action Buttons */}\n          <div className=\"flex items-center justify-between pt-6 border-t border-gray-200\">\n            <button\n              onClick={() => setShowPreview(true)}\n              className=\"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n            >\n              <FiEye className=\"w-4 h-4 mr-2\" />\n              {t('surveys.admin.preview')}\n            </button>\n\n            <div className=\"flex space-x-3\">\n              <button\n                onClick={handleSave}\n                disabled={saving}\n                className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                <FiSave className=\"w-4 h-4 mr-2\" />\n                {saving ? t('common.saving') : t('common.save')}\n              </button>\n\n              {status !== 'active' && (\n                <button\n                  onClick={handlePublish}\n                  disabled={saving}\n                  className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  {saving ? t('common.saving') : t('surveys.admin.publish')}\n                </button>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Preview Modal */}\n        {showPreview && (\n          <div className=\"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center p-4 z-50\">\n            <div className=\"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-auto\">\n              <div className=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\n                <h3 className=\"text-lg font-medium text-gray-900\">\n                  {t('surveys.admin.preview')}\n                </h3>\n                <button\n                  onClick={() => setShowPreview(false)}\n                  className=\"text-gray-400 hover:text-gray-600\"\n                >\n                  √ó\n                </button>\n              </div>\n              <div className=\"p-6\">\n                <SurveyPreview\n                  survey={{\n                    id: id || 'preview',\n                    title,\n                    description,\n                    questions,\n                    target_segment: {},\n                    status,\n                    access_type: accessType,\n                    created_at: new Date().toISOString(),\n                    updated_at: new Date().toISOString()\n                  }}\n                  onClose={() => setShowPreview(false)}\n                />\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default SurveyBuilderMultilingual;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/admin/SurveyBuilderWithTranslation.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1371,1374],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1371,1374],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'i18n' is assigned a value but never used.","line":162,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":162,"endColumn":18},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'checkOngoingTranslations' and 'loadSurvey'. Either include them or remove the dependency array.","line":212,"column":6,"nodeType":"ArrayExpression","endLine":212,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [checkOngoingTranslations, id, isEditing, loadSurvey, location.state]","fix":{"range":[7344,7375],"text":"[checkOngoingTranslations, id, isEditing, loadSurvey, location.state]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":336,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":336,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11349,11352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11349,11352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":337,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":337,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[11362,11406],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":351,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":351,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11801,11804],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11801,11804],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":366,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":366,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12369,12372],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12369,12372],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":394,"column":87,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":394,"endColumn":89,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[13578,13580],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":432,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":432,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[14850,14914],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":443,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":443,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[15151,15212],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":447,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":447,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15277,15280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15277,15280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleTranslate' is assigned a value but never used.","line":454,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":454,"endColumn":24},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":466,"column":9,"nodeType":"MemberExpression","endLine":466,"endColumn":24},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":514,"column":15,"nodeType":"MemberExpression","endLine":514,"endColumn":32},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":518,"column":64,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":518,"endColumn":66,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[17671,17673],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":524,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":524,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[17813,17868],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":533,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":533,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18057,18060],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18057,18060],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":534,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":534,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[18070,18111],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":540,"column":9,"nodeType":"MemberExpression","endLine":540,"endColumn":26},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":554,"column":40,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":554,"endColumn":42,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[18664,18666],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":567,"column":38,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":567,"endColumn":40,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[19263,19265],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":576,"column":9,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":576,"endColumn":11,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[19530,19532],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":583,"column":67,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":583,"endColumn":69,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[19708,19710],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":588,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":588,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[19842,19844],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":622,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":622,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[20745,20747],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":623,"column":25,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":623,"endColumn":27,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[20802,20804],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":631,"column":79,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":631,"endColumn":81,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[21079,21081],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":641,"column":19,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":641,"endColumn":21,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[21513,21515],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":660,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":660,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[22310,22370],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":669,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":669,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22648,22651],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22648,22651],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":676,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":676,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23023,23026],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23023,23026],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Variable Assigned to Object Injection Sink","line":706,"column":25,"nodeType":"MemberExpression","endLine":706,"endColumn":74},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":798,"column":43,"nodeType":"MemberExpression","endLine":798,"endColumn":78},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":853,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":853,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[30610,30612],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":871,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":871,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[31765,31767],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":900,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":900,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33342,33345],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33342,33345],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":909,"column":30,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":909,"endColumn":55,"suggestions":[{"messageId":"suggestOptionalChain","fix":{"range":[33808,33809],"text":"?"},"desc":"Consider using the optional chain operator `?.` instead. This operator includes runtime checks, so it is safer than the compile-only non-null assertion operator."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":37,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useNavigate, useParams, useLocation } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { FiPlus, FiSave, FiEye, FiGlobe } from 'react-icons/fi';\nimport { Survey, SurveyQuestion, CreateSurveyRequest, QuestionType, SurveyAccessType, SurveyStatus } from '../../types/survey';\nimport { surveyService } from '../../services/surveyService';\nimport { translationService } from '../../services/translationService';\nimport DashboardButton from '../../components/navigation/DashboardButton';\nimport QuestionEditor from '../../components/surveys/QuestionEditor';\nimport SurveyPreview from '../../components/surveys/SurveyPreview';\nimport LanguageSwitcher from '../../components/LanguageSwitcher';\nimport LanguageTabs from '../../components/translation/LanguageTabs';\nimport toast from 'react-hot-toast';\nimport { MultilingualSurvey, SupportedLanguage, TranslationStatus } from '../../types/multilingual';\n\n// Validation utility types and functions (keeping existing)\ninterface QuestionValidationError {\n  id: string;\n  text: string;\n  error: string;\n  questionNumber: number;\n}\n\ninterface SurveyValidationResult {\n  emptyQuestions: QuestionValidationError[];\n  emptyOptions: QuestionValidationError[];\n  isValid: boolean;\n}\n\nconst validateSurveyQuestions = (questions: SurveyQuestion[], t: any): SurveyValidationResult => {\n  const emptyQuestions: QuestionValidationError[] = [];\n  const emptyOptions: QuestionValidationError[] = [];\n\n  questions.forEach((question, index) => {\n    const hasValidText = question.text && \n                        typeof question.text === 'string' && \n                        question.text.trim().length > 0;\n    \n    if (!hasValidText) {\n      emptyQuestions.push({\n        id: question.id,\n        text: question.text || '',\n        error: t('surveys.admin.validation.questionTextRequired'),\n        questionNumber: index + 1\n      });\n    }\n\n    if (['single_choice', 'multiple_choice'].includes(question.type) && question.options) {\n      question.options.forEach((option, optIndex) => {\n        const hasValidOptionText = option.text && \n                                  typeof option.text === 'string' && \n                                  option.text.trim().length > 0;\n        \n        if (!hasValidOptionText) {\n          emptyOptions.push({\n            id: `${question.id}_${option.id}`,\n            text: option.text || '',\n            error: `Option ${optIndex + 1} text is required`,\n            questionNumber: index + 1\n          });\n        }\n      });\n    }\n  });\n\n  return {\n    emptyQuestions,\n    emptyOptions,\n    isValid: emptyQuestions.length === 0 && emptyOptions.length === 0\n  };\n};\n\nconst handleQuestionValidationErrors = (validationResult: SurveyValidationResult): void => {\n  const { emptyQuestions, emptyOptions } = validationResult;\n  \n  document.querySelectorAll('.validation-error-highlight').forEach(el => {\n    el.classList.remove('validation-error-highlight');\n  });\n  document.querySelectorAll('.validation-field-error').forEach(el => {\n    el.classList.remove('validation-field-error');\n  });\n  \n  if (emptyQuestions.length > 0) {\n    const questionNumbers = emptyQuestions.map(q => q.questionNumber).join(', ');\n    const message = emptyQuestions.length === 1 \n      ? `Question ${questionNumbers} needs your attention`\n      : `Questions ${questionNumbers} need your attention`;\n    \n    toast.error(message, {\n      duration: 6000,\n      icon: 'üëÜ'\n    });\n    \n    emptyQuestions.forEach((question, index) => {\n      const questionContainer = document.querySelector(`[data-question-id=\"${question.id}\"]`);\n      const questionTextarea = document.querySelector(`[data-question-id=\"${question.id}\"] textarea`);\n      \n      if (questionContainer) {\n        questionContainer.classList.add('validation-error-highlight');\n      }\n      \n      if (questionTextarea) {\n        questionTextarea.classList.add('validation-field-error');\n        \n        if (index === 0) {\n          questionTextarea.scrollIntoView({ \n            behavior: 'smooth', \n            block: 'center'\n          });\n          \n          setTimeout(() => {\n            (questionTextarea as HTMLElement).focus();\n            questionTextarea.classList.add('animate-pulse');\n            setTimeout(() => {\n              questionTextarea.classList.remove('animate-pulse');\n            }, 2000);\n          }, 500);\n        }\n      }\n    });\n    \n    setTimeout(() => {\n      document.querySelectorAll('.validation-error-highlight').forEach(el => {\n        el.classList.remove('validation-error-highlight');\n      });\n      document.querySelectorAll('.validation-field-error').forEach(el => {\n        el.classList.remove('validation-field-error');\n      });\n    }, 8000);\n  }\n  \n  if (emptyOptions.length > 0) {\n    const message = emptyOptions.length === 1\n      ? 'Please fill in all option text fields'\n      : `Please fill in all option text fields (${emptyOptions.length} empty options found)`;\n    \n    toast.error(message, {\n      duration: 5000,\n      icon: 'üìã'\n    });\n    \n    emptyOptions.forEach((option, index) => {\n      const optionInput = document.querySelector(`input[value=\"${option.text}\"]`);\n      if (optionInput) {\n        optionInput.classList.add('validation-field-error');\n        \n        if (emptyQuestions.length === 0 && index === 0) {\n          optionInput.scrollIntoView({ \n            behavior: 'smooth', \n            block: 'center'\n          });\n          setTimeout(() => {\n            (optionInput as HTMLElement).focus();\n          }, 500);\n        }\n      }\n    });\n  }\n};\n\nconst SurveyBuilderWithTranslation: React.FC = () => {\n  const { t, i18n } = useTranslation();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const { id } = useParams<{ id: string }>();\n  const isEditing = !!id;\n\n  const [survey, setSurvey] = useState<Partial<Survey>>({\n    title: '',\n    description: '',\n    questions: [],\n    target_segment: {},\n    status: 'draft',\n    access_type: 'public'\n  });\n\n  const [multilingualSurvey, setMultilingualSurvey] = useState<MultilingualSurvey | null>(null);\n  const [selectedLanguage, setSelectedLanguage] = useState<SupportedLanguage>('th');\n  const [translationStatus, setTranslationStatus] = useState<Record<SupportedLanguage, TranslationStatus>>({\n    th: 'original',\n    en: 'pending',\n    'zh-CN': 'pending'\n  });\n  const [isTranslating, setIsTranslating] = useState(false);\n  const [justRefreshed, setJustRefreshed] = useState(false);\n  \n  const [loading, setLoading] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [showPreview, setShowPreview] = useState(false);\n  const [validationState, setValidationState] = useState<SurveyValidationResult>({\n    emptyQuestions: [],\n    emptyOptions: [],\n    isValid: true\n  });\n\n  useEffect(() => {\n    if (isEditing) {\n      loadSurvey();\n      // Check for any ongoing translation jobs when page loads/refreshes\n      checkOngoingTranslations();\n    } else if (location.state?.template) {\n      const template = location.state.template;\n      setSurvey({\n        title: template.title,\n        description: template.description,\n        questions: template.questions,\n        target_segment: {},\n        status: 'draft',\n        access_type: 'public'\n      });\n    }\n  }, [id, isEditing, location.state]);\n\n  useEffect(() => {\n    if (survey.questions && survey.questions.length > 0) {\n      const validation = validateSurveyQuestions(survey.questions, t);\n      setValidationState(validation);\n    } else {\n      setValidationState({ emptyQuestions: [], emptyOptions: [], isValid: true });\n    }\n  }, [survey.questions, t]);\n\n  // Inject validation error highlighting CSS\n  useEffect(() => {\n    const styleId = 'validation-highlighting-styles';\n    \n    if (document.getElementById(styleId)) {\n      return;\n    }\n\n    const style = document.createElement('style');\n    style.id = styleId;\n    style.textContent = `\n      .validation-error-highlight {\n        border: 3px solid #ef4444 !important;\n        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2) !important;\n        transition: all 0.3s ease-in-out !important;\n        animation: validation-pulse 0.5s ease-in-out !important;\n      }\n      \n      @keyframes validation-pulse {\n        0% { transform: scale(1); }\n        50% { transform: scale(1.02); }\n        100% { transform: scale(1); }\n      }\n      \n      .validation-error-highlight textarea {\n        border-color: #ef4444 !important;\n        background-color: #fef2f2 !important;\n      }\n      \n      .validation-field-error {\n        border: 2px solid #ef4444 !important;\n        background-color: #fef2f2 !important;\n        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;\n        animation: field-error-pulse 0.6s ease-in-out !important;\n      }\n      \n      @keyframes field-error-pulse {\n        0% { \n          transform: scale(1);\n          box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);\n        }\n        50% { \n          transform: scale(1.01);\n          box-shadow: 0 0 0 5px rgba(239, 68, 68, 0.2);\n        }\n        100% { \n          transform: scale(1);\n          box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);\n        }\n      }\n      \n      .validation-field-error:focus {\n        border-color: #dc2626 !important;\n        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.3) !important;\n        background-color: #ffffff !important;\n      }\n      \n      .validation-error-highlight:hover {\n        border-color: #dc2626 !important;\n      }\n    `;\n\n    document.head.appendChild(style);\n\n    return () => {\n      const existingStyle = document.getElementById(styleId);\n      if (existingStyle) {\n        existingStyle.remove();\n      }\n    };\n  }, []);\n\n  const loadSurvey = async () => {\n    if (!id) {return;}\n    \n    try {\n      setLoading(true);\n      const surveyData = await surveyService.getSurveyById(id);\n      setSurvey(surveyData);\n      \n      // Load translations if available\n      const translationsData = await translationService.getSurveyTranslations(id);\n      if (translationsData) {\n        // Create a MultilingualSurvey-compatible object from backend response\n        const multilingualData: MultilingualSurvey = {\n          ...translationsData,\n          originalLanguage: translationsData.original_language || 'th',\n          availableLanguages: translationsData.available_languages || ['th'],\n          translationStatus: 'none',\n          translations: translationsData.translations || {}\n        };\n        \n        setMultilingualSurvey(multilingualData);\n        \n        // Update translation status\n        const newStatus: Record<SupportedLanguage, TranslationStatus> = {\n          th: 'original',\n          en: 'pending',\n          'zh-CN': 'pending'\n        };\n        \n        // Check if translations exist in the response\n        if (translationsData.translations && typeof translationsData.translations === 'object') {\n          Object.keys(translationsData.translations).forEach((lang) => {\n            if (lang !== translationsData.original_language) {\n              newStatus[lang as SupportedLanguage] = 'translated';\n            }\n          });\n        }\n        \n        setTranslationStatus(newStatus);\n        setSelectedLanguage(translationsData.original_language || 'th');\n      }\n    } catch (err: any) {\n      console.error('Error loading survey:', err);\n      toast.error(t('surveys.admin.messages.loadError'));\n      navigate('/admin/surveys');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const checkOngoingTranslations = async () => {\n    if (!id) {return;}\n    \n    try {\n      // Get recent translation jobs for this survey\n      const jobs = await translationService.getTranslationJobs();\n      const surveyJobs = jobs.filter((job: any) => \n        job.entityId === id && \n        job.entityType === 'survey' &&\n        (job.status === 'pending' || job.status === 'processing')\n      );\n      \n      if (surveyJobs.length > 0) {\n        // Show notification that translations are in progress\n        toast('Translation in progress... The page will auto-refresh when complete.', {\n          duration: 5000,\n          icon: 'üîÑ'\n        });\n        \n        // Update status to pending for languages being translated\n        const newStatus = { ...translationStatus };\n        surveyJobs.forEach((job: any) => {\n          job.target_languages?.forEach((lang: string) => {\n            newStatus[lang as SupportedLanguage] = 'pending';\n          });\n        });\n        setTranslationStatus(newStatus);\n        setIsTranslating(true);\n        \n        // Poll for completion of any ongoing jobs\n        const pollInterval = setInterval(async () => {\n          try {\n            let allCompleted = true;\n            \n            for (const job of surveyJobs) {\n              const jobStatus = await translationService.getTranslationJob(job.id);\n              \n              if (jobStatus.status === 'completed') {\n                // Don't break yet, check all jobs\n                continue;\n              } else if (jobStatus.status === 'failed') {\n                allCompleted = false;\n                // Update specific job languages to error\n                const errorStatus = { ...translationStatus };\n                job.targetLanguages?.forEach((lang: string) => {\n                  errorStatus[lang as SupportedLanguage] = 'error';\n                });\n                setTranslationStatus(errorStatus);\n                \n                toast.error(`Translation failed for some languages: ${jobStatus.error || 'Unknown error'}`, {\n                  duration: 7000,\n                  icon: '‚ùå'\n                });\n              } else {\n                allCompleted = false;\n              }\n            }\n            \n            if (allCompleted) {\n              clearInterval(pollInterval);\n              setIsTranslating(false);\n              \n              // Show refreshing indicator\n              toast.loading('Refreshing survey with new translations...', {\n                duration: 2000,\n                icon: 'üîÑ'\n              });\n              \n              // Reload survey with translations\n              await loadSurvey();\n              \n              // Show refresh indicator\n              setJustRefreshed(true);\n              setTimeout(() => setJustRefreshed(false), 5000);\n              \n              // Success notification\n              toast.success('Translation completed! The page has been automatically refreshed.', {\n                duration: 7000,\n                icon: '‚úÖ'\n              });\n              \n              // Smooth scroll to top to show refreshed content\n              setTimeout(() => {\n                window.scrollTo({ top: 0, behavior: 'smooth' });\n              }, 1000);\n            }\n          } catch (error) {\n            console.error('Error polling ongoing translation jobs:', error);\n          }\n        }, 3000);\n        \n        // Stop polling after 5 minutes\n        setTimeout(() => {\n          clearInterval(pollInterval);\n          setIsTranslating(false);\n        }, 300000);\n      }\n    } catch (error) {\n      console.error('Error checking ongoing translations:', error);\n    }\n  };\n\n  const handleSurveyChange = (field: string, value: any) => {\n    setSurvey(prev => ({\n      ...prev,\n      [field]: value\n    }));\n  };\n\n  const handleTranslate = async (targetLanguages: SupportedLanguage[]) => {\n    if (!id) {\n      toast.error('Please save the survey before translating');\n      return;\n    }\n\n    try {\n      setIsTranslating(true);\n      \n      // Update status to pending for target languages\n      const newStatus = { ...translationStatus };\n      targetLanguages.forEach(lang => {\n        newStatus[lang] = 'pending';\n      });\n      setTranslationStatus(newStatus);\n\n      const result = await translationService.translateSurvey(id, selectedLanguage, targetLanguages);\n      \n      toast.success(`Translation started! Job ID: ${result.id}`, {\n        duration: 5000,\n        icon: 'üåê'\n      });\n\n      // Poll for translation completion\n      const pollInterval = setInterval(async () => {\n        try {\n          const jobStatus = await translationService.getTranslationJob(result.id);\n          \n          if (jobStatus.status === 'completed') {\n            clearInterval(pollInterval);\n            \n            // Show refreshing indicator\n            toast.loading('Refreshing survey with new translations...', {\n              duration: 2000,\n              icon: 'üîÑ'\n            });\n            \n            // Reload survey with translations\n            await loadSurvey();\n            \n            // Show refresh indicator\n            setJustRefreshed(true);\n            setTimeout(() => setJustRefreshed(false), 5000);\n            \n            // Success notification with auto-refresh info\n            toast.success('Translation completed! The page has been automatically refreshed with the translated content.', {\n              duration: 7000,\n              icon: '‚úÖ'\n            });\n            \n            // Force a brief UI update to highlight the change\n            setTimeout(() => {\n              window.scrollTo({ top: 0, behavior: 'smooth' });\n            }, 1000);\n          } else if (jobStatus.status === 'failed') {\n            clearInterval(pollInterval);\n            \n            // Update status to error\n            const errorStatus = { ...translationStatus };\n            targetLanguages.forEach(lang => {\n              errorStatus[lang] = 'error';\n            });\n            setTranslationStatus(errorStatus);\n            \n            toast.error(`Translation failed: ${jobStatus.error || 'Unknown error'}`, {\n              duration: 7000,\n              icon: '‚ùå'\n            });\n          }\n        } catch (error) {\n          console.error('Error polling translation job:', error);\n        }\n      }, 3000); // Poll every 3 seconds\n\n      // Stop polling after 2 minutes\n      setTimeout(() => {\n        clearInterval(pollInterval);\n      }, 120000);\n\n    } catch (err: any) {\n      console.error('Translation error:', err);\n      toast.error('Failed to start translation');\n      \n      // Reset status on error\n      const errorStatus = { ...translationStatus };\n      targetLanguages.forEach(lang => {\n        errorStatus[lang] = 'error';\n      });\n      setTranslationStatus(errorStatus);\n    } finally {\n      setIsTranslating(false);\n    }\n  };\n\n  const addQuestion = (type: QuestionType) => {\n    const newQuestion: SurveyQuestion = {\n      id: surveyService.generateQuestionId(),\n      type,\n      text: '',\n      required: true,\n      order: (survey.questions?.length || 0) + 1,\n      ...(type === 'multiple_choice' || type === 'single_choice' ? {\n        options: [\n          { id: surveyService.generateOptionId(), text: t('surveys.admin.questions.defaultOptions.option1'), value: '1' },\n          { id: surveyService.generateOptionId(), text: t('surveys.admin.questions.defaultOptions.option2'), value: '2' }\n        ]\n      } : {}),\n      ...(type === 'rating_5' ? { min_rating: 1, max_rating: 5 } : {}),\n      ...(type === 'rating_10' ? { min_rating: 1, max_rating: 10 } : {})\n    };\n\n    setSurvey(prev => ({\n      ...prev,\n      questions: [...(prev.questions || []), newQuestion]\n    }));\n  };\n\n  const updateQuestion = (questionId: string, updates: Partial<SurveyQuestion>) => {\n    setSurvey(prev => ({\n      ...prev,\n      questions: prev.questions?.map(q => \n        q.id === questionId ? { ...q, ...updates } : q\n      ) || []\n    }));\n  };\n\n  const removeQuestion = (questionId: string) => {\n    setSurvey(prev => ({\n      ...prev,\n      questions: prev.questions?.filter(q => q.id !== questionId) || []\n    }));\n  };\n\n  const reorderQuestions = (fromIndex: number, toIndex: number) => {\n    const questions = [...(survey.questions || [])];\n    const [removed] = questions.splice(fromIndex, 1);\n    questions.splice(toIndex, 0, removed);\n    \n    const reorderedQuestions = questions.map((q, index) => ({\n      ...q,\n      order: index + 1\n    }));\n\n    setSurvey(prev => ({\n      ...prev,\n      questions: reorderedQuestions\n    }));\n  };\n\n  const saveSurvey = async (status?: string) => {\n    if (!survey.title || !survey.questions?.length) {\n      toast.error(t('surveys.admin.validation.titleAndQuestionRequired'));\n      return;\n    }\n\n    if (!validationState.isValid) {\n      handleQuestionValidationErrors(validationState);\n      return;\n    }\n\n    try {\n      setSaving(true);\n      \n      const surveyData: CreateSurveyRequest = {\n        title: survey.title,\n        description: survey.description,\n        questions: survey.questions,\n        target_segment: survey.target_segment,\n        access_type: survey.access_type || 'public' as SurveyAccessType,\n        status: (status || survey.status) as SurveyStatus,\n        original_language: selectedLanguage,\n        available_languages: [selectedLanguage]\n      };\n\n      let surveyId = id;\n      \n      if (isEditing && id) {\n        await surveyService.updateSurvey(id, { ...surveyData, status: (status || survey.status) as SurveyStatus });\n        toast.success(t('surveys.admin.messages.updateSuccess'));\n      } else {\n        const newSurvey = await surveyService.createSurvey(surveyData);\n        surveyId = newSurvey.id;\n        toast.success(t('surveys.admin.messages.createSuccess'));\n        navigate(`/admin/surveys/${newSurvey.id}/edit`);\n      }\n\n      // Auto-translate when publishing (status = 'active')\n      if ((status || survey.status) === 'active' && surveyId) {\n        try {\n          setIsTranslating(true);\n          const targetLanguages: SupportedLanguage[] = (['en', 'zh-CN'] as SupportedLanguage[]).filter(lang => lang !== selectedLanguage);\n          \n          if (targetLanguages.length > 0) {\n            toast('Starting automatic translation to all languages...', {\n              duration: 3000,\n              icon: 'üåê'\n            });\n            \n            const translationJob = await translationService.translateSurvey(surveyId, selectedLanguage, targetLanguages);\n            \n            toast.success(`Auto-translation started! Job ID: ${translationJob.id}`, {\n              duration: 5000,\n              icon: 'üîÑ'\n            });\n          }\n        } catch (translationError) {\n          console.error('Auto-translation failed:', translationError);\n          toast.error('Survey published successfully, but auto-translation failed. You can translate manually later.', {\n            duration: 7000,\n            icon: '‚ö†Ô∏è'\n          });\n        } finally {\n          setIsTranslating(false);\n        }\n      }\n    } catch (err: any) {\n      const isValidationError = err.response?.status === 400;\n      const errorMessage = err.response?.data?.message || err.message || 'Failed to save survey';\n      \n      if (isValidationError) {\n        const backendErrors = err.response?.data?.validationErrors || [];\n        if (backendErrors.length > 0) {\n          const fieldErrors = backendErrors.map((error: any) => error.message || error.field).join(', ');\n          toast.error(t('surveys.admin.messages.validationFailed', { errors: fieldErrors }), {\n            duration: 6000,\n            icon: '‚ö†Ô∏è'\n          });\n        } else {\n          toast.error(errorMessage, { duration: 5000, icon: '‚ö†Ô∏è' });\n        }\n      } else {\n        toast.error(t('surveys.admin.messages.networkError', { message: errorMessage }), {\n          duration: 7000,\n          icon: 'üîå'\n        });\n      }\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  // Get display content based on selected language\n  const getDisplayContent = () => {\n    if (!multilingualSurvey || selectedLanguage === multilingualSurvey.originalLanguage) {\n      return survey;\n    }\n\n    // Check if translations exist (backend may not return translations structure)\n    if (!multilingualSurvey.translations || typeof multilingualSurvey.translations !== 'object') {\n      return survey;\n    }\n\n    const translation = multilingualSurvey.translations[selectedLanguage];\n    if (!translation) {\n      return survey;\n    }\n\n    return {\n      ...survey,\n      title: translation.title || survey.title,\n      description: translation.description || survey.description,\n      questions: translation.questions || survey.questions\n    };\n  };\n\n  const displayContent = getDisplayContent();\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-4xl mx-auto p-4\">\n          <div className=\"flex justify-center items-center h-64\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\" />\n            <span className=\"ml-3 text-gray-600\">{t('surveys.admin.surveyBuilder.loading')}</span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center py-6\">\n            <div className=\"flex items-center\">\n              <h1 className=\"text-2xl font-bold text-gray-900\">\n                {isEditing ? t('surveys.admin.surveyBuilder.pageTitle.edit') : t('surveys.admin.surveyBuilder.pageTitle.create')}\n              </h1>\n              {isTranslating && (\n                <div className=\"ml-4 flex items-center text-sm text-blue-600\">\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2\" />\n                  <span>Translation in progress...</span>\n                </div>\n              )}\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <button\n                onClick={() => setShowPreview(!showPreview)}\n                className=\"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n              >\n                <FiEye className=\"mr-2 h-4 w-4\" />\n                {showPreview ? t('surveys.admin.surveyBuilder.hidePreview') : t('surveys.admin.surveyBuilder.preview')}\n              </button>\n              <LanguageSwitcher />\n              <DashboardButton variant=\"outline\" size=\"md\" />\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"max-w-4xl mx-auto p-4\">\n        {showPreview ? (\n          <SurveyPreview survey={displayContent as Survey} onClose={() => setShowPreview(false)} />\n        ) : (\n          <div className=\"space-y-6\">\n            {/* Language Tabs */}\n            {isEditing && (\n              <LanguageTabs\n                languages={['th', 'en', 'zh-CN']}\n                currentLanguage={selectedLanguage}\n                onLanguageChange={setSelectedLanguage}\n                translationStatus={translationStatus}\n              />\n            )}\n\n            {/* Auto-refresh Notice */}\n            {justRefreshed && (\n              <div className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\n                <div className=\"flex\">\n                  <div className=\"flex-shrink-0\">\n                    <div className=\"h-5 w-5 text-green-400\">‚úÖ</div>\n                  </div>\n                  <div className=\"ml-3\">\n                    <p className=\"text-sm text-green-700 font-medium\">\n                      Content updated! The page has been automatically refreshed with the latest translations.\n                    </p>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Translation Notice */}\n            {selectedLanguage !== 'th' && translationStatus[selectedLanguage] === 'translated' && (\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                <div className=\"flex\">\n                  <FiGlobe className=\"h-5 w-5 text-blue-400 mt-0.5\" />\n                  <div className=\"ml-3\">\n                    <p className=\"text-sm text-blue-700\">\n                      You are viewing the {selectedLanguage === 'en' ? 'English' : 'Chinese'} translation.\n                      To edit the original content, switch to Thai language.\n                    </p>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Basic Information */}\n            <div className=\"bg-white shadow rounded-lg p-6\">\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">{t('surveys.admin.basicInfo.title')}</h2>\n              \n              <div className=\"space-y-4\">\n                <div>\n                  <label htmlFor=\"title\" className=\"block text-sm font-medium text-gray-700\">\n                    {t('surveys.admin.basicInfo.surveyTitle')}\n                  </label>\n                  <input\n                    type=\"text\"\n                    id=\"title\"\n                    value={displayContent.title || ''}\n                    onChange={(e) => handleSurveyChange('title', e.target.value)}\n                    disabled={isEditing && selectedLanguage !== multilingualSurvey?.originalLanguage}\n                    className=\"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm disabled:bg-gray-100\"\n                    placeholder={t('surveys.admin.basicInfo.surveyTitlePlaceholder')}\n                  />\n                </div>\n\n                <div>\n                  <label htmlFor=\"description\" className=\"block text-sm font-medium text-gray-700\">\n                    {t('surveys.admin.basicInfo.description')}\n                  </label>\n                  <textarea\n                    id=\"description\"\n                    rows={3}\n                    value={displayContent.description || ''}\n                    onChange={(e) => handleSurveyChange('description', e.target.value)}\n                    disabled={isEditing && selectedLanguage !== multilingualSurvey?.originalLanguage}\n                    className=\"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm disabled:bg-gray-100\"\n                    placeholder={t('surveys.admin.basicInfo.descriptionPlaceholder')}\n                  />\n                </div>\n\n                <div>\n                  <label htmlFor=\"status\" className=\"block text-sm font-medium text-gray-700\">\n                    {t('surveys.admin.basicInfo.status')}\n                  </label>\n                  <select\n                    id=\"status\"\n                    value={survey.status || 'draft'}\n                    onChange={(e) => handleSurveyChange('status', e.target.value)}\n                    className=\"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm\"\n                  >\n                    <option value=\"draft\">{t('surveys.admin.basicInfo.statusOptions.draft')}</option>\n                    <option value=\"active\">{t('surveys.admin.basicInfo.statusOptions.active')}</option>\n                    <option value=\"paused\">{t('surveys.admin.basicInfo.statusOptions.paused')}</option>\n                    <option value=\"completed\">{t('surveys.admin.basicInfo.statusOptions.completed')}</option>\n                    <option value=\"archived\">{t('surveys.admin.basicInfo.statusOptions.archived')}</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label htmlFor=\"access_type\" className=\"block text-sm font-medium text-gray-700\">\n                    {t('surveys.admin.basicInfo.accessType')}\n                  </label>\n                  <select\n                    id=\"access_type\"\n                    value={survey.access_type || 'public'}\n                    onChange={(e) => handleSurveyChange('access_type', e.target.value)}\n                    className=\"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm\"\n                  >\n                    <option value=\"public\">{t('surveys.admin.basicInfo.accessTypeOptions.public')}</option>\n                    <option value=\"invite_only\">{t('surveys.admin.basicInfo.accessTypeOptions.inviteOnly')}</option>\n                  </select>\n                  <p className=\"mt-2 text-sm text-gray-500\">\n                    {survey.access_type === 'public' \n                      ? t('surveys.admin.basicInfo.accessTypeDescriptions.public')\n                      : t('surveys.admin.basicInfo.accessTypeDescriptions.inviteOnly')\n                    }\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* Questions */}\n            <div className=\"bg-white shadow rounded-lg p-6\">\n              <div className=\"flex justify-between items-center mb-4\">\n                <h2 className=\"text-lg font-medium text-gray-900\">{t('surveys.admin.questions.title')}</h2>\n                <div className=\"flex items-center space-x-2\">\n                  <span className=\"text-sm text-gray-500\">\n                    {t('surveys.admin.questions.count', { count: displayContent.questions?.length || 0 })}\n                  </span>\n                </div>\n              </div>\n\n              <div className=\"space-y-4\">\n                {displayContent.questions?.map((question: any, index: number) => (\n                  <QuestionEditor\n                    key={question.id}\n                    question={question}\n                    index={index}\n                    questionNumber={index + 1}\n                    onUpdate={(updates) => updateQuestion(question.id, updates)}\n                    onRemove={() => removeQuestion(question.id)}\n                    onReorder={reorderQuestions}\n                    canMove={displayContent.questions!.length > 1}\n                    disabled={isEditing && selectedLanguage !== multilingualSurvey?.originalLanguage}\n                  />\n                ))}\n\n                {displayContent.questions?.length === 0 && (\n                  <div className=\"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg\">\n                    <p className=\"text-gray-500 mb-4\">{t('surveys.admin.questions.noQuestions')}</p>\n                  </div>\n                )}\n              </div>\n\n              {/* Add Question Buttons - only show in original language */}\n              {(!isEditing || selectedLanguage === multilingualSurvey?.originalLanguage) && (\n                <div className=\"mt-6 pt-6 border-t border-gray-200\">\n                  <h3 className=\"text-sm font-medium text-gray-700 mb-3\">{t('surveys.admin.questions.addQuestion')}</h3>\n                  <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\n                    <button\n                      onClick={() => addQuestion('single_choice')}\n                      className=\"flex items-center justify-center px-4 py-3 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n                    >\n                      <FiPlus className=\"mr-2 h-4 w-4\" />\n                      {t('surveys.admin.questions.questionTypes.singleChoice')}\n                    </button>\n                    <button\n                      onClick={() => addQuestion('multiple_choice')}\n                      className=\"flex items-center justify-center px-4 py-3 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n                    >\n                      <FiPlus className=\"mr-2 h-4 w-4\" />\n                      {t('surveys.admin.questions.questionTypes.multipleChoice')}\n                    </button>\n                    <button\n                      onClick={() => addQuestion('text')}\n                      className=\"flex items-center justify-center px-4 py-3 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n                    >\n                      <FiPlus className=\"mr-2 h-4 w-4\" />\n                      {t('surveys.admin.questions.questionTypes.text')}\n                    </button>\n                    <button\n                      onClick={() => addQuestion('textarea')}\n                      className=\"flex items-center justify-center px-4 py-3 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n                    >\n                      <FiPlus className=\"mr-2 h-4 w-4\" />\n                      {t('surveys.admin.questions.questionTypes.textarea')}\n                    </button>\n                    <button\n                      onClick={() => addQuestion('rating_5')}\n                      className=\"flex items-center justify-center px-4 py-3 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n                    >\n                      <FiPlus className=\"mr-2 h-4 w-4\" />\n                      {t('surveys.admin.questions.questionTypes.rating5')}\n                    </button>\n                    <button\n                      onClick={() => addQuestion('rating_10')}\n                      className=\"flex items-center justify-center px-4 py-3 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n                    >\n                      <FiPlus className=\"mr-2 h-4 w-4\" />\n                      {t('surveys.admin.questions.questionTypes.rating10')}\n                    </button>\n                    <button\n                      onClick={() => addQuestion('yes_no')}\n                      className=\"flex items-center justify-center px-4 py-3 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n                    >\n                      <FiPlus className=\"mr-2 h-4 w-4\" />\n                      {t('surveys.admin.questions.questionTypes.yesNo')}\n                    </button>\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* Save Actions */}\n            <div className=\"bg-white shadow rounded-lg p-6\">\n              <div className=\"flex justify-between items-center\">\n                <button\n                  onClick={() => navigate('/admin/surveys')}\n                  className=\"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n                >\n                  {t('surveys.admin.surveyBuilder.cancel')}\n                </button>\n                \n                <div className=\"flex items-center space-x-3\">\n                  {/* Validation Status Indicator */}\n                  {survey.questions && survey.questions.length > 0 && (\n                    <div className=\"flex items-center text-sm\">\n                      {validationState.isValid ? (\n                        <span className=\"flex items-center text-green-600\">\n                          <span className=\"w-2 h-2 bg-green-500 rounded-full mr-2\" />\n                          {t('surveys.admin.validation.readyToSave')}\n                        </span>\n                      ) : (\n                        <span className=\"flex items-center text-amber-600\">\n                          <span className=\"w-2 h-2 bg-amber-500 rounded-full mr-2\" />\n                          {validationState.emptyQuestions.length === 1 \n                            ? t('surveys.admin.validation.needsAttention', { count: validationState.emptyQuestions.length })\n                            : t('surveys.admin.validation.needsAttentionPlural', { count: validationState.emptyQuestions.length })\n                          }\n                        </span>\n                      )}\n                    </div>\n                  )}\n                  \n                  <button\n                    onClick={() => saveSurvey('draft')}\n                    disabled={saving || (isEditing && selectedLanguage !== multilingualSurvey?.originalLanguage)}\n                    className=\"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50\"\n                  >\n                    <FiSave className=\"mr-2 h-4 w-4\" />\n                    {t('surveys.admin.saveDraft')}\n                  </button>\n                  \n                  <button\n                    onClick={() => saveSurvey('active')}\n                    disabled={saving || (isEditing && selectedLanguage !== multilingualSurvey?.originalLanguage)}\n                    className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50\"\n                  >\n                    {saving && <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\" />}\n                    {isEditing ? t('surveys.admin.updateAndPublish') : t('surveys.admin.createAndPublish')}\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default SurveyBuilderWithTranslation;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/admin/SurveyInvitations.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedTier' is assigned a value but never used.","line":45,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":45,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSelectedTier' is assigned a value but never used.","line":45,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":45,"endColumn":39},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":58,"column":6,"nodeType":"ArrayExpression","endLine":58,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [id, loadData]","fix":{"range":[1815,1819],"text":"[id, loadData]"}}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":65,"column":60,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":65,"endColumn":63},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":69,"column":72,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":69,"endColumn":75},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2701,2704],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2701,2704],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":83,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":83,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2714,2756],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-alert","severity":1,"message":"Unexpected confirm.","line":91,"column":10,"nodeType":"CallExpression","messageId":"unexpected","endLine":91,"endColumn":85},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":97,"column":64,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":97,"endColumn":67},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3229,3232],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3229,3232],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":101,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":101,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3242,3291],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3651,3654],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3651,3654],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":114,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":114,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3664,3714],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":125,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4054,4057],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4054,4057],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":126,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":126,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4067,4110],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-alert","severity":1,"message":"Unexpected confirm.","line":156,"column":10,"nodeType":"CallExpression","messageId":"unexpected","endLine":156,"endColumn":103},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":164,"column":71,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":164,"endColumn":74},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":175,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5461,5464],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5461,5464],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":176,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":176,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5474,5532],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadUsers'. Either include it or remove the dependency array.","line":191,"column":6,"nodeType":"ArrayExpression","endLine":191,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [userSearch, showUserSelection, loadUsers]","fix":{"range":[5875,5906],"text":"[userSearch, showUserSelection, loadUsers]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":20,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useParams, Link } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { \n  FiArrowLeft, \n  FiSend, \n  FiUsers, \n  FiMail,\n  FiClock,\n  FiCheckCircle,\n  FiAlertCircle,\n  FiFilter,\n  FiSearch,\n  FiUserPlus,\n  FiX\n} from 'react-icons/fi';\nimport { Survey, SurveyInvitation } from '../../types/survey';\nimport { surveyService } from '../../services/surveyService';\nimport { User, userService } from '../../services/userService';\nimport DashboardButton from '../../components/navigation/DashboardButton';\nimport toast from 'react-hot-toast';\n\ninterface InvitationStats {\n  total: number;\n  sent: number;\n  viewed: number;\n  started: number;\n  completed: number;\n}\n\nconst SurveyInvitations: React.FC = () => {\n  const { id } = useParams<{ id: string }>();\n  const { t } = useTranslation();\n  const [survey, setSurvey] = useState<Survey | null>(null);\n  const [invitations, setInvitations] = useState<SurveyInvitation[]>([]);\n  const [stats, setStats] = useState<InvitationStats>({\n    total: 0,\n    sent: 0,\n    viewed: 0,\n    started: 0,\n    completed: 0\n  });\n  const [loading, setLoading] = useState(true);\n  const [sending, setSending] = useState(false);\n  const [selectedTier, setSelectedTier] = useState<string>('all');\n  const [selectedStatus, setSelectedStatus] = useState<string>('all');\n  const [showUserSelection, setShowUserSelection] = useState(false);\n  const [users, setUsers] = useState<User[]>([]);\n  const [selectedUsers, setSelectedUsers] = useState<Set<string>>(new Set());\n  const [userSearch, setUserSearch] = useState('');\n  const [loadingUsers, setLoadingUsers] = useState(false);\n  const [sendingToUsers, setSendingToUsers] = useState(false);\n\n  useEffect(() => {\n    if (id) {\n      loadData();\n    }\n  }, [id]);\n\n  const loadData = async () => {\n    try {\n      setLoading(true);\n      \n      // Load survey details\n      const surveyData = await surveyService.getSurveyById(id!);\n      setSurvey(surveyData);\n      \n      // Load invitations\n      const invitationsData = await surveyService.getSurveyInvitations(id!);\n      setInvitations(invitationsData);\n      \n      // Calculate stats\n      const newStats: InvitationStats = {\n        total: invitationsData.length,\n        sent: invitationsData.filter(i => i.status !== 'pending').length,\n        viewed: invitationsData.filter(i => ['viewed', 'started', 'completed'].includes(i.status)).length,\n        started: invitationsData.filter(i => ['started', 'completed'].includes(i.status)).length,\n        completed: invitationsData.filter(i => i.status === 'completed').length\n      };\n      setStats(newStats);\n      \n    } catch (err: any) {\n      console.error('Error loading data:', err);\n      toast.error('Failed to load survey invitations');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSendInvitations = async () => {\n    if (!confirm('Are you sure you want to send invitations to all eligible users?')) {\n      return;\n    }\n\n    try {\n      setSending(true);\n      const result = await surveyService.sendSurveyInvitations(id!);\n      toast.success(`Successfully sent ${result.sent} invitations`);\n      loadData();\n    } catch (err: any) {\n      console.error('Error sending invitations:', err);\n      toast.error(err.response?.data?.message || 'Failed to send invitations');\n    } finally {\n      setSending(false);\n    }\n  };\n\n  const handleResendInvitation = async (invitationId: string) => {\n    try {\n      await surveyService.resendInvitation(invitationId);\n      toast.success('Invitation resent successfully');\n      loadData();\n    } catch (err: any) {\n      console.error('Error resending invitation:', err);\n      toast.error('Failed to resend invitation');\n    }\n  };\n\n  const loadUsers = async () => {\n    try {\n      setLoadingUsers(true);\n      const result = await userService.getAllUsers(1, 100, userSearch);\n      const customerUsers = result.users.filter(user => user.role === 'customer');\n      setUsers(customerUsers);\n    } catch (err: any) {\n      console.error('Error loading users:', err);\n      toast.error('Failed to load users');\n    } finally {\n      setLoadingUsers(false);\n    }\n  };\n\n  const handleShowUserSelection = () => {\n    setShowUserSelection(true);\n    if (users.length === 0) {\n      loadUsers();\n    }\n  };\n\n  const handleUserSelectionToggle = (userId: string) => {\n    const newSelection = new Set(selectedUsers);\n    if (newSelection.has(userId)) {\n      newSelection.delete(userId);\n    } else {\n      newSelection.add(userId);\n    }\n    setSelectedUsers(newSelection);\n  };\n\n  const handleSendToSelectedUsers = async () => {\n    if (selectedUsers.size === 0) {\n      toast.error('Please select at least one user');\n      return;\n    }\n\n    if (!confirm(`Are you sure you want to send invitations to ${selectedUsers.size} selected users?`)) {\n      return;\n    }\n\n    try {\n      setSendingToUsers(true);\n      const userIdsArray = Array.from(selectedUsers);\n      \n      const result = await surveyService.sendSurveyInvitationsToUsers(id!, userIdsArray);\n      \n      if (result.sent === 0) {\n        toast.error(`No invitations were sent. Users may not match targeting criteria or already have invitations.`);\n      } else {\n        toast.success(`Successfully sent ${result.sent} invitations`);\n      }\n      \n      setShowUserSelection(false);\n      setSelectedUsers(new Set());\n      loadData();\n    } catch (err: any) {\n      console.error('Error sending invitations to users:', err);\n      toast.error(err.response?.data?.message || 'Failed to send invitations');\n    } finally {\n      setSendingToUsers(false);\n    }\n  };\n\n  // Debounced user search\n  useEffect(() => {\n    if (showUserSelection) {\n      const timer = setTimeout(() => {\n        loadUsers();\n      }, 300);\n      return () => clearTimeout(timer);\n    }\n  }, [userSearch, showUserSelection]);\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'pending':\n        return (<span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800\">\n          <FiClock className=\"mr-1 h-3 w-3\" /> Pending\n                </span>);\n      case 'sent':\n        return (<span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">\n          <FiMail className=\"mr-1 h-3 w-3\" /> Sent\n                </span>);\n      case 'viewed':\n        return (<span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800\">\n          <FiAlertCircle className=\"mr-1 h-3 w-3\" /> Viewed\n                </span>);\n      case 'started':\n        return (<span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800\">\n          <FiClock className=\"mr-1 h-3 w-3\" /> In Progress\n                </span>);\n      case 'completed':\n        return (<span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\n          <FiCheckCircle className=\"mr-1 h-3 w-3\" /> Completed\n                </span>);\n      default:\n        return null;\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-7xl mx-auto p-4\">\n          <div className=\"flex justify-center items-center h-64\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\" />\n            <span className=\"ml-3 text-gray-600\">Loading invitations...</span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!survey) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-7xl mx-auto p-4\">\n          <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md\">\n            <p>Survey not found</p>\n            <Link to=\"/admin/surveys\" className=\"text-red-800 underline mt-2 inline-block\">\n              Back to Surveys\n            </Link>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Show message for public surveys (invitations not needed)\n  if (survey.access_type === 'public') {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        {/* Header */}\n        <header className=\"bg-white shadow\">\n          <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div className=\"flex justify-between items-center py-6\">\n              <div className=\"flex items-center\">\n                <Link\n                  to=\"/admin/surveys\"\n                  className=\"mr-4 text-gray-400 hover:text-gray-600\"\n                >\n                  <FiArrowLeft className=\"h-6 w-6\" />\n                </Link>\n                <div>\n                  <h1 className=\"text-3xl font-bold text-gray-900\">Survey Invitations</h1>\n                  <p className=\"text-sm text-gray-600 mt-1\">{survey.title}</p>\n                </div>\n              </div>\n              <div className=\"flex items-center space-x-4\">\n                <DashboardButton variant=\"outline\" size=\"md\" />\n              </div>\n            </div>\n          </div>\n        </header>\n\n        {/* Content */}\n        <main className=\"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8\">\n          <div className=\"px-4 py-6 sm:px-0\">\n            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-8 text-center\">\n              <FiUsers className=\"mx-auto h-12 w-12 text-blue-600 mb-4\" />\n              <h3 className=\"text-lg font-medium text-blue-900 mb-2\">\n                {t('surveys.admin.invitations.publicSurveyTitle')}\n              </h3>\n              <p className=\"text-blue-800 mb-4\">\n                {t('surveys.admin.invitations.publicSurveyDescription')}\n              </p>\n              <div className=\"space-y-2 text-sm text-blue-700\">\n                <p><strong>{t('surveys.admin.invitations.surveyType')}:</strong> {t('surveys.admin.invitations.publicSurveyType')}</p>\n                <p><strong>Status:</strong> {survey.status}</p>\n                <p><strong>Questions:</strong> {survey.questions.length}</p>\n                <p><strong>Availability:</strong> All users can access this survey</p>\n              </div>\n              <div className=\"mt-6 space-x-4\">\n                <Link\n                  to={`/admin/surveys/${survey.id}/analytics`}\n                  className=\"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700\"\n                >\n                  View Analytics\n                </Link>\n                <Link\n                  to={`/admin/surveys/${survey.id}/edit`}\n                  className=\"inline-flex items-center px-4 py-2 border border-blue-300 rounded-md shadow-sm text-sm font-medium text-blue-700 bg-white hover:bg-blue-50\"\n                >\n                  Edit Survey\n                </Link>\n              </div>\n            </div>\n          </div>\n        </main>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center py-6\">\n            <div className=\"flex items-center\">\n              <Link\n                to=\"/admin/surveys\"\n                className=\"mr-4 text-gray-400 hover:text-gray-600\"\n              >\n                <FiArrowLeft className=\"h-6 w-6\" />\n              </Link>\n              <div>\n                <h1 className=\"text-3xl font-bold text-gray-900\">Survey Invitations</h1>\n                <p className=\"text-sm text-gray-600 mt-1\">{survey.title}</p>\n              </div>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <button\n                onClick={handleShowUserSelection}\n                disabled={survey.status !== 'active'}\n                className=\"inline-flex items-center px-4 py-2 border border-blue-300 rounded-md shadow-sm text-sm font-medium text-blue-700 bg-white hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                <FiUserPlus className=\"mr-2 h-4 w-4\" />\n                Select Users\n              </button>\n              <button\n                onClick={handleSendInvitations}\n                disabled={sending || survey.status !== 'active'}\n                className=\"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                <FiSend className=\"mr-2 h-4 w-4\" />\n                {sending ? 'Sending...' : 'Send to All Eligible'}\n              </button>\n              <DashboardButton variant=\"outline\" size=\"md\" />\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Content */}\n      <main className=\"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8\">\n        <div className=\"px-4 py-6 sm:px-0\">\n          {/* Stats */}\n          <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4 mb-8\">\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <div className=\"flex items-center\">\n                <div className=\"flex-shrink-0\">\n                  <FiUsers className=\"h-8 w-8 text-gray-400\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"text-sm font-medium text-gray-500\">Total Invitations</p>\n                  <p className=\"text-2xl font-semibold text-gray-900\">{stats.total}</p>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <div className=\"flex items-center\">\n                <div className=\"flex-shrink-0\">\n                  <FiMail className=\"h-8 w-8 text-blue-500\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"text-sm font-medium text-gray-500\">Sent</p>\n                  <p className=\"text-2xl font-semibold text-gray-900\">{stats.sent}</p>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <div className=\"flex items-center\">\n                <div className=\"flex-shrink-0\">\n                  <FiAlertCircle className=\"h-8 w-8 text-yellow-500\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"text-sm font-medium text-gray-500\">Viewed</p>\n                  <p className=\"text-2xl font-semibold text-gray-900\">{stats.viewed}</p>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <div className=\"flex items-center\">\n                <div className=\"flex-shrink-0\">\n                  <FiClock className=\"h-8 w-8 text-purple-500\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"text-sm font-medium text-gray-500\">Started</p>\n                  <p className=\"text-2xl font-semibold text-gray-900\">{stats.started}</p>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <div className=\"flex items-center\">\n                <div className=\"flex-shrink-0\">\n                  <FiCheckCircle className=\"h-8 w-8 text-green-500\" />\n                </div>\n                <div className=\"ml-4\">\n                  <p className=\"text-sm font-medium text-gray-500\">Completed</p>\n                  <p className=\"text-2xl font-semibold text-gray-900\">{stats.completed}</p>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Filters */}\n          <div className=\"bg-white rounded-lg shadow p-4 mb-6\">\n            <div className=\"flex items-center space-x-4\">\n              <FiFilter className=\"h-5 w-5 text-gray-400\" />\n              <select\n                value={selectedStatus}\n                onChange={(e) => setSelectedStatus(e.target.value)}\n                className=\"block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md\"\n              >\n                <option value=\"all\">All Status</option>\n                <option value=\"pending\">Pending</option>\n                <option value=\"sent\">Sent</option>\n                <option value=\"viewed\">Viewed</option>\n                <option value=\"started\">Started</option>\n                <option value=\"completed\">Completed</option>\n              </select>\n            </div>\n          </div>\n\n          {/* Invitations List */}\n          <div className=\"bg-white shadow overflow-hidden sm:rounded-lg\">\n            <div className=\"px-4 py-5 sm:px-6\">\n              <h3 className=\"text-lg leading-6 font-medium text-gray-900\">\n                Invitation Recipients\n              </h3>\n            </div>\n            {invitations.length > 0 ? (\n              <div className=\"border-t border-gray-200\">\n                <ul className=\"divide-y divide-gray-200\">\n                  {invitations\n                    .filter(inv => selectedStatus === 'all' || inv.status === selectedStatus)\n                    .map((invitation) => (\n                    <li key={invitation.id} className=\"px-4 py-4 sm:px-6\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center min-w-0\">\n                          <div className=\"flex-shrink-0\">\n                            <div className=\"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center\">\n                              <FiUsers className=\"h-5 w-5 text-gray-600\" />\n                            </div>\n                          </div>\n                          <div className=\"ml-4 min-w-0\">\n                            <p className=\"text-sm font-medium text-gray-900 truncate\">\n                              User ID: {invitation.user_id}\n                            </p>\n                            <p className=\"text-sm text-gray-500\">\n                              Invited: {new Date(invitation.created_at).toLocaleDateString()}\n                              {invitation.sent_at && ` ‚Ä¢ Sent: ${new Date(invitation.sent_at).toLocaleDateString()}`}\n                            </p>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center space-x-4\">\n                          {getStatusBadge(invitation.status)}\n                          {invitation.status === 'pending' && (\n                            <button\n                              onClick={() => handleResendInvitation(invitation.id)}\n                              className=\"text-blue-600 hover:text-blue-800 text-sm font-medium\"\n                            >\n                              Send Now\n                            </button>\n                          )}\n                        </div>\n                      </div>\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            ) : (\n              <div className=\"border-t border-gray-200 p-6 text-center\">\n                <FiUsers className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n                <p className=\"text-gray-500\">No invitations sent yet</p>\n                {survey.status === 'active' && (\n                  <button\n                    onClick={handleSendInvitations}\n                    className=\"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700\"\n                  >\n                    <FiSend className=\"mr-2 h-4 w-4\" />\n                    Send First Invitations\n                  </button>\n                )}\n              </div>\n            )}\n          </div>\n        </div>\n      </main>\n\n      {/* User Selection Modal */}\n      {showUserSelection && (\n        <div className=\"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50\">\n          <div className=\"relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"text-lg font-bold text-gray-900\">Select Users to Invite</h3>\n              <button\n                onClick={() => setShowUserSelection(false)}\n                className=\"text-gray-400 hover:text-gray-600\"\n              >\n                <FiX className=\"h-6 w-6\" />\n              </button>\n            </div>\n\n            {/* Search */}\n            <div className=\"mb-4\">\n              <div className=\"relative\">\n                <FiSearch className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5\" />\n                <input\n                  type=\"text\"\n                  placeholder=\"Search users by email or name...\"\n                  value={userSearch}\n                  onChange={(e) => setUserSearch(e.target.value)}\n                  className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500\"\n                />\n              </div>\n            </div>\n\n            {/* Selected count */}\n            {selectedUsers.size > 0 && (\n              <div className=\"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md\">\n                <p className=\"text-sm text-blue-800\">\n                  {selectedUsers.size} user{selectedUsers.size === 1 ? '' : 's'} selected\n                </p>\n              </div>\n            )}\n\n            {/* Users list */}\n            <div className=\"max-h-96 overflow-y-auto border border-gray-200 rounded-md\">\n              {loadingUsers ? (\n                <div className=\"flex justify-center items-center p-8\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500\" />\n                  <span className=\"ml-3 text-gray-600\">Loading users...</span>\n                </div>\n              ) : users.length > 0 ? (\n                <div className=\"divide-y divide-gray-200\">\n                  {users.map((user) => (\n                    <div key={user.id} className=\"flex items-center p-4 hover:bg-gray-50\">\n                      <input\n                        type=\"checkbox\"\n                        checked={selectedUsers.has(user.id)}\n                        onChange={() => handleUserSelectionToggle(user.id)}\n                        className=\"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\n                      />\n                      <div className=\"ml-3 flex-1\">\n                        <div className=\"flex items-center\">\n                          <p className=\"text-sm font-medium text-gray-900\">\n                            {user.firstName} {user.lastName}\n                          </p>\n                          <span className=\"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800\">\n                            {user.role}\n                          </span>\n                        </div>\n                        <p className=\"text-sm text-gray-500\">{user.email}</p>\n                        <p className=\"text-xs text-gray-400\">\n                          Joined: {new Date(user.createdAt).toLocaleDateString()}\n                        </p>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"p-8 text-center text-gray-500\">\n                  <FiUsers className=\"mx-auto h-12 w-12 mb-4\" />\n                  <p>No users found</p>\n                  {userSearch && (\n                    <p className=\"text-sm mt-1\">Try adjusting your search terms</p>\n                  )}\n                </div>\n              )}\n            </div>\n\n            {/* Actions */}\n            <div className=\"flex justify-end space-x-3 mt-6\">\n              <button\n                onClick={() => setShowUserSelection(false)}\n                className=\"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleSendToSelectedUsers}\n                disabled={selectedUsers.size === 0 || sendingToUsers}\n                className=\"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                <FiSend className=\"mr-2 h-4 w-4\" />\n                {sendingToUsers ? 'Sending...' : `Send Invitations (${selectedUsers.size})`}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default SurveyInvitations;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/admin/SurveyManagement.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSurveys'. Either include it or remove the dependency array.","line":23,"column":6,"nodeType":"ArrayExpression","endLine":23,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [currentPage, loadSurveys, statusFilter]","fix":{"range":[1143,1170],"text":"[currentPage, loadSurveys, statusFilter]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1466,1469],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1466,1469],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":34,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":34,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1479,1524],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-alert","severity":1,"message":"Unexpected confirm.","line":43,"column":10,"nodeType":"CallExpression","messageId":"unexpected","endLine":43,"endColumn":95},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2025,2028],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2025,2028],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":52,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":52,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2038,2083],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2782,2785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2782,2785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":70,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":70,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2795,2844],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Link } from 'react-router-dom';\nimport { FiPlus, FiEdit, FiTrash2, FiEye, FiBarChart, FiDownload, FiUsers, FiFileText, FiMail, FiGlobe, FiLock, FiGift } from 'react-icons/fi';\nimport { Survey } from '../../types/survey';\nimport { surveyService } from '../../services/surveyService';\nimport DashboardButton from '../../components/navigation/DashboardButton';\nimport SurveyCouponAssignments from '../../components/surveys/SurveyCouponAssignments';\nimport toast from 'react-hot-toast';\n\nconst SurveyManagement: React.FC = () => {\n  const { t } = useTranslation();\n  const [surveys, setSurveys] = useState<Survey[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [statusFilter, setStatusFilter] = useState<string>('');\n  const [selectedSurveyForCoupons, setSelectedSurveyForCoupons] = useState<Survey | null>(null);\n\n  useEffect(() => {\n    loadSurveys();\n  }, [currentPage, statusFilter]);\n\n  const loadSurveys = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      \n      const response = await surveyService.getSurveys(currentPage, 10, statusFilter);\n      setSurveys(response.surveys);\n      setTotalPages(response.pagination.totalPages);\n    } catch (err: any) {\n      console.error('Error loading surveys:', err);\n      setError(err.response?.data?.message || 'Failed to load surveys');\n      toast.error('Failed to load surveys');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDeleteSurvey = async (surveyId: string) => {\n    if (!confirm('Are you sure you want to delete this survey? This action cannot be undone.')) {\n      return;\n    }\n\n    try {\n      await surveyService.deleteSurvey(surveyId);\n      toast.success('Survey deleted successfully');\n      loadSurveys();\n    } catch (err: any) {\n      console.error('Error deleting survey:', err);\n      toast.error(err.response?.data?.message || 'Failed to delete survey');\n    }\n  };\n\n  const handleExportResponses = async (surveyId: string, surveyTitle: string) => {\n    try {\n      const blob = await surveyService.exportSurveyResponses(surveyId);\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `survey-${surveyTitle.replace(/[^a-z0-9]/gi, '-').toLowerCase()}-responses.csv`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      window.URL.revokeObjectURL(url);\n      toast.success('Survey responses exported successfully');\n    } catch (err: any) {\n      console.error('Error exporting responses:', err);\n      toast.error('Failed to export survey responses');\n    }\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'active': return 'bg-green-100 text-green-800';\n      case 'draft': return 'bg-gray-100 text-gray-800';\n      case 'paused': return 'bg-yellow-100 text-yellow-800';\n      case 'completed': return 'bg-blue-100 text-blue-800';\n      case 'archived': return 'bg-red-100 text-red-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const getAccessTypeColor = (accessType: string) => {\n    switch (accessType) {\n      case 'public': return 'bg-blue-50 text-blue-700 border-blue-200';\n      case 'invite_only': return 'bg-purple-50 text-purple-700 border-purple-200';\n      default: return 'bg-gray-50 text-gray-700 border-gray-200';\n    }\n  };\n\n  const getAccessTypeLabel = (accessType: string) => {\n    switch (accessType) {\n      case 'public': return (\n        <>\n          <FiGlobe className=\"mr-1 h-3 w-3\" />\n          Public\n        </>\n      );\n      case 'invite_only': return (\n        <>\n          <FiLock className=\"mr-1 h-3 w-3\" />\n          Invite Only\n        </>\n      );\n      default: return 'Unknown';\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-7xl mx-auto p-4\">\n          <div className=\"flex justify-center items-center h-64\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\" />\n            <span className=\"ml-3 text-gray-600\">Loading surveys...</span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center py-6\">\n            <div className=\"flex items-center\">\n              <h1 className=\"text-3xl font-bold text-gray-900\">Survey Management</h1>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <DashboardButton variant=\"outline\" size=\"md\" />\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Content */}\n      <main className=\"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8\">\n        <div className=\"px-4 py-6 sm:px-0\">\n          {/* Actions Bar */}\n          <div className=\"flex justify-between items-center mb-6\">\n            <div className=\"flex items-center space-x-4\">\n              <Link\n                to=\"/admin/surveys/create\"\n                className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n              >\n                <FiPlus className=\"mr-2 h-4 w-4\" />\n                Create Survey\n              </Link>\n              \n              <Link\n                to=\"/admin/surveys/templates\"\n                className=\"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n              >\n                <FiFileText className=\"mr-2 h-4 w-4\" />\n                Templates\n              </Link>\n              \n              <select\n                value={statusFilter}\n                onChange={(e) => setStatusFilter(e.target.value)}\n                className=\"block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md\"\n              >\n                <option value=\"\">All Status</option>\n                <option value=\"draft\">Draft</option>\n                <option value=\"active\">Active</option>\n                <option value=\"paused\">Paused</option>\n                <option value=\"completed\">Completed</option>\n                <option value=\"archived\">Archived</option>\n              </select>\n            </div>\n          </div>\n\n          {error && (\n            <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md mb-4\">\n              <p>{error}</p>\n            </div>\n          )}\n\n          {/* Survey List */}\n          <div className=\"bg-white shadow overflow-hidden sm:rounded-lg\">\n            <div className=\"px-4 py-5 sm:px-6\">\n              <h3 className=\"text-lg leading-6 font-medium text-gray-900\">\n                Surveys ({surveys.length})\n              </h3>\n              <p className=\"mt-1 max-w-2xl text-sm text-gray-500\">\n                Manage and monitor your customer surveys\n              </p>\n            </div>\n\n            {surveys.length > 0 ? (\n              <div className=\"border-t border-gray-200\">\n                <ul className=\"divide-y divide-gray-200\">\n                  {surveys.map((survey) => (\n                    <li key={survey.id} className=\"px-4 py-4 sm:px-6 hover:bg-gray-50\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center min-w-0 flex-1\">\n                          <div className=\"min-w-0 flex-1\">\n                            <div className=\"flex items-center\">\n                              <p className=\"text-lg font-semibold text-gray-900 truncate\">\n                                {survey.title}\n                              </p>\n                              <span className={`ml-3 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getStatusColor(survey.status)}`}>\n                                {survey.status}\n                              </span>\n                              <span className={`ml-2 inline-flex items-center px-2 py-0.5 rounded-md text-xs font-medium border ${getAccessTypeColor(survey.access_type)}`}>\n                                {getAccessTypeLabel(survey.access_type)}\n                              </span>\n                            </div>\n                            {survey.description && (\n                              <p className=\"mt-1 text-sm text-gray-600 truncate\">\n                                {survey.description}\n                              </p>\n                            )}\n                            <div className=\"mt-2 flex items-center text-xs text-gray-500 space-x-4\">\n                              <span className=\"flex items-center\">\n                                <FiUsers className=\"mr-1 h-3 w-3\" />\n                                {survey.questions.length} questions\n                              </span>\n                              <span>Created: {new Date(survey.created_at).toLocaleDateString()}</span>\n                              <span>Updated: {new Date(survey.updated_at).toLocaleDateString()}</span>\n                            </div>\n                          </div>\n                        </div>\n\n                        <div className=\"flex items-center space-x-2\">\n                          <Link\n                            to={`/admin/surveys/${survey.id}/preview`}\n                            className=\"p-2 text-gray-400 hover:text-gray-600\"\n                            title=\"Preview survey\"\n                          >\n                            <FiEye className=\"h-4 w-4\" />\n                          </Link>\n                          \n                          <Link\n                            to={`/admin/surveys/${survey.id}/analytics`}\n                            className=\"p-2 text-gray-400 hover:text-blue-600\"\n                            title=\"View analytics\"\n                          >\n                            <FiBarChart className=\"h-4 w-4\" />\n                          </Link>\n                          \n                          <Link\n                            to={`/admin/surveys/${survey.id}/invitations`}\n                            className=\"p-2 text-gray-400 hover:text-purple-600\"\n                            title=\"Manage invitations\"\n                          >\n                            <FiMail className=\"h-4 w-4\" />\n                          </Link>\n                          \n                          <button\n                            onClick={() => setSelectedSurveyForCoupons(survey)}\n                            className=\"p-2 text-gray-400 hover:text-orange-600\"\n                            title=\"Manage survey rewards\"\n                          >\n                            <FiGift className=\"h-4 w-4\" />\n                          </button>\n                          \n                          <button\n                            onClick={() => handleExportResponses(survey.id, survey.title)}\n                            className=\"p-2 text-gray-400 hover:text-green-600\"\n                            title=\"Export responses\"\n                          >\n                            <FiDownload className=\"h-4 w-4\" />\n                          </button>\n                          \n                          <Link\n                            to={`/admin/surveys/${survey.id}/edit`}\n                            className=\"p-2 text-gray-400 hover:text-blue-600\"\n                            title=\"Edit survey\"\n                          >\n                            <FiEdit className=\"h-4 w-4\" />\n                          </Link>\n                          \n                          <button\n                            onClick={() => handleDeleteSurvey(survey.id)}\n                            className=\"p-2 text-gray-400 hover:text-red-600\"\n                            title=\"Delete survey\"\n                          >\n                            <FiTrash2 className=\"h-4 w-4\" />\n                          </button>\n                        </div>\n                      </div>\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            ) : (\n              <div className=\"border-t border-gray-200 p-6 text-center\">\n                <div className=\"text-gray-500\">\n                  <FiBarChart className=\"mx-auto h-12 w-12 mb-4\" />\n                  <h3 className=\"text-lg font-medium mb-2\">No surveys found</h3>\n                  <p className=\"mb-4\">Get started by creating your first customer survey.</p>\n                  <Link\n                    to=\"/admin/surveys/create\"\n                    className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700\"\n                  >\n                    <FiPlus className=\"mr-2 h-4 w-4\" />\n                    Create Survey\n                  </Link>\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* Pagination */}\n          {totalPages > 1 && (\n            <div className=\"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6 mt-4 rounded-lg shadow\">\n              <div className=\"flex-1 flex justify-between sm:hidden\">\n                <button\n                  onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}\n                  disabled={currentPage === 1}\n                  className=\"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  Previous\n                </button>\n                <button\n                  onClick={() => setCurrentPage(Math.min(totalPages, currentPage + 1))}\n                  disabled={currentPage === totalPages}\n                  className=\"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  Next\n                </button>\n              </div>\n              <div className=\"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between\">\n                <div>\n                  <p className=\"text-sm text-gray-700\">\n                    Page <span className=\"font-medium\">{currentPage}</span> of{' '}\n                    <span className=\"font-medium\">{totalPages}</span>\n                  </p>\n                </div>\n                <div>\n                  <nav className=\"relative z-0 inline-flex rounded-md shadow-sm -space-x-px\">\n                    {Array.from({ length: totalPages }, (_, i) => i + 1).map((page) => (\n                      <button\n                        key={page}\n                        onClick={() => setCurrentPage(page)}\n                        className={`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${\n                          page === currentPage\n                            ? 'z-10 bg-blue-50 border-blue-500 text-blue-600'\n                            : 'bg-white border-gray-300 text-gray-500 hover:bg-gray-50'\n                        }`}\n                      >\n                        {page}\n                      </button>\n                    ))}\n                  </nav>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      </main>\n\n      {/* Survey Coupon Assignment Modal */}\n      {selectedSurveyForCoupons && (\n        <div className=\"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50\">\n          <div className=\"relative top-20 mx-auto p-5 border w-11/12 max-w-6xl shadow-lg rounded-md bg-white\">\n            <div className=\"flex justify-between items-center mb-4\">\n              <h3 className=\"text-lg font-medium text-gray-900\">\n                {t('surveys.admin.couponAssignment.title')} - {selectedSurveyForCoupons.title || t('surveys.untitled')}\n              </h3>\n              <button\n                onClick={() => setSelectedSurveyForCoupons(null)}\n                className=\"text-gray-400 hover:text-gray-600\"\n              >\n                <svg className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                </svg>\n              </button>\n            </div>\n            \n            <SurveyCouponAssignments\n              surveyId={selectedSurveyForCoupons.id}\n              surveyTitle={selectedSurveyForCoupons.title}\n              surveyStatus={selectedSurveyForCoupons.status}\n            />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default SurveyManagement;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/admin/SurveyPreview.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is assigned a value but never used.","line":13,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSurvey'. Either include it or remove the dependency array.","line":22,"column":6,"nodeType":"ArrayExpression","endLine":22,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [id, loadSurvey]","fix":{"range":[844,848],"text":"[id, loadSurvey]"}}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":29,"column":60,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":29,"endColumn":63},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1062,1065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1062,1065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":32,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":32,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1075,1119],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":53,"column":13,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":53,"endColumn":15,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[1719,1721],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":58,"column":23,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":58,"endColumn":25,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[1958,1960],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useParams, Link } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { FiArrowLeft } from 'react-icons/fi';\nimport { Survey } from '../../types/survey';\nimport { surveyService } from '../../services/surveyService';\nimport SurveyPreview from '../../components/surveys/SurveyPreview';\nimport DashboardButton from '../../components/navigation/DashboardButton';\nimport toast from 'react-hot-toast';\n\nconst SurveyPreviewPage: React.FC = () => {\n  const { id } = useParams<{ id: string }>();\n  const { t } = useTranslation();\n  const [survey, setSurvey] = useState<Survey | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (id) {\n      loadSurvey();\n    }\n  }, [id]);\n\n  const loadSurvey = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      \n      const surveyData = await surveyService.getSurveyById(id!);\n      setSurvey(surveyData);\n    } catch (err: any) {\n      console.error('Error loading survey:', err);\n      setError(err.response?.data?.message || 'Failed to load survey');\n      toast.error('Failed to load survey');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-7xl mx-auto p-4\">\n          <div className=\"flex justify-center items-center h-64\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\" />\n            <span className=\"ml-3 text-gray-600\">Loading survey...</span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !survey) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-7xl mx-auto p-4\">\n          <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md\">\n            <p>{error || 'Survey not found'}</p>\n            <Link to=\"/admin/surveys\" className=\"text-red-800 underline mt-2 inline-block\">\n              Back to Surveys\n            </Link>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center py-6\">\n            <div className=\"flex items-center\">\n              <Link\n                to=\"/admin/surveys\"\n                className=\"mr-4 text-gray-400 hover:text-gray-600\"\n              >\n                <FiArrowLeft className=\"h-6 w-6\" />\n              </Link>\n              <h1 className=\"text-3xl font-bold text-gray-900\">Survey Preview</h1>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <DashboardButton variant=\"outline\" size=\"md\" />\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Content */}\n      <main className=\"max-w-4xl mx-auto py-6 sm:px-6 lg:px-8\">\n        <div className=\"px-4 py-6 sm:px-0\">\n          <SurveyPreview \n            survey={survey} \n            onClose={() => window.history.back()} \n          />\n        </div>\n      </main>\n    </div>\n  );\n};\n\nexport default SurveyPreviewPage;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/admin/SurveyTemplates.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FiShoppingCart' is defined but never used.","line":8,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[661,664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[661,664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[728,731],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[728,731],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used.","line":256,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":256,"endColumn":17},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":263,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":263,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[10257,10311],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-alert","severity":1,"message":"Unexpected confirm.","line":302,"column":10,"nodeType":"CallExpression","messageId":"unexpected","endLine":302,"endColumn":61},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":311,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":311,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[11972,12021],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":450,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":450,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[18218,18220],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Link, useNavigate } from 'react-router-dom';\nimport { \n  FiFileText, \n  FiStar, \n  FiUsers, \n  FiShoppingCart, \n  FiHelpCircle,\n  FiPlus,\n  FiCopy,\n  FiTrash2,\n  FiEdit\n} from 'react-icons/fi';\nimport DashboardButton from '../../components/navigation/DashboardButton';\nimport { Survey } from '../../types/survey';\nimport { surveyService } from '../../services/surveyService';\nimport toast from 'react-hot-toast';\n\ninterface SurveyTemplate {\n  id: string;\n  name: string;\n  description: string;\n  icon: React.ReactNode;\n  category: string;\n  questions: any[];\n  popularity: number;\n}\n\nconst getPredefinedTemplates = (t: any): SurveyTemplate[] => [\n  {\n    id: 'satisfaction',\n    name: t('surveys.admin.templates.predefinedTemplates.satisfaction.name'),\n    description: t('surveys.admin.templates.predefinedTemplates.satisfaction.description'),\n    icon: <FiStar className=\"h-8 w-8\" />,\n    category: t('surveys.admin.templates.categories.feedback'),\n    popularity: 95,\n    questions: [\n      {\n        id: 'q1',\n        type: 'rating_5',\n        text: t('surveys.admin.templates.predefinedTemplates.satisfaction.questions.q1.text'),\n        description: t('surveys.admin.templates.predefinedTemplates.satisfaction.questions.q1.description'),\n        required: true,\n        order: 1\n      },\n      {\n        id: 'q2',\n        type: 'single_choice',\n        text: t('surveys.admin.templates.predefinedTemplates.satisfaction.questions.q2.text'),\n        required: true,\n        options: [\n          { id: 'opt1', text: t('surveys.admin.templates.predefinedTemplates.satisfaction.questions.q2.options.veryLikely'), value: 5 },\n          { id: 'opt2', text: t('surveys.admin.templates.predefinedTemplates.satisfaction.questions.q2.options.likely'), value: 4 },\n          { id: 'opt3', text: t('surveys.admin.templates.predefinedTemplates.satisfaction.questions.q2.options.neutral'), value: 3 },\n          { id: 'opt4', text: t('surveys.admin.templates.predefinedTemplates.satisfaction.questions.q2.options.unlikely'), value: 2 },\n          { id: 'opt5', text: t('surveys.admin.templates.predefinedTemplates.satisfaction.questions.q2.options.veryUnlikely'), value: 1 }\n        ],\n        order: 2\n      },\n      {\n        id: 'q3',\n        type: 'textarea',\n        text: t('surveys.admin.templates.predefinedTemplates.satisfaction.questions.q3.text'),\n        required: false,\n        order: 3\n      },\n      {\n        id: 'q4',\n        type: 'textarea',\n        text: t('surveys.admin.templates.predefinedTemplates.satisfaction.questions.q4.text'),\n        required: false,\n        order: 4\n      }\n    ]\n  },\n  {\n    id: 'nps',\n    name: t('surveys.admin.templates.predefinedTemplates.nps.name'),\n    description: t('surveys.admin.templates.predefinedTemplates.nps.description'),\n    icon: <FiUsers className=\"h-8 w-8\" />,\n    category: t('surveys.admin.templates.categories.loyalty'),\n    popularity: 88,\n    questions: [\n      {\n        id: 'q1',\n        type: 'rating_10',\n        text: t('surveys.admin.templates.predefinedTemplates.nps.questions.q1.text'),\n        description: t('surveys.admin.templates.predefinedTemplates.nps.questions.q1.description'),\n        required: true,\n        order: 1\n      },\n      {\n        id: 'q2',\n        type: 'textarea',\n        text: t('surveys.admin.templates.predefinedTemplates.nps.questions.q2.text'),\n        required: true,\n        order: 2\n      },\n      {\n        id: 'q3',\n        type: 'single_choice',\n        text: t('surveys.admin.templates.predefinedTemplates.nps.questions.q3.text'),\n        required: true,\n        options: [\n          { id: 'opt1', text: t('surveys.admin.templates.predefinedTemplates.nps.questions.q3.options.room'), value: 'room' },\n          { id: 'opt2', text: t('surveys.admin.templates.predefinedTemplates.nps.questions.q3.options.staff'), value: 'staff' },\n          { id: 'opt3', text: t('surveys.admin.templates.predefinedTemplates.nps.questions.q3.options.location'), value: 'location' },\n          { id: 'opt4', text: t('surveys.admin.templates.predefinedTemplates.nps.questions.q3.options.value'), value: 'value' },\n          { id: 'opt5', text: t('surveys.admin.templates.predefinedTemplates.nps.questions.q3.options.amenities'), value: 'amenities' },\n          { id: 'opt6', text: t('surveys.admin.templates.predefinedTemplates.nps.questions.q3.options.other'), value: 'other' }\n        ],\n        order: 3\n      }\n    ]\n  },\n  {\n    id: 'post-stay',\n    name: t('surveys.admin.templates.predefinedTemplates.postStay.name'),\n    description: t('surveys.admin.templates.predefinedTemplates.postStay.description'),\n    icon: <FiFileText className=\"h-8 w-8\" />,\n    category: t('surveys.admin.templates.categories.feedback'),\n    popularity: 82,\n    questions: [\n      {\n        id: 'q1',\n        type: 'rating_5',\n        text: t('surveys.admin.templates.predefinedTemplates.postStay.questions.q1.text'),\n        required: true,\n        order: 1\n      },\n      {\n        id: 'q2',\n        type: 'multiple_choice',\n        text: t('surveys.admin.templates.predefinedTemplates.postStay.questions.q2.text'),\n        required: false,\n        options: [\n          { id: 'opt1', text: t('surveys.admin.templates.predefinedTemplates.postStay.questions.q2.options.pool'), value: 'pool' },\n          { id: 'opt2', text: t('surveys.admin.templates.predefinedTemplates.postStay.questions.q2.options.gym'), value: 'gym' },\n          { id: 'opt3', text: t('surveys.admin.templates.predefinedTemplates.postStay.questions.q2.options.spa'), value: 'spa' },\n          { id: 'opt4', text: t('surveys.admin.templates.predefinedTemplates.postStay.questions.q2.options.restaurant'), value: 'restaurant' },\n          { id: 'opt5', text: t('surveys.admin.templates.predefinedTemplates.postStay.questions.q2.options.bar'), value: 'bar' },\n          { id: 'opt6', text: t('surveys.admin.templates.predefinedTemplates.postStay.questions.q2.options.business'), value: 'business' },\n          { id: 'opt7', text: t('surveys.admin.templates.predefinedTemplates.postStay.questions.q2.options.concierge'), value: 'concierge' }\n        ],\n        order: 2\n      },\n      {\n        id: 'q3',\n        type: 'yes_no',\n        text: t('surveys.admin.templates.predefinedTemplates.postStay.questions.q3.text'),\n        required: true,\n        order: 3\n      },\n      {\n        id: 'q4',\n        type: 'textarea',\n        text: t('surveys.admin.templates.predefinedTemplates.postStay.questions.q4.text'),\n        required: false,\n        order: 4\n      },\n      {\n        id: 'q5',\n        type: 'yes_no',\n        text: t('surveys.admin.templates.predefinedTemplates.postStay.questions.q5.text'),\n        required: true,\n        order: 5\n      }\n    ]\n  },\n  {\n    id: 'event-feedback',\n    name: t('surveys.admin.templates.predefinedTemplates.eventFeedback.name'),\n    description: t('surveys.admin.templates.predefinedTemplates.eventFeedback.description'),\n    icon: <FiUsers className=\"h-8 w-8\" />,\n    category: t('surveys.admin.templates.categories.events'),\n    popularity: 75,\n    questions: [\n      {\n        id: 'q1',\n        type: 'single_choice',\n        text: t('surveys.admin.templates.predefinedTemplates.eventFeedback.questions.q1.text'),\n        required: true,\n        options: [\n          { id: 'opt1', text: t('surveys.admin.templates.predefinedTemplates.eventFeedback.questions.q1.options.email'), value: 'email' },\n          { id: 'opt2', text: t('surveys.admin.templates.predefinedTemplates.eventFeedback.questions.q1.options.social'), value: 'social' },\n          { id: 'opt3', text: t('surveys.admin.templates.predefinedTemplates.eventFeedback.questions.q1.options.website'), value: 'website' },\n          { id: 'opt4', text: t('surveys.admin.templates.predefinedTemplates.eventFeedback.questions.q1.options.referral'), value: 'referral' },\n          { id: 'opt5', text: t('surveys.admin.templates.predefinedTemplates.eventFeedback.questions.q1.options.other'), value: 'other' }\n        ],\n        order: 1\n      },\n      {\n        id: 'q2',\n        type: 'rating_5',\n        text: t('surveys.admin.templates.predefinedTemplates.eventFeedback.questions.q2.text'),\n        required: true,\n        order: 2\n      },\n      {\n        id: 'q3',\n        type: 'rating_5',\n        text: t('surveys.admin.templates.predefinedTemplates.eventFeedback.questions.q3.text'),\n        required: true,\n        order: 3\n      },\n      {\n        id: 'q4',\n        type: 'yes_no',\n        text: t('surveys.admin.templates.predefinedTemplates.eventFeedback.questions.q4.text'),\n        required: true,\n        order: 4\n      },\n      {\n        id: 'q5',\n        type: 'textarea',\n        text: t('surveys.admin.templates.predefinedTemplates.eventFeedback.questions.q5.text'),\n        required: false,\n        order: 5\n      }\n    ]\n  },\n  {\n    id: 'quick-pulse',\n    name: t('surveys.admin.templates.predefinedTemplates.quickPulse.name'),\n    description: t('surveys.admin.templates.predefinedTemplates.quickPulse.description'),\n    icon: <FiHelpCircle className=\"h-8 w-8\" />,\n    category: t('surveys.admin.templates.categories.quick'),\n    popularity: 70,\n    questions: [\n      {\n        id: 'q1',\n        type: 'rating_5',\n        text: t('surveys.admin.templates.predefinedTemplates.quickPulse.questions.q1.text'),\n        required: true,\n        order: 1\n      },\n      {\n        id: 'q2',\n        type: 'text',\n        text: t('surveys.admin.templates.predefinedTemplates.quickPulse.questions.q2.text'),\n        description: t('surveys.admin.templates.predefinedTemplates.quickPulse.questions.q2.description'),\n        required: false,\n        order: 2\n      }\n    ]\n  }\n];\n\nconst SurveyTemplates: React.FC = () => {\n  const { t } = useTranslation();\n  const navigate = useNavigate();\n  const [templates, setTemplates] = useState<SurveyTemplate[]>([]);\n  const [selectedCategory, setSelectedCategory] = useState<string>('all');\n  const [customTemplates, setCustomTemplates] = useState<Survey[]>([]);\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    try {\n      setTemplates(getPredefinedTemplates(t));\n      loadCustomTemplates();\n    } catch (error) {\n      console.error('Error initializing templates:', error);\n      toast.error('Failed to load survey templates');\n    }\n  }, [t]);\n\n  const loadCustomTemplates = () => {\n    // Custom templates functionality is disabled for now\n    // Templates are provided as predefined options only\n    setCustomTemplates([]);\n    setLoading(false);\n  };\n\n  const categories = [\n    { key: 'all', label: t('surveys.admin.templates.allTemplates') },\n    { key: 'Feedback', label: t('surveys.admin.templates.categories.feedback') },\n    { key: 'Loyalty', label: t('surveys.admin.templates.categories.loyalty') },\n    { key: 'Events', label: t('surveys.admin.templates.categories.events') },\n    { key: 'Quick', label: t('surveys.admin.templates.categories.quick') },\n    { key: 'Custom', label: t('surveys.admin.templates.categories.custom') }\n  ];\n\n  const filteredTemplates = selectedCategory === 'all' \n    ? templates \n    : templates.filter(template => template.category === t(`surveys.admin.templates.categories.${selectedCategory.toLowerCase()}`));\n\n  const handleUseTemplate = (template: SurveyTemplate) => {\n    // Navigate to survey builder with template data\n    navigate('/admin/surveys/create', { \n      state: { \n        template: {\n          title: template.name,\n          description: template.description,\n          questions: template.questions\n        }\n      }\n    });\n  };\n\n  const handleDeleteCustomTemplate = async (templateId: string) => {\n    if (!confirm(t('surveys.admin.templates.deleteConfirm'))) {\n      return;\n    }\n\n    try {\n      await surveyService.deleteSurvey(templateId);\n      toast.success(t('surveys.admin.templates.templateDeleted'));\n      loadCustomTemplates();\n    } catch (error) {\n      console.error('Error deleting template:', error);\n      toast.error(t('surveys.admin.templates.deleteFailed'));\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center py-6\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-900\">{t('surveys.admin.templates.title')}</h1>\n              <p className=\"text-sm text-gray-600 mt-1\">\n                {t('surveys.admin.templates.subtitle')}\n              </p>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <Link\n                to=\"/admin/surveys\"\n                className=\"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n              >\n                {t('surveys.admin.templates.backToSurveys')}\n              </Link>\n              <DashboardButton variant=\"outline\" size=\"md\" />\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Content */}\n      <main className=\"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8\">\n        <div className=\"px-4 py-6 sm:px-0\">\n          {/* Category Filter */}\n          <div className=\"mb-6\">\n            <div className=\"flex space-x-2 overflow-x-auto pb-2\">\n              {categories.map(category => (\n                <button\n                  key={category.key}\n                  onClick={() => setSelectedCategory(category.key)}\n                  className={`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${\n                    selectedCategory === category.key\n                      ? 'bg-blue-600 text-white'\n                      : 'bg-white text-gray-700 hover:bg-gray-100'\n                  }`}\n                >\n                  {category.label}\n                </button>\n              ))}\n            </div>\n          </div>\n\n          {/* Blank Template Card */}\n          <div className=\"mb-8\">\n            <div\n              onClick={() => navigate('/admin/surveys/create')}\n              className=\"bg-white rounded-lg shadow-sm border-2 border-dashed border-gray-300 hover:border-blue-400 p-8 text-center cursor-pointer transition-all hover:shadow-md\"\n            >\n              <FiPlus className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n                {t('surveys.admin.templates.startFromScratch')}\n              </h3>\n              <p className=\"text-gray-600\">\n                {t('surveys.admin.templates.createCustomSurvey')}\n              </p>\n            </div>\n          </div>\n\n          {/* Template Grid */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {filteredTemplates.map(template => (\n              <div\n                key={template.id}\n                className=\"bg-white rounded-lg shadow hover:shadow-lg transition-shadow overflow-hidden\"\n              >\n                <div className=\"p-6\">\n                  <div className=\"flex items-start justify-between mb-4\">\n                    <div className=\"text-blue-600\">{template.icon}</div>\n                    <span className=\"text-xs text-gray-500\">\n                      {t('surveys.admin.templates.popularityText', { percent: template.popularity })}\n                    </span>\n                  </div>\n                  \n                  <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n                    {template.name}\n                  </h3>\n                  \n                  <p className=\"text-sm text-gray-600 mb-4\">\n                    {template.description}\n                  </p>\n                  \n                  <div className=\"flex items-center justify-between text-xs text-gray-500 mb-4\">\n                    <span>{t('surveys.admin.templates.questionsCount', { count: template.questions.length })}</span>\n                    <span className=\"bg-gray-100 px-2 py-1 rounded\">\n                      {template.category}\n                    </span>\n                  </div>\n                  \n                  <div className=\"flex space-x-2\">\n                    <button\n                      onClick={() => handleUseTemplate(template)}\n                      className=\"flex-1 inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700\"\n                    >\n                      <FiCopy className=\"mr-2 h-4 w-4\" />\n                      {t('surveys.admin.templates.useTemplate')}\n                    </button>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n\n          {/* Custom Templates Section */}\n          {customTemplates.length > 0 && (\n            <>\n              <h2 className=\"text-xl font-semibold text-gray-900 mt-12 mb-6\">\n                {t('surveys.admin.templates.customTemplatesTitle')}\n              </h2>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {customTemplates.map(template => (\n                  <div\n                    key={template.id}\n                    className=\"bg-white rounded-lg shadow hover:shadow-lg transition-shadow overflow-hidden\"\n                  >\n                    <div className=\"p-6\">\n                      <div className=\"flex items-start justify-between mb-4\">\n                        <div className=\"text-purple-600\">\n                          <FiFileText className=\"h-8 w-8\" />\n                        </div>\n                        <span className=\"bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded\">\n                          {t('surveys.admin.templates.categories.custom')}\n                        </span>\n                      </div>\n                      \n                      <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n                        {template.title}\n                      </h3>\n                      \n                      <p className=\"text-sm text-gray-600 mb-4\">\n                        {template.description || t('surveys.admin.templates.noDescription')}\n                      </p>\n                      \n                      <div className=\"flex items-center justify-between text-xs text-gray-500 mb-4\">\n                        <span>{template.questions.length} questions</span>\n                        <span>\n                          {t('surveys.admin.templates.created', { date: new Date(template.created_at).toLocaleDateString() })}\n                        </span>\n                      </div>\n                      \n                      <div className=\"flex space-x-2\">\n                        <button\n                          onClick={() => navigate(`/admin/surveys/${template.id}/edit`)}\n                          className=\"flex-1 inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50\"\n                        >\n                          <FiEdit className=\"mr-2 h-4 w-4\" />\n                          {t('surveys.admin.templates.edit')}\n                        </button>\n                        <button\n                          onClick={() => handleDeleteCustomTemplate(template.id)}\n                          className=\"inline-flex items-center justify-center px-4 py-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50\"\n                        >\n                          <FiTrash2 className=\"h-4 w-4\" />\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </>\n          )}\n        </div>\n      </main>\n    </div>\n  );\n};\n\nexport default SurveyTemplates;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/admin/ThaiSurveyDebug.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[596,599],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[596,599],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":51,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":51,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1612,1669],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":52,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":52,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1676,1741],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":55,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":55,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1796,1833],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":56,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":56,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1840,2092],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":63,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":63,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2106,2336],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":65,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":65,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2221,2223],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":70,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":70,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2393,2554],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":77,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":77,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2615,2790],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":86,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":86,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2887,2941],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3021,3024],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3021,3024],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":90,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":90,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3034,3088],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":165,"column":64,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":165,"endColumn":66,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[6264,6266],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":203,"column":25,"nodeType":"MemberExpression","endLine":203,"endColumn":61},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":203,"column":25,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":203,"endColumn":54,"suggestions":[{"messageId":"suggestOptionalChain","fix":{"range":[8031,8032],"text":"?."},"desc":"Consider using the optional chain operator `?.` instead. This operator includes runtime checks, so it is safer than the compile-only non-null assertion operator."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":287,"column":25,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[11847,11900],"text":"Click &quot;Create Thai Survey\" to reproduce the 400 error"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[11847,11900],"text":"Click &ldquo;Create Thai Survey\" to reproduce the 400 error"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[11847,11900],"text":"Click &#34;Create Thai Survey\" to reproduce the 400 error"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[11847,11900],"text":"Click &rdquo;Create Thai Survey\" to reproduce the 400 error"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":287,"column":44,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[11847,11900],"text":"Click \"Create Thai Survey&quot; to reproduce the 400 error"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[11847,11900],"text":"Click \"Create Thai Survey&ldquo; to reproduce the 400 error"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[11847,11900],"text":"Click \"Create Thai Survey&#34; to reproduce the 400 error"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[11847,11900],"text":"Click \"Create Thai Survey&rdquo; to reproduce the 400 error"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":289,"column":29,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[12000,12059],"text":"Check the &quot;Last Error\" section above for validation details"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[12000,12059],"text":"Check the &ldquo;Last Error\" section above for validation details"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[12000,12059],"text":"Check the &#34;Last Error\" section above for validation details"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[12000,12059],"text":"Check the &rdquo;Last Error\" section above for validation details"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":289,"column":40,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[12000,12059],"text":"Check the \"Last Error&quot; section above for validation details"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[12000,12059],"text":"Check the \"Last Error&ldquo; section above for validation details"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[12000,12059],"text":"Check the \"Last Error&#34; section above for validation details"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[12000,12059],"text":"Check the \"Last Error&rdquo; section above for validation details"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { surveyService } from '../../services/surveyService';\nimport { CreateSurveyRequest } from '../../types/survey';\nimport toast from 'react-hot-toast';\n\n/**\n * Thai Survey Debug Page\n * \n * This component provides a dedicated interface for testing Thai language\n * survey creation to debug the 400 error. It includes detailed logging\n * and error capture specifically for Thai content validation issues.\n */\nconst ThaiSurveyDebug: React.FC = () => {\n  const [isCreating, setIsCreating] = useState(false);\n  const [lastError, setLastError] = useState<any>(null);\n\n  // Pre-filled Thai survey data matching the test scenario\n  const [surveyData, setSurveyData] = useState<CreateSurveyRequest>({\n    title: \"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤\", // \"Customer Satisfaction\" in Thai\n    description: \"‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏£‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£\", // \"Please help us improve our service\" in Thai\n    questions: [\n      {\n        id: \"q_thai_001\",\n        type: \"single_choice\",\n        text: \"‡∏Ñ‡∏∏‡∏ì‡∏û‡∏≠‡πÉ‡∏à‡∏Å‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏°?\", // \"Are you satisfied with the service?\" in Thai\n        required: true,\n        order: 1,\n        options: [\n          {\n            id: \"opt_thai_001\",\n            text: \"‡∏û‡∏≠‡πÉ‡∏à‡∏°‡∏≤‡∏Å\", // \"Very satisfied\" in Thai\n            value: \"very_satisfied\"\n          },\n          {\n            id: \"opt_thai_002\", \n            text: \"‡∏û‡∏≠‡πÉ‡∏à\", // \"Satisfied\" in Thai\n            value: \"satisfied\"\n          }\n        ]\n      }\n    ],\n    target_segment: {},\n    access_type: \"public\"\n  });\n\n  const handleCreateSurvey = async () => {\n    setIsCreating(true);\n    setLastError(null);\n\n    try {\n      console.log('üß™ THAI SURVEY DEBUG - Creating survey...');\n      console.log('Survey data:', JSON.stringify(surveyData, null, 2));\n      \n      // Analyze encoding before sending\n      console.log('üìä Encoding analysis:');\n      console.log('Title:', {\n        text: surveyData.title,\n        length: surveyData.title.length,\n        bytes: new TextEncoder().encode(surveyData.title).length,\n        charCodes: Array.from(surveyData.title).map(char => char.charCodeAt(0))\n      });\n      \n      console.log('Description:', {\n        text: surveyData.description,\n        length: surveyData.description?.length || 0,\n        bytes: surveyData.description ? new TextEncoder().encode(surveyData.description).length : 0\n      });\n\n      surveyData.questions.forEach((q, i) => {\n        console.log(`Question ${i + 1}:`, {\n          text: q.text,\n          length: q.text.length,\n          bytes: new TextEncoder().encode(q.text).length\n        });\n        \n        q.options?.forEach((opt, j) => {\n          console.log(`  Option ${j + 1}:`, {\n            text: opt.text,\n            length: opt.text.length,\n            bytes: new TextEncoder().encode(opt.text).length\n          });\n        });\n      });\n\n      const result = await surveyService.createSurvey(surveyData);\n      console.log('‚úÖ Survey created successfully:', result);\n      toast.success('Thai survey created successfully!');\n\n    } catch (error: any) {\n      console.error('‚ùå THAI SURVEY CREATION ERROR:', error);\n      setLastError(error);\n      \n      const errorMessage = error.response?.data?.message || error.message || 'Unknown error';\n      toast.error(`Failed to create survey: ${errorMessage}`);\n    } finally {\n      setIsCreating(false);\n    }\n  };\n\n  const analyzeTextEncoding = (text: string) => {\n    return {\n      text,\n      length: text.length,\n      bytes: new TextEncoder().encode(text).length,\n      hasThaiChars: /[\\u0E00-\\u0E7F]/.test(text),\n      charCodes: Array.from(text).slice(0, 10).map(char => ({\n        char,\n        code: char.charCodeAt(0),\n        unicode: `U+${char.charCodeAt(0).toString(16).toUpperCase().padStart(4, '0')}`\n      }))\n    };\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-4\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-6\">\n            üß™ Thai Survey Debug Tool\n          </h1>\n          \n          <div className=\"mb-6 p-4 bg-blue-50 rounded-lg\">\n            <h2 className=\"text-lg font-semibold text-blue-900 mb-2\">Purpose</h2>\n            <p className=\"text-blue-800\">\n              This page is designed to debug the 400 error when creating surveys with Thai language content.\n              It includes detailed logging and error capture to identify validation issues.\n            </p>\n          </div>\n\n          {/* Survey Data Preview */}\n          <div className=\"mb-6\">\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">üìã Survey Data</h2>\n            \n            <div className=\"space-y-4\">\n              {/* Title */}\n              <div className=\"border rounded p-4\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Title (Thai)\n                </label>\n                <input\n                  type=\"text\"\n                  value={surveyData.title}\n                  onChange={(e) => setSurveyData({...surveyData, title: e.target.value})}\n                  className=\"w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500\"\n                />\n                <div className=\"mt-2 text-xs text-gray-600\">\n                  <div>Length: {surveyData.title.length} chars</div>\n                  <div>Bytes: {new TextEncoder().encode(surveyData.title).length}</div>\n                  <div>Has Thai: {/[\\u0E00-\\u0E7F]/.test(surveyData.title) ? 'Yes' : 'No'}</div>\n                </div>\n              </div>\n\n              {/* Description */}\n              <div className=\"border rounded p-4\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Description (Thai)\n                </label>\n                <textarea\n                  value={surveyData.description}\n                  onChange={(e) => setSurveyData({...surveyData, description: e.target.value})}\n                  className=\"w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500\"\n                  rows={3}\n                />\n                <div className=\"mt-2 text-xs text-gray-600\">\n                  <div>Length: {surveyData.description?.length || 0} chars</div>\n                  <div>Bytes: {surveyData.description ? new TextEncoder().encode(surveyData.description).length : 0}</div>\n                </div>\n              </div>\n\n              {/* Question */}\n              <div className=\"border rounded p-4\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Question Text (Thai)\n                </label>\n                <input\n                  type=\"text\"\n                  value={surveyData.questions[0].text}\n                  onChange={(e) => {\n                    const updated = {...surveyData};\n                    updated.questions[0].text = e.target.value;\n                    setSurveyData(updated);\n                  }}\n                  className=\"w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500\"\n                />\n                <div className=\"mt-2 text-xs text-gray-600\">\n                  <div>Length: {surveyData.questions[0].text.length} chars</div>\n                  <div>Bytes: {new TextEncoder().encode(surveyData.questions[0].text).length}</div>\n                </div>\n              </div>\n\n              {/* Options */}\n              <div className=\"border rounded p-4\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Options (Thai)\n                </label>\n                {surveyData.questions[0].options?.map((option, index) => (\n                  <div key={option.id} className=\"mb-2\">\n                    <input\n                      type=\"text\"\n                      value={option.text}\n                      onChange={(e) => {\n                        const updated = {...surveyData};\n                        updated.questions[0].options![index].text = e.target.value;\n                        setSurveyData(updated);\n                      }}\n                      className=\"w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500\"\n                      placeholder={`Option ${index + 1}`}\n                    />\n                    <div className=\"text-xs text-gray-600 mt-1\">\n                      Length: {option.text.length} chars, Bytes: {new TextEncoder().encode(option.text).length}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n\n          {/* Text Analysis */}\n          <div className=\"mb-6\">\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">üîç Text Analysis</h2>\n            <div className=\"bg-gray-50 rounded p-4 space-y-2\">\n              <div>\n                <strong>Title Analysis:</strong>\n                <pre className=\"text-xs mt-1\">{JSON.stringify(analyzeTextEncoding(surveyData.title), null, 2)}</pre>\n              </div>\n            </div>\n          </div>\n\n          {/* Action Buttons */}\n          <div className=\"mb-6\">\n            <button\n              onClick={handleCreateSurvey}\n              disabled={isCreating}\n              className=\"bg-blue-600 text-white px-6 py-3 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center\"\n            >\n              {isCreating && <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\" />}\n              {isCreating ? 'Creating Survey...' : 'üöÄ Create Thai Survey'}\n            </button>\n          </div>\n\n          {/* Error Display */}\n          {lastError && (\n            <div className=\"mb-6\">\n              <h2 className=\"text-lg font-semibold text-red-900 mb-4\">‚ùå Last Error</h2>\n              <div className=\"bg-red-50 border border-red-200 rounded p-4\">\n                <div className=\"mb-4\">\n                  <strong>Status:</strong> {lastError.response?.status} {lastError.response?.statusText}\n                </div>\n                \n                <div className=\"mb-4\">\n                  <strong>Message:</strong> {lastError.response?.data?.message || lastError.message}\n                </div>\n\n                {lastError.response?.data?.validationErrors && (\n                  <div className=\"mb-4\">\n                    <strong>Validation Errors:</strong>\n                    <pre className=\"text-xs mt-2 bg-white p-2 rounded border overflow-auto max-h-40\">\n                      {JSON.stringify(lastError.response.data.validationErrors, null, 2)}\n                    </pre>\n                  </div>\n                )}\n\n                {lastError.response?.data?.receivedData && (\n                  <div className=\"mb-4\">\n                    <strong>Backend Received:</strong>\n                    <pre className=\"text-xs mt-2 bg-white p-2 rounded border overflow-auto max-h-40\">\n                      {JSON.stringify(lastError.response.data.receivedData, null, 2)}\n                    </pre>\n                  </div>\n                )}\n\n                <div>\n                  <strong>Full Error:</strong>\n                  <pre className=\"text-xs mt-2 bg-white p-2 rounded border overflow-auto max-h-60\">\n                    {JSON.stringify(lastError.response?.data || lastError, null, 2)}\n                  </pre>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Instructions */}\n          <div className=\"bg-yellow-50 border border-yellow-200 rounded p-4\">\n            <h2 className=\"text-lg font-semibold text-yellow-900 mb-2\">üìù Instructions</h2>\n            <ol className=\"list-decimal list-inside text-yellow-800 space-y-1\">\n              <li>Open browser dev tools console for detailed logging</li>\n              <li>Click \"Create Thai Survey\" to reproduce the 400 error</li>\n              <li>Check the console for detailed request/response data</li>\n              <li>Check the \"Last Error\" section above for validation details</li>\n              <li>Check backend server logs for additional debugging info</li>\n            </ol>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ThaiSurveyDebug;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/admin/UserManagement.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchStats' and 'fetchUsers'. Either include them or remove the dependency array.","line":53,"column":6,"nodeType":"ArrayExpression","endLine":53,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [currentPage, fetchStats, fetchUsers, searchTerm]","fix":{"range":[1956,1981],"text":"[currentPage, fetchStats, fetchUsers, searchTerm]"}}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":288,"column":45,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":288,"endColumn":47,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11437,11439],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":289,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":289,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11505,11507],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":289,"column":74,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":289,"endColumn":76,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11528,11530],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":297,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":297,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[11897,11899],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":391,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":391,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[16799,16801],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":392,"column":53,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":392,"endColumn":55,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[16877,16879],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":392,"column":84,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":392,"endColumn":86,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[16908,16910],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":399,"column":98,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":399,"endColumn":100,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[17280,17282],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":407,"column":73,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":407,"endColumn":75,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[17774,17776],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":453,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":453,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[20458,20460],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":454,"column":51,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":454,"endColumn":53,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[20534,20536],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":454,"column":82,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":454,"endColumn":84,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[20565,20567],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\nimport { toast } from 'react-hot-toast';\nimport { useTranslation } from 'react-i18next';\nimport { FiUser, FiUsers, FiUserCheck, FiUserX, FiSearch, FiTrash2, FiEye } from 'react-icons/fi';\nimport { userManagementService, User, UserStats } from '../../services/userManagementService';\nimport DashboardButton from '../../components/navigation/DashboardButton';\n\nconst UserManagement: React.FC = () => {\n  const { t } = useTranslation();\n  const [users, setUsers] = useState<User[]>([]);\n  const [stats, setStats] = useState<UserStats | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\n  const [showUserModal, setShowUserModal] = useState(false);\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\n  const [userToDelete, setUserToDelete] = useState<User | null>(null);\n\n  const pageSize = 10;\n\n  const fetchUsers = useCallback(async (page = 1, search = '') => {\n    try {\n      const response = await userManagementService.getUsers(page, pageSize, search);\n      setUsers(response.data);\n      setTotalPages(response.pagination.pages);\n    } catch (error) {\n      toast.error(t('userManagement.messages.fetchUsersFailed'));\n    }\n  }, [t]);\n\n  const fetchStats = useCallback(async () => {\n    try {\n      const response = await userManagementService.getUserStats();\n      setStats(response.data);\n    } catch (error) {\n      toast.error(t('userManagement.messages.fetchStatsFailed'));\n    }\n  }, [t]);\n\n  useEffect(() => {\n    const loadData = async () => {\n      setLoading(true);\n      await Promise.all([\n        fetchUsers(currentPage, searchTerm),\n        fetchStats()\n      ]);\n      setLoading(false);\n    };\n\n    loadData();\n  }, [currentPage, searchTerm]);\n\n  const handleSearch = useCallback((e: React.FormEvent) => {\n    e.preventDefault();\n    setCurrentPage(1);\n    fetchUsers(1, searchTerm);\n  }, [searchTerm, fetchUsers]);\n\n  const handleStatusToggle = useCallback(async (user: User) => {\n    try {\n      await userManagementService.updateUserStatus(user.userId, !user.isActive);\n      toast.success(user.isActive \n        ? t('userManagement.messages.userDeactivated') \n        : t('userManagement.messages.userActivated')\n      );\n      fetchUsers(currentPage, searchTerm);\n    } catch (error) {\n      toast.error(t('userManagement.messages.updateStatusFailed'));\n    }\n  }, [currentPage, searchTerm, fetchUsers, t]);\n\n  const handleRoleChange = async (user: User, newRole: string) => {\n    try {\n      await userManagementService.updateUserRole(user.userId, newRole);\n      toast.success(t('userManagement.messages.roleUpdated'));\n      fetchUsers(currentPage, searchTerm);\n    } catch (error) {\n      toast.error(t('userManagement.messages.updateRoleFailed'));\n    }\n  };\n\n  const handleDeleteUser = async () => {\n    if (!userToDelete) {return;}\n\n    try {\n      await userManagementService.deleteUser(userToDelete.userId);\n      toast.success(t('userManagement.messages.userDeleted'));\n      setShowDeleteConfirm(false);\n      setUserToDelete(null);\n      fetchUsers(currentPage, searchTerm);\n      fetchStats();\n    } catch (error) {\n      toast.error(t('userManagement.messages.deleteFailed'));\n    }\n  };\n\n  const confirmDelete = (user: User) => {\n    setUserToDelete(user);\n    setShowDeleteConfirm(true);\n  };\n\n  const viewUserDetails = async (user: User) => {\n    try {\n      const response = await userManagementService.getUserById(user.userId);\n      setSelectedUser(response.data);\n      setShowUserModal(true);\n    } catch (error) {\n      toast.error(t('userManagement.messages.fetchDetailsFailed'));\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString();\n  };\n\n  const getRoleBadgeColor = (role: string) => {\n    switch (role) {\n      case 'super_admin':\n        return 'bg-red-100 text-red-800';\n      case 'admin':\n        return 'bg-purple-100 text-purple-800';\n      default:\n        return 'bg-blue-100 text-blue-800';\n    }\n  };\n\n  const getStatusBadgeColor = (isActive: boolean) => {\n    return isActive \n      ? 'bg-green-100 text-green-800' \n      : 'bg-gray-100 text-gray-800';\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 p-4\">\n        <div className=\"max-w-6xl mx-auto\">\n          <div className=\"animate-pulse\">\n            <div className=\"h-8 bg-gray-300 rounded w-64 mb-6\" />\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n              {[1, 2, 3, 4].map(i => (\n                <div key={i} className=\"bg-white p-6 rounded-lg shadow\">\n                  <div className=\"h-4 bg-gray-300 rounded w-20 mb-2\" />\n                  <div className=\"h-8 bg-gray-300 rounded w-12\" />\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow\">\n        <div className=\"max-w-6xl mx-auto px-4 py-6\">\n          <div className=\"flex justify-between items-center\">\n            <div className=\"flex items-center\">\n              <FiUsers className=\"h-8 w-8 text-blue-600 mr-3\" />\n              <h1 className=\"text-3xl font-bold text-gray-900\">{t('userManagement.title')}</h1>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <DashboardButton variant=\"outline\" size=\"md\" />\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Content */}\n      <div className=\"max-w-6xl mx-auto p-4\">\n\n        {/* Statistics Cards */}\n        {stats && (\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n            <div className=\"bg-white p-6 rounded-lg shadow\">\n              <div className=\"flex items-center\">\n                <FiUsers className=\"h-8 w-8 text-blue-600 mr-3\" />\n                <div>\n                  <p className=\"text-sm text-gray-600\">{t('userManagement.totalUsers')}</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">{stats.total}</p>\n                </div>\n              </div>\n            </div>\n            <div className=\"bg-white p-6 rounded-lg shadow\">\n              <div className=\"flex items-center\">\n                <FiUserCheck className=\"h-8 w-8 text-green-600 mr-3\" />\n                <div>\n                  <p className=\"text-sm text-gray-600\">{t('userManagement.activeUsers')}</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">{stats.active}</p>\n                </div>\n              </div>\n            </div>\n            <div className=\"bg-white p-6 rounded-lg shadow\">\n              <div className=\"flex items-center\">\n                <FiUser className=\"h-8 w-8 text-purple-600 mr-3\" />\n                <div>\n                  <p className=\"text-sm text-gray-600\">{t('userManagement.administrators')}</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">{stats.admins}</p>\n                </div>\n              </div>\n            </div>\n            <div className=\"bg-white p-6 rounded-lg shadow\">\n              <div className=\"flex items-center\">\n                <FiUserCheck className=\"h-8 w-8 text-orange-600 mr-3\" />\n                <div>\n                  <p className=\"text-sm text-gray-600\">{t('userManagement.recentJoins')}</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">{stats.recentlyJoined}</p>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Search Bar */}\n        <div className=\"bg-white p-6 rounded-lg shadow mb-8\">\n          <form onSubmit={handleSearch} className=\"flex gap-4\">\n            <div className=\"flex-1 relative\">\n              <FiSearch className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\n              <input\n                type=\"text\"\n                placeholder={t('userManagement.searchPlaceholder')}\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n              />\n            </div>\n            <button\n              type=\"submit\"\n              className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n            >\n              {t('userManagement.search')}\n            </button>\n          </form>\n        </div>\n\n        {/* Users Table */}\n        <div className=\"bg-white rounded-lg shadow overflow-hidden\">\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full divide-y divide-gray-200\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    {t('userManagement.user')}\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    {t('profile.membershipId')}\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    {t('userManagement.email')}\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    {t('userManagement.role')}\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    {t('userManagement.status')}\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    {t('userManagement.joined')}\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                    {t('userManagement.actions')}\n                  </th>\n                </tr>\n              </thead>\n              <tbody className=\"bg-white divide-y divide-gray-200\">\n                {users.map((user) => (\n                  <tr key={user.userId} className=\"hover:bg-gray-50\">\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <div className=\"flex items-center\">\n                        <div className=\"flex-shrink-0 h-10 w-10\">\n                          {user.avatarUrl ? (\n                            <img\n                              className=\"h-10 w-10 rounded-full\"\n                              src={user.avatarUrl}\n                              alt=\"\"\n                            />\n                          ) : (\n                            <div className=\"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center\">\n                              <FiUser className=\"h-6 w-6 text-gray-600\" />\n                            </div>\n                          )}\n                        </div>\n                        <div className=\"ml-4\">\n                          <div className=\"text-sm font-medium text-gray-900\">\n                            {user.firstName || user.lastName \n                              ? `${user.firstName || ''} ${user.lastName || ''}`.trim()\n                              : t('userManagement.noNameProvided')\n                            }\n                          </div>\n                        </div>\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-mono\">\n                      {user.membershipId || '-'}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                      {user.email}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <select\n                        value={user.role}\n                        onChange={(e) => handleRoleChange(user, e.target.value)}\n                        className={`text-xs font-semibold px-2 py-1 rounded-full ${getRoleBadgeColor(user.role)}`}\n                      >\n                        <option value=\"customer\">{t('userManagement.customer')}</option>\n                        <option value=\"admin\">{t('userManagement.admin')}</option>\n                        <option value=\"super_admin\">{t('userManagement.superAdmin')}</option>\n                      </select>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${getStatusBadgeColor(user.isActive)}`}>\n                        {user.isActive ? t('userManagement.active') : t('userManagement.inactive')}\n                      </span>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                      {formatDate(user.createdAt)}\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                      <div className=\"flex space-x-2\">\n                        <button\n                          onClick={() => viewUserDetails(user)}\n                          className=\"text-blue-600 hover:text-blue-900 p-1\"\n                          title={t('userManagement.viewDetails')}\n                        >\n                          <FiEye className=\"h-4 w-4\" />\n                        </button>\n                        <button\n                          onClick={() => handleStatusToggle(user)}\n                          className={`p-1 ${user.isActive \n                            ? 'text-red-600 hover:text-red-900' \n                            : 'text-green-600 hover:text-green-900'\n                          }`}\n                          title={user.isActive ? t('userManagement.deactivate') : t('userManagement.activate')}\n                        >\n                          {user.isActive ? <FiUserX className=\"h-4 w-4\" /> : <FiUserCheck className=\"h-4 w-4\" />}\n                        </button>\n                        <button\n                          onClick={() => confirmDelete(user)}\n                          className=\"text-red-600 hover:text-red-900 p-1\"\n                          title={t('userManagement.deleteUser')}\n                        >\n                          <FiTrash2 className=\"h-4 w-4\" />\n                        </button>\n                      </div>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        </div>\n\n        {/* Pagination */}\n        {totalPages > 1 && (\n          <div className=\"flex justify-between items-center mt-6\">\n            <div className=\"text-sm text-gray-700\">\n              {t('userManagement.pagination', { current: currentPage, total: totalPages })}\n            </div>\n            <div className=\"flex space-x-2\">\n              <button\n                onClick={() => setCurrentPage(currentPage - 1)}\n                disabled={currentPage === 1}\n                className=\"px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {t('userManagement.previous')}\n              </button>\n              <button\n                onClick={() => setCurrentPage(currentPage + 1)}\n                disabled={currentPage === totalPages}\n                className=\"px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {t('userManagement.next')}\n              </button>\n            </div>\n          </div>\n        )}\n\n        {/* User Details Modal */}\n        {showUserModal && selectedUser && (\n          <div className=\"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50\">\n            <div className=\"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white\">\n              <div className=\"mt-3\">\n                <h3 className=\"text-lg font-medium text-gray-900 mb-4\">{t('userManagement.userDetails')}</h3>\n                <div className=\"space-y-3\">\n                  <div>\n                    <span className=\"font-medium text-gray-700\">{t('userManagement.name')}: </span>\n                    <span className=\"text-gray-900\">\n                      {selectedUser.firstName || selectedUser.lastName \n                        ? `${selectedUser.firstName || ''} ${selectedUser.lastName || ''}`.trim()\n                        : t('userManagement.notProvided')\n                      }\n                    </span>\n                  </div>\n                  <div>\n                    <span className=\"font-medium text-gray-700\">{t('profile.membershipId')}: </span>\n                    <span className=\"text-gray-900 font-mono text-sm\">{selectedUser.membershipId || t('admin.coupons.notAssigned')}</span>\n                  </div>\n                  <div>\n                    <span className=\"font-medium text-gray-700\">{t('userManagement.email')}: </span>\n                    <span className=\"text-gray-900\">{selectedUser.email}</span>\n                  </div>\n                  <div>\n                    <span className=\"font-medium text-gray-700\">{t('userManagement.phone')}: </span>\n                    <span className=\"text-gray-900\">{selectedUser.phone || t('userManagement.notProvided')}</span>\n                  </div>\n                  <div>\n                    <span className=\"font-medium text-gray-700\">{t('userManagement.role')}: </span>\n                    <span className={`px-2 py-1 text-xs font-semibold rounded-full ${getRoleBadgeColor(selectedUser.role)}`}>\n                      {selectedUser.role === 'super_admin' ? t('userManagement.superAdmin') : \n                       selectedUser.role === 'admin' ? t('userManagement.admin') : t('userManagement.customer')}\n                    </span>\n                  </div>\n                  <div>\n                    <span className=\"font-medium text-gray-700\">{t('userManagement.status')}: </span>\n                    <span className={`px-2 py-1 text-xs font-semibold rounded-full ${getStatusBadgeColor(selectedUser.isActive)}`}>\n                      {selectedUser.isActive ? t('userManagement.active') : t('userManagement.inactive')}\n                    </span>\n                  </div>\n                  <div>\n                    <span className=\"font-medium text-gray-700\">{t('userManagement.emailVerified')}: </span>\n                    <span className=\"text-gray-900\">{selectedUser.emailVerified ? t('userManagement.yes') : t('userManagement.no')}</span>\n                  </div>\n                  <div>\n                    <span className=\"font-medium text-gray-700\">{t('userManagement.joined')}: </span>\n                    <span className=\"text-gray-900\">{formatDate(selectedUser.createdAt)}</span>\n                  </div>\n                </div>\n                <div className=\"mt-6\">\n                  <button\n                    onClick={() => setShowUserModal(false)}\n                    className=\"w-full px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors\"\n                  >\n                    {t('userManagement.close')}\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Delete Confirmation Modal */}\n        {showDeleteConfirm && userToDelete && (\n          <div className=\"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50\">\n            <div className=\"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white\">\n              <div className=\"mt-3 text-center\">\n                <FiTrash2 className=\"mx-auto h-16 w-16 text-red-600\" />\n                <h3 className=\"text-lg font-medium text-gray-900 mt-4\">{t('userManagement.deleteUser')}</h3>\n                <p className=\"text-sm text-gray-500 mt-2\">\n                  {t('userManagement.confirmDelete', {\n                    name: userToDelete.firstName || userToDelete.lastName \n                      ? `${userToDelete.firstName || ''} ${userToDelete.lastName || ''}`.trim()\n                      : userToDelete.email\n                  })}\n                </p>\n                <div className=\"mt-6 flex justify-center space-x-4\">\n                  <button\n                    onClick={() => {\n                      setShowDeleteConfirm(false);\n                      setUserToDelete(null);\n                    }}\n                    className=\"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors\"\n                  >\n                    {t('userManagement.cancel')}\n                  </button>\n                  <button\n                    onClick={handleDeleteUser}\n                    className=\"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors\"\n                  >\n                    {t('userManagement.delete')}\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default React.memo(UserManagement);","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/auth/LoginPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/auth/OAuthSuccessPage.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":71,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":71,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2050,2104],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'setTokens'. Either include it or remove the dependency array.","line":78,"column":6,"nodeType":"ArrayExpression","endLine":78,"endColumn":30,"suggestions":[{"desc":"Update the dependencies array to be: [searchParams, navigate, setTokens]","fix":{"range":[2246,2270],"text":"[searchParams, navigate, setTokens]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect } from 'react';\nimport { useNavigate, useSearchParams } from 'react-router-dom';\nimport { useAuthStore } from '../../store/authStore';\nimport { notify } from '../../utils/notificationManager';\n\nexport default function OAuthSuccessPage() {\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n  const setTokens = useAuthStore((state) => state.setTokens);\n\n  useEffect(() => {\n    const handleOAuthSuccess = async () => {\n      const token = searchParams.get('token');\n      const refreshToken = searchParams.get('refreshToken');\n      const isNewUser = searchParams.get('isNewUser') === 'true';\n      const error = searchParams.get('error');\n\n\n      if (error) {\n        notify.error('Social login failed. Please try again.');\n        navigate('/login');\n        return;\n      }\n\n      if (!token || !refreshToken) {\n        notify.error('Invalid authentication response. Please try again.');\n        navigate('/login');\n        return;\n      }\n\n      try {\n        // Set tokens in auth store\n        setTokens(token, refreshToken);\n\n        // Get user data using the token\n        const meUrl = `${import.meta.env.VITE_API_URL}/oauth/me`;\n        \n        const response = await fetch(meUrl, {\n          headers: {\n            'Authorization': `Bearer ${token}`,\n            'Content-Type': 'application/json'\n          }\n        });\n\n\n        if (!response.ok) {\n          throw new Error('Failed to get user data');\n        }\n\n        const { user } = await response.json();\n\n        // Update auth store with user data\n        useAuthStore.setState({\n          user,\n          accessToken: token,\n          refreshToken,\n          isAuthenticated: true,\n          isLoading: false\n        });\n\n        // Show success message\n        if (isNewUser) {\n          notify.success('Welcome! Your account has been created successfully.');\n        } else {\n          notify.success('Welcome back!');\n        }\n\n        // Redirect to dashboard\n        navigate('/dashboard');\n      } catch (error) {\n        console.error('OAuth success handling error:', error);\n        notify.error('Authentication failed. Please try again.');\n        navigate('/login');\n      }\n    };\n\n    handleOAuthSuccess();\n  }, [searchParams, navigate]); // Removed setTokens to prevent re-runs\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n      <div className=\"text-center\">\n        <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto\" />\n        <p className=\"mt-4 text-gray-600\">Completing your login...</p>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/auth/RegisterPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'confirmPassword' is assigned a value but never used.","line":42,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useTranslation } from 'react-i18next';\nimport { useAuthStore } from '../../store/authStore';\nimport { FiMail, FiLock, FiUser, FiPhone, FiEye, FiEyeOff } from 'react-icons/fi';\n\nconst registerSchema = z.object({\n  email: z.string().email('Invalid email address'),\n  password: z.string().min(8, 'Password must be at least 8 characters'),\n  confirmPassword: z.string(),\n  firstName: z.string().min(1, 'First name is required'),\n  lastName: z.string().min(1, 'Last name is required'),\n  phone: z.string().optional(),\n}).refine((data) => data.password === data.confirmPassword, {\n  message: \"Passwords don't match\",\n  path: ['confirmPassword'],\n});\n\ntype RegisterFormData = z.infer<typeof registerSchema>;\n\nexport default function RegisterPage() {\n  const { t } = useTranslation();\n  const navigate = useNavigate();\n  const register = useAuthStore((state) => state.register);\n  const isLoading = useAuthStore((state) => state.isLoading);\n  const [showPassword, setShowPassword] = useState(false);\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\n\n  const {\n    register: registerField,\n    handleSubmit,\n    formState: { errors },\n  } = useForm<RegisterFormData>({\n    resolver: zodResolver(registerSchema),\n  });\n\n  const onSubmit = async (data: RegisterFormData) => {\n    try {\n      const { confirmPassword, ...registerData } = data;\n      await register(registerData);\n      navigate('/dashboard');\n    } catch (error) {\n      // Error is handled in the store\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\">\n      <div className=\"max-w-md w-full space-y-8\">\n        <div>\n          <h2 className=\"mt-6 text-center text-3xl font-extrabold text-gray-900\">\n            Create your account\n          </h2>\n          <p className=\"mt-2 text-center text-sm text-gray-600\">\n            Or{' '}\n            <Link\n              to=\"/login\"\n              className=\"font-medium text-primary-600 hover:text-primary-500\"\n            >\n              sign in to your existing account\n            </Link>\n          </p>\n        </div>\n        <form className=\"mt-8 space-y-6\" onSubmit={handleSubmit(onSubmit)}>\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label htmlFor=\"firstName\" className=\"block text-sm font-medium text-gray-700\">\n                  First Name\n                </label>\n                <div className=\"mt-1 relative\">\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                    <FiUser className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                  <input\n                    {...registerField('firstName')}\n                    id=\"firstName\"\n                    type=\"text\"\n                    className=\"appearance-none block w-full px-3 py-2 pl-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                    placeholder={t('profile.firstNamePlaceholder')}\n                  />\n                </div>\n                {errors.firstName && (\n                  <p className=\"mt-1 text-sm text-red-600\">{errors.firstName.message}</p>\n                )}\n              </div>\n              <div>\n                <label htmlFor=\"lastName\" className=\"block text-sm font-medium text-gray-700\">\n                  Last Name\n                </label>\n                <div className=\"mt-1 relative\">\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                    <FiUser className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                  <input\n                    {...registerField('lastName')}\n                    id=\"lastName\"\n                    type=\"text\"\n                    className=\"appearance-none block w-full px-3 py-2 pl-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                    placeholder={t('profile.lastNamePlaceholder')}\n                  />\n                </div>\n                {errors.lastName && (\n                  <p className=\"mt-1 text-sm text-red-600\">{errors.lastName.message}</p>\n                )}\n              </div>\n            </div>\n\n            <div>\n              <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700\">\n                Email Address\n              </label>\n              <div className=\"mt-1 relative\">\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                  <FiMail className=\"h-5 w-5 text-gray-400\" />\n                </div>\n                <input\n                  {...registerField('email')}\n                  id=\"email\"\n                  type=\"email\"\n                  autoComplete=\"email\"\n                  className=\"appearance-none block w-full px-3 py-2 pl-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                  placeholder=\"john@example.com\"\n                />\n              </div>\n              {errors.email && (\n                <p className=\"mt-1 text-sm text-red-600\">{errors.email.message}</p>\n              )}\n            </div>\n\n            <div>\n              <label htmlFor=\"phone\" className=\"block text-sm font-medium text-gray-700\">\n                Phone Number (Optional)\n              </label>\n              <div className=\"mt-1 relative\">\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                  <FiPhone className=\"h-5 w-5 text-gray-400\" />\n                </div>\n                <input\n                  {...registerField('phone')}\n                  id=\"phone\"\n                  type=\"tel\"\n                  className=\"appearance-none block w-full px-3 py-2 pl-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                  placeholder=\"+1 (555) 123-4567\"\n                />\n              </div>\n              {errors.phone && (\n                <p className=\"mt-1 text-sm text-red-600\">{errors.phone.message}</p>\n              )}\n            </div>\n\n            <div>\n              <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700\">\n                Password\n              </label>\n              <div className=\"mt-1 relative\">\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                  <FiLock className=\"h-5 w-5 text-gray-400\" />\n                </div>\n                <input\n                  {...registerField('password')}\n                  id=\"password\"\n                  type={showPassword ? 'text' : 'password'}\n                  autoComplete=\"new-password\"\n                  className=\"appearance-none block w-full px-3 py-2 pl-10 pr-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                  placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n                />\n                <button\n                  type=\"button\"\n                  className=\"absolute inset-y-0 right-0 pr-3 flex items-center\"\n                  onClick={() => setShowPassword(!showPassword)}\n                >\n                  {showPassword ? (\n                    <FiEyeOff className=\"h-5 w-5 text-gray-400\" />\n                  ) : (\n                    <FiEye className=\"h-5 w-5 text-gray-400\" />\n                  )}\n                </button>\n              </div>\n              {errors.password && (\n                <p className=\"mt-1 text-sm text-red-600\">{errors.password.message}</p>\n              )}\n            </div>\n\n            <div>\n              <label htmlFor=\"confirmPassword\" className=\"block text-sm font-medium text-gray-700\">\n                Confirm Password\n              </label>\n              <div className=\"mt-1 relative\">\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                  <FiLock className=\"h-5 w-5 text-gray-400\" />\n                </div>\n                <input\n                  {...registerField('confirmPassword')}\n                  id=\"confirmPassword\"\n                  type={showConfirmPassword ? 'text' : 'password'}\n                  autoComplete=\"new-password\"\n                  className=\"appearance-none block w-full px-3 py-2 pl-10 pr-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                  placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n                />\n                <button\n                  type=\"button\"\n                  className=\"absolute inset-y-0 right-0 pr-3 flex items-center\"\n                  onClick={() => setShowConfirmPassword(!showConfirmPassword)}\n                >\n                  {showConfirmPassword ? (\n                    <FiEyeOff className=\"h-5 w-5 text-gray-400\" />\n                  ) : (\n                    <FiEye className=\"h-5 w-5 text-gray-400\" />\n                  )}\n                </button>\n              </div>\n              {errors.confirmPassword && (\n                <p className=\"mt-1 text-sm text-red-600\">{errors.confirmPassword.message}</p>\n              )}\n            </div>\n          </div>\n\n          <div>\n            <button\n              type=\"submit\"\n              disabled={isLoading}\n              className=\"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {isLoading ? 'Creating account...' : 'Create account'}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/auth/ResetPasswordPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1520,1523],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1520,1523],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1955,1958],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1955,1958],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":168,"column":69,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[6546,6738],"text":"\n                    If an account exists with that email address, we&apos;ve sent a password reset\n                    link. Please check your email and follow the instructions.\n                  "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[6546,6738],"text":"\n                    If an account exists with that email address, we&lsquo;ve sent a password reset\n                    link. Please check your email and follow the instructions.\n                  "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[6546,6738],"text":"\n                    If an account exists with that email address, we&#39;ve sent a password reset\n                    link. Please check your email and follow the instructions.\n                  "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[6546,6738],"text":"\n                    If an account exists with that email address, we&rsquo;ve sent a password reset\n                    link. Please check your email and follow the instructions.\n                  "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\nimport { Link, useSearchParams } from 'react-router-dom';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { authService } from '../../services/authService';\nimport toast from 'react-hot-toast';\nimport { FiMail, FiLock } from 'react-icons/fi';\n\nconst requestSchema = z.object({\n  email: z.string().email('Invalid email address'),\n});\n\nconst resetSchema = z.object({\n  password: z.string().min(8, 'Password must be at least 8 characters'),\n  confirmPassword: z.string(),\n}).refine((data) => data.password === data.confirmPassword, {\n  message: \"Passwords don't match\",\n  path: ['confirmPassword'],\n});\n\ntype RequestFormData = z.infer<typeof requestSchema>;\ntype ResetFormData = z.infer<typeof resetSchema>;\n\nexport default function ResetPasswordPage() {\n  const [searchParams] = useSearchParams();\n  const token = searchParams.get('token');\n  const [isLoading, setIsLoading] = useState(false);\n  const [isSubmitted, setIsSubmitted] = useState(false);\n\n  const requestForm = useForm<RequestFormData>({\n    resolver: zodResolver(requestSchema),\n  });\n\n  const resetForm = useForm<ResetFormData>({\n    resolver: zodResolver(resetSchema),\n  });\n\n  const onRequestSubmit = async (data: RequestFormData) => {\n    setIsLoading(true);\n    try {\n      await authService.resetPasswordRequest(data.email);\n      setIsSubmitted(true);\n      toast.success('Password reset link sent to your email');\n    } catch (error: any) {\n      toast.error(error.response?.data?.error || 'Failed to send reset link');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const onResetSubmit = async (data: ResetFormData) => {\n    if (!token) {return;}\n    \n    setIsLoading(true);\n    try {\n      await authService.resetPassword(token, data.password);\n      toast.success('Password reset successfully');\n      window.location.href = '/login';\n    } catch (error: any) {\n      toast.error(error.response?.data?.error || 'Failed to reset password');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  if (token) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\">\n        <div className=\"max-w-md w-full space-y-8\">\n          <div>\n            <h2 className=\"mt-6 text-center text-3xl font-extrabold text-gray-900\">\n              Reset your password\n            </h2>\n            <p className=\"mt-2 text-center text-sm text-gray-600\">\n              Enter your new password below\n            </p>\n          </div>\n          <form className=\"mt-8 space-y-6\" onSubmit={resetForm.handleSubmit(onResetSubmit)}>\n            <div className=\"space-y-4\">\n              <div>\n                <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700\">\n                  New Password\n                </label>\n                <div className=\"mt-1 relative\">\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                    <FiLock className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                  <input\n                    {...resetForm.register('password')}\n                    id=\"password\"\n                    type=\"password\"\n                    className=\"appearance-none block w-full px-3 py-2 pl-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                    placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n                  />\n                </div>\n                {resetForm.formState.errors.password && (\n                  <p className=\"mt-1 text-sm text-red-600\">\n                    {resetForm.formState.errors.password.message}\n                  </p>\n                )}\n              </div>\n\n              <div>\n                <label htmlFor=\"confirmPassword\" className=\"block text-sm font-medium text-gray-700\">\n                  Confirm New Password\n                </label>\n                <div className=\"mt-1 relative\">\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                    <FiLock className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                  <input\n                    {...resetForm.register('confirmPassword')}\n                    id=\"confirmPassword\"\n                    type=\"password\"\n                    className=\"appearance-none block w-full px-3 py-2 pl-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                    placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n                  />\n                </div>\n                {resetForm.formState.errors.confirmPassword && (\n                  <p className=\"mt-1 text-sm text-red-600\">\n                    {resetForm.formState.errors.confirmPassword.message}\n                  </p>\n                )}\n              </div>\n            </div>\n\n            <div>\n              <button\n                type=\"submit\"\n                disabled={isLoading}\n                className=\"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {isLoading ? 'Resetting...' : 'Reset password'}\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\">\n      <div className=\"max-w-md w-full space-y-8\">\n        <div>\n          <h2 className=\"mt-6 text-center text-3xl font-extrabold text-gray-900\">\n            Forgot your password?\n          </h2>\n          <p className=\"mt-2 text-center text-sm text-gray-600\">\n            Or{' '}\n            <Link\n              to=\"/login\"\n              className=\"font-medium text-primary-600 hover:text-primary-500\"\n            >\n              return to sign in\n            </Link>\n          </p>\n        </div>\n\n        {isSubmitted ? (\n          <div className=\"rounded-md bg-green-50 p-4\">\n            <div className=\"flex\">\n              <div className=\"ml-3\">\n                <h3 className=\"text-sm font-medium text-green-800\">Check your email</h3>\n                <div className=\"mt-2 text-sm text-green-700\">\n                  <p>\n                    If an account exists with that email address, we've sent a password reset\n                    link. Please check your email and follow the instructions.\n                  </p>\n                </div>\n              </div>\n            </div>\n          </div>\n        ) : (\n          <form className=\"mt-8 space-y-6\" onSubmit={requestForm.handleSubmit(onRequestSubmit)}>\n            <div>\n              <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700\">\n                Email address\n              </label>\n              <div className=\"mt-1 relative\">\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                  <FiMail className=\"h-5 w-5 text-gray-400\" />\n                </div>\n                <input\n                  {...requestForm.register('email')}\n                  id=\"email\"\n                  type=\"email\"\n                  autoComplete=\"email\"\n                  className=\"appearance-none block w-full px-3 py-2 pl-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm\"\n                  placeholder=\"john@example.com\"\n                />\n              </div>\n              {requestForm.formState.errors.email && (\n                <p className=\"mt-1 text-sm text-red-600\">\n                  {requestForm.formState.errors.email.message}\n                </p>\n              )}\n            </div>\n\n            <div>\n              <button\n                type=\"submit\"\n                disabled={isLoading}\n                className=\"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {isLoading ? 'Sending...' : 'Send reset link'}\n              </button>\n            </div>\n          </form>\n        )}\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/coupons/CouponWallet.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totalPages' is assigned a value but never used.","line":19,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1579,1582],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1579,1582],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":39,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":39,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1592,1637],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadCoupons'. Either include it or remove the dependency array.","line":48,"column":6,"nodeType":"ArrayExpression","endLine":48,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadCoupons]","fix":{"range":[1815,1817],"text":"[loadCoupons]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { UserActiveCoupon } from '../../types/coupon';\nimport { couponService } from '../../services/couponService';\nimport CouponCard from '../../components/coupons/CouponCard';\nimport QRCodeModal from '../../components/coupons/QRCodeModal';\nimport CouponDetailsModal from '../../components/coupons/CouponDetailsModal';\nimport DashboardButton from '../../components/navigation/DashboardButton';\n\nconst CouponWallet: React.FC = () => {\n  const { t } = useTranslation();\n  const [coupons, setCoupons] = useState<UserActiveCoupon[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedCoupon, setSelectedCoupon] = useState<UserActiveCoupon | null>(null);\n  const [showQRCode, setShowQRCode] = useState(false);\n  const [showDetails, setShowDetails] = useState(false);\n  const [page, setPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n  const [hasMore, setHasMore] = useState(false);\n\n  const loadCoupons = async (pageNum: number = 1, append: boolean = false) => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      const response = await couponService.getUserCoupons(pageNum, 20);\n      \n      if (append) {\n        setCoupons(prev => [...prev, ...response.coupons]);\n      } else {\n        setCoupons(response.coupons);\n      }\n      \n      setTotalPages(response.totalPages);\n      setHasMore(pageNum < response.totalPages);\n      setPage(pageNum);\n    } catch (err: any) {\n      console.error('Error loading coupons:', err);\n      setError(err.response?.data?.message || t('errors.failedToLoadCoupons'));\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    loadCoupons();\n  }, []);\n\n  const handleUseCoupon = (coupon: UserActiveCoupon) => {\n    setSelectedCoupon(coupon);\n    setShowQRCode(true);\n    setShowDetails(false);\n  };\n\n  const handleViewDetails = (coupon: UserActiveCoupon) => {\n    setSelectedCoupon(coupon);\n    setShowDetails(true);\n    setShowQRCode(false);\n  };\n\n  const handleLoadMore = () => {\n    if (hasMore && !loading) {\n      loadCoupons(page + 1, true);\n    }\n  };\n\n  const handleRefresh = () => {\n    setPage(1);\n    loadCoupons(1, false);\n  };\n\n  // Separate coupons by expiry status\n  const activeCoupons = coupons.filter(coupon => !couponService.isExpiringSoon(coupon));\n  const expiringSoonCoupons = coupons.filter(coupon => couponService.isExpiringSoon(coupon));\n\n  if (loading && coupons.length === 0) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 p-4\">\n        <div className=\"max-w-4xl mx-auto\">\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <div className=\"animate-pulse space-y-4\">\n              <div className=\"h-6 bg-gray-200 rounded w-1/4\" />\n              <div className=\"space-y-3\">\n                {[...Array(3)].map((_, i) => (\n                  <div key={i} className=\"h-32 bg-gray-200 rounded\" />\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <div className=\"bg-white shadow-sm\">\n        <div className=\"max-w-4xl mx-auto p-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-2xl font-bold text-gray-900\">\n                {t('coupons.myCoupons')}\n              </h1>\n              <p className=\"text-gray-600 mt-1\">\n                {t('coupons.walletDescription')}\n              </p>\n            </div>\n            <div className=\"flex items-center space-x-3\">\n              <button\n                onClick={handleRefresh}\n                disabled={loading}\n                className=\"inline-flex items-center font-medium border border-gray-300 bg-white text-gray-700 px-4 py-2 text-sm rounded-md hover:bg-gray-50 disabled:opacity-50 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n              >\n                {loading ? t('common.loading') : t('common.refresh')}\n              </button>\n              <DashboardButton variant=\"outline\" size=\"md\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"max-w-4xl mx-auto p-4\">\n        {error && (\n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-6\">\n            <div className=\"flex\">\n              <div className=\"text-red-400 mr-3\">‚ö†Ô∏è</div>\n              <div>\n                <h3 className=\"text-red-800 font-medium\">\n                  {t('errors.error')}\n                </h3>\n                <p className=\"text-red-700 mt-1\">{error}</p>\n                <button\n                  onClick={handleRefresh}\n                  className=\"text-red-600 underline hover:text-red-800 mt-2\"\n                >\n                  {t('common.tryAgain')}\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {coupons.length === 0 && !loading && !error && (\n          <div className=\"bg-white rounded-lg shadow p-8 text-center\">\n            <div className=\"text-6xl mb-4\">üé´</div>\n            <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">\n              {t('coupons.noCoupons')}\n            </h3>\n            <p className=\"text-gray-600 mb-4\">\n              {t('coupons.noCouponsDescription')}\n            </p>\n            <button\n              onClick={handleRefresh}\n              className=\"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors\"\n            >\n              {t('common.refresh')}\n            </button>\n          </div>\n        )}\n\n        {/* Expiring Soon Section */}\n        {expiringSoonCoupons.length > 0 && (\n          <div className=\"mb-8\">\n            <div className=\"flex items-center mb-4\">\n              <div className=\"bg-red-100 p-2 rounded-full mr-3\">\n                <span className=\"text-red-600 text-xl\">‚è∞</span>\n              </div>\n              <h2 className=\"text-xl font-semibold text-red-700\">\n                {t('coupons.expiringSoon')} ({expiringSoonCoupons.length})\n              </h2>\n            </div>\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n              {expiringSoonCoupons.map((coupon) => (\n                <CouponCard\n                  key={coupon.userCouponId}\n                  coupon={coupon}\n                  onUse={handleUseCoupon}\n                  onViewDetails={handleViewDetails}\n                />\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Active Coupons Section */}\n        {activeCoupons.length > 0 && (\n          <div className=\"mb-8\">\n            <div className=\"flex items-center mb-4\">\n              <div className=\"bg-green-100 p-2 rounded-full mr-3\">\n                <span className=\"text-green-600 text-xl\">‚úÖ</span>\n              </div>\n              <h2 className=\"text-xl font-semibold text-gray-900\">\n                {t('coupons.activeCoupons')} ({activeCoupons.length})\n              </h2>\n            </div>\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n              {activeCoupons.map((coupon) => (\n                <CouponCard\n                  key={coupon.userCouponId}\n                  coupon={coupon}\n                  onUse={handleUseCoupon}\n                  onViewDetails={handleViewDetails}\n                />\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Load More Button */}\n        {hasMore && (\n          <div className=\"text-center mt-8\">\n            <button\n              onClick={handleLoadMore}\n              disabled={loading}\n              className=\"bg-gray-100 text-gray-700 px-6 py-3 rounded-md hover:bg-gray-200 disabled:opacity-50 transition-colors\"\n            >\n              {loading ? t('common.loading') : t('common.loadMore')}\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* QR Code Modal */}\n      {showQRCode && selectedCoupon && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"max-w-md w-full max-h-full overflow-y-auto\">\n            <QRCodeModal\n              coupon={selectedCoupon}\n              onClose={() => {\n                setShowQRCode(false);\n                setSelectedCoupon(null);\n              }}\n            />\n          </div>\n        </div>\n      )}\n\n      {/* Coupon Details Modal */}\n      {showDetails && selectedCoupon && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"max-w-lg w-full max-h-full overflow-y-auto\">\n            <CouponDetailsModal\n              coupon={selectedCoupon}\n              onClose={() => {\n                setShowDetails(false);\n                setSelectedCoupon(null);\n              }}\n            />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default CouponWallet;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/loyalty/LoyaltyDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FiGift' is defined but never used.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":20,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":13},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadLoyaltyData'. Either include it or remove the dependency array.","line":30,"column":6,"nodeType":"ArrayExpression","endLine":30,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadLoyaltyData]","fix":{"range":[1192,1194],"text":"[loadLoyaltyData]"}}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":49,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":49,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1795,1847],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { FiGift } from 'react-icons/fi';\nimport toast from 'react-hot-toast';\nimport { \n  loyaltyService, \n  UserLoyaltyStatus, \n  Tier, \n  PointsTransaction,\n  PointsCalculation\n} from '../../services/loyaltyService';\nimport PointsBalance from '../../components/loyalty/PointsBalance';\nimport TierStatus from '../../components/loyalty/TierStatus';\nimport TransactionList from '../../components/loyalty/TransactionList';\nimport { useAuthStore } from '../../store/authStore';\nimport DashboardButton from '../../components/navigation/DashboardButton';\n\nexport default function LoyaltyDashboard() {\n  const { t } = useTranslation();\n  const user = useAuthStore((state) => state.user);\n  \n  const [loyaltyStatus, setLoyaltyStatus] = useState<UserLoyaltyStatus | null>(null);\n  const [allTiers, setAllTiers] = useState<Tier[]>([]);\n  const [pointsCalculation, setPointsCalculation] = useState<PointsCalculation | null>(null);\n  const [transactions, setTransactions] = useState<PointsTransaction[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    loadLoyaltyData();\n  }, []);\n\n  const loadLoyaltyData = async () => {\n    try {\n      setIsLoading(true);\n      \n      // Load all data in parallel\n      const [statusResult, tiersResult, calculationResult, historyResult] = await Promise.all([\n        loyaltyService.getUserLoyaltyStatus(),\n        loyaltyService.getTiers(),\n        loyaltyService.getPointsCalculation(),\n        loyaltyService.getPointsHistory(20, 0)\n      ]);\n\n      setLoyaltyStatus(statusResult);\n      setAllTiers(tiersResult);\n      setPointsCalculation(calculationResult);\n      setTransactions(historyResult.transactions);\n    } catch (error) {\n      console.error('Error loading loyalty data:', error);\n      toast.error(t('errors.networkError'));\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 py-8\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"animate-pulse space-y-6\">\n            <div className=\"h-8 bg-gray-200 rounded w-1/3\" />\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n              <div className=\"lg:col-span-2 space-y-6\">\n                <div className=\"h-48 bg-gray-200 rounded-lg\" />\n                <div className=\"h-64 bg-gray-200 rounded-lg\" />\n              </div>\n              <div className=\"h-96 bg-gray-200 rounded-lg\" />\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!loyaltyStatus || !pointsCalculation) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <p className=\"text-gray-600 mb-4\">{t('errors.networkError')}</p>\n          <button\n            onClick={loadLoyaltyData}\n            className=\"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700\"\n          >\n            {t('common.refresh')}\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 py-8\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-900\">\n                {t('loyalty.dashboard.title')}\n              </h1>\n              <p className=\"mt-2 text-gray-600\">\n                {t('loyalty.dashboard.welcome')}\n              </p>\n            </div>\n            <DashboardButton variant=\"outline\" size=\"md\" />\n          </div>\n        </div>\n\n\n        {/* Main Content */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          {/* Left Column - Points & Tier */}\n          <div className=\"lg:col-span-2 space-y-6\">\n            {/* Points Balance */}\n            <PointsBalance\n              loyaltyStatus={loyaltyStatus}\n              expiringPoints={pointsCalculation.expiring_points}\n              nextExpiryDate={pointsCalculation.next_expiry_date}\n            />\n\n            {/* Transaction History */}\n            <TransactionList\n              transactions={transactions}\n              isLoading={false}\n            />\n          </div>\n\n          {/* Right Column - Tier Status */}\n          <div className=\"space-y-6\">\n            <TierStatus\n              loyaltyStatus={loyaltyStatus}\n              allTiers={allTiers}\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/surveys/SurveyDetailsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'translationStatus' is assigned a value but never used.","line":21,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":27},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSurvey'. Either include it or remove the dependency array.","line":34,"column":6,"nodeType":"ArrayExpression","endLine":34,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [id, loadSurvey]","fix":{"range":[1633,1637],"text":"[id, loadSurvey]"}}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":42,"column":37,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":42,"endColumn":40},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":43,"column":50,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":43,"endColumn":53},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3133,3136],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3133,3136],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":79,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":79,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3146,3190],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Variable Assigned to Object Injection Sink","line":100,"column":25,"nodeType":"MemberExpression","endLine":100,"endColumn":74},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":148,"column":13,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":148,"endColumn":15,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[5490,5492],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":154,"column":22,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":154,"endColumn":24,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[5736,5738],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":258,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":258,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[9963,9965],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport { useParams, Link } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { FiArrowLeft, FiCalendar, FiUsers, FiEye } from 'react-icons/fi';\nimport { Survey } from '../../types/survey';\nimport { surveyService } from '../../services/surveyService';\nimport { translationService } from '../../services/translationService';\nimport SurveyPreview from '../../components/surveys/SurveyPreview';\nimport DashboardButton from '../../components/navigation/DashboardButton';\nimport LanguageSwitcher from '../../components/LanguageSwitcher';\nimport LanguageTabs from '../../components/translation/LanguageTabs';\nimport { MultilingualSurvey, SupportedLanguage, TranslationStatus } from '../../types/multilingual';\nimport toast from 'react-hot-toast';\n\nconst SurveyDetailsPage: React.FC = () => {\n  const { id } = useParams<{ id: string }>();\n  const { t } = useTranslation();\n  const [survey, setSurvey] = useState<Survey | null>(null);\n  const [multilingualSurvey, setMultilingualSurvey] = useState<MultilingualSurvey | null>(null);\n  const [selectedLanguage, setSelectedLanguage] = useState<SupportedLanguage>('th');\n  const [translationStatus, setTranslationStatus] = useState<Record<SupportedLanguage, TranslationStatus>>({\n    th: 'original',\n    en: 'pending',\n    'zh-CN': 'pending'\n  });\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [translationLoading, setTranslationLoading] = useState(false);\n\n  useEffect(() => {\n    if (id) {\n      loadSurvey();\n    }\n  }, [id]);\n\n  const loadSurvey = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      \n      const [surveyData, translationsData] = await Promise.all([\n        surveyService.getSurveyById(id!),\n        translationService.getSurveyTranslations(id!)\n      ]);\n      \n      setSurvey(surveyData);\n      \n      // Load translations if available\n      if (translationsData) {\n        const multilingualData: MultilingualSurvey = {\n          ...translationsData,\n          originalLanguage: translationsData.original_language || 'th',\n          availableLanguages: translationsData.available_languages || ['th'],\n          translationStatus: 'none',\n          translations: translationsData.translations || {}\n        };\n        \n        setMultilingualSurvey(multilingualData);\n        \n        // Update translation status\n        const newStatus: Record<SupportedLanguage, TranslationStatus> = {\n          th: 'original',\n          en: 'pending',\n          'zh-CN': 'pending'\n        };\n        \n        if (translationsData.translations && typeof translationsData.translations === 'object') {\n          Object.keys(translationsData.translations).forEach((lang) => {\n            if (lang !== translationsData.original_language) {\n              newStatus[lang as SupportedLanguage] = 'translated';\n            }\n          });\n        }\n        \n        setTranslationStatus(newStatus);\n        setSelectedLanguage(translationsData.original_language || 'th');\n      }\n    } catch (err: any) {\n      console.error('Error loading survey:', err);\n      setError(err.response?.data?.message || t('surveys.errors.loadFailed'));\n      toast.error(t('surveys.errors.loadFailed'));\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Memoize display content calculation for performance\n  const getDisplayContent = useCallback(() => {\n    if (!survey) {return null;}\n    \n    if (!multilingualSurvey || selectedLanguage === multilingualSurvey.originalLanguage) {\n      return survey;\n    }\n\n    // Check if translations exist\n    if (!multilingualSurvey.translations || typeof multilingualSurvey.translations !== 'object') {\n      return survey;\n    }\n\n    const translation = multilingualSurvey.translations[selectedLanguage];\n    if (!translation) {\n      return survey;\n    }\n\n    return {\n      ...survey,\n      title: translation.title || survey.title,\n      description: translation.description || survey.description,\n      questions: translation.questions || survey.questions\n    };\n  }, [survey, multilingualSurvey, selectedLanguage]);\n\n  // Memoize date formatting for performance\n  const formatDate = useMemo(() => (dateString: string) => {\n    return new Date(dateString).toLocaleDateString();\n  }, []);\n\n  // Optimized language change handler with loading state\n  const handleLanguageChange = useCallback(async (language: SupportedLanguage) => {\n    if (language === selectedLanguage || translationLoading) {return;}\n    \n    setTranslationLoading(true);\n    try {\n      // Add a small delay to show loading state for better UX\n      await new Promise(resolve => setTimeout(resolve, 150));\n      setSelectedLanguage(language);\n    } finally {\n      setTranslationLoading(false);\n    }\n  }, [selectedLanguage, translationLoading]);\n\n  // Get display content based on selected language (moved here to fix hooks order)\n  const displayContent = useMemo(() => getDisplayContent(), [getDisplayContent]);\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-4xl mx-auto p-4\">\n          <div className=\"flex justify-center items-center h-64\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\" />\n            <span className=\"ml-3 text-gray-600\">{t('surveys.loading')}</span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !survey) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-4xl mx-auto p-4\">\n          <div className=\"text-center py-12\">\n            <div className=\"text-red-500 text-xl mb-4\">\n              {error || t('surveys.notFound')}\n            </div>\n            <Link\n              to=\"/surveys\"\n              className=\"inline-flex items-center text-blue-600 hover:text-blue-800\"\n            >\n              <FiArrowLeft className=\"mr-2 h-4 w-4\" />\n              {t('surveys.backToSurveys')}\n            </Link>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center py-6\">\n            <div className=\"flex items-center\">\n              <Link\n                to=\"/surveys\"\n                className=\"mr-4 text-gray-400 hover:text-gray-600\"\n              >\n                <FiArrowLeft className=\"h-6 w-6\" />\n              </Link>\n              <div className=\"flex items-center\">\n                <div>\n                  <h1 className=\"text-2xl font-bold text-gray-900\">{displayContent?.title}</h1>\n                  <div className=\"flex items-center space-x-4 text-sm text-gray-500 mt-1\">\n                    <span className=\"flex items-center\">\n                      <FiCalendar className=\"mr-1 h-3 w-3\" />\n                      {t('surveys.created')} {formatDate(survey.created_at)}\n                    </span>\n                    <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${\n                      survey.access_type === 'public' \n                        ? 'bg-green-100 text-green-800' \n                        : 'bg-blue-100 text-blue-800'\n                    }`}\n                    >\n                      {survey.access_type === 'public' ? (\n                        <>\n                          <FiUsers className=\"mr-1 h-3 w-3\" />\n                          {t('surveys.accessType.public')}\n                        </>\n                      ) : (\n                        <>\n                          <FiEye className=\"mr-1 h-3 w-3\" />\n                          {t('surveys.accessType.invited')}\n                        </>\n                      )}\n                    </span>\n                  </div>\n                </div>\n                <span className=\"ml-4 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full\">\n                  {selectedLanguage.toUpperCase()}\n                </span>\n              </div>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <Link\n                to={`/surveys/${survey.id}/take`}\n                className=\"bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-700 transition-colors\"\n              >\n                {t('surveys.takeSurvey')}\n              </Link>\n              <LanguageSwitcher />\n              <DashboardButton variant=\"outline\" size=\"sm\" />\n            </div>\n          </div>\n          \n          {/* Language Tabs - show if we have multilingual survey data */}\n          {multilingualSurvey && (\n            <div className=\"border-t border-gray-200\">\n              <div className=\"px-4 sm:px-6 lg:px-8\">\n                <LanguageTabs\n                  languages={['th', 'en', 'zh-CN']}\n                  currentLanguage={selectedLanguage}\n                  onLanguageChange={handleLanguageChange}\n                  isLoading={translationLoading}\n                  aria-label={t('translation.languages')}\n                />\n              </div>\n            </div>\n          )}\n        </div>\n      </header>\n\n      {/* Content */}\n      <main className=\"max-w-4xl mx-auto py-6 px-4 sm:px-6 lg:px-8\">\n        {displayContent?.description && (\n          <div className=\"bg-white rounded-lg shadow-sm p-6 mb-6\">\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-2\">{t('surveys.description')}</h2>\n            <p className=\"text-gray-600\">{displayContent.description}</p>\n          </div>\n        )}\n\n        <div className=\"bg-white rounded-lg shadow-sm p-6\">\n          <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">\n            {t('surveys.preview', { count: displayContent?.questions?.length || 0 })}\n          </h2>\n          <SurveyPreview \n            survey={displayContent || survey} \n            onClose={() => window.history.back()} \n          />\n        </div>\n      </main>\n    </div>\n  );\n};\n\nexport default SurveyDetailsPage;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/surveys/SurveyList.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":14,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":13},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSurveys'. Either include it or remove the dependency array.","line":27,"column":6,"nodeType":"ArrayExpression","endLine":27,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [isAuthenticated, loadSurveys]","fix":{"range":[1223,1240],"text":"[isAuthenticated, loadSurveys]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1734,1737],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1734,1737],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":46,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":46,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1747,1792],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { FiUsers, FiEye, FiCalendar, FiRefreshCw } from 'react-icons/fi';\nimport { Survey } from '../../types/survey';\nimport { surveyService } from '../../services/surveyService';\nimport { useAuthStore } from '../../store/authStore';\nimport { useAuthRedirect } from '../../hooks/useAuthRedirect';\nimport DashboardButton from '../../components/navigation/DashboardButton';\nimport LanguageSwitcher from '../../components/LanguageSwitcher';\n\nconst SurveyList: React.FC = () => {\n  const { t } = useTranslation();\n  const user = useAuthStore((state) => state.user);\n  const { isAuthenticated } = useAuthRedirect(); // Additional auth check\n  const [publicSurveys, setPublicSurveys] = useState<Survey[]>([]);\n  const [invitedSurveys, setInvitedSurveys] = useState<Survey[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [activeTab, setActiveTab] = useState<'public' | 'invited'>('public');\n\n  useEffect(() => {\n    // Only load surveys if authenticated\n    if (isAuthenticated) {\n      loadSurveys();\n    }\n  }, [isAuthenticated]);\n\n  const loadSurveys = async () => {\n    // Don't attempt to load if not authenticated\n    if (!isAuthenticated) {\n      setLoading(false);\n      return;\n    }\n\n    try {\n      setLoading(true);\n      setError(null);\n      const [publicSurveysData, invitedSurveysData] = await Promise.all([\n        surveyService.getPublicSurveys(),\n        surveyService.getInvitedSurveys()\n      ]);\n      setPublicSurveys(publicSurveysData);\n      setInvitedSurveys(invitedSurveysData);\n    } catch (err: any) {\n      console.error('Error loading surveys:', err);\n      setError(err.response?.data?.message || t('surveys.errors.loadFailed'));\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString();\n  };\n\n  const renderSurveyCard = (survey: Survey) => (\n    <div\n      key={survey.id}\n      className=\"bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200 flex flex-col h-full\"\n    >\n      <div className=\"p-6 flex flex-col h-full\">\n        <div className=\"flex-1\">\n          <div className=\"flex items-start justify-between\">\n            <div className=\"flex-1\">\n              <div className=\"flex items-center space-x-2 mb-2\">\n                <h3 className=\"text-xl font-semibold text-gray-900\">\n                  {survey.title}\n                </h3>\n                <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${\n                  survey.access_type === 'public' \n                    ? 'bg-green-100 text-green-800' \n                    : 'bg-blue-100 text-blue-800'\n                }`}\n                >\n                  {survey.access_type === 'public' ? (\n                    <>\n                      <FiUsers className=\"mr-1 h-3 w-3\" />\n                      Public\n                    </>\n                  ) : (\n                    <>\n                      <FiEye className=\"mr-1 h-3 w-3\" />\n                      Invited\n                    </>\n                  )}\n                </span>\n              </div>\n              {survey.description && (\n                <p className=\"text-gray-600 text-sm mb-4 line-clamp-3\">\n                  {survey.description}\n                </p>\n              )}\n            </div>\n          </div>\n\n          <div className=\"flex items-center justify-between text-sm text-gray-500 mb-4\">\n            <span>\n              {survey.questions.length} {t('surveys.questions', 'questions')}\n            </span>\n            <span className=\"flex items-center\">\n              <FiCalendar className=\"mr-1 h-3 w-3\" />\n              {formatDate(survey.created_at)}\n            </span>\n          </div>\n        </div>\n\n        <div className=\"flex space-x-3 mt-auto\">\n          <Link\n            to={`/surveys/${survey.id}/take`}\n            className=\"flex-1 bg-blue-600 text-white py-2 px-4 rounded-md text-sm font-medium hover:bg-blue-700 transition-colors flex items-center justify-center\"\n          >\n            {t('surveys.takeSurvey', 'Take Survey')}\n          </Link>\n          <Link\n            to={`/surveys/${survey.id}/details`}\n            className=\"flex-1 bg-gray-100 text-gray-700 py-2 px-4 rounded-md text-sm font-medium hover:bg-gray-200 transition-colors flex items-center justify-center\"\n          >\n            {t('surveys.viewDetails', 'View Details')}\n          </Link>\n        </div>\n      </div>\n    </div>\n  );\n\n  const currentSurveys = activeTab === 'public' ? publicSurveys : invitedSurveys;\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-4xl mx-auto p-4\">\n          <div className=\"flex justify-center items-center h-64\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\" />\n            <span className=\"ml-3 text-gray-600\">{t('surveys.loading')}</span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center py-6\">\n            <div className=\"flex items-center\">\n              <h1 className=\"text-3xl font-bold text-gray-900\">\n                {t('surveys.title', 'Surveys')}\n              </h1>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <button\n                onClick={loadSurveys}\n                disabled={loading}\n                className=\"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50\"\n              >\n                <FiRefreshCw className={`mr-2 h-4 w-4 ${loading ? 'animate-spin' : ''}`} />\n                Refresh\n              </button>\n              <LanguageSwitcher />\n              <DashboardButton variant=\"outline\" size=\"md\" />\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Content */}\n      <main className=\"max-w-4xl mx-auto p-4\">\n        {error && (\n          <div className=\"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md\">\n            <div className=\"flex\">\n              <div className=\"ml-3\">\n                <p className=\"text-sm\">{error}</p>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Survey Type Tabs */}\n        <div className=\"mb-6\">\n          <div className=\"border-b border-gray-200\">\n            <nav className=\"-mb-px flex space-x-8\" aria-label=\"Tabs\">\n              <button\n                onClick={() => setActiveTab('public')}\n                className={`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ${\n                  activeTab === 'public'\n                    ? 'border-blue-500 text-blue-600'\n                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                }`}\n              >\n                <div className=\"flex items-center\">\n                  <FiUsers className=\"mr-2 h-4 w-4\" />\n                  {t('surveys.tabs.public')} {t('surveys.title')} ({publicSurveys.length})\n                </div>\n              </button>\n              <button\n                onClick={() => setActiveTab('invited')}\n                className={`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ${\n                  activeTab === 'invited'\n                    ? 'border-blue-500 text-blue-600'\n                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                }`}\n              >\n                <div className=\"flex items-center\">\n                  <FiEye className=\"mr-2 h-4 w-4\" />\n                  {t('surveys.tabs.invited')} {t('surveys.title')} ({invitedSurveys.length})\n                </div>\n              </button>\n            </nav>\n          </div>\n        </div>\n\n        {/* Survey Description */}\n        <div className=\"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n          <div className=\"flex items-start\">\n            {activeTab === 'public' ? (\n              <FiUsers className=\"flex-shrink-0 h-5 w-5 text-blue-600 mt-0.5 mr-3\" />\n            ) : (\n              <FiEye className=\"flex-shrink-0 h-5 w-5 text-blue-600 mt-0.5 mr-3\" />\n            )}\n            <div>\n              <h3 className=\"text-sm font-medium text-blue-900 mb-1\">\n                {activeTab === 'public' ? 'Public Surveys' : 'Invited Surveys'}\n              </h3>\n              <p className=\"text-sm text-blue-800\">\n                {activeTab === 'public' \n                  ? 'These surveys are available to all users in the app. Complete them anytime to share your feedback.'\n                  : 'These surveys are specifically for you. You were personally invited to participate in these surveys.'\n                }\n              </p>\n            </div>\n          </div>\n        </div>\n\n        {currentSurveys.length === 0 && !loading && !error ? (\n          <div className=\"text-center py-12\">\n            <div className=\"text-gray-500 text-lg mb-4\">\n              {activeTab === 'public' ? 'üìã' : '‚úâÔ∏è'} {t('surveys.noSurveys', 'No surveys available')}\n            </div>\n            <p className=\"text-gray-400\">\n              {activeTab === 'public' \n                ? t('surveys.noPublicSurveys', 'No public surveys are currently available. Check back later!')\n                : t('surveys.noInvitedSurveys', 'You haven\\'t been invited to any surveys yet.')\n              }\n            </p>\n          </div>\n        ) : (\n          <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n            {currentSurveys.map((survey) => renderSurveyCard(survey))}\n          </div>\n        )}\n\n        {/* Refresh button */}\n        <div className=\"mt-8 text-center\">\n          <button\n            onClick={loadSurveys}\n            disabled={loading}\n            className=\"bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-md transition-colors disabled:opacity-50\"\n          >\n            {loading ? t('common.loading', 'Loading...') : t('common.refresh', 'Refresh')}\n          </button>\n        </div>\n      </main>\n    </div>\n  );\n};\n\nexport default SurveyList;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/pages/surveys/TakeSurvey.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'translationStatus' is assigned a value but never used.","line":22,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'existingResponse' is assigned a value but never used.","line":27,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1537,1540],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1537,1540],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isCompleted' is assigned a value but never used.","line":34,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":21},{"ruleId":"security/detect-object-injection","severity":1,"message":"Variable Assigned to Object Injection Sink","line":47,"column":25,"nodeType":"MemberExpression","endLine":47,"endColumn":74},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSurvey'. Either include it or remove the dependency array.","line":64,"column":6,"nodeType":"ArrayExpression","endLine":64,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [id, loadSurvey]","fix":{"range":[2671,2675],"text":"[id, loadSurvey]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'getDisplayContent'. Either include it or remove the dependency array.","line":72,"column":61,"nodeType":"ArrayExpression","endLine":72,"endColumn":107,"suggestions":[{"desc":"Update the dependencies array to be: [getDisplayContent]","fix":{"range":[2992,3038],"text":"[getDisplayContent]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'saveProgress'. Either include it or remove the dependency array.","line":83,"column":6,"nodeType":"ArrayExpression","endLine":83,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [survey, answers, saveProgress]","fix":{"range":[3287,3304],"text":"[survey, answers, saveProgress]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5113,5116],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5113,5116],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":137,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":137,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5126,5170],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5886,5889],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5886,5889],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":164,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":164,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5899,5944],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6134,6137],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6134,6137],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":178,"column":9,"nodeType":"MemberExpression","endLine":178,"endColumn":27},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":181,"column":16,"nodeType":"MemberExpression","endLine":181,"endColumn":37},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":191,"column":22,"nodeType":"MemberExpression","endLine":191,"endColumn":65},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":336,"column":14,"nodeType":"MemberExpression","endLine":336,"endColumn":58},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":339,"column":29,"nodeType":"MemberExpression","endLine":339,"endColumn":70},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":340,"column":35,"nodeType":"MemberExpression","endLine":340,"endColumn":76},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":342,"column":33,"nodeType":"MemberExpression","endLine":342,"endColumn":74},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":379,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":379,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13030,13033],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13030,13033],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":21,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { Survey, SurveyResponse } from '../../types/survey';\nimport { surveyService } from '../../services/surveyService';\nimport { translationService } from '../../services/translationService';\nimport QuestionRenderer from '../../components/surveys/QuestionRenderer';\nimport SurveyProgress from '../../components/surveys/SurveyProgress';\nimport DashboardButton from '../../components/navigation/DashboardButton';\nimport LanguageSwitcher from '../../components/LanguageSwitcher';\nimport LanguageTabs from '../../components/translation/LanguageTabs';\nimport { MultilingualSurvey, SupportedLanguage, TranslationStatus } from '../../types/multilingual';\n\nconst TakeSurvey: React.FC = () => {\n  const { t } = useTranslation();\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n\n  const [survey, setSurvey] = useState<Survey | null>(null);\n  const [multilingualSurvey, setMultilingualSurvey] = useState<MultilingualSurvey | null>(null);\n  const [selectedLanguage, setSelectedLanguage] = useState<SupportedLanguage>('th');\n  const [translationStatus, setTranslationStatus] = useState<Record<SupportedLanguage, TranslationStatus>>({\n    th: 'original',\n    en: 'pending',\n    'zh-CN': 'pending'\n  });\n  const [existingResponse, setExistingResponse] = useState<SurveyResponse | null>(null);\n  const [answers, setAnswers] = useState<Record<string, any>>({});\n  const [currentQuestion, setCurrentQuestion] = useState(0);\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const [isCompleted, setIsCompleted] = useState(false);\n\n  // Get display content based on selected language\n  const getDisplayContent = () => {\n    if (!multilingualSurvey || selectedLanguage === multilingualSurvey.originalLanguage) {\n      return survey;\n    }\n\n    // Check if translations exist\n    if (!multilingualSurvey.translations || typeof multilingualSurvey.translations !== 'object') {\n      return survey;\n    }\n\n    const translation = multilingualSurvey.translations[selectedLanguage];\n    if (!translation) {\n      return survey;\n    }\n\n    return {\n      ...survey,\n      title: translation.title || survey?.title,\n      description: translation.description || survey?.description,\n      questions: translation.questions || survey?.questions\n    };\n  };\n\n  useEffect(() => {\n    if (id) {\n      loadSurvey(id);\n    }\n  }, [id]);\n\n  // Track language changes\n  useEffect(() => {\n    // Language change effect - can add analytics tracking here if needed\n  }, [selectedLanguage, multilingualSurvey]);\n\n  // Get display content based on selected language (moved here to fix hooks order)\n  const displayContent = useMemo(() => getDisplayContent(), [multilingualSurvey, selectedLanguage, survey]);\n\n  // Auto-save every 30 seconds\n  useEffect(() => {\n    if (survey && Object.keys(answers).length > 0) {\n      const interval = setInterval(() => {\n        saveProgress();\n      }, 30000);\n\n      return () => clearInterval(interval);\n    }\n  }, [survey, answers]);\n\n  const loadSurvey = async (surveyId: string) => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      const [surveyData, responseData, translationsData] = await Promise.all([\n        surveyService.getSurveyById(surveyId),\n        surveyService.getUserResponse(surveyId),\n        translationService.getSurveyTranslations(surveyId)\n      ]);\n\n      setSurvey(surveyData);\n      setExistingResponse(responseData);\n\n      // Load translations if available\n      if (translationsData) {\n        const multilingualData: MultilingualSurvey = {\n          ...translationsData,\n          originalLanguage: translationsData.original_language || 'th',\n          availableLanguages: translationsData.available_languages || ['th'],\n          translationStatus: 'none',\n          translations: translationsData.translations || {}\n        };\n        \n        setMultilingualSurvey(multilingualData);\n        \n        // Update translation status\n        const newStatus: Record<SupportedLanguage, TranslationStatus> = {\n          th: 'original',\n          en: 'pending',\n          'zh-CN': 'pending'\n        };\n        \n        if (translationsData.translations && typeof translationsData.translations === 'object') {\n          Object.keys(translationsData.translations).forEach((lang) => {\n            if (lang !== translationsData.original_language) {\n              newStatus[lang as SupportedLanguage] = 'translated';\n            }\n          });\n        }\n        \n        setTranslationStatus(newStatus);\n        setSelectedLanguage(translationsData.original_language || 'th');\n      }\n\n      if (responseData) {\n        // Allow retaking surveys - always start fresh for multiple submissions\n        setAnswers({});\n        setIsCompleted(false);\n        setCurrentQuestion(0);\n      }\n    } catch (err: any) {\n      console.error('Error loading survey:', err);\n      setError(err.response?.data?.message || t('surveys.errors.loadFailed'));\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const saveProgress = async (isCompletingNow = false) => {\n    if (!survey || !id) {return;}\n\n    try {\n      setSaving(true);\n      \n      const isComplete = isCompletingNow || surveyService.isResponseComplete(survey, answers);\n      \n      await surveyService.submitResponse({\n        survey_id: id,\n        answers,\n        is_completed: isComplete\n      });\n\n      if (isComplete && isCompletingNow) {\n        setIsCompleted(true);\n        const displayContent = getDisplayContent();\n        setCurrentQuestion(displayContent?.questions?.length || 0);\n      }\n    } catch (err: any) {\n      console.error('Error saving progress:', err);\n      setError(err.response?.data?.message || t('surveys.errors.saveFailed'));\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleAnswerChange = (questionId: string, answer: any) => {\n    setAnswers(prev => ({\n      ...prev,\n      [questionId]: answer\n    }));\n\n    // Clear error for this question\n    if (errors[questionId]) {\n      setErrors(prev => {\n        const newErrors = { ...prev };\n        delete newErrors[questionId];\n        return newErrors;\n      });\n    }\n  };\n\n  const validateCurrentQuestion = (): boolean => {\n    const displayContent = getDisplayContent();\n    if (!displayContent || currentQuestion >= (displayContent.questions?.length || 0)) {return true;}\n\n    const question = displayContent.questions?.[currentQuestion];\n    if (!question) {return true;}\n    \n    const answer = answers[question.id];\n    \n    if (!surveyService.validateAnswer(question, answer)) {\n      setErrors({\n        [question.id]: question.required \n          ? t('surveys.errors.required')\n          : t('surveys.errors.invalid')\n      });\n      return false;\n    }\n\n    return true;\n  };\n\n  const goToNext = () => {\n    if (!validateCurrentQuestion()) {return;}\n\n    const displayContent = getDisplayContent();\n    if (displayContent && currentQuestion < (displayContent.questions?.length || 0) - 1) {\n      setCurrentQuestion(prev => prev + 1);\n      saveProgress();\n    } else {\n      // Last question, complete survey\n      saveProgress(true);\n    }\n  };\n\n  const goToPrevious = () => {\n    if (currentQuestion > 0) {\n      setCurrentQuestion(prev => prev - 1);\n    }\n  };\n\n  const goToQuestion = (index: number) => {\n    setCurrentQuestion(index);\n  };\n\n  const exitSurvey = () => {\n    if (Object.keys(answers).length > 0) {\n      saveProgress();\n    }\n    navigate('/surveys');\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-4xl mx-auto p-4\">\n          <div className=\"flex justify-center items-center h-64\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\" />\n            <span className=\"ml-3 text-gray-600\">{t('surveys.loading')}</span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-4xl mx-auto p-4\">\n          <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md\">\n            <p>{error}</p>\n          </div>\n          <div className=\"mt-4\">\n            <button\n              onClick={() => navigate('/surveys')}\n              className=\"bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-md transition-colors\"\n            >\n              {t('surveys.backToList')}\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!survey) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-4xl mx-auto p-4\">\n          <div className=\"text-center py-12\">\n            <p className=\"text-gray-500\">{t('surveys.notFound')}</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const progress = surveyService.calculateProgress(answers, displayContent?.questions?.length || 0);\n  const isLastQuestion = currentQuestion >= (displayContent?.questions?.length || 0) - 1;\n  const isCompletionPage = currentQuestion >= (displayContent?.questions?.length || 0);\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center py-6\">\n            <div className=\"flex items-center\">\n              <h1 className=\"text-2xl font-bold text-gray-900\">{displayContent?.title}</h1>\n              <span className=\"ml-4 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full\">\n                {selectedLanguage.toUpperCase()}\n              </span>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <LanguageSwitcher />\n              <DashboardButton variant=\"outline\" size=\"md\" />\n              <button\n                onClick={exitSurvey}\n                className=\"text-gray-600 hover:text-gray-900 font-medium text-sm\"\n              >\n                {t('surveys.exit')}\n              </button>\n            </div>\n          </div>\n          \n          {/* Language Tabs - show if we have multilingual survey data */}\n          {multilingualSurvey && (\n            <div className=\"border-t border-gray-200\">\n              <div className=\"px-4 sm:px-6 lg:px-8\">\n                <LanguageTabs\n                  languages={['th', 'en', 'zh-CN']}\n                  currentLanguage={selectedLanguage}\n                  onLanguageChange={setSelectedLanguage}\n                />\n              </div>\n            </div>\n          )}\n        </div>\n      </header>\n\n      {/* Content */}\n      <main className=\"max-w-2xl mx-auto p-4\">\n        {!isCompletionPage ? (\n          <>\n            <SurveyProgress\n              current={currentQuestion + 1}\n              total={displayContent?.questions?.length || 0}\n              progress={progress}\n            />\n\n            {displayContent?.questions?.[currentQuestion] && (\n              <div className=\"bg-white rounded-lg shadow-md p-6 mb-6\">\n                <QuestionRenderer\n                  question={displayContent.questions[currentQuestion]}\n                  answer={answers[displayContent.questions[currentQuestion].id]}\n                  onAnswerChange={handleAnswerChange}\n                  error={errors[displayContent.questions[currentQuestion].id]}\n                />\n              </div>\n            )}\n\n            {/* Navigation */}\n            <div className=\"flex justify-between items-center\">\n              <button\n                onClick={goToPrevious}\n                disabled={currentQuestion === 0}\n                className=\"bg-gray-100 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed text-gray-700 font-medium py-2 px-4 rounded-md transition-colors\"\n              >\n                {t('surveys.previous')}\n              </button>\n\n              <div className=\"flex items-center space-x-2\">\n                {saving && (\n                  <span className=\"text-sm text-gray-500\">\n                    {t('surveys.saving')}\n                  </span>\n                )}\n                \n                <button\n                  onClick={goToNext}\n                  disabled={saving}\n                  className=\"bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white font-medium py-2 px-4 rounded-md transition-colors\"\n                >\n                  {isLastQuestion \n                    ? t('surveys.complete')\n                    : t('surveys.next')\n                  }\n                </button>\n              </div>\n            </div>\n\n            {/* Question navigation dots */}\n            <div className=\"flex justify-center mt-6 space-x-2\">\n              {displayContent?.questions?.map((question: any, index: number) => (\n                <button\n                  key={index}\n                  onClick={() => goToQuestion(index)}\n                  className={`w-3 h-3 rounded-full transition-colors ${\n                    index === currentQuestion\n                      ? 'bg-blue-600'\n                      : answers[question.id]\n                      ? 'bg-green-400'\n                      : 'bg-gray-300'\n                  }`}\n                />\n              ))}\n            </div>\n          </>\n        ) : (\n          /* Completion Page */\n          <div className=\"bg-white rounded-lg shadow-md p-8 text-center\">\n            <div className=\"text-6xl mb-4\">üéâ</div>\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">\n              {t('surveys.completed.title')}\n            </h2>\n            <p className=\"text-gray-600 mb-6\">\n              {t('surveys.completed.message')}\n            </p>\n            \n            <div className=\"bg-green-50 border border-green-200 rounded-lg p-4 mb-6\">\n              <p className=\"text-green-800 text-sm\">\n                ‚úì {t('surveys.completed.saved')}\n              </p>\n            </div>\n\n            <div className=\"flex justify-center space-x-4\">\n              <button\n                onClick={() => navigate('/surveys')}\n                className=\"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors\"\n              >\n                {t('surveys.backToList')}\n              </button>\n            </div>\n          </div>\n        )}\n      </main>\n    </div>\n  );\n};\n\nexport default TakeSurvey;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/services/adminService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/services/authService.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":25,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":25,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[645,812],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":31,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":31,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[840,983],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":37,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":37,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1026,1091],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":40,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":40,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1119,1251],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":48,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":48,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1301,1365],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":94,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":94,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2840,2893],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":96,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":96,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2971,3139],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":120,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":120,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3551,3601],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":122,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":122,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3678,3839],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4495,4498],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4495,4498],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":169,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5026,5029],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5026,5029],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":170,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":170,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5039,5110],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import axios from 'axios';\n\nconst API_URL = import.meta.env.VITE_API_URL || 'http://localhost:4000/api';\n\nconst api = axios.create({\n  baseURL: API_URL,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\n// Add auth token to requests\napi.interceptors.request.use(\n  (config) => {\n    // Get token from Zustand persist storage\n    const authStorage = localStorage.getItem('auth-storage');\n    \n    if (authStorage) {\n      try {\n        const parsedAuth = JSON.parse(authStorage);\n        const token = parsedAuth.state?.accessToken;\n        \n        if (token) {\n          config.headers.Authorization = `Bearer ${token}`;\n          console.log('[Auth Debug] Request interceptor adding token', {\n            url: config.url,\n            hasToken: true,\n            method: config.method\n          });\n        } else {\n          console.log('[Auth Debug] Request interceptor - no token found', {\n            url: config.url,\n            method: config.method\n          });\n        }\n      } catch (error) {\n        console.error('[Auth Debug] Error parsing auth storage:', error);\n      }\n    } else {\n      console.log('[Auth Debug] Request interceptor - no auth storage', {\n        url: config.url,\n        method: config.method\n      });\n    }\n    return config;\n  },\n  (error) => {\n    console.error('[Auth Debug] Request interceptor error:', error);\n    return Promise.reject(error);\n  }\n);\n\n// Handle token refresh\napi.interceptors.response.use(\n  (response) => response,\n  async (error) => {\n    const originalRequest = error.config;\n\n    if (error.response?.status === 401 && !originalRequest._retry) {\n      originalRequest._retry = true;\n\n      try {\n        // Get refresh token from Zustand persist storage\n        const authStorage = localStorage.getItem('auth-storage');\n        if (authStorage) {\n          const parsedAuth = JSON.parse(authStorage);\n          const refreshToken = parsedAuth.state?.refreshToken;\n          \n          if (refreshToken) {\n            const response = await authService.refreshToken(refreshToken);\n            \n            // Update the Zustand storage with new tokens\n            parsedAuth.state.accessToken = response.tokens.accessToken;\n            parsedAuth.state.refreshToken = response.tokens.refreshToken;\n            localStorage.setItem('auth-storage', JSON.stringify(parsedAuth));\n            \n            originalRequest.headers.Authorization = `Bearer ${response.tokens.accessToken}`;\n            return api(originalRequest);\n          }\n        }\n      } catch (refreshError) {\n        // Refresh failed, clear auth and redirect to login\n        localStorage.removeItem('auth-storage');\n        window.location.href = '/login';\n      }\n    }\n\n    return Promise.reject(error);\n  }\n);\n\nexport const authService = {\n  async login(email: string, password: string) {\n    console.log('[Auth Debug] Login attempt', { email });\n    const response = await api.post('/auth/login', { email, password });\n    console.log('[Auth Debug] Login response', { \n      success: response.data.success,\n      hasUser: !!response.data.user,\n      hasTokens: !!response.data.tokens\n    });\n    return response.data;\n  },\n\n  async register(data: {\n    email: string;\n    password: string;\n    firstName: string;\n    lastName: string;\n    phone?: string;\n  }) {\n    const response = await api.post('/auth/register', data);\n    return response.data;\n  },\n\n  async logout(refreshToken: string) {\n    await api.post('/auth/logout', { refreshToken });\n  },\n\n  async refreshToken(refreshToken: string) {\n    console.log('[Auth Debug] Token refresh attempt');\n    const response = await api.post('/auth/refresh', { refreshToken });\n    console.log('[Auth Debug] Token refresh response', { \n      success: !!response.data.tokens,\n      hasNewAccessToken: !!response.data.tokens?.accessToken\n    });\n    return response.data;\n  },\n\n  async resetPasswordRequest(email: string) {\n    const response = await api.post('/auth/reset-password/request', { email });\n    return response.data;\n  },\n\n  async resetPassword(token: string, password: string) {\n    const response = await api.post('/auth/reset-password', { token, password });\n    return response.data;\n  },\n\n  async getCurrentUser() {\n    const response = await api.get('/auth/me');\n    return response.data;\n  },\n  \n  async getMe() {\n    const response = await api.get('/auth/me');\n    return response.data;\n  },\n\n  async apiCall(url: string, method: 'GET' | 'POST' | 'PUT' | 'DELETE' = 'GET', data?: any) {\n    try {\n      let response;\n      switch (method) {\n        case 'GET':\n          response = await api.get(url);\n          break;\n        case 'POST':\n          response = await api.post(url, data);\n          break;\n        case 'PUT':\n          response = await api.put(url, data);\n          break;\n        case 'DELETE':\n          response = await api.delete(url);\n          break;\n        default:\n          throw new Error(`Unsupported HTTP method: ${method}`);\n      }\n      return response.data;\n    } catch (error: any) {\n      console.error(`[Auth Debug] API call failed: ${method} ${url}`, error);\n      throw error;\n    }\n  },\n};\n\nexport default api;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/services/couponService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1252,1255],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1252,1255],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3502,3505],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3502,3505],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":110,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":113,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3716,3719],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3716,3719],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4377,4380],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4377,4380],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4644,4647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4644,4647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":214,"column":32,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":214,"endColumn":34,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[5684,5686],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":216,"column":33,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":216,"endColumn":35,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[5752,5754],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":261,"column":58,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":261,"endColumn":60,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[6974,6976],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":268,"column":48,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":268,"endColumn":50,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[7260,7262],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":293,"column":47,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":293,"endColumn":49,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[7873,7875],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import axios from 'axios';\nimport { addAuthTokenInterceptor } from '../utils/axiosInterceptor';\nimport type {\n  Coupon,\n  UserActiveCoupon,\n  CreateCouponRequest,\n  UpdateCouponRequest,\n  AssignCouponRequest,\n  RedeemCouponRequest,\n  RedeemCouponResponse,\n  CouponListResponse,\n  UserCouponListResponse,\n  CouponStatsResponse,\n  CouponType,\n  CouponStatus\n} from '../types/coupon';\n\nconst API_URL = import.meta.env.VITE_API_URL || 'http://localhost:4000/api';\n\n// Create axios instance with auth interceptor\nconst api = axios.create({\n  baseURL: API_URL,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\n// Add auth token interceptor\naddAuthTokenInterceptor(api);\n\nexport class CouponService {\n  // Customer coupon management\n  async getUserCoupons(page: number = 1, limit: number = 20): Promise<UserCouponListResponse> {\n    const response = await api.get(`/coupons/my-coupons`, {\n      params: { page, limit }\n    });\n    return response.data.data;\n  }\n\n  async redeemCoupon(data: RedeemCouponRequest): Promise<RedeemCouponResponse> {\n    const response = await api.post(`/coupons/redeem`, data);\n    return response.data.data;\n  }\n\n  async validateCoupon(qrCode: string): Promise<{\n    success: boolean;\n    valid: boolean;\n    data?: any;\n    message: string;\n  }> {\n    const response = await api.get(`/coupons/validate/${qrCode}`);\n    return response.data;\n  }\n\n  // Public coupon listing\n  async listCoupons(\n    page: number = 1,\n    limit: number = 20,\n    filters: {\n      status?: CouponStatus;\n      type?: CouponType;\n      search?: string;\n    } = {}\n  ): Promise<CouponListResponse> {\n    const response = await api.get(`/coupons`, {\n      params: { page, limit, ...filters }\n    });\n    return response.data.data;\n  }\n\n  async getCoupon(couponId: string): Promise<Coupon> {\n    const response = await api.get(`/coupons/${couponId}`);\n    return response.data.data;\n  }\n\n  // Alias for compatibility with existing code\n  async getCoupons(\n    page: number = 1,\n    limit: number = 20,\n    filters: {\n      status?: CouponStatus;\n      type?: CouponType;\n      search?: string;\n    } = {}\n  ): Promise<CouponListResponse> {\n    return this.getAdminCoupons(page, limit, filters);\n  }\n\n  // Multilingual support method\n  async getCouponWithTranslations(couponId: string): Promise<Coupon> {\n    const response = await api.get(`/coupons/${couponId}/translations`);\n    return response.data.data;\n  }\n\n  // Admin coupon management\n  async getAdminCoupons(\n    page: number = 1,\n    limit: number = 20,\n    filters: {\n      status?: CouponStatus;\n      type?: CouponType;\n      search?: string;\n    } = {}\n  ): Promise<CouponListResponse> {\n    const response = await api.get(`/coupons`, {\n      params: { page, limit, ...filters }\n    });\n    return response.data.data;\n  }\n\n  async createCoupon(data: CreateCouponRequest): Promise<Coupon> {\n    const response = await api.post(`/coupons`, data);\n    return response.data.data;\n  }\n\n  async updateCoupon(couponId: string, data: UpdateCouponRequest): Promise<Coupon> {\n    const response = await api.put(`/coupons/${couponId}`, data);\n    return response.data.data;\n  }\n\n  async deleteCoupon(couponId: string): Promise<void> {\n    await api.delete(`/coupons/${couponId}`);\n  }\n\n  async updateCouponStatus(couponId: string, status: CouponStatus): Promise<Coupon> {\n    const response = await api.put(`/coupons/${couponId}`, { status });\n    return response.data.data;\n  }\n\n  async assignCoupon(data: AssignCouponRequest): Promise<any> {\n    const response = await api.post(`/coupons/assign`, data);\n    return response.data.data;\n  }\n\n  async assignCouponToUsers(data: { couponId: string; userIds: string[]; assignedReason?: string }): Promise<any> {\n    const response = await api.post(`/coupons/assign`, data);\n    return response.data.data;\n  }\n\n  async revokeUserCoupon(userCouponId: string, reason?: string): Promise<void> {\n    await api.post(`/coupons/user-coupons/${userCouponId}/revoke`, {\n      reason\n    });\n  }\n\n  // Admin analytics and reporting\n  async getCouponStats(): Promise<CouponStatsResponse> {\n    const response = await api.get(`/coupons/analytics/stats`);\n    return response.data.data;\n  }\n\n  async getCouponAnalytics(\n    page: number = 1,\n    limit: number = 20,\n    filters: {\n      couponId?: string;\n      startDate?: string;\n      endDate?: string;\n    } = {}\n  ): Promise<any> {\n    const response = await api.get(`/coupons/analytics/data`, {\n      params: { page, limit, ...filters }\n    });\n    return response.data.data;\n  }\n\n  async getCouponRedemptions(\n    couponId: string,\n    page: number = 1,\n    limit: number = 20\n  ): Promise<any> {\n    const response = await api.get(`/coupons/${couponId}/redemptions`, {\n      params: { page, limit }\n    });\n    return response.data.data;\n  }\n\n  async getCouponAssignments(\n    couponId: string,\n    page: number = 1,\n    limit: number = 20\n  ): Promise<{\n    assignments: Array<{\n      userId: string;\n      firstName: string;\n      lastName: string;\n      email: string;\n      assignedCount: number;\n      usedCount: number;\n      availableCount: number;\n      latestAssignment: Date;\n    }>;\n    summary: {\n      totalUsers: number;\n      totalAssigned: number;\n      totalUsed: number;\n      totalAvailable: number;\n    };\n    total: number;\n    page: number;\n    limit: number;\n    totalPages: number;\n  }> {\n    const response = await api.get(`/coupons/${couponId}/assignments`, {\n      params: { page, limit }\n    });\n    return response.data.data;\n  }\n\n  // Utility methods\n  formatCouponValue(coupon: Coupon | UserActiveCoupon): string {\n    switch (coupon.type) {\n      case 'percentage':\n        return `${coupon.value || 0}%`;\n      case 'fixed_amount':\n        return `‡∏ø${coupon.value || 0}`;\n      case 'bogo':\n        return 'Buy One Get One';\n      case 'free_upgrade':\n        return 'Free Upgrade';\n      case 'free_service':\n        return 'Free Service';\n      default:\n        return 'Special Offer';\n    }\n  }\n\n  formatMinimumSpend(coupon: Coupon | UserActiveCoupon): string | null {\n    if (!coupon.minimumSpend) {return null;}\n    return `Min. spend ‡∏ø${coupon.minimumSpend}`;\n  }\n\n  formatMaximumDiscount(coupon: Coupon | UserActiveCoupon): string | null {\n    if (!coupon.maximumDiscount) {return null;}\n    return `Max. discount ‡∏ø${coupon.maximumDiscount}`;\n  }\n\n  calculateDiscount(\n    coupon: Coupon | UserActiveCoupon,\n    originalAmount: number\n  ): {\n    discountAmount: number;\n    finalAmount: number;\n    isValid: boolean;\n    errorMessage?: string;\n  } {\n    // Check minimum spend\n    if (coupon.minimumSpend && originalAmount < coupon.minimumSpend) {\n      return {\n        discountAmount: 0,\n        finalAmount: originalAmount,\n        isValid: false,\n        errorMessage: `Minimum spend of ‡∏ø${coupon.minimumSpend} required`\n      };\n    }\n\n    let discountAmount = 0;\n\n    switch (coupon.type) {\n      case 'percentage':\n        discountAmount = originalAmount * ((coupon.value || 0) / 100);\n        // Apply maximum discount if set\n        if (coupon.maximumDiscount && discountAmount > coupon.maximumDiscount) {\n          discountAmount = coupon.maximumDiscount;\n        }\n        break;\n      case 'fixed_amount':\n        discountAmount = Math.min(coupon.value || 0, originalAmount);\n        break;\n      case 'bogo':\n        // Assume 50% discount for BOGO\n        discountAmount = originalAmount * 0.5;\n        break;\n      default:\n        // For other types, no automatic calculation\n        discountAmount = 0;\n    }\n\n    const finalAmount = Math.max(0, originalAmount - discountAmount);\n\n    return {\n      discountAmount,\n      finalAmount,\n      isValid: true\n    };\n  }\n\n  isExpiringSoon(coupon: UserActiveCoupon): boolean {\n    return coupon.expiringSoon;\n  }\n\n  getExpiryDate(coupon: UserActiveCoupon): Date | null {\n    const expiryDate = coupon.effectiveExpiry || coupon.expiresAt;\n    return expiryDate ? new Date(expiryDate) : null;\n  }\n\n  formatExpiryDate(coupon: UserActiveCoupon): string | null {\n    const expiryDate = this.getExpiryDate(coupon);\n    if (!expiryDate) {return null;}\n\n    const now = new Date();\n    const timeDiff = expiryDate.getTime() - now.getTime();\n    const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));\n\n    if (daysDiff < 0) {return 'Expired';}\n    if (daysDiff === 0) {return 'Expires today';}\n    if (daysDiff === 1) {return 'Expires tomorrow';}\n    if (daysDiff <= 7) {return `Expires in ${daysDiff} days`;}\n\n    return expiryDate.toLocaleDateString();\n  }\n\n  async revokeUserCouponsForCoupon(\n    couponId: string,\n    userId: string,\n    reason?: string\n  ): Promise<{\n    success: boolean;\n    message: string;\n    revokedCount: number;\n  }> {\n    const response = await api.post(`/coupons/${couponId}/users/${userId}/revoke`, {\n      reason\n    });\n    return response.data;\n  }\n}\n\nexport const couponService = new CouponService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/services/loyaltyService.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":28,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":28,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[725,777],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":120,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":120,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2785,2831],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":133,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":133,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3139,3194],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":146,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":146,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3513,3572],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":161,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":161,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3973,4028],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":180,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":180,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4487,4542],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":196,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4863,4866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4863,4866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":204,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":204,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5092,5157],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":241,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":241,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[6007,6054],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":265,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":265,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[6539,6587],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":284,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":284,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[7049,7117],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":292,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":292,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7281,7284],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7281,7284],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":297,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":297,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[7431,7485],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":310,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":310,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[7820,7867],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":341,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":341,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[8596,8657],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import axios from 'axios';\n\nconst API_URL = import.meta.env?.VITE_API_URL || 'http://localhost:4000/api';\n\n// Create axios instance with auth interceptor\nconst api = axios.create({\n  baseURL: API_URL,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\n// Add auth token to requests\napi.interceptors.request.use(\n  (config) => {\n    // Get token from Zustand persist storage\n    const authStorage = localStorage.getItem('auth-storage');\n    \n    if (authStorage) {\n      try {\n        const parsedAuth = JSON.parse(authStorage);\n        const token = parsedAuth.state?.accessToken;\n        \n        if (token) {\n          config.headers.Authorization = `Bearer ${token}`;\n        }\n      } catch (error) {\n        console.error('Error parsing auth storage:', error);\n      }\n    }\n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);\n\nexport interface Tier {\n  id: string;\n  name: string;\n  min_points: number; // This will represent min_nights in the new system\n  min_nights?: number; // Explicit nights field for clarity\n  benefits: {\n    description: string;\n    perks: string[];\n  };\n  color: string;\n  sort_order: number;\n}\n\nexport interface UserLoyaltyStatus {\n  user_id: string;\n  current_points: number;\n  total_nights?: number;\n  tier_name: string;\n  tier_color: string;\n  tier_benefits: {\n    description: string;\n    perks: string[];\n  };\n  tier_level: number;\n  progress_percentage: number;\n  next_tier_points: number | null;\n  next_tier_name: string | null;\n  points_to_next_tier: number | null;\n  // New nights-based fields\n  next_tier_nights?: number | null;\n  nights_to_next_tier?: number | null;\n}\n\nexport interface PointsTransaction {\n  id: string;\n  user_id: string;\n  points: number;\n  type: string;\n  description: string | null;\n  reference_id: string | null;\n  admin_user_id: string | null;\n  admin_reason: string | null;\n  admin_email?: string;\n  expires_at: string | null;\n  created_at: string;\n}\n\nexport interface PointsCalculation {\n  current_points: number;\n  expiring_points: number;\n  next_expiry_date: string | null;\n}\n\nexport interface PointsHistoryResponse {\n  transactions: PointsTransaction[];\n  total: number;\n}\n\nexport interface AdminUserLoyalty extends UserLoyaltyStatus {\n  first_name: string | null;\n  last_name: string | null;\n  email: string;\n  oauth_provider: string | null;\n  oauth_provider_id: string | null;\n  user_created_at: string;\n  membership_id?: string | null;\n}\n\nexport interface AdminUsersResponse {\n  users: AdminUserLoyalty[];\n  total: number;\n}\n\nexport class LoyaltyService {\n  /**\n   * Get all available loyalty tiers\n   */\n  async getTiers(): Promise<Tier[]> {\n    try {\n      const response = await api.get('/loyalty/tiers');\n      return response.data.data;\n    } catch (error) {\n      console.error('Error fetching tiers:', error);\n      throw new Error('Failed to fetch loyalty tiers');\n    }\n  }\n\n  /**\n   * Get current user's loyalty status\n   */\n  async getUserLoyaltyStatus(): Promise<UserLoyaltyStatus> {\n    try {\n      const response = await api.get('/loyalty/status');\n      return response.data.data;\n    } catch (error) {\n      console.error('Error fetching loyalty status:', error);\n      throw new Error('Failed to fetch loyalty status');\n    }\n  }\n\n  /**\n   * Get detailed points calculation\n   */\n  async getPointsCalculation(): Promise<PointsCalculation> {\n    try {\n      const response = await api.get('/loyalty/points/calculation');\n      return response.data.data;\n    } catch (error) {\n      console.error('Error fetching points calculation:', error);\n      throw new Error('Failed to fetch points calculation');\n    }\n  }\n\n  /**\n   * Get user's points transaction history\n   */\n  async getPointsHistory(limit: number = 50, offset: number = 0): Promise<PointsHistoryResponse> {\n    try {\n      const response = await api.get('/loyalty/history', {\n        params: { limit, offset }\n      });\n      return response.data.data;\n    } catch (error) {\n      console.error('Error fetching points history:', error);\n      throw new Error('Failed to fetch points history');\n    }\n  }\n\n  /**\n   * Simulate earning points for a hotel stay\n   */\n  async simulateStayEarning(amountSpent: number, stayId?: string): Promise<{\n    transactionId: string;\n    loyaltyStatus: UserLoyaltyStatus;\n  }> {\n    try {\n      const response = await api.post('/loyalty/simulate-stay', {\n        amountSpent,\n        stayId\n      });\n      return response.data.data;\n    } catch (error) {\n      console.error('Error simulating stay earning:', error);\n      throw new Error('Failed to simulate stay earning');\n    }\n  }\n\n  // Admin methods\n\n  /**\n   * Get all users' loyalty status (admin only)\n   */\n  async getAllUsersLoyaltyStatus(\n    limit: number = 50,\n    offset: number = 0,\n    searchTerm?: string\n  ): Promise<AdminUsersResponse> {\n    try {\n      const params: any = { limit, offset };\n      if (searchTerm) {\n        params.search = searchTerm;\n      }\n\n      const response = await api.get('/loyalty/admin/users', { params });\n      return response.data.data;\n    } catch (error) {\n      console.error('Error fetching all users loyalty status:', error);\n      throw new Error('Failed to fetch users loyalty status');\n    }\n  }\n\n  /**\n   * Get users for coupon assignment (admin only) - Alias for getAllUsersLoyaltyStatus\n   */\n  async getUsers(\n    limit: number = 50,\n    offset: number = 0,\n    searchTerm?: string\n  ): Promise<AdminUsersResponse> {\n    return this.getAllUsersLoyaltyStatus(limit, offset, searchTerm);\n  }\n\n  /**\n   * Award points to a user (admin only)\n   */\n  async awardPoints(\n    userId: string,\n    points: number,\n    description?: string,\n    referenceId?: string\n  ): Promise<{\n    transactionId: string;\n    loyaltyStatus: UserLoyaltyStatus;\n  }> {\n    try {\n      const response = await api.post('/loyalty/admin/award-points', {\n        userId,\n        points,\n        description,\n        referenceId\n      });\n      return response.data.data;\n    } catch (error) {\n      console.error('Error awarding points:', error);\n      throw new Error('Failed to award points');\n    }\n  }\n\n  /**\n   * Deduct points from a user (admin only)\n   */\n  async deductPoints(\n    userId: string,\n    points: number,\n    reason: string\n  ): Promise<{\n    transactionId: string;\n    loyaltyStatus: UserLoyaltyStatus;\n  }> {\n    try {\n      const response = await api.post('/loyalty/admin/deduct-points', {\n        userId,\n        points,\n        reason\n      });\n      return response.data.data;\n    } catch (error) {\n      console.error('Error deducting points:', error);\n      throw new Error('Failed to deduct points');\n    }\n  }\n\n  /**\n   * Get specific user's points history (admin only)\n   */\n  async getUserPointsHistoryAdmin(\n    userId: string,\n    limit: number = 50,\n    offset: number = 0\n  ): Promise<PointsHistoryResponse> {\n    try {\n      const response = await api.get(`/loyalty/admin/user/${userId}/history`, {\n        params: { limit, offset }\n      });\n      return response.data.data;\n    } catch (error) {\n      console.error('Error fetching user points history (admin):', error);\n      throw new Error('Failed to fetch user points history');\n    }\n  }\n\n  /**\n   * Get points earning rules (admin only)\n   */\n  async getEarningRules(): Promise<any[]> {\n    try {\n      const response = await api.get('/loyalty/admin/earning-rules');\n      return response.data.data;\n    } catch (error) {\n      console.error('Error fetching earning rules:', error);\n      throw new Error('Failed to fetch earning rules');\n    }\n  }\n\n  /**\n   * Manually trigger points expiration (admin only)\n   */\n  async expirePoints(): Promise<{ expiredCount: number }> {\n    try {\n      const response = await api.post('/loyalty/admin/expire-points');\n      return response.data.data;\n    } catch (error) {\n      console.error('Error expiring points:', error);\n      throw new Error('Failed to expire points');\n    }\n  }\n\n  /**\n   * Award spending points with optional nights stayed (admin only)\n   */\n  async awardSpendingWithNights(\n    userId: string,\n    amountSpent: number,\n    nightsStayed: number,\n    referenceId?: string,\n    description?: string\n  ): Promise<{\n    transactionId: string;\n    pointsEarned: number;\n    newTotalNights: number;\n    newTierName: string;\n    loyaltyStatus: UserLoyaltyStatus;\n  }> {\n    try {\n      const response = await api.post('/loyalty/admin/award-spending-with-nights', {\n        userId,\n        amountSpent,\n        nightsStayed,\n        referenceId,\n        description\n      });\n      return response.data.data;\n    } catch (error) {\n      console.error('Error awarding spending with nights:', error);\n      throw new Error('Failed to award spending with nights');\n    }\n  }\n}\n\n// Export singleton instance\nexport const loyaltyService = new LoyaltyService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/services/surveyService.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":45,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":45,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[1305,1387],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1829,1832],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1829,1832],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":58,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":58,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1842,1887],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":60,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":60,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1924,2001],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3672,3675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3672,3675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":241,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":241,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7755,7758],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7755,7758],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":246,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":246,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7953,7956],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7953,7956],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":246,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":246,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7966,7969],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7966,7969],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":273,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":273,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8891,8894],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8891,8894],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import axios from 'axios';\nimport { addAuthTokenInterceptor } from '../utils/axiosInterceptor';\nimport {\n  Survey,\n  SurveyResponse,\n  SurveyInvitation,\n  CreateSurveyRequest,\n  UpdateSurveyRequest,\n  SubmitResponseRequest,\n  SurveyListResponse,\n  SurveyResponseListResponse,\n  SurveyAnalytics,\n  AssignCouponToSurveyRequest,\n  UpdateSurveyCouponAssignmentRequest,\n  SurveyCouponAssignmentListResponse,\n  SurveyRewardHistoryResponse,\n  SurveyCouponAssignment\n} from '../types/survey';\n\nconst API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:4000/api';\n\n// Create axios instance for surveys and add auth interceptor\nconst surveyAxios = axios.create({\n  baseURL: API_BASE_URL,\n});\naddAuthTokenInterceptor(surveyAxios);\n\nclass SurveyService {\n  // Admin Survey Management\n  async createSurvey(data: CreateSurveyRequest): Promise<Survey> {\n    const response = await surveyAxios.post('/surveys', data);\n    return response.data.survey;\n  }\n\n  async getSurveys(\n    page = 1, \n    limit = 10, \n    status?: string,\n    createdBy?: string\n  ): Promise<SurveyListResponse> {\n    try {\n      // Validate status parameter against known valid statuses\n      const validStatuses = ['draft', 'active', 'paused', 'completed', 'archived'];\n      if (status && !validStatuses.includes(status)) {\n        console.warn(`Invalid survey status '${status}'. Valid statuses:`, validStatuses);\n        throw new Error(`Invalid survey status: ${status}`);\n      }\n\n      const params = new URLSearchParams();\n      params.append('page', page.toString());\n      params.append('limit', limit.toString());\n      if (status) {params.append('status', status);}\n      if (createdBy) {params.append('created_by', createdBy);}\n\n      const response = await surveyAxios.get(`/surveys?${params}`);\n      return response.data;\n    } catch (error: any) {\n      console.error('Error in getSurveys:', error);\n      if (error.response) {\n        console.error('Response error:', error.response.status, error.response.data);\n      }\n      throw error;\n    }\n  }\n\n  async getSurveyById(id: string): Promise<Survey> {\n    const response = await surveyAxios.get(`/surveys/${id}`);\n    return response.data.survey;\n  }\n\n  async getSurveyWithTranslations(id: string, language?: string): Promise<Survey> {\n    const params = language ? `?language=${language}` : '';\n    const response = await surveyAxios.get(`/surveys/${id}/translations${params}`);\n    return response.data.survey;\n  }\n\n  async updateSurvey(id: string, data: UpdateSurveyRequest): Promise<Survey> {\n    const response = await surveyAxios.put(`/surveys/${id}`, data);\n    return response.data.survey;\n  }\n\n  async deleteSurvey(id: string): Promise<void> {\n    await surveyAxios.delete(`/surveys/${id}`);\n  }\n\n  // Customer Survey Experience\n  async getAvailableSurveys(): Promise<Survey[]> {\n    const response = await surveyAxios.get('/surveys/available/user');\n    return response.data.surveys;\n  }\n\n  async getPublicSurveys(): Promise<Survey[]> {\n    const response = await surveyAxios.get('/surveys/public/user');\n    return response.data.surveys;\n  }\n\n  async getInvitedSurveys(): Promise<Survey[]> {\n    const response = await surveyAxios.get('/surveys/invited/user');\n    return response.data.surveys;\n  }\n\n  async submitResponse(data: SubmitResponseRequest): Promise<SurveyResponse> {\n    const response = await surveyAxios.post('/surveys/responses', data);\n    return response.data.response;\n  }\n\n  async getUserResponse(surveyId: string): Promise<SurveyResponse | null> {\n    try {\n      const response = await surveyAxios.get(`/surveys/responses/${surveyId}/user`);\n      return response.data.response;\n    } catch (error: any) {\n      if (error.response?.status === 404) {\n        return null;\n      }\n      throw error;\n    }\n  }\n\n  // Admin Response Management\n  async getSurveyResponses(\n    surveyId: string, \n    page = 1, \n    limit = 10\n  ): Promise<SurveyResponseListResponse> {\n    const response = await surveyAxios.get(\n      `/surveys/${surveyId}/responses?page=${page}&limit=${limit}`\n    );\n    return response.data;\n  }\n\n  async getSurveyAnalytics(surveyId: string): Promise<SurveyAnalytics> {\n    const response = await surveyAxios.get(`/surveys/${surveyId}/analytics`);\n    return response.data;\n  }\n\n  async exportSurveyResponses(surveyId: string): Promise<Blob> {\n    const response = await surveyAxios.get(`/surveys/${surveyId}/export`, {\n      responseType: 'blob'\n    });\n    return response.data;\n  }\n\n  // Survey Invitations Management\n  async getSurveyInvitations(surveyId: string): Promise<SurveyInvitation[]> {\n    const response = await surveyAxios.get(`/surveys/${surveyId}/invitations`);\n    return response.data.invitations;\n  }\n\n  async sendSurveyInvitations(surveyId: string): Promise<{ sent: number }> {\n    const response = await surveyAxios.post(`/surveys/${surveyId}/invitations/send`);\n    return response.data;\n  }\n\n  async sendSurveyInvitationsToUsers(surveyId: string, userIds: string[]): Promise<{ sent: number }> {\n    const response = await surveyAxios.post(`/surveys/${surveyId}/invitations/send-to-users`, {\n      userIds\n    });\n    return response.data;\n  }\n\n  async resendInvitation(invitationId: string): Promise<void> {\n    await surveyAxios.post(`/surveys/invitations/${invitationId}/resend`);\n  }\n\n  // Survey Coupon Assignment Management\n  async assignCouponToSurvey(data: AssignCouponToSurveyRequest): Promise<SurveyCouponAssignment> {\n    const response = await surveyAxios.post('/surveys/coupon-assignments', data);\n    return response.data.assignment;\n  }\n\n  async getSurveyCouponAssignments(\n    surveyId: string,\n    page = 1,\n    limit = 20\n  ): Promise<SurveyCouponAssignmentListResponse> {\n    const response = await surveyAxios.get(\n      `/surveys/${surveyId}/coupon-assignments?page=${page}&limit=${limit}`\n    );\n    return response.data;\n  }\n\n  async updateSurveyCouponAssignment(\n    surveyId: string,\n    couponId: string,\n    data: UpdateSurveyCouponAssignmentRequest\n  ): Promise<SurveyCouponAssignment> {\n    const response = await surveyAxios.put(\n      `/surveys/${surveyId}/coupon-assignments/${couponId}`,\n      data\n    );\n    return response.data.assignment;\n  }\n\n  async removeCouponFromSurvey(surveyId: string, couponId: string): Promise<void> {\n    await surveyAxios.delete(`/surveys/${surveyId}/coupon-assignments/${couponId}`);\n  }\n\n  async getSurveyRewardHistory(\n    surveyId: string,\n    page = 1,\n    limit = 20\n  ): Promise<SurveyRewardHistoryResponse> {\n    const response = await surveyAxios.get(\n      `/surveys/${surveyId}/reward-history?page=${page}&limit=${limit}`\n    );\n    return response.data;\n  }\n\n  async getAllSurveyCouponAssignments(\n    page = 1,\n    limit = 20,\n    filters: {\n      survey_id?: string;\n      coupon_id?: string;\n      is_active?: boolean;\n      assigned_by?: string;\n    } = {}\n  ): Promise<SurveyCouponAssignmentListResponse> {\n    const params = new URLSearchParams();\n    params.append('page', page.toString());\n    params.append('limit', limit.toString());\n    \n    if (filters.survey_id) {params.append('survey_id', filters.survey_id);}\n    if (filters.coupon_id) {params.append('coupon_id', filters.coupon_id);}\n    if (filters.is_active !== undefined) {params.append('is_active', filters.is_active.toString());}\n    if (filters.assigned_by) {params.append('assigned_by', filters.assigned_by);}\n\n    const response = await surveyAxios.get(`/surveys/admin/coupon-assignments?${params}`);\n    return response.data;\n  }\n\n  // Utility methods\n  generateQuestionId(): string {\n    return 'q_' + Math.random().toString(36).substr(2, 9);\n  }\n\n  generateOptionId(): string {\n    return 'opt_' + Math.random().toString(36).substr(2, 9);\n  }\n\n  calculateProgress(answers: Record<string, any>, totalQuestions: number): number {\n    const answeredQuestions = Object.keys(answers).length;\n    return Math.round((answeredQuestions / totalQuestions) * 100);\n  }\n\n  validateAnswer(question: any, answer: any): boolean {\n    if (question.required && (answer === undefined || answer === null || answer === '')) {\n      return false;\n    }\n\n    if (answer === undefined || answer === null || answer === '') {\n      return true; // Optional question, no answer is valid\n    }\n\n    switch (question.type) {\n      case 'multiple_choice':\n        return Array.isArray(answer) && answer.length > 0;\n      case 'single_choice':\n      case 'yes_no':\n        return typeof answer === 'string' || typeof answer === 'number';\n      case 'text':\n      case 'textarea':\n        return typeof answer === 'string' && answer.trim().length > 0;\n      case 'rating_5':\n        return typeof answer === 'number' && answer >= 1 && answer <= 5;\n      case 'rating_10':\n        return typeof answer === 'number' && answer >= 1 && answer <= 10;\n      default:\n        return false;\n    }\n  }\n\n  isResponseComplete(survey: Survey, answers: Record<string, any>): boolean {\n    return survey.questions.every(question => \n      this.validateAnswer(question, answers[question.id])\n    );\n  }\n}\n\nexport const surveyService = new SurveyService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/services/translationService.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":48,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":48,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1424,1475],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":69,"column":7,"nodeType":"MemberExpression","endLine":69,"endColumn":23},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":92,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":92,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2550,2600],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":114,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":114,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3095,3145],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":127,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":127,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3436,3490],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":147,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":147,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3947,3995],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":155,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4129,4132],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4129,4132],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4280,4283],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4280,4283],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":163,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":163,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4366,4417],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4551,4554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4551,4554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":175,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4702,4705],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4702,4705],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":179,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":179,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4788,4839],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":192,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":192,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5155,5201],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":201,"column":34,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":201,"endColumn":36,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[5387,5389],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":220,"column":12,"nodeType":"MemberExpression","endLine":220,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":259,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6860,6863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6860,6863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":265,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":265,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7072,7075],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7072,7075],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":269,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":269,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7252,7255],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7252,7255],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":280,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":280,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7489,7492],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7489,7492],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import axios from 'axios';\nimport { addAuthTokenInterceptor } from '../utils/axiosInterceptor';\nimport { \n  TranslationRequest, \n  TranslationResponse, \n  SupportedLanguage, \n  TranslationServiceConfig,\n  TranslationJob \n} from '../types/multilingual';\n\nconst API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:4001/api';\n\n// Create axios instance with auth interceptor\nconst api = axios.create({\n  baseURL: API_BASE_URL,\n  timeout: 30000,\n});\n\naddAuthTokenInterceptor(api);\n\nclass TranslationService {\n  private config: TranslationServiceConfig;\n\n  constructor() {\n    // Default to Azure Translator for the generous free tier\n    this.config = {\n      provider: 'azure',\n      apiKey: import.meta.env.VITE_AZURE_TRANSLATION_KEY_1,\n      endpoint: import.meta.env.VITE_AZURE_TRANSLATION_TEXT_URI || 'https://api.cognitive.microsofttranslator.com',\n      region: import.meta.env.VITE_AZURE_TRANSLATION_REGION || 'global'\n    };\n  }\n\n  /**\n   * Translate multiple texts from source language to target languages\n   */\n  async translateTexts(request: TranslationRequest): Promise<TranslationResponse> {\n    try {\n      const response = await api.post('/translation/translate', {\n        texts: request.texts,\n        sourceLanguage: request.sourceLanguage,\n        targetLanguages: request.targetLanguages,\n        provider: this.config.provider\n      });\n\n      return response.data;\n    } catch (error) {\n      console.error('Translation service error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Translate a single text to multiple languages\n   */\n  async translateText(\n    text: string, \n    sourceLanguage: SupportedLanguage, \n    targetLanguages: SupportedLanguage[]\n  ): Promise<{ [language: string]: string }> {\n    const response = await this.translateTexts({\n      texts: [text],\n      sourceLanguage,\n      targetLanguages\n    });\n\n    const result: { [language: string]: string } = {};\n    for (const [language, translations] of Object.entries(response.translations)) {\n      result[language] = translations[0] || text;\n    }\n    \n    return result;\n  }\n\n  /**\n   * Start a translation job for a survey\n   */\n  async translateSurvey(\n    surveyId: string, \n    sourceLanguage: SupportedLanguage, \n    targetLanguages: SupportedLanguage[]\n  ): Promise<TranslationJob> {\n    try {\n      const response = await api.post(`/translation/survey/${surveyId}/translate`, {\n        sourceLanguage,\n        targetLanguages,\n        provider: this.config.provider\n      });\n\n      return response.data;\n    } catch (error) {\n      console.error('Survey translation error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Start a translation job for a coupon\n   */\n  async translateCoupon(\n    couponId: string, \n    sourceLanguage: SupportedLanguage, \n    targetLanguages: SupportedLanguage[]\n  ): Promise<TranslationJob> {\n    try {\n      const response = await api.post(`/translation/coupon/${couponId}/translate`, {\n        sourceLanguage,\n        targetLanguages,\n        provider: this.config.provider\n      });\n\n      return response.data;\n    } catch (error) {\n      console.error('Coupon translation error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get the status of a translation job\n   */\n  async getTranslationJobStatus(jobId: string): Promise<TranslationJob> {\n    try {\n      const response = await api.get(`/translation/job/${jobId}`);\n      return response.data;\n    } catch (error) {\n      console.error('Translation job status error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Alias for getTranslationJobStatus for compatibility\n   */\n  async getTranslationJob(jobId: string): Promise<TranslationJob> {\n    return this.getTranslationJobStatus(jobId);\n  }\n\n  /**\n   * Get all translation jobs\n   */\n  async getTranslationJobs(): Promise<TranslationJob[]> {\n    try {\n      const response = await api.get('/translation/jobs');\n      return response.data.jobs || [];\n    } catch (error) {\n      console.error('Translation jobs error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get survey with translations\n   */\n  async getSurveyTranslations(surveyId: string): Promise<any> {\n    try {\n      const response = await api.get(`/translation/survey/${surveyId}/translations`);\n      return response.data;\n    } catch (error: any) {\n      if (error.response?.status === 404) {\n        return null;\n      }\n      console.error('Survey translations error:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Get coupon with translations\n   */\n  async getCouponTranslations(couponId: string): Promise<any> {\n    try {\n      const response = await api.get(`/translation/coupon/${couponId}/translations`);\n      return response.data;\n    } catch (error: any) {\n      if (error.response?.status === 404) {\n        return null;\n      }\n      console.error('Coupon translations error:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Get translation service status\n   */\n  async getServiceStatus(): Promise<{ available: boolean; provider: string; charactersRemaining?: number }> {\n    try {\n      const response = await api.get('/translation/status');\n      return response.data;\n    } catch (error) {\n      console.error('Service status error:', error);\n      return { available: false, provider: 'none' };\n    }\n  }\n\n  /**\n   * Check if translation service is configured\n   */\n  isConfigured(): boolean {\n    return !!(this.config.apiKey || this.config.endpoint);\n  }\n\n  /**\n   * Get supported languages\n   */\n  getSupportedLanguages(): SupportedLanguage[] {\n    return ['th', 'en', 'zh-CN'];\n  }\n\n  /**\n   * Get language display name\n   */\n  getLanguageDisplayName(language: SupportedLanguage): string {\n    const names: { [key in SupportedLanguage]: string } = {\n      'th': '‡πÑ‡∏ó‡∏¢',\n      'en': 'English',\n      'zh-CN': '‰∏≠Êñá'\n    };\n    return names[language] || language;\n  }\n\n  /**\n   * Validate if language is supported\n   */\n  isLanguageSupported(language: string): language is SupportedLanguage {\n    return this.getSupportedLanguages().includes(language as SupportedLanguage);\n  }\n\n  /**\n   * Get default language based on browser locale\n   */\n  getDefaultLanguage(): SupportedLanguage {\n    const browserLang = navigator.language.toLowerCase();\n    \n    if (browserLang.startsWith('th')) {return 'th';}\n    if (browserLang.startsWith('zh')) {return 'zh-CN';}\n    return 'en'; // Default fallback\n  }\n\n  /**\n   * Estimate translation cost (characters)\n   */\n  estimateTranslationCost(texts: string[], targetLanguageCount: number): number {\n    const totalCharacters = texts.reduce((sum, text) => sum + text.length, 0);\n    return totalCharacters * targetLanguageCount;\n  }\n\n  /**\n   * Check if text needs translation\n   */\n  needsTranslation(text: string): boolean {\n    return !!(text && text.trim().length > 0);\n  }\n\n  /**\n   * Extract translatable texts from survey\n   */\n  extractSurveyTexts(survey: any): string[] {\n    const texts: string[] = [];\n    \n    if (survey.title) {texts.push(survey.title);}\n    if (survey.description) {texts.push(survey.description);}\n    \n    survey.questions?.forEach((question: any) => {\n      if (question.text) {texts.push(question.text);}\n      if (question.description) {texts.push(question.description);}\n      \n      question.options?.forEach((option: any) => {\n        if (option.text) {texts.push(option.text);}\n      });\n    });\n    \n    return texts.filter(text => this.needsTranslation(text));\n  }\n\n  /**\n   * Extract translatable texts from coupon\n   */\n  extractCouponTexts(coupon: any): string[] {\n    const texts: string[] = [];\n    \n    if (coupon.name) {texts.push(coupon.name);}\n    if (coupon.description) {texts.push(coupon.description);}\n    if (coupon.termsAndConditions) {texts.push(coupon.termsAndConditions);}\n    \n    return texts.filter(text => this.needsTranslation(text));\n  }\n}\n\nexport const translationService = new TranslationService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/services/userManagementService.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":28,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":28,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[725,777],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import axios from 'axios';\n\nconst API_URL = import.meta.env?.VITE_API_URL || 'http://localhost:4000/api';\n\n// Create axios instance with auth interceptor\nconst api = axios.create({\n  baseURL: API_URL,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\n// Add auth token to requests\napi.interceptors.request.use(\n  (config) => {\n    // Get token from Zustand persist storage\n    const authStorage = localStorage.getItem('auth-storage');\n    \n    if (authStorage) {\n      try {\n        const parsedAuth = JSON.parse(authStorage);\n        const token = parsedAuth.state?.accessToken;\n        \n        if (token) {\n          config.headers.Authorization = `Bearer ${token}`;\n        }\n      } catch (error) {\n        console.error('Error parsing auth storage:', error);\n      }\n    }\n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);\n\nexport interface User {\n  userId: string;\n  email: string;\n  role: string;\n  isActive: boolean;\n  emailVerified: boolean;\n  firstName?: string;\n  lastName?: string;\n  phone?: string;\n  createdAt: string;\n  avatarUrl?: string;\n  membershipId?: string;\n}\n\nexport interface UserStats {\n  total: number;\n  active: number;\n  admins: number;\n  recentlyJoined: number;\n}\n\nexport interface PaginationInfo {\n  page: number;\n  limit: number;\n  total: number;\n  pages: number;\n}\n\nexport interface UsersResponse {\n  success: boolean;\n  data: User[];\n  pagination: PaginationInfo;\n}\n\nexport interface StatsResponse {\n  success: boolean;\n  data: UserStats;\n}\n\nexport interface UserResponse {\n  success: boolean;\n  data: User;\n}\n\nexport const userManagementService = {\n  async getUsers(page = 1, limit = 10, search = ''): Promise<UsersResponse> {\n    const params = new URLSearchParams({\n      page: page.toString(),\n      limit: limit.toString(),\n    });\n    \n    if (search) {\n      params.append('search', search);\n    }\n\n    const response = await api.get(`/users/admin/users?${params}`);\n    return response.data;\n  },\n\n  async getUserStats(): Promise<StatsResponse> {\n    const response = await api.get('/users/admin/stats');\n    return response.data;\n  },\n\n  async getUserById(userId: string): Promise<UserResponse> {\n    const response = await api.get(`/users/admin/users/${userId}`);\n    return response.data;\n  },\n\n  async updateUserStatus(userId: string, isActive: boolean): Promise<{ success: boolean; message: string }> {\n    const response = await api.patch(`/users/admin/users/${userId}/status`, {\n      isActive\n    });\n    return response.data;\n  },\n\n  async updateUserRole(userId: string, role: string): Promise<{ success: boolean; message: string }> {\n    const response = await api.patch(`/users/admin/users/${userId}/role`, {\n      role\n    });\n    return response.data;\n  },\n\n  async deleteUser(userId: string): Promise<{ success: boolean; message: string }> {\n    const response = await api.delete(`/users/admin/users/${userId}`);\n    return response.data;\n  }\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/services/userService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[196,199],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[196,199],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2494,2497],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2494,2497],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import api from './authService';\n\nexport interface UserProfile {\n  userId: string;\n  firstName: string;\n  lastName: string;\n  phone?: string;\n  dateOfBirth?: string;\n  preferences: Record<string, any>;\n  avatarUrl?: string;\n  membershipId?: string;\n  gender?: string;\n  occupation?: string;\n  interests?: string[];\n  profileCompleted?: boolean;\n  profileCompletedAt?: string;\n  newMemberCouponAwarded?: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface ProfileCompletionStatus {\n  isComplete: boolean;\n  missingFields: string[];\n  newMemberCouponAvailable: boolean;\n}\n\nexport interface User {\n  id: string;\n  email: string;\n  role: string;\n  isActive: boolean;\n  emailVerified: boolean;\n  createdAt: string;\n  firstName?: string;\n  lastName?: string;\n  phone?: string;\n  avatarUrl?: string;\n  membershipId?: string;\n}\n\nexport const userService = {\n  async getProfile(): Promise<UserProfile> {\n    const response = await api.get('/users/profile');\n    return response.data.profile;\n  },\n\n  async updateProfile(data: Partial<UserProfile>): Promise<UserProfile> {\n    const response = await api.put('/users/profile', data);\n    return response.data.profile;\n  },\n\n  async uploadAvatar(file: File): Promise<{ data: { avatarUrl: string } }> {\n    const formData = new FormData();\n    formData.append('avatar', file);\n    \n    const response = await api.post('/users/avatar', formData, {\n      headers: {\n        'Content-Type': 'multipart/form-data',\n      },\n    });\n    return response.data;\n  },\n\n  async updateEmojiAvatar(emoji: string): Promise<UserProfile> {\n    const response = await api.put('/users/avatar/emoji', { emoji });\n    return response.data.data.profile;\n  },\n\n  async updateEmail(email: string): Promise<void> {\n    await api.put('/users/email', { email });\n  },\n\n  async deleteAvatar(): Promise<void> {\n    await api.delete('/users/avatar');\n  },\n\n  async getMyMembershipId(): Promise<{ membershipId: string }> {\n    const response = await api.get('/membership/my-id');\n    return response.data.data;\n  },\n\n  async getProfileCompletionStatus(): Promise<ProfileCompletionStatus> {\n    const response = await api.get('/users/profile-completion-status');\n    return response.data.data;\n  },\n\n  async completeProfile(data: {\n    firstName?: string;\n    lastName?: string;\n    phone?: string;\n    dateOfBirth?: string;\n    gender?: string;\n    occupation?: string;\n    interests?: string[];\n  }): Promise<{ profile: UserProfile; couponAwarded: boolean; coupon?: any }> {\n    const response = await api.put('/users/complete-profile', data);\n    return response.data.data;\n  },\n\n  // Admin functions\n  async getAllUsers(page: number = 1, limit: number = 50, search: string = ''): Promise<{\n    users: User[];\n    pagination: {\n      page: number;\n      limit: number;\n      total: number;\n      pages: number;\n    };\n  }> {\n    const params = new URLSearchParams({\n      page: page.toString(),\n      limit: limit.toString(),\n      ...(search && { search })\n    });\n    \n    const response = await api.get(`/users/admin/users?${params}`);\n    return {\n      users: response.data.data,\n      pagination: response.data.pagination\n    };\n  },\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/store/authStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1712,1715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1712,1715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2320,2323],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2320,2323],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":104,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":104,"endColumn":23,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[2962,3017],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":123,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":123,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3605,3645],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":125,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3682,3685],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3682,3685],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":126,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":126,"endColumn":23,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[3699,3761],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":131,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":131,"endColumn":25,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[4009,4071],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":180,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5493,5496],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5493,5496],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":183,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":183,"endColumn":25,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[5655,5743],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":193,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6081,6084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6081,6084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":194,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":194,"endColumn":27,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[6102,6162],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":206,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":206,"endColumn":23,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[6622,6680],"text":""},"desc":"Remove the console.warn()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport { authService } from '../services/authService';\nimport { notify } from '../utils/notificationManager';\n\ninterface User {\n  id: string;\n  email: string;\n  role: 'customer' | 'admin' | 'super_admin';\n  firstName?: string;\n  lastName?: string;\n  avatarUrl?: string;\n  oauthProvider?: string;\n  oauthProviderId?: string;\n}\n\ninterface AuthState {\n  user: User | null;\n  accessToken: string | null;\n  refreshToken: string | null;\n  isAuthenticated: boolean;\n  isLoading: boolean;\n  \n  login: (email: string, password: string) => Promise<void>;\n  register: (data: {\n    email: string;\n    password: string;\n    firstName: string;\n    lastName: string;\n    phone?: string;\n  }) => Promise<void>;\n  logout: () => Promise<void>;\n  refreshAuth: () => Promise<void>;\n  setTokens: (accessToken: string, refreshToken: string) => void;\n  clearAuth: () => void;\n  checkAuthStatus: () => Promise<boolean>;\n  updateUser: (updates: Partial<User>) => void;\n}\n\nexport const useAuthStore = create<AuthState>()(\n  persist(\n    (set, get) => ({\n      user: null,\n      accessToken: null,\n      refreshToken: null,\n      isAuthenticated: false,\n      isLoading: false,\n\n      login: async (email: string, password: string) => {\n        set({ isLoading: true });\n        try {\n          const response = await authService.login(email, password);\n          set({\n            user: response.user,\n            accessToken: response.tokens.accessToken,\n            refreshToken: response.tokens.refreshToken,\n            isAuthenticated: true,\n            isLoading: false,\n          });\n          notify.success('Welcome back!');\n        } catch (error: any) {\n          set({ isLoading: false });\n          notify.error(error.message || 'Login failed');\n          throw error;\n        }\n      },\n\n      register: async (data) => {\n        set({ isLoading: true });\n        try {\n          const response = await authService.register(data);\n          set({\n            user: response.user,\n            accessToken: response.tokens.accessToken,\n            refreshToken: response.tokens.refreshToken,\n            isAuthenticated: true,\n            isLoading: false,\n          });\n          notify.success('Account created successfully!');\n        } catch (error: any) {\n          set({ isLoading: false });\n          notify.error(error.message || 'Registration failed');\n          throw error;\n        }\n      },\n\n      logout: async () => {\n        const { refreshToken } = get();\n        try {\n          if (refreshToken) {\n            await authService.logout(refreshToken);\n          }\n        } catch (error) {\n          // Logout error - continue with local logout\n        } finally {\n          get().clearAuth();\n          notify.success('Logged out successfully');\n        }\n      },\n\n      refreshAuth: async () => {\n        const { refreshToken } = get();\n        if (!refreshToken) {\n          console.warn('No refresh token available for refresh');\n          get().clearAuth();\n          return;\n        }\n\n        try {\n          // Add timeout to refresh request\n          const controller = new AbortController();\n          const timeoutId = setTimeout(() => controller.abort(), 10000); // 10s timeout\n          \n          const response = await authService.refreshToken(refreshToken);\n          clearTimeout(timeoutId);\n          \n          set({\n            accessToken: response.tokens.accessToken,\n            refreshToken: response.tokens.refreshToken,\n          });\n          \n          if (import.meta.env?.DEV) {\n            console.log('Token refresh successful');\n          }\n        } catch (error: any) {\n          console.warn('Token refresh failed:', error.message || error);\n          \n          // Only clear auth on explicit auth failures, not network issues\n          if (error.response?.status === 401 || error.response?.status === 403 || \n              error.message?.includes('Invalid refresh token')) {\n            console.warn('Refresh token is invalid, clearing auth state');\n            get().clearAuth();\n          }\n          \n          throw error;\n        }\n      },\n\n      setTokens: (accessToken: string, refreshToken: string) => {\n        set({ accessToken, refreshToken });\n      },\n\n      clearAuth: () => {\n        set({\n          user: null,\n          accessToken: null,\n          refreshToken: null,\n          isAuthenticated: false,\n        });\n      },\n\n      checkAuthStatus: async () => {\n        const state = get();\n        \n        // If no access token, not authenticated\n        if (!state.accessToken) {\n          if (state.isAuthenticated) {\n            get().clearAuth();\n          }\n          return false;\n        }\n\n        try {\n          // Try to verify the token by getting user info with timeout\n          const controller = new AbortController();\n          const timeoutId = setTimeout(() => controller.abort(), 5000); // 5s timeout\n          \n          const response = await authService.getMe();\n          clearTimeout(timeoutId);\n          \n          // Update user info if it has changed\n          if (response.user.email !== state.user?.email || \n              response.user.avatarUrl !== state.user?.avatarUrl ||\n              response.user.firstName !== state.user?.firstName ||\n              response.user.lastName !== state.user?.lastName) {\n            set({ user: response.user });\n          }\n          \n          return true;\n        } catch (error: any) {\n          // Handle network errors differently from auth errors\n          if (error.name === 'AbortError' || error.code === 'NETWORK_ERROR') {\n            console.warn('Network error during auth check, assuming valid for now:', error.message);\n            // On network errors, don't clear auth - user might be offline\n            return true;\n          }\n          \n          // Token is invalid or expired, try to refresh\n          if (state.refreshToken) {\n            try {\n              await get().refreshAuth();\n              return true;\n            } catch (refreshError: any) {\n              console.warn('Refresh token failed:', refreshError.message);\n              // Only clear auth on explicit 401/403 errors, not network issues\n              if (refreshError.response?.status === 401 || refreshError.response?.status === 403) {\n                get().clearAuth();\n                return false;\n              }\n              // For other errors (network, etc), keep auth state but return false\n              return false;\n            }\n          }\n          \n          // No refresh token available\n          console.warn('No refresh token available, clearing auth');\n          get().clearAuth();\n          return false;\n        }\n      },\n\n      updateUser: (updates: Partial<User>) => {\n        const currentUser = get().user;\n        if (currentUser) {\n          set({\n            user: {\n              ...currentUser,\n              ...updates\n            }\n          });\n        }\n      },\n    }),\n    {\n      name: 'auth-storage',\n      partialize: (state) => ({\n        user: state.user,\n        accessToken: state.accessToken,\n        refreshToken: state.refreshToken,\n        isAuthenticated: state.isAuthenticated,\n      }),\n    }\n  )\n);","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/types/coupon.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[719,722],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[719,722],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1284,1287],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1284,1287],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2389,2392],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2389,2392],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2893,2896],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2893,2896],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export type CouponType = 'percentage' | 'fixed_amount' | 'bogo' | 'free_upgrade' | 'free_service';\nexport type CouponStatus = 'draft' | 'active' | 'paused' | 'expired' | 'exhausted';\nexport type UserCouponStatus = 'available' | 'used' | 'expired' | 'revoked';\n\nexport interface Coupon {\n  id: string;\n  code: string;\n  name: string;\n  description?: string;\n  termsAndConditions?: string;\n  type: CouponType;\n  value?: number;\n  currency: string;\n  minimumSpend?: number;\n  maximumDiscount?: number;\n  \n  // Availability\n  validFrom: string;\n  validUntil?: string;\n  usageLimit?: number;\n  usageLimitPerUser: number;\n  usedCount: number;\n  \n  // Targeting\n  tierRestrictions: string[];\n  customerSegment: Record<string, any>;\n  \n  // Metadata\n  status: CouponStatus;\n  createdBy?: string;\n  createdAt: string;\n  updatedAt: string;\n  \n  // Multilingual support\n  originalLanguage?: import('./multilingual').SupportedLanguage;\n  availableLanguages?: import('./multilingual').SupportedLanguage[];\n}\n\nexport interface UserCoupon {\n  id: string;\n  userId: string;\n  couponId: string;\n  \n  // Status and tracking\n  status: UserCouponStatus;\n  qrCode: string;\n  \n  // Usage details\n  usedAt?: string;\n  usedByAdmin?: string;\n  redemptionLocation?: string;\n  redemptionDetails: Record<string, any>;\n  \n  // Assignment metadata\n  assignedBy?: string;\n  assignedReason?: string;\n  expiresAt?: string;\n  \n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface UserActiveCoupon {\n  userCouponId: string;\n  userId: string;\n  status: UserCouponStatus;\n  qrCode: string;\n  expiresAt?: string;\n  assignedAt: string;\n  \n  // Coupon details\n  couponId: string;\n  code: string;\n  name: string;\n  description?: string;\n  termsAndConditions?: string;\n  type: CouponType;\n  value?: number;\n  currency: string;\n  minimumSpend?: number;\n  maximumDiscount?: number;\n  couponExpiresAt?: string;\n  \n  // Calculated fields\n  effectiveExpiry?: string;\n  expiringSoon: boolean;\n}\n\n// API Request/Response types\nexport interface CreateCouponRequest {\n  code: string;\n  name: string;\n  description?: string;\n  termsAndConditions?: string;\n  type: CouponType;\n  value?: number;\n  currency?: string;\n  minimumSpend?: number;\n  maximumDiscount?: number;\n  validFrom?: string;\n  validUntil?: string;\n  usageLimit?: number;\n  usageLimitPerUser?: number;\n  tierRestrictions?: string[];\n  customerSegment?: Record<string, any>;\n  // Multilingual support\n  originalLanguage?: import('./multilingual').SupportedLanguage;\n}\n\nexport interface UpdateCouponRequest extends Partial<CreateCouponRequest> {\n  status?: CouponStatus;\n}\n\nexport interface AssignCouponRequest {\n  couponId: string;\n  userIds: string[];\n  assignedReason?: string;\n  customExpiry?: string;\n}\n\nexport interface RedeemCouponRequest {\n  qrCode: string;\n  originalAmount: number;\n  transactionReference?: string;\n  location?: string;\n  metadata?: Record<string, any>;\n}\n\nexport interface RedeemCouponResponse {\n  success: boolean;\n  message: string;\n  discountAmount: number;\n  finalAmount: number;\n  userCouponId?: string;\n}\n\nexport interface CouponListResponse {\n  coupons: Coupon[];\n  total: number;\n  page: number;\n  limit: number;\n  totalPages: number;\n}\n\nexport interface UserCouponListResponse {\n  coupons: UserActiveCoupon[];\n  total: number;\n  page: number;\n  limit: number;\n  totalPages: number;\n}\n\nexport interface CouponStatsResponse {\n  totalCoupons: number;\n  activeCoupons: number;\n  totalAssigned: number;\n  totalRedeemed: number;\n  totalRevenueImpact: number;\n  conversionRate: number;\n  topCoupons: Array<{\n    couponId: string;\n    name: string;\n    code: string;\n    redemptionCount: number;\n    conversionRate: number;\n  }>;\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/types/multilingual.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1690,1693],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1690,1693],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2272,2275],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2272,2275],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3764,3767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3764,3767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Multi-language support types for surveys and coupons\n\nexport type SupportedLanguage = 'th' | 'en' | 'zh-CN';\nexport type TranslationStatus = 'original' | 'translated' | 'pending' | 'error';\n\nexport interface MultilingualText {\n  th: string;\n  en: string;\n  'zh-CN': string;\n}\n\nexport interface TranslationRequest {\n  sourceLanguage: SupportedLanguage;\n  targetLanguages: SupportedLanguage[];\n  texts: string[];\n}\n\nexport interface TranslationResponse {\n  translations: {\n    [language: string]: string[];\n  };\n  originalTexts: string[];\n  sourceLanguage: string;\n}\n\n// Extended survey types with multi-language support\nexport interface MultilingualQuestionOption {\n  id: string;\n  text: MultilingualText;\n  value: string | number;\n}\n\nexport interface MultilingualSurveyQuestion {\n  id: string;\n  type: import('./survey').QuestionType;\n  text: MultilingualText;\n  description?: MultilingualText;\n  required: boolean;\n  options?: MultilingualQuestionOption[];\n  min_rating?: number;\n  max_rating?: number;\n  order: number;\n}\n\nexport interface MultilingualSurvey {\n  id: string;\n  title: MultilingualText;\n  description?: MultilingualText;\n  questions: MultilingualSurveyQuestion[];\n  target_segment: import('./survey').TargetSegment;\n  status: import('./survey').SurveyStatus;\n  access_type: import('./survey').SurveyAccessType;\n  scheduled_start?: string;\n  scheduled_end?: string;\n  created_by?: string;\n  created_at: string;\n  updated_at: string;\n  // Translation metadata\n  originalLanguage: SupportedLanguage;\n  availableLanguages: SupportedLanguage[];\n  lastTranslated?: string;\n  translationStatus: 'none' | 'pending' | 'completed' | 'error';\n  translations?: { [language: string]: any };\n}\n\n// Extended coupon types with multi-language support\nexport interface MultilingualCoupon {\n  id: string;\n  code: string;\n  name: MultilingualText;\n  description?: MultilingualText;\n  termsAndConditions?: MultilingualText;\n  type: import('./coupon').CouponType;\n  value?: number;\n  currency: string;\n  minimumSpend?: number;\n  maximumDiscount?: number;\n  \n  // Availability\n  validFrom: string;\n  validUntil?: string;\n  usageLimit?: number;\n  usageLimitPerUser: number;\n  usedCount: number;\n  \n  // Targeting\n  tierRestrictions: string[];\n  customerSegment: Record<string, any>;\n  \n  // Metadata\n  status: import('./coupon').CouponStatus;\n  createdBy?: string;\n  createdAt: string;\n  updatedAt: string;\n  \n  // Translation metadata\n  originalLanguage: SupportedLanguage;\n  availableLanguages: SupportedLanguage[];\n  lastTranslated?: string;\n  translationStatus: 'none' | 'pending' | 'completed' | 'error';\n}\n\n// Request types for creating multilingual content\nexport interface CreateMultilingualSurveyRequest {\n  title: string;\n  description?: string;\n  questions: Array<{\n    type: import('./survey').QuestionType;\n    text: string;\n    description?: string;\n    required: boolean;\n    options?: Array<{\n      text: string;\n      value: string | number;\n    }>;\n    min_rating?: number;\n    max_rating?: number;\n  }>;\n  target_segment?: import('./survey').TargetSegment;\n  access_type: import('./survey').SurveyAccessType;\n  status?: import('./survey').SurveyStatus;\n  scheduled_start?: string;\n  scheduled_end?: string;\n  originalLanguage: SupportedLanguage;\n  autoTranslate?: boolean;\n  targetLanguages?: SupportedLanguage[];\n}\n\nexport interface CreateMultilingualCouponRequest {\n  code: string;\n  name: string;\n  description?: string;\n  termsAndConditions?: string;\n  type: import('./coupon').CouponType;\n  value?: number;\n  currency?: string;\n  minimumSpend?: number;\n  maximumDiscount?: number;\n  validFrom?: string;\n  validUntil?: string;\n  usageLimit?: number;\n  usageLimitPerUser?: number;\n  tierRestrictions?: string[];\n  customerSegment?: Record<string, any>;\n  originalLanguage: SupportedLanguage;\n  autoTranslate?: boolean;\n  targetLanguages?: SupportedLanguage[];\n}\n\n// Translation service types\nexport interface TranslationServiceConfig {\n  provider: 'azure' | 'google' | 'libretranslate';\n  apiKey?: string;\n  endpoint?: string;\n  region?: string;\n}\n\nexport interface TranslationJob {\n  id: string;\n  entityType: 'survey' | 'coupon';\n  entityId: string;\n  sourceLanguage: SupportedLanguage;\n  targetLanguages: SupportedLanguage[];\n  status: 'pending' | 'processing' | 'completed' | 'failed';\n  progress: number;\n  createdAt: string;\n  completedAt?: string;\n  error?: string;\n}\n\n// UI component props\nexport interface LanguageTabsProps {\n  languages: SupportedLanguage[];\n  currentLanguage: SupportedLanguage;\n  onLanguageChange: (language: SupportedLanguage) => void;\n  translationStatus?: { [key in SupportedLanguage]?: TranslationStatus };\n  isLoading?: boolean;\n  className?: string;\n  'aria-label'?: string;\n}\n\nexport interface TranslationButtonProps {\n  onTranslate: () => void;\n  isTranslating: boolean;\n  disabled?: boolean;\n  availableLanguages: SupportedLanguage[];\n}\n\n// Helper function types\nexport type GetTextInLanguage = (\n  multilingualText: MultilingualText | string | undefined,\n  language: SupportedLanguage,\n  fallbackLanguage?: SupportedLanguage\n) => string;\n\nexport type CreateMultilingualText = (\n  originalText: string,\n  originalLanguage: SupportedLanguage\n) => MultilingualText;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/types/survey.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1426,1429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1426,1429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2425,2428],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2425,2428],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4358,4361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4358,4361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export type QuestionType = 'multiple_choice' | 'single_choice' | 'text' | 'textarea' | 'rating_5' | 'rating_10' | 'yes_no';\nexport type SurveyStatus = 'draft' | 'active' | 'paused' | 'completed' | 'archived';\nexport type SurveyAccessType = 'invite_only' | 'public';\nexport type InvitationStatus = 'pending' | 'sent' | 'viewed' | 'started' | 'completed' | 'expired';\n\nexport interface QuestionOption {\n  id: string;\n  text: string;\n  value: string | number;\n}\n\nexport interface SurveyQuestion {\n  id: string;\n  type: QuestionType;\n  text: string;\n  description?: string;\n  required: boolean;\n  options?: QuestionOption[];\n  min_rating?: number;\n  max_rating?: number;\n  order: number;\n}\n\nexport interface TargetSegment {\n  tier_restrictions?: string[];\n  min_points?: number;\n  max_points?: number;\n  registration_after?: string;\n  registration_before?: string;\n  oauth_providers?: string[];\n  exclude_users?: string[];\n}\n\nexport interface Survey {\n  id: string;\n  title: string;\n  description?: string;\n  questions: SurveyQuestion[];\n  target_segment: TargetSegment;\n  status: SurveyStatus;\n  access_type: SurveyAccessType;\n  scheduled_start?: string;\n  scheduled_end?: string;\n  created_by?: string;\n  created_at: string;\n  updated_at: string;\n  original_language?: string;\n  available_languages?: string[];\n}\n\nexport interface SurveyResponse {\n  id: string;\n  survey_id: string;\n  user_id: string;\n  answers: Record<string, any>;\n  is_completed: boolean;\n  progress: number;\n  started_at: string;\n  completed_at?: string;\n  created_at: string;\n  updated_at: string;\n  user_email?: string;\n  user_first_name?: string;\n  user_last_name?: string;\n}\n\nexport interface SurveyInvitation {\n  id: string;\n  survey_id: string;\n  user_id: string;\n  status: InvitationStatus;\n  sent_at?: string;\n  viewed_at?: string;\n  expires_at?: string;\n  created_at: string;\n  updated_at: string;\n}\n\n// API Request/Response types\nexport interface CreateSurveyRequest {\n  title: string;\n  description?: string;\n  questions: SurveyQuestion[];\n  target_segment?: TargetSegment;\n  access_type: SurveyAccessType;\n  status?: SurveyStatus;\n  scheduled_start?: string;\n  scheduled_end?: string;\n  original_language?: string;\n  available_languages?: string[];\n}\n\nexport interface UpdateSurveyRequest extends Partial<CreateSurveyRequest> {\n  status?: SurveyStatus;\n}\n\nexport interface SubmitResponseRequest {\n  survey_id: string;\n  answers: Record<string, any>;\n  is_completed?: boolean;\n}\n\nexport interface SurveyListResponse {\n  surveys: Survey[];\n  pagination: {\n    total: number;\n    page: number;\n    limit: number;\n    totalPages: number;\n  };\n}\n\nexport interface SurveyResponseListResponse {\n  responses: SurveyResponse[];\n  pagination: {\n    total: number;\n    page: number;\n    limit: number;\n    totalPages: number;\n  };\n}\n\nexport interface SurveyAnalytics {\n  survey: Survey;\n  responses: SurveyResponse[];\n  totalResponses: number;\n  completionRate: number;\n  averageCompletionTime: number;\n  responsesByDate: { date: string; count: number }[];\n  questionAnalytics: {\n    questionId: string;\n    question: string;\n    type: string;\n    responses: Record<string, number>;\n    averageRating?: number;\n  }[];\n}\n\n// Survey Coupon Assignment types\n// Note: Coupons are always awarded on survey completion\n\nexport interface SurveyCouponAssignment {\n  id: string;\n  survey_id: string;\n  coupon_id: string;\n  is_active: boolean;\n  max_awards?: number;\n  awarded_count: number;\n  assigned_by?: string;\n  assigned_reason: string;\n  custom_expiry_days?: number;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface SurveyCouponDetails {\n  assignment_id: string;\n  survey_id: string;\n  survey_title: string;\n  survey_status: string;\n  coupon_id: string;\n  coupon_code: string;\n  coupon_name: string;\n  coupon_type: string;\n  coupon_value?: number;\n  coupon_currency: string;\n  coupon_status: string;\n  is_active: boolean;\n  max_awards?: number;\n  awarded_count: number;\n  custom_expiry_days?: number;\n  assigned_reason: string;\n  assigned_by?: string;\n  assigned_by_email?: string;\n  assigned_at: string;\n  updated_at: string;\n}\n\nexport interface SurveyRewardHistory {\n  id: string;\n  survey_coupon_assignment_id: string;\n  survey_response_id: string;\n  user_coupon_id: string;\n  user_id: string;\n  awarded_at: string;\n  award_condition_met: string;\n  metadata: Record<string, any>;\n  created_at: string;\n  // Additional display fields\n  user_email?: string;\n  user_name?: string;\n  coupon_code?: string;\n  coupon_name?: string;\n}\n\n// API Request types for survey-coupon assignments\nexport interface AssignCouponToSurveyRequest {\n  survey_id: string;\n  coupon_id: string;\n  max_awards?: number;\n  custom_expiry_days?: number;\n  assigned_reason?: string;\n}\n\nexport interface UpdateSurveyCouponAssignmentRequest {\n  max_awards?: number;\n  custom_expiry_days?: number;\n  assigned_reason?: string;\n  is_active?: boolean;\n}\n\nexport interface SurveyCouponAssignmentListResponse {\n  assignments: SurveyCouponDetails[];\n  total: number;\n  page: number;\n  limit: number;\n  totalPages: number;\n}\n\nexport interface SurveyRewardHistoryResponse {\n  rewards: SurveyRewardHistory[];\n  total: number;\n  totalPages: number;\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/utils/axiosInterceptor.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1235,1238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1235,1238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":41,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":41,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1755,1808],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":90,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":90,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3575,3627],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":100,"column":65,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":100,"endColumn":67,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[3920,4020],"text":"(config.url?.includes('/auth/') ?? \n                                config.url?.includes('/register'))"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":101,"column":67,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":101,"endColumn":69,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[4021,4023],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":105,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":105,"endColumn":23,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[4150,4226],"text":""},"desc":"Remove the console.warn()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import axios, { AxiosError, AxiosInstance, InternalAxiosRequestConfig } from 'axios';\nimport { useAuthStore } from '../store/authStore';\nimport { notify } from './notificationManager';\n\n// Track if we've already shown the session expired message\nlet sessionExpiredShown = false;\n\nexport function setupAxiosInterceptors() {\n  // Response interceptor to handle 401 errors globally\n  axios.interceptors.response.use(\n    (response) => response,\n    async (error: AxiosError) => {\n      if (error.response?.status === 401) {\n        const authStore = useAuthStore.getState();\n        const currentPath = window.location.pathname;\n        \n        // Skip if we're already on auth pages\n        const authPages = ['/login', '/register', '/reset-password', '/oauth/success'];\n        if (authPages.some(page => currentPath.startsWith(page))) {\n          return Promise.reject(error);\n        }\n\n        // Try to refresh token first - but only if we have a refresh token\n        const refreshToken = authStore.refreshToken;\n        if (refreshToken) {\n          try {\n            await authStore.refreshAuth();\n            \n            // If refresh successful, retry the original request\n            const originalRequest = error.config as any;\n            if (originalRequest && !originalRequest._retry) {\n              originalRequest._retry = true; // Prevent infinite retry loops\n              // Update the Authorization header with the new token\n              const newToken = useAuthStore.getState().accessToken;\n              if (newToken) {\n                originalRequest.headers.Authorization = `Bearer ${newToken}`;\n                return axios.request(originalRequest);\n              }\n            }\n          } catch (refreshError) {\n            console.error('Token refresh failed:', refreshError);\n          }\n        }\n\n        // Clear auth state and redirect (whether refresh failed or no refresh token)\n        authStore.clearAuth();\n        \n        // Show session expired message only once\n        if (!sessionExpiredShown) {\n          sessionExpiredShown = true;\n          notify.error('Your session has expired. Please log in again.', {\n            id: 'session-expired'\n          });\n          \n          // Reset the flag after 5 seconds\n          setTimeout(() => {\n            sessionExpiredShown = false;\n          }, 5000);\n        }\n        \n        // Force redirect to login with return URL - use window.location for immediate redirect\n        const returnUrl = currentPath + window.location.search;\n        window.location.href = `/login?returnUrl=${encodeURIComponent(returnUrl)}`;\n        \n        // Also return rejected promise to prevent further processing\n        return new Promise(() => {}); // Never resolves, preventing continued execution\n      }\n      \n      return Promise.reject(error);\n    }\n  );\n}\n\n// Helper function to add auth token to axios instances\nexport function addAuthTokenInterceptor(axiosInstance: AxiosInstance) {\n  axiosInstance.interceptors.request.use(\n    (config: InternalAxiosRequestConfig) => {\n      // Try to get token from auth store first, then fallback to localStorage\n      const authStore = useAuthStore.getState();\n      let token = authStore.accessToken;\n      \n      // Fallback to localStorage if store doesn't have token\n      if (!token) {\n        const authStorage = localStorage.getItem('auth-storage');\n        if (authStorage) {\n          try {\n            const parsedAuth = JSON.parse(authStorage);\n            token = parsedAuth.state?.accessToken;\n          } catch (error) {\n            console.error('Error parsing auth storage:', error);\n          }\n        }\n      }\n      \n      if (token) {\n        config.headers.Authorization = `Bearer ${token}`;\n      } else {\n        // If no token is available and this isn't a public endpoint,\n        // we should probably redirect to login immediately\n        const isPublicEndpoint = config.url?.includes('/auth/') || \n                                config.url?.includes('/register') ||\n                                config.url?.includes('/forgot-password');\n        \n        if (!isPublicEndpoint) {\n          console.warn('No auth token available for protected endpoint:', config.url);\n          // Don't make the request if we know it will fail\n          // Let the axios interceptor handle the redirect\n        }\n      }\n      \n      return config;\n    },\n    (error: AxiosError) => {\n      return Promise.reject(error);\n    }\n  );\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/utils/emojiUtils.ts","messages":[{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":100,"column":22,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":100,"endColumn":34},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":102,"column":19,"nodeType":"MemberExpression","endLine":102,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Emoji Avatar Utility\n * Handles emoji selection and display for user avatars\n */\n\n// Comprehensive list of person and animal emojis for profile pictures\nexport const PROFILE_EMOJIS = [\n  // Basic faces and people\n  'üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÜ', 'üòÖ', 'ü§£', 'üòÇ', 'üôÇ', 'üôÉ', \n  'üòâ', 'üòä', 'üòá', 'ü•∞', 'üòç', 'ü§©', 'üòò', 'üòó', 'üòö', 'üòô',\n  'üòã', 'üòõ', 'üòú', 'ü§™', 'üòù', 'ü§ë', 'ü§ó', 'ü§≠', 'ü§´', 'ü§î',\n  'ü§ê', 'ü§®', 'üòê', 'üòë', 'üò∂', 'üòè', 'üòí', 'üôÑ', 'üò¨', 'ü§•',\n  'üòî', 'üò™', 'ü§§', 'üò¥', 'üò∑', 'ü§í', 'ü§ï', 'ü§¢', 'ü§Æ', 'ü§ß',\n  'ü•µ', 'ü•∂', 'ü•¥', 'üòµ', 'ü§Ø', 'ü§†', 'ü•≥', 'üòé', 'ü§ì', 'üßê',\n  \n  // People and professions\n  'üë∂', 'üßí', 'üë¶', 'üëß', 'üßë', 'üë±', 'üë®', 'üßî', 'üë©', 'üßì',\n  'üë¥', 'üëµ', 'üôç', 'üôé', 'üôÖ', 'üôÜ', 'üíÅ', 'üôã', 'üôá', 'ü§¶',\n  'ü§∑', 'üëÆ', 'üïµÔ∏è', 'üíÇ', 'üë∑', 'ü§¥', 'üë∏', 'üë≥', 'üë≤', 'üßï',\n  'ü§µ', 'üë∞', 'ü§∞', 'ü§±', 'üëº', 'üéÖ', 'ü§∂', 'ü¶∏', 'ü¶π', 'üßô',\n  'üßö', 'üßõ', 'üßú', 'üßù', 'üßû', 'üßü', 'üôè',\n  \n  // People with activities and professions\n  'üßë‚Äç‚öïÔ∏è', 'üë®‚Äç‚öïÔ∏è', 'üë©‚Äç‚öïÔ∏è', 'üßë‚Äçüåæ', 'üë®‚Äçüåæ', 'üë©‚Äçüåæ', 'üßë‚Äçüç≥', 'üë®‚Äçüç≥', 'üë©‚Äçüç≥',\n  'üßë‚Äçüéì', 'üë®‚Äçüéì', 'üë©‚Äçüéì', 'üßë‚Äçüé§', 'üë®‚Äçüé§', 'üë©‚Äçüé§', 'üßë‚Äçüè´', 'üë®‚Äçüè´', 'üë©‚Äçüè´',\n  'üßë‚Äçüè≠', 'üë®‚Äçüè≠', 'üë©‚Äçüè≠', 'üßë‚Äçüíª', 'üë®‚Äçüíª', 'üë©‚Äçüíª', 'üßë‚Äçüíº', 'üë®‚Äçüíº', 'üë©‚Äçüíº',\n  'üßë‚Äçüîß', 'üë®‚Äçüîß', 'üë©‚Äçüîß', 'üßë‚Äçüî¨', 'üë®‚Äçüî¨', 'üë©‚Äçüî¨', 'üßë‚Äçüé®', 'üë®‚Äçüé®', 'üë©‚Äçüé®',\n  'üßë‚Äçüöí', 'üë®‚Äçüöí', 'üë©‚Äçüöí', 'üßë‚Äç‚úàÔ∏è', 'üë®‚Äç‚úàÔ∏è', 'üë©‚Äç‚úàÔ∏è', 'üßë‚ÄçüöÄ', 'üë®‚ÄçüöÄ', 'üë©‚ÄçüöÄ',\n  'üßë‚Äç‚öñÔ∏è', 'üë®‚Äç‚öñÔ∏è', 'üë©‚Äç‚öñÔ∏è', 'üßë‚Äçü¶±', 'üë®‚Äçü¶±', 'üë©‚Äçü¶±', 'üßë‚Äçü¶∞', 'üë®‚Äçü¶∞', 'üë©‚Äçü¶∞',\n  'üßë‚Äçü¶≥', 'üë®‚Äçü¶≥', 'üë©‚Äçü¶≥', 'üßë‚Äçü¶≤', 'üë®‚Äçü¶≤', 'üë©‚Äçü¶≤',\n  \n  // Animals - mammals\n  'üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'üêØ',\n  'ü¶Å', 'üêÆ', 'üê∑', 'üêΩ', 'üê∏', 'üêµ', 'üôà', 'üôâ', 'üôä', 'üêí',\n  'üêî', 'üêß', 'üê¶', 'üê§', 'üê£', 'üê•', 'ü¶Ü', 'ü¶Ö', 'ü¶â', 'ü¶á',\n  'üê∫', 'üêó', 'üê¥', 'ü¶Ñ', 'üêù', 'üêõ', 'ü¶ã', 'üêå', 'üêû', 'üêú',\n  'ü¶ü', 'ü¶ó', 'üï∑Ô∏è', 'üï∏Ô∏è', 'ü¶Ç', 'üê¢', 'üêç', 'ü¶é', 'ü¶ñ', 'ü¶ï',\n  \n  // Sea creatures\n  'üêô', 'ü¶ë', 'ü¶ê', 'ü¶û', 'ü¶Ä', 'üê°', 'üê†', 'üêü', 'üê¨', 'üê≥',\n  'üêã', 'ü¶à', 'üêä', 'üêÖ', 'üêÜ', 'ü¶ì', 'ü¶è', 'ü¶õ', 'üêò', 'ü¶í',\n  'ü¶ò', 'üêÉ', 'üêÇ', 'üêÑ', 'üêé', 'üêñ', 'üêè', 'üêë', 'ü¶ô', 'üêê',\n  'ü¶å', 'üêï', 'üê©', 'ü¶Æ', 'üêï‚Äçü¶∫', 'üêà', 'üêà‚Äç‚¨õ', 'üêì', 'ü¶É', 'ü¶ö',\n  'ü¶ú', 'ü¶¢', 'ü¶©', 'üïäÔ∏è', 'üêá', 'ü¶ù', 'ü¶®', 'ü¶°', 'ü¶¶', 'ü¶´',\n  'üêøÔ∏è', 'ü¶î',\n  \n  // More animals and creatures\n  'üê≤', 'üêâ', 'ü¶ï', 'ü¶ñ', 'üê≥', 'üêã', 'üê¨', 'üêü', 'üê†', 'üê°',\n  'ü¶à', 'üêô', 'ü¶ë', 'üêö', 'ü¶™', 'ü¶Ä', 'ü¶û', 'ü¶ê', 'üêå', 'ü¶ã',\n  'üêõ', 'üêú', 'üêù', 'üêû', 'ü¶ó', 'üï∑Ô∏è', 'ü¶Ç', 'üê¢', 'üêç', 'ü¶é'\n];\n\n/**\n * Get all available emoji options for user selection\n * Returns the complete list of person and animal emojis\n */\nexport function getAllEmojiOptions(): string[] {\n  return PROFILE_EMOJIS;\n}\n\n/**\n * Get a random emoji from the full collection\n */\nexport function getRandomEmoji(): string {\n  return PROFILE_EMOJIS[Math.floor(Math.random() * PROFILE_EMOJIS.length)];\n}\n\n/**\n * Check if a string is a valid emoji avatar\n */\nexport function isValidEmojiAvatar(emoji: string): boolean {\n  return PROFILE_EMOJIS.includes(emoji);\n}\n\n/**\n * Format emoji avatar for display\n * Ensures consistent sizing and fallback\n */\nexport function formatEmojiAvatar(avatar: string | null | undefined, size: 'sm' | 'md' | 'lg' | 'xl' = 'md'): {\n  emoji: string;\n  isEmoji: boolean;\n  className: string;\n} {\n  // Extract emoji from URL format (emoji:üòÄ) or use direct emoji\n  let actualEmoji = avatar;\n  if (avatar && avatar.startsWith('emoji:')) {\n    actualEmoji = avatar.replace('emoji:', '');\n  }\n  \n  const isEmoji = actualEmoji && PROFILE_EMOJIS.includes(actualEmoji);\n  \n  const sizeClasses = {\n    sm: 'text-lg', // ~18px\n    md: 'text-2xl', // ~24px  \n    lg: 'text-3xl', // ~30px\n    xl: 'text-4xl', // ~36px\n  };\n  \n  return {\n    emoji: isEmoji ? actualEmoji! : 'üë§', // Default user icon\n    isEmoji: !!isEmoji,\n    className: `${sizeClasses[size]} select-none`,\n  };\n}\n\n/**\n * Generate avatar URL for emoji (returns emoji directly for frontend use)\n * For consistency with existing avatar system\n */\nexport function generateEmojiAvatarUrl(emoji: string): string {\n  // Return the emoji directly - frontend will handle display\n  return `emoji:${emoji}`;\n}\n\n/**\n * Extract emoji from avatar URL\n */\nexport function extractEmojiFromUrl(avatarUrl: string | null | undefined): string | null {\n  if (!avatarUrl) {return null;}\n  \n  if (avatarUrl.startsWith('emoji:')) {\n    const emoji = avatarUrl.replace('emoji:', '');\n    return isValidEmojiAvatar(emoji) ? emoji : null;\n  }\n  \n  return null;\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/utils/notificationManager.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[123,126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[123,126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":59,"column":28,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":59,"endColumn":30,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[1810,1812],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":62,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":62,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"debug"},"fix":{"range":[1893,1983],"text":""},"desc":"Remove the console.debug()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":77,"column":28,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":77,"endColumn":30,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2267,2269],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":80,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":80,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"debug"},"fix":{"range":[2348,2436],"text":""},"desc":"Remove the console.debug()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":95,"column":28,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":95,"endColumn":30,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2717,2719],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":98,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":98,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"debug"},"fix":{"range":[2797,2884],"text":""},"desc":"Remove the console.debug()."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":113,"column":28,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":113,"endColumn":30,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[3162,3164],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":116,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":116,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"debug"},"fix":{"range":[3245,3335],"text":""},"desc":"Remove the console.debug()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import toast from 'react-hot-toast';\n\ninterface NotificationOptions {\n  duration?: number;\n  id?: string;\n  [key: string]: any;\n}\n\nclass NotificationManager {\n  private static instance: NotificationManager;\n  private activeNotifications = new Map<string, string>();\n  private notificationDebounce = new Map<string, NodeJS.Timeout>();\n  private readonly DEBOUNCE_TIME = 500; // 500ms debounce for duplicate messages\n\n  static getInstance(): NotificationManager {\n    if (!NotificationManager.instance) {\n      NotificationManager.instance = new NotificationManager();\n    }\n    return NotificationManager.instance;\n  }\n\n  private constructor() {\n    // Private constructor to ensure singleton\n  }\n\n  private generateId(type: string, message: string): string {\n    // Create a unique ID based on type and message content\n    return `${type}-${message.toLowerCase().replace(/\\s+/g, '-')}`;\n  }\n\n  private isDuplicate(id: string): boolean {\n    return this.activeNotifications.has(id) || this.notificationDebounce.has(id);\n  }\n\n  private registerNotification(id: string): void {\n    this.activeNotifications.set(id, id);\n    \n    // Set up debounce protection\n    this.notificationDebounce.set(id, setTimeout(() => {\n      this.notificationDebounce.delete(id);\n    }, this.DEBOUNCE_TIME));\n    \n    // Auto-cleanup after duration\n    setTimeout(() => {\n      this.unregisterNotification(id);\n    }, 5000); // Default 5s cleanup\n  }\n\n  private unregisterNotification(id: string): void {\n    this.activeNotifications.delete(id);\n    const debounceTimer = this.notificationDebounce.get(id);\n    if (debounceTimer) {\n      clearTimeout(debounceTimer);\n      this.notificationDebounce.delete(id);\n    }\n  }\n\n  showSuccess(message: string, options?: NotificationOptions): string | undefined {\n    const id = options?.id || this.generateId('success', message);\n    \n    if (this.isDuplicate(id)) {\n      console.debug(`[NotificationManager] Blocked duplicate success notification: ${message}`);\n      return undefined;\n    }\n\n    toast.success(message, {\n      duration: 4000,\n      ...options,\n      id,\n    });\n\n    this.registerNotification(id);\n    return id;\n  }\n\n  showError(message: string, options?: NotificationOptions): string | undefined {\n    const id = options?.id || this.generateId('error', message);\n    \n    if (this.isDuplicate(id)) {\n      console.debug(`[NotificationManager] Blocked duplicate error notification: ${message}`);\n      return undefined;\n    }\n\n    toast.error(message, {\n      duration: 4000,\n      ...options,\n      id,\n    });\n\n    this.registerNotification(id);\n    return id;\n  }\n\n  showInfo(message: string, options?: NotificationOptions): string | undefined {\n    const id = options?.id || this.generateId('info', message);\n    \n    if (this.isDuplicate(id)) {\n      console.debug(`[NotificationManager] Blocked duplicate info notification: ${message}`);\n      return undefined;\n    }\n\n    toast(message, {\n      duration: 4000,\n      ...options,\n      id,\n    });\n\n    this.registerNotification(id);\n    return id;\n  }\n\n  showWarning(message: string, options?: NotificationOptions): string | undefined {\n    const id = options?.id || this.generateId('warning', message);\n    \n    if (this.isDuplicate(id)) {\n      console.debug(`[NotificationManager] Blocked duplicate warning notification: ${message}`);\n      return undefined;\n    }\n\n    toast(message, {\n      duration: 4000,\n      icon: '‚ö†Ô∏è',\n      ...options,\n      id,\n    });\n\n    this.registerNotification(id);\n    return id;\n  }\n\n  dismiss(id: string): void {\n    if (this.activeNotifications.has(id)) {\n      toast.dismiss(id);\n      this.unregisterNotification(id);\n    }\n  }\n\n  dismissAll(): void {\n    this.activeNotifications.forEach((_, id) => {\n      toast.dismiss(id);\n    });\n    this.activeNotifications.clear();\n    this.notificationDebounce.forEach(timer => clearTimeout(timer));\n    this.notificationDebounce.clear();\n  }\n\n  // Get count of active notifications\n  getActiveCount(): number {\n    return this.activeNotifications.size;\n  }\n\n  // Check if a specific notification is active\n  isActive(id: string): boolean {\n    return this.activeNotifications.has(id);\n  }\n}\n\n// Export singleton instance\nexport const notificationManager = NotificationManager.getInstance();\n\n// Export convenience functions\nexport const notify = {\n  success: (message: string, options?: NotificationOptions) => \n    notificationManager.showSuccess(message, options),\n  error: (message: string, options?: NotificationOptions) => \n    notificationManager.showError(message, options),\n  info: (message: string, options?: NotificationOptions) => \n    notificationManager.showInfo(message, options),\n  warning: (message: string, options?: NotificationOptions) => \n    notificationManager.showWarning(message, options),\n  dismiss: (id: string) => \n    notificationManager.dismiss(id),\n  dismissAll: () => \n    notificationManager.dismissAll(),\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/utils/translationHelpers.ts","messages":[{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":18,"column":7,"nodeType":"MemberExpression","endLine":18,"endColumn":33},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":19,"column":12,"nodeType":"MemberExpression","endLine":19,"endColumn":38},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":23,"column":7,"nodeType":"MemberExpression","endLine":23,"endColumn":41},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":24,"column":12,"nodeType":"MemberExpression","endLine":24,"endColumn":46},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":30,"column":9,"nodeType":"MemberExpression","endLine":30,"endColumn":31},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":31,"column":14,"nodeType":"MemberExpression","endLine":31,"endColumn":36},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":46,"column":3,"nodeType":"MemberExpression","endLine":46,"endColumn":27},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":52,"column":7,"nodeType":"MemberExpression","endLine":52,"endColumn":19},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":86,"column":13,"nodeType":"MemberExpression","endLine":86,"endColumn":39},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":86,"column":43,"nodeType":"MemberExpression","endLine":86,"endColumn":69},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":105,"column":9,"nodeType":"MemberExpression","endLine":105,"endColumn":31},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":105,"column":35,"nodeType":"MemberExpression","endLine":105,"endColumn":57},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":8,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":11,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4322,4325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4322,4325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":166,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4473,4476],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4473,4476],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":168,"column":11,"nodeType":"MemberExpression","endLine":168,"endColumn":22},{"ruleId":"security/detect-object-injection","severity":1,"message":"Function Call Object Injection Sink","line":169,"column":40,"nodeType":"MemberExpression","endLine":169,"endColumn":51},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":190,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5010,5013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5010,5013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":195,"column":4,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":195,"endColumn":7,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5143,5146],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5143,5146],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":198,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":198,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5214,5217],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5214,5217],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":202,"column":11,"nodeType":"MemberExpression","endLine":202,"endColumn":22},{"ruleId":"security/detect-object-injection","severity":1,"message":"Variable Assigned to Object Injection Sink","line":203,"column":29,"nodeType":"MemberExpression","endLine":203,"endColumn":40},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":207,"column":11,"nodeType":"MemberExpression","endLine":207,"endColumn":24},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":208,"column":11,"nodeType":"MemberExpression","endLine":208,"endColumn":40},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":208,"column":11,"nodeType":"MemberExpression","endLine":208,"endColumn":24},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":208,"column":43,"nodeType":"MemberExpression","endLine":208,"endColumn":73},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":211,"column":11,"nodeType":"MemberExpression","endLine":211,"endColumn":24},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":213,"column":31,"nodeType":"MemberExpression","endLine":213,"endColumn":61},{"ruleId":"security/detect-object-injection","severity":1,"message":"Generic Object Injection Sink","line":240,"column":10,"nodeType":"MemberExpression","endLine":240,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":28,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { MultilingualText, SupportedLanguage } from '../types/multilingual';\n\n/**\n * Get text in specified language with fallback\n */\nexport const getTextInLanguage = (\n  multilingualText: MultilingualText | string | undefined,\n  language: SupportedLanguage,\n  fallbackLanguage: SupportedLanguage = 'en'\n): string => {\n  if (!multilingualText) {return '';}\n  \n  if (typeof multilingualText === 'string') {\n    return multilingualText;\n  }\n  \n  // Try requested language first\n  if (multilingualText[language]) {\n    return multilingualText[language];\n  }\n  \n  // Try fallback language\n  if (multilingualText[fallbackLanguage]) {\n    return multilingualText[fallbackLanguage];\n  }\n  \n  // Try any available language\n  const availableLanguages: SupportedLanguage[] = ['th', 'en', 'zh-CN'];\n  for (const lang of availableLanguages) {\n    if (multilingualText[lang]) {\n      return multilingualText[lang];\n    }\n  }\n  \n  return '';\n};\n\n/**\n * Create multilingual text object from original text\n */\nexport const createMultilingualText = (\n  originalText: string,\n  originalLanguage: SupportedLanguage\n): MultilingualText => {\n  const result: Partial<MultilingualText> = {};\n  result[originalLanguage] = originalText;\n  \n  // Initialize other languages as empty strings\n  const allLanguages: SupportedLanguage[] = ['th', 'en', 'zh-CN'];\n  allLanguages.forEach(lang => {\n    if (lang !== originalLanguage) {\n      result[lang] = '';\n    }\n  });\n  \n  return result as MultilingualText;\n};\n\n/**\n * Update multilingual text with new translation\n */\nexport const updateMultilingualText = (\n  multilingualText: MultilingualText,\n  language: SupportedLanguage,\n  newText: string\n): MultilingualText => {\n  return {\n    ...multilingualText,\n    [language]: newText\n  };\n};\n\n/**\n * Check if multilingual text has translation for language\n */\nexport const hasTranslation = (\n  multilingualText: MultilingualText | string | undefined,\n  language: SupportedLanguage\n): boolean => {\n  if (!multilingualText) {return false;}\n  \n  if (typeof multilingualText === 'string') {\n    return true; // String text is considered available for any language\n  }\n  \n  return !!(multilingualText[language] && multilingualText[language].trim().length > 0);\n};\n\n/**\n * Get available languages from multilingual text\n */\nexport const getAvailableLanguages = (\n  multilingualText: MultilingualText | string | undefined\n): SupportedLanguage[] => {\n  if (!multilingualText) {return [];}\n  \n  if (typeof multilingualText === 'string') {\n    return ['th', 'en', 'zh-CN']; // String text is available for all languages\n  }\n  \n  const languages: SupportedLanguage[] = [];\n  const allLanguages: SupportedLanguage[] = ['th', 'en', 'zh-CN'];\n  \n  allLanguages.forEach(lang => {\n    if (multilingualText[lang] && multilingualText[lang].trim().length > 0) {\n      languages.push(lang);\n    }\n  });\n  \n  return languages;\n};\n\n/**\n * Convert legacy string text to multilingual format\n */\nexport const convertToMultilingual = (\n  text: string,\n  originalLanguage: SupportedLanguage\n): MultilingualText => {\n  return createMultilingualText(text, originalLanguage);\n};\n\n/**\n * Check if all required languages have translations\n */\nexport const isFullyTranslated = (\n  multilingualText: MultilingualText | string | undefined,\n  requiredLanguages: SupportedLanguage[]\n): boolean => {\n  if (!multilingualText) {return false;}\n  \n  if (typeof multilingualText === 'string') {\n    return requiredLanguages.length === 1; // String can only satisfy one language\n  }\n  \n  return requiredLanguages.every(lang => hasTranslation(multilingualText, lang));\n};\n\n/**\n * Get translation completion percentage\n */\nexport const getTranslationCompleteness = (\n  multilingualText: MultilingualText | string | undefined,\n  requiredLanguages: SupportedLanguage[]\n): number => {\n  if (!multilingualText || requiredLanguages.length === 0) {return 0;}\n  \n  if (typeof multilingualText === 'string') {\n    return requiredLanguages.length === 1 ? 100 : (100 / requiredLanguages.length);\n  }\n  \n  const translatedCount = requiredLanguages.filter(lang => hasTranslation(multilingualText, lang)).length;\n  return Math.round((translatedCount / requiredLanguages.length) * 100);\n};\n\n/**\n * Extract all text content that needs translation from an object\n */\nexport const extractTextForTranslation = (\n  obj: any,\n  textFields: string[],\n  currentLanguage: SupportedLanguage\n): string[] => {\n  const texts: string[] = [];\n  \n  const extractFromObject = (item: any, fields: string[]) => {\n    fields.forEach(field => {\n      if (item[field]) {\n        const text = getTextInLanguage(item[field], currentLanguage);\n        if (text && text.trim().length > 0) {\n          texts.push(text);\n        }\n      }\n    });\n  };\n  \n  if (Array.isArray(obj)) {\n    obj.forEach(item => extractFromObject(item, textFields));\n  } else {\n    extractFromObject(obj, textFields);\n  }\n  \n  return texts;\n};\n\n/**\n * Apply translations back to multilingual object\n */\nexport const applyTranslations = (\n  originalObj: any,\n  translations: string[],\n  textFields: string[],\n  targetLanguage: SupportedLanguage,\n  originalLanguage: SupportedLanguage\n): any => {\n  let translationIndex = 0;\n  \n  const applyToObject = (item: any, fields: string[]) => {\n    const result = { ...item };\n    \n    fields.forEach(field => {\n      if (item[field] && translationIndex < translations.length) {\n        const currentText = item[field];\n        \n        if (typeof currentText === 'string') {\n          // Convert to multilingual format\n          result[field] = createMultilingualText(currentText, originalLanguage);\n          result[field][targetLanguage] = translations[translationIndex];\n        } else if (currentText && typeof currentText === 'object') {\n          // Already multilingual\n          result[field] = {\n            ...currentText,\n            [targetLanguage]: translations[translationIndex]\n          };\n        }\n        \n        translationIndex++;\n      }\n    });\n    \n    return result;\n  };\n  \n  if (Array.isArray(originalObj)) {\n    return originalObj.map(item => applyToObject(item, textFields));\n  } else {\n    return applyToObject(originalObj, textFields);\n  }\n};\n\n/**\n * Get language display name\n */\nexport const getLanguageDisplayName = (language: SupportedLanguage): string => {\n  const names: { [key in SupportedLanguage]: string } = {\n    'th': '‡πÑ‡∏ó‡∏¢',\n    'en': 'English',\n    'zh-CN': '‰∏≠Êñá'\n  };\n  return names[language] || language;\n};\n\n/**\n * Validate supported language\n */\nexport const isValidLanguage = (language: string): language is SupportedLanguage => {\n  return ['th', 'en', 'zh-CN'].includes(language as SupportedLanguage);\n};\n\n/**\n * Get browser default language\n */\nexport const getBrowserLanguage = (): SupportedLanguage => {\n  const browserLang = navigator.language.toLowerCase();\n  \n  if (browserLang.startsWith('th')) {return 'th';}\n  if (browserLang.startsWith('zh')) {return 'zh-CN';}\n  return 'en'; // Default fallback\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/utils/userHelpers.ts","messages":[{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":41,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":41,"endColumn":52},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":45,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":45,"endColumn":54},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":62,"column":25,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":62,"endColumn":27,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[1668,1670],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"interface User {\n  id: string;\n  email: string;\n  role: 'customer' | 'admin' | 'super_admin';\n  firstName?: string;\n  lastName?: string;\n  avatarUrl?: string;\n  oauthProvider?: string;\n  oauthProviderId?: string;\n}\n\n/**\n * Gets a user-friendly display name from user data\n */\nexport function getUserDisplayName(user: User | null): string {\n  if (!user) {return 'Guest';}\n\n  // If we have first and last name, use them\n  if (user.firstName && user.lastName) {\n    return `${user.firstName} ${user.lastName}`;\n  }\n\n  // If we only have first name, use it\n  if (user.firstName) {\n    return user.firstName;\n  }\n\n  // If we only have last name, use it\n  if (user.lastName) {\n    return user.lastName;\n  }\n\n  // For OAuth users, try to extract name from email\n  if (user.oauthProvider) {\n    switch (user.oauthProvider) {\n      case 'line':\n        // For LINE users, show \"LINE User\" instead of the generated email\n        return 'LINE User';\n      case 'google':\n        // For Google users, try to extract name from email before @\n        const emailPart = user.email.split('@')[0];\n        return emailPart.replace(/[._]/g, ' ');\n      case 'facebook':\n        // For Facebook users, similar logic\n        const fbEmailPart = user.email.split('@')[0];\n        return fbEmailPart.replace(/[._]/g, ' ');\n      default:\n        break;\n    }\n  }\n\n  // Fallback to email username part\n  const emailUsername = user.email.split('@')[0];\n  return emailUsername.replace(/[._]/g, ' ');\n}\n\n/**\n * Gets a user avatar URL or returns null for default avatar\n */\nexport function getUserAvatarUrl(user: User | null): string | null {\n  if (!user) {return null;}\n  return user.avatarUrl || null;\n}\n\n/**\n * Checks if user is an OAuth user\n */\nexport function isOAuthUser(user: User | null): boolean {\n  return !!(user?.oauthProvider);\n}\n\n/**\n * Gets the OAuth provider display name\n */\nexport function getOAuthProviderName(user: User | null): string | null {\n  if (!user?.oauthProvider) {return null;}\n  \n  switch (user.oauthProvider) {\n    case 'google':\n      return 'Google';\n    case 'facebook':\n      return 'Facebook';\n    case 'line':\n      return 'LINE';\n    default:\n      return user.oauthProvider;\n  }\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/nut/loyalty-app/frontend/src/vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]}]
